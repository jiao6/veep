import "dart:html";import "dart:html" as ZB;import "dart:collection";import "dart:math";import "dart:math" as DD;import "dart:async";import "dart:typed_data";abstract class PL{l IM(final String g);List<l> TO(final String g);l tH(final l g,final l h);String XD(final l g);String kI(final l g);String HM(final l g);String RO(final l g);List<String> lK(final l g);List<String> cM(final l g);bool UO(final l g,final String h);List<String> rO();String iG(final String g);String LE();List<l> MD();List<l> FI();bool EI(final l g,final l h);bool nD(final l g,final l h);List<l> bC(final l g);String cD(final l g,final bool h,final bool i);List<l> iC(final l g);List<l> iE(final l g);String attributeName(final l g);String attributeNamespace(final l g);String oH(final l g);String eK(final String g);bool GO(final l g,final l h);List<String> gI(final l g);List<String> OP(final l g);String uF(final l g);HO(final l g,final String h);bool RE(final l g);}class YL implements PL{HashMap<String,String> gY;l hY;HashMap<String,l> iY;HashMap<l,String> jY;YL(l g,HashMap<String,String> h){hY=g;gY=h;kY();}l IM(final String g){return (iY[g]);}List<l> TO(final String g){return ([iY[g]]);}l tH(final l g,final l i){String h;if(g.EC==null)h=g.nodeName;else h=g.localName;return (IM(h));}String XD(final l g){return (jY[g]);}String kI(final l g){return (null);}String HM(final l g){return (null);}String RO(final l g){return (null);}List<String> lK(final l g){return (null);}List<String> cM(final l g){return (null);}bool UO(final l g,final String h){return (true);}List<String> rO(){return (null);}String iG(final String g){return (null);}String LE(){return (null);}List<l> MD(){return (new List.from(jY.keys));}List<l> FI(){return (MD());}bool EI(final l g,final l h){return (false);}bool nD(final l g,final l h){return (true);}List<l> bC(final l j){final List<l> h=new List<l>();final List<BB> k=j.getElementsByTagName('SOUS-ELEMENT');for(int g=0;g<k.length;g++ ){final l v=k[g] as l;h.add(iY[v.getAttribute('element')]);}final List<BB> m=j.getElementsByTagName('SOUS-ENSEMBLE');for(int g=0;g<m.length;g++ ){final l DB=m[g] as l;final String FB=DB.getAttribute('ensemble');final List<BB> o=hY.getElementsByTagName('ENSEMBLE');for(int i=0;i<o.length;i++ ){final l t=o[i] as l;if(FB==t.getAttribute('nom'))h.addAll(bC(t));}}return (h);}String cD(final l m,final bool k,final bool o){final List<l> j=bC(m);final StringBuffer g=new StringBuffer();final int i=j.length;for(int h=0;h<i;h++ ){if(h!=0)g.write('|');if(k)g.write(lY(j[h]));else g.write(XD(j[h]));if(!k)g.write(',');}if(i!=0){String i=g.toString();g.clear();g.write('(');g.write(i);g.write(')*');}return (g.toString());}List<l> iC(final l j){final List<l> i=new List<l>();if(j.nodeName=='ELEMENT'){final List<BB> k=hY.getElementsByTagName('SOUS-ELEMENT');for(int h=0;h<k.length;h++ ){final l m=k[h] as l;if(m.getAttribute('element')==j.getAttribute('nom')){final l g=m.parentNode as l;if(g.nodeName=='ELEMENT')i.add(g);else if(g.nodeName=='ENSEMBLE')i.addAll(iC(g));}}}else if(j.nodeName=='ENSEMBLE'){final String v=j.getAttribute('nom');final List<BB> o=hY.getElementsByTagName('SOUS-ENSEMBLE');for(int h=0;h<o.length;h++ ){final l t=o[h] as l;if(t.getAttribute('ensemble')==v){final l g=t.parentNode as l;if(g.nodeName=='ELEMENT')i.add(g);else if(g.nodeName=='ENSEMBLE')i.addAll(iC(g));}}}return (i);}List<l> iE(final l h){final List<BB> i=h.getElementsByTagName('ATTRIBUT');final List<l> g=new List<l>();for(BB j in i)g.add(j as l);return (g);}String attributeName(final l g){return (g.getAttribute('nom'));}String attributeNamespace(final l g){return (null);}String oH(final l g){return (null);}String eK(final String g){return (null);}bool GO(final l i,final l g){final String h=g.getAttribute('presence');return (h=='obligatoire');}List<String> gI(final l j){final List<BB> g=j.getElementsByTagName('VALEUR');if(g.length==0)return (null);final List<String> i=new List<String>();for(int h=0;h<g.length;h++ ){final l k=g[h] as l;final String m=k.firstChild.nodeValue.trim();i.add(m);}return (i);}List<String> OP(final l g){return (null);}String uF(final l g){return (null);}HO(final l h,final String g){final String j=h.getAttribute('presence');bool k=(j=='obligatoire');if((g==null||g=='')&&k)return (false);final List<String> i=gI(h);if(i!=null)return (i.contains(g));return (true);}bool RE(final l g){final String h=g.getAttribute('texte');return (h=='autorise');}void kY(){iY=new HashMap<String,l>();jY=new HashMap<l,String>();final List<BB> i=hY.getElementsByTagName('ELEMENT');for(int g=0;g<i.length;g++ ){final l h=i[g] as l;final String j=h.getAttribute('nom');iY[j]=h;jY[h]=j;}}String lY(final l h){String g=jY[h];if(gY[g]!=null)return (gY[g]);else return (g);}}class LB{static String tJ="packages/daxe/LocalStrings";static HashMap<String,String> KN=null;static String ZL;static const xP='en';static Future<bool> gT(){Completer<bool> g=new Completer<bool>();pT().then((String h){if(h!=null)ZL=h;else ZL=xP;String i=ZL.split('_')[0];String j="${tJ}_${i}.properties";yP(j,g);});return (g.future);}static String MB(String g){return (KN[g]);}static void yP(String i,Completer<bool> h){HttpRequest g=new HttpRequest();g.open("GET",i);g.onLoad.listen((ProgressEvent k){if(g.status==404){String m=xP.split('_')[0];String j="${tJ}_${m}.properties";if(i==j)h.completeError("Error when reading the strings in ${tJ}");else yP(j,h);}else if(g.status!=200){h.completeError("Error when reading the strings in ${tJ}");}else{hT(g.responseText);h.complete(true);}});g.onError.listen((ProgressEvent k){h.completeError("Error when reading the strings in ${tJ}");});g.send();}static void hT(String i){KN=new HashMap<String,String>();List<String> j=i.split("\n");for(String g in j){if(g.startsWith('#'))continue;int h=g.indexOf('=');if(h==-1)continue;String k=g.substring(0,h).trim();String m=g.substring(h+1).trim();KN[k]=m;}}}class bS{static String cS(List<int> g,{bool urlSafe: false,bool addLineSeparator: false}){return VS.dS(g,urlSafe,addLineSeparator);}}abstract class VS{static const int gM=61;static const int WS=13;static const int XS=10;static const int YS=76;static const String ZS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";static const String aS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";static String dS(List<int> k,[bool KB=false,bool DB=false]){int o=k.length;if(o==0){return "";}final String j=KB?aS:ZS;final int t=o.remainder(3);final int QB=o-t;int v=((o~/3)*4)+((t>0)?4:0);if(DB){v+= ((v-1)~/YS)<<1;}List<int> g=new List<int>(v);int h=0,m=0,FB=0;while(m<QB){int i=((k[m++ ]<<16)&0xFFFFFF)|((k[m++ ]<<8)&0xFFFFFF)|k[m++ ];g[h++ ]=j.codeUnitAt(i>>18);g[h++ ]=j.codeUnitAt((i>>12)&0x3F);g[h++ ]=j.codeUnitAt((i>>6)&0x3F);g[h++ ]=j.codeUnitAt(i&0x3f);if(DB&& ++FB==19&&h<v-2){g[h++ ]=WS;g[h++ ]=XS;FB=0;}}if(t==1){int i=k[m];g[h++ ]=j.codeUnitAt(i>>2);g[h++ ]=j.codeUnitAt((i<<4)&0x3F);g[h++ ]=gM;g[h++ ]=gM;}else if(t==2){int i=k[m];int HB=k[m+1];g[h++ ]=j.codeUnitAt(i>>2);g[h++ ]=j.codeUnitAt(((i<<4)|(HB>>4))&0x3F);g[h++ ]=j.codeUnitAt((HB<<2)&0x3F);g[h++ ]=gM;}return new String.fromCharCodes(g);}}typedef void kD();mM IB;HL s;Map<String,kD> YP=new Map<String,kD>();void uS(){pD.tS();LB.gT().then((bool g){vS();}).catchError((h){ZB.document.body.appendText('Error when loading the strings in LocalStrings_en.properties.');});}Future vS(){Completer i=new Completer();s=new HL();IB=new mM();String k=null;String h=null;String m=null;Location o=ZB.window.location;String j=o.search;if(j.startsWith('?'))j=j.substring(1);List<String> t=j.split('&');for(String v in t){List<String> g=v.split('=');if(g.length!=2)continue;if(g[0]=='config')h=g[1];else if(g[0]=='file')k=Uri.decodeComponent(g[1]);else if(g[0]=='save')m=g[1];}if(m!=null)s.bJ=m;if(h!=null&&k!=null)IB.wO(k,h).then((DB)=>i.complete());else if(h!=null)IB.sO(h).then((DB)=>i.complete());else{ZB.window.alert(LB.MB('daxe.missing_config'));i.completeError(LB.MB('daxe.missing_config'));}return (i.future);}class hM{n RF;l AB;List<l> uG;HashMap<l,FE> controls;HashMap<iB,TextInputElement> wI;kD okfct;hM(this.RF,[this.okfct]){AB=RF.AB;controls=new HashMap<l,FE>();wI=null;}void show(){DivElement t=new DivElement();t.id='attributes_dlg';t.classes.add('dlg1');DivElement SB=new DivElement();SB.classes.add('dlg2');DivElement v=new DivElement();v.classes.add('dlg3');DivElement m=new DivElement();m.classes.add('dlgtitle');m.text=s.CB.YD(AB);v.append(m);FormElement bB=new FormElement();TableElement jB=new TableElement();uG=s.CB.iE(AB);FE DB=null;for(l h in uG){TableRowElement i=new TableRowElement();TableCellElement g=new TableCellElement();String wC=s.CB.oH(AB,h);if(wC!=null){ButtonElement j=new ButtonElement();j.attributes['type']='button';j.classes.add('help');j.value='?';j.text='?';j.title=wC;j.onClick.listen((Event yB)=>fO(h,AB));g.append(j);}i.append(g);g=new TableCellElement();String VG=s.CB.fK(AB,h);String m=s.CB.GM(AB,h);g.appendText(m);if(s.CB.vK(AB,h))g.classes.add('required');else g.classes.add('optional');i.append(g);g=new TableCellElement();String FB=RF.getAttribute(VG);String KD=s.CB.uF(h);if(FB==null){if(KD!=null)FB=KD;else FB='';}FE HC=new FE.HY(AB,h,FB);controls[h]=HC;List<String> YE=s.CB.gI(h);if(YE==null||YE.length==0)if(DB==null)DB=HC;g.append(HC.UB());i.append(g);jB.append(i);}for(iB o in RF.attributes){bool HF=false;for(l h in controls.keys){if(o.localName==s.CB.attributeName(h)&&o.tB==s.CB.attributeNamespace(h)){HF=true;break;}}if(!HF){if(wI==null)wI=new HashMap<iB,TextInputElement>();TextInputElement k=new TextInputElement();k.spellcheck=false;k.size=40;k.value=o.value;k.classes.add('invalid');wI[o]=k;TableRowElement i=new TableRowElement();TableCellElement g=new TableCellElement();i.append(g);g=new TableCellElement();g.appendText(o.name);i.append(g);g=new TableCellElement();g.append(k);i.append(g);jB.append(i);}}bB.append(jB);DivElement HB=new DivElement();HB.classes.add('buttons');ButtonElement KB=new ButtonElement();KB.attributes['type']='button';KB.appendText(LB.MB("button.Cancel"));KB.onClick.listen((MouseEvent yB)=>cancel());HB.append(KB);ButtonElement QB=new ButtonElement();QB.attributes['type']='submit';QB.appendText(LB.MB("button.OK"));QB.onClick.listen((MouseEvent yB)=>UF(yB));HB.append(QB);bB.append(HB);v.append(bB);SB.append(v);t.append(SB);ZB.document.body.append(t);if(DB!=null)DB.focus();}void UF(MouseEvent v){for(l h in controls.keys){FE k=controls[h];String g=k.wF();bool FB=s.CB.vK(AB,h);if(g==''&&FB){v.preventDefault();ZB.window.alert(LB.MB('attribute.missing_required'));return;}}LinkedHashMap<String,iB> j=RF.SR();for(l h in controls.keys){FE k=controls[h];String i=s.CB.fK(AB,h);String g=k.wF();String m=s.CB.attributeNamespace(h);String o=s.CB.uF(h);if((g==''&&o==null)||g==o)j.remove(i);else if(g!=''||o!=null)j[i]=new iB.lW(m,i,g);}if(wI!=null){for(iB t in wI.keys){TextInputElement HB=wI[t];String i=t.name;String g=HB.value;String m=t.tB;if(g=='')j.remove(i);else j[i]=new iB.lW(m,i,g);}}ZB.querySelector('div#attributes_dlg').remove();v.preventDefault();List<iB> DB=new List.from(j.values);if(RF.DC()!=null){GB KB=new GB.BX(RF,DB);s.KC(KB);}else{RF.attributes=DB;}IB.gG();if(okfct!=null)okfct();}void cancel(){ZB.querySelector('div#attributes_dlg').remove();IB.gG();}void fO(l g,l h){EH i=new EH.fW(g,h);i.show();}}class GH{static final String VP="string";l mY;String ZM;String nY;HashMap<String,l> oY;HashMap<l,String> pY;HashMap<l,String> qY;HashMap<l,Pattern> rY=null;HashMap<l,Pattern> sY=null;HashMap<l,HashMap<String,List<String>>> tY=null;List<String> uY=null;PL vY;l wY;l xY;l yY;l zY;l AZ;List<l> BZ;GH(){}Future load(final String h){Completer g=new Completer();if(h==null){mY=null;return (new Future.error(new RD("Config.load: null path")));}gH t=new gH();t.xO(h).then((AC i){String m;if(i.documentElement.nodeName=="CONFIG_JAXE")m=null;else m=CZ(i.documentElement);nY=wS(h);mY=i.documentElement;DZ();qY=new HashMap<l,String>();final String j=BW();if(j==null){final l o=SC(EZ(),"SCHEMA_SIMPLE");if(o==null){g.completeError(new RD("Error: no XML schema is defined in the config file ${h}"));return;}vY=new YL(o,FZ());ZM=null;GZ();g.complete();return;}if(nY!=null)ZM="${nY}/${j}";else ZM=j;vY=new vB(FZ());(vY as vB).load(ZM).then((v){GZ();g.complete();},onError:(lF k){g.completeError(new RD("Error reading schemaURL: ${k}"));});},onError:(eD k){g.completeError(new RD("Error reading ${h}: ${k}"));});return (g.future);}static String wS(final String g){final int h=g.lastIndexOf("/");if(h>=0){return (g.substring(0,h));}return (null);}List<l> FI(){final List<l> h=new List<l>();final List<l> j=vY.FI();l g=SC(EZ(),"RACINE");while(g!=null){final String k=g.getAttribute("element");for(final l i in j)if(k==vY.XD(i))h.add(i);g=lD(g,"RACINE");}return (h);}void CO(final n g){final List<String> o=HZ();for(final String h in o){if(h!=""){final String i=iG(h);String j;if(i!=null&&i!="")j="xmlns:${i}";else j="xmlns";g.setAttributeNS("http://www.w3.org/2000/xmlns/",j,h);}}final String k=KV();final String m=HV();if(k!=null||m!=null){g.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");if(k!=null)g.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",k);if(m!=null)g.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:noNamespaceSchemaLocation",m);}}String BW(){final l h=SC(EZ(),"FICHIER_SCHEMA");if(h==null)return (null);String g=h.getAttribute("nom");if(g=="")g=null;return (g);}HashMap<String,l> DZ(){oY=new HashMap<String,l>();if(mY==null)return (oY);l g=SC(IZ(),"AFFICHAGE_ELEMENT");while(g!=null){final String h=g.getAttribute("element");oY[h]=g;g=lD(g,"AFFICHAGE_ELEMENT");}return (oY);}l oK(String g){return oY[g];}void GZ(){pY=new HashMap<l,String>();if(mY==null)return;final List<l> i=vY.MD();for(final l g in i){final String h=vY.XD(g);if(h!=null)pY[g]=h;}}String CZ(final l h){final l g=SC(h,"FICHIERTITRES");if(g==null)return (null);return (g.getAttribute("nom"));}String KV(){final l g=SC(JZ(),"SCHEMALOCATION");if(g!=null){final String h=g.getAttribute("schemaLocation");if(h!="")return (h);}return (null);}String HV(){final l g=SC(JZ(),"SCHEMALOCATION");if(g!=null){final String h=g.getAttribute("noNamespaceSchemaLocation");if(h!="")return (h);}return (null);}String iG(final String h){if(h=="http://www.w3.org/XML/1998/namespace")return ("xml");l g=SC(JZ(),"PREFIXE_ESPACE");while(g!=null){if(h==g.getAttribute("uri"))return (g.getAttribute("prefixe"));g=lD(g,"PREFIXE_ESPACE");}return (vY.iG(h));}dB KZ(final HL v,final l QB){final String SB=QB.getAttribute("nom");String yB=zH(SB);final dB i=new dB(yB);String bB=vR(SB);if(bB!=null){i.uI=bB;}BB g=QB.firstChild;while(g!=null){IC h=null;final String o=g.nodeName;String DB=null;if(g is l){final String FB=(g as l).getAttribute("raccourci");if(FB!=null&&FB!=""){DB=FB.toUpperCase()[0];}}if(o=="MENU_INSERTION"){final l jB=g as l;final String j=jB.getAttribute("nom");final String HB=zH(j);String t=jB.getAttribute("type_noeud");if(t=="")t="element";l k;if(t=="element"){k=tH(j);if(k==null)pJ("Erreur: MENU_INSERTION: pas de référence pour '${j}' dans le schéma");}else k=null;h=new IC(HB,()=>v.oI(k,t),shortcut:DB,data:k);i.add(h);String m=jI(k);if(m!=null){h.uI=m;}}else if(o=="MENU_FONCTION"){final l KB=g as l;final String HC=KB.getAttribute("classe");final String j=KB.getAttribute("nom");final String HB=zH(j);h=new IC(HB,()=>v.tU(HC,KB),shortcut:DB);i.add(h);String m=vR(j);if(m!=null){h.uI=m;}}else if(o=="MENU"){h=KZ(v,g as l);i.add(h);}else if(o=="SEPARATEUR")i.EO();g=g.nextSibling;}return (i);}zF ZV(final HL k){final zF h=new zF();final l i=LZ();if(i!=null){l g=SC(i,"MENU");while(g!=null){final dB j=KZ(k,g);j.parent=h;h.add(j);g=lD(g,"MENU");}}return (h);}PL JV(){return (vY);}List<l> SU(){final List<l> g=vY.MD();return (g);}String XD(final l g){return (pY[g]);}l OM(final l g,final l h){return (vY.tH(g,h));}l tH(final String g){final l h=vY.IM(rM(g));return (h);}List<l> JM(final String g){return (vY.TO(rM(g)));}String kI(final l g){return (vY.kI(g));}String HM(final l h){final String g=kI(h);if(g==null)return (null);return (iG(g));}List<String> lK(final l g){final List<String> h=vY.lK(g);return (h);}bool jO(final l g,final String h){return (vY.UO(g,h));}List<String> HZ(){if(uY!=null)return (uY);final List<String> g=new List<String>();final List<String> h=vY.rO();if(h!=null)g.addAll(h);uY=g;return (g);}bool EI(final l g,final l h){return (vY.EI(g,h));}bool ZD(final l h,final l i){final List<l> g=bC(h);if(g==null)return (false);return (g.contains(i));}l SF(final l i,final List<l> j){final List<l> g=bC(i);if(g==null)return (null);for(l h in j)if(g.contains(h))return (h);return (null);}List<l> bC(final l g){return (vY.bC(g));}String MZ(final l g,final bool h,final bool i){return (vY.cD(g,h,i));}String cD(final l g){return (vY.cD(g,true,false));}bool QM(n h,final int m,final int o,final l t){if(h.nodeType==n.BG){for(n g in h.childNodes){if(g.nodeType==n.tC)return (false);}return (true);}assert(h.nodeType==n.tC);if(vY is YL)return (true);if(m<0){pJ("Config.insertionPossible: debutSelection < parent.debut");return (false);}if(vY is vB){final List<l> i=new List<l>();bool j=false;for(n g=h.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==n.tC){int k=h.aB(g);if(k<m||k>=o){if(!j&&k>=o){i.add(t);j=true;}i.add(g.AB);}}}if(!j)i.add(t);final bool v=(vY as vB).PS(h.AB,i,true);return (v);}return (false);}bool SO(final n g){if(g is CG||g is IH||g is DG)return (true);if(g.AB==null)return (false);if(!YU(g))return (false);if(g.parent!=null&&g.parent.AB!=null&&!ZD(g.parent.AB,g.AB))return (false);if(g.firstChild==null&&!jO(g.AB,''))return (false);else if(g.childNodes.length==1&&g.firstChild is OB&&g.firstChild.nodeValue!=null&&!jO(g.AB,g.firstChild.nodeValue))return (false);if(vY is YL)return (true);if(vY is vB){final List<l> v=new List<l>();bool j=false;for(n i=g.firstChild;i!=null;i=i.nextSibling){if(i.nodeType==n.tC&&i.AB!=null){v.add(i.AB);}else if(i.nodeType==n.qB){if(i.nodeValue.trim()!="")j=true;}else if(i is DG){if(i.firstChild!=null&&i.firstChild.nodeValue.trim()!='')j=true;}}if(j&&!vY.RE(g.AB))return (false);final vB DB=vY as vB;return (DB.PS(g.AB,v,false));}final l k=g.AB;final StringBuffer o=new StringBuffer();if(sY==null)sY=new HashMap<l,Pattern>();bool j=false;n h=g.firstChild;while(h!=null){if(h is DG){if(h.firstChild!=null&&h.firstChild.nodeValue.trim()!='')j=true;}else if(h.nodeType==n.tC&&h is!CG&&h is!IH){o.write(h.localName);o.write(",");}else if(h.nodeType==n.qB){if(h.nodeValue.trim()!='')j=true;}h=h.nextSibling;}if(j&&!vY.RE(k))return (false);RegExp m=sY[k];if(m==null){final String t=MZ(k,false,true);if(t==null||t=="")return (true);try {m=new RegExp(r"^$expr$");}on Exception catch (FB){pJ("elementValide(JaxeElement, bool, List<String>) - Malformed Pattern: ^${t}\$:",FB);return (true);}sY[k]=m;}final bool HB=m.hasMatch(o.toString());return (HB);}bool YU(final n h){if(h.nodeType!=n.tC){pJ("Config.attributsValides : ce n'est pas un élément: ${h}");return (false);}final List<l> m=iE(h.AB);List<String> i=new List<String>(m.length);List<String> DB=new List<String>(i.length);for(int g=0;g<m.length;g++ ){final l j=m[g];i[g]=attributeName(j);DB[g]=attributeNamespace(j);final String o=h.getAttribute(i[g]);if(o==null||o==''){if(vK(h.AB,j))return (false);}else if(!OS(j,o))return (false);}final List<iB> FB=h.attributes;for(int g=0;g<FB.length;g++ ){iB t=FB[g];final String v=t.EC;if(v=="xml"||v=="xmlns")continue;final String HB=t.localName;if(v==null&&HB=="xmlns")continue;final String KB=t.tB;if(KB=="http://www.w3.org/2001/XMLSchema-instance")continue;bool QB=false;for(int k=0;k<i.length;k++ ){if(i[k]==HB&&DB[k]==KB){QB=true;break;}}if(!QB)return (false);}return (true);}List<l> iC(final l g){return (vY.iC(g));}bool RE(final l g){if(g==null)return (true);return (vY.RE(g));}List<l> iE(final l g){return (vY.iE(g));}String attributeName(final l g){return (vY.attributeName(g));}String fK(final l j,final l g){String h=vY.attributeName(g);String k=vY.attributeNamespace(g);if(k!=null){String i=BR(j,g);if(i!=null)h="${i}:${h}";}return (h);}String attributeNamespace(final l g){return (vY.attributeNamespace(g));}String BR(final l i,final l j){final String g=attributeNamespace(j);if(g==null)return (null);if(g=="http://www.w3.org/XML/1998/namespace")return ("xml");if(g=="http://www.w3.org/2000/xmlns/"&&attributeName(j)!="xmlns")return ("xmlns");String h=i.oO(g);if(h==null){if(i.ownerDocument.documentElement!=null)h=i.ownerDocument.oO(g);else h=iG(g);}return (h);}String eK(final String g){return (vY.eK(g));}bool vK(final l g,final l h){return (vY.GO(g,h));}List<String> gI(final l g){final List<String> h=vY.gI(g);return (h);}String uF(final l g){return (vY.uF(g));}bool OS(final l g,final String h){return (vY.HO(g,h));}static String rM(final String g){if(g==null)return (null);final int h=g.indexOf(':');if(h==-1)return (g);return (g.substring(h+1));}String zR(final l k,final String i,final int h){if(h==BB.zE){final l j=oK(rM(i));if(j==null)return (VP);return (j.getAttribute("type"));}else if(h==BB.DK){l g=SC(IZ(),"PLUGIN_INSTRUCTION");while(g!=null){if(i!=null&&i==g.getAttribute("cible"))return ("plugin");g=lD(g,"PLUGIN_INSTRUCTION");}return ("instruction");}else if(h==BB.EK){final l g=SC(IZ(),"PLUGIN_COMMENTAIRE");if(g!=null)return ("plugin");return ("commentaire");}else if(h==BB.CK){final l g=SC(IZ(),"PLUGIN_CDATA");if(g!=null)return ("plugin");return ("cdata");}else if(h==BB.nF){return ("texte");}return (null);}String QO(final l h){final l g=oK(XD(h));if(g==null)return (VP);return (g.getAttribute("type"));}l XO(final String h){if(mY==null)return (null);l g=SC(IZ(),"AFFICHAGE_ELEMENT");while(g!=null){if(h==g.getAttribute("type"))return (tH(g.getAttribute("element")));g=lD(g,"AFFICHAGE_ELEMENT");}return (null);}List<l> yG(final String i){if(mY==null)return (null);List<l> h=new List<l>();l g=SC(IZ(),"AFFICHAGE_ELEMENT");while(g!=null){if(i==g.getAttribute("type"))h.addAll(JM(g.getAttribute("element")));g=lD(g,"AFFICHAGE_ELEMENT");}return (h);}String eC(final l g,final String h,final String i){return vO(g,"element",null,h,i);}String vO(final l i,final String j,final String k,final String m,final String o){final HashMap<String,List<String>> t=fR(i,j,k);final List<String> g=t[m];String h;if(g!=null&&g.length>0)h=g[0];else h=o;return h;}HashMap<String,List<String>> NZ(final l j){final HashMap<String,List<String>> i=new HashMap<String,List<String>>();l g=SC(j,"PARAMETRE");while(g!=null){final String k=g.getAttribute("nom");final String m=g.getAttribute("valeur");List<String> h=i[k];if(h==null){h=new List<String>();h.add(m);i[k]=h;}else h.add(m);g=lD(g,"PARAMETRE");}tY[j]=i;return (i);}HashMap<String,List<String>> AV(final l g){return (fR(g,"element",null));}HashMap<String,List<String>> fR(final l m,final String i,final String k){l g;if(i=="element")g=oK(XD(m));else if(i=="instruction"){g=null;l h=SC(IZ(),"PLUGIN_INSTRUCTION");while(h!=null){if(k!=null&&k==h.getAttribute("cible")){g=h;break;}h=lD(h,"PLUGIN_INSTRUCTION");}}else if(i=="commentaire"){final l h=SC(IZ(),"PLUGIN_COMMENTAIRE");if(h==null){g=null;}else{g=h;}}else g=null;if(g==null)return (new HashMap<String,List<String>>());if(tY==null)tY=new HashMap<l,HashMap<String,List<String>>>();HashMap<String,List<String>> j=tY[g];if(j==null)j=NZ(g);return (j);}List<String> rU(final l i){final Set<String> g=new LinkedHashSet<String>();List<String> m=vY.cM(i);if(m!=null)g.addAll(vY.cM(i));final l j=oK(XD(i));if(j!=null){l h=SC(j,"VALEUR_SUGGEREE");while(h!=null){final String k=WG(h);if(k!=null)g.add(k);h=lD(h,"VALEUR_SUGGEREE");}}if(g.length==0)return (null);else return (g.toList());}List<String> XU(final l t,final l j){final Set<String> h=new LinkedHashSet<String>();List<String> k=vY.OP(j);if(k!=null)h.addAll(k);final l m=oK(XD(t));if(m!=null){final String v=attributeName(j);l g=SC(m,"AFFICHAGE_ATTRIBUT");while(g!=null){if(g.getAttribute("attribut")==v){l i=SC(g,"VALEUR_SUGGEREE");while(i!=null){final String o=WG(i);if(o!=null)h.add(o);i=lD(i,"VALEUR_SUGGEREE");}}g=lD(g,"AFFICHAGE_ATTRIBUT");}}if(h.length==0)return (null);else return (h.toList());}List<l> OZ(){final ZE k=new ZE();final List<l> i=new List<l>();final List<l> m=PZ();for(final l g in m){final String h=g.getAttribute("langue");if(h!=""){ZE j;if(g.getAttribute("pays")=="")j=new ZE.eW(h);else j=new ZE.jW(h,g.getAttribute("pays"));if(k==j&&!i.contains(g))i.add(g);}}for(final l g in m){final String h=g.getAttribute("langue");if(h!=""){final ZE o=new ZE.jW(k.language,k.qH);ZE j;if(g.getAttribute("pays")=="")j=new ZE.eW(h);else j=new ZE.jW(h,g.getAttribute("pays"));if(o==j&&!i.contains(g))i.add(g);}}for(final l g in m){final String h=g.getAttribute("langue");if(h!=""){final ZE o=new ZE.eW(k.language);if(o==new ZE.eW(h)&&!i.contains(g))i.add(g);}}for(final l g in m){if(!i.contains(g))i.add(g);}return (i);}String zH(final String h){final List<l> m=OZ();for(final l j in m){l g=cP(j,"STRINGS_MENU");while(g!=null){if(h==g.getAttribute("menu")){final l i=SC(g,"TITRE");if(i!=null&&i.firstChild!=null){return (WG(i));}break;}g=sM(j,g,"STRINGS_MENU");}}final l k=tH(h);if(k!=null)return (YD(k));return (h);}String vR(final String j){final List<l> k=OZ();for(final l i in k){l g=cP(i,"STRINGS_MENU");while(g!=null){if(j==g.getAttribute("menu")){final l h=SC(g,"DOCUMENTATION");if(h!=null&&h.firstChild!=null){return (WG(h));}break;}g=sM(i,g,"STRINGS_MENU");}}return (null);}HashMap<String,String> FZ(){HashMap<String,String> h=new HashMap<String,String>();final List<l> m=OZ();for(final l o in m){l g=SC(o,"STRINGS_ELEMENT");while(g!=null){String i=g.getAttribute("element");if(h[i]==null){String k=i;final l j=SC(g,"TITRE");if(j!=null&&j.firstChild!=null)k=WG(j);h[i]=k;}g=lD(g,"STRINGS_ELEMENT");}}return (h);}String YD(final l i){String g=null;g=qY[i];if(g!=null)return (g);final String j=XD(i);if(j==null){pJ("Config.elementTitle : no name for ${i}");return (null);}final List<l> m=OZ();for(final l o in m){if(g==null){l h=SC(o,"STRINGS_ELEMENT");while(h!=null){if(h.getAttribute("element")==j){final l k=SC(h,"TITRE");if(k!=null&&k.firstChild!=null){g=WG(k);break;}break;}h=lD(h,"STRINGS_ELEMENT");}}}if(g==null||g=="")g=j;qY[i]=g;return (g);}String jI(final l h){if(h==null)return (null);final String j=XD(h);final List<l> k=OZ();for(final l m in k){l g=SC(m,"STRINGS_ELEMENT");while(g!=null){if(j==g.getAttribute("element")){final l i=SC(g,"DOCUMENTATION");if(i!=null&&i.firstChild!=null)return (WG(i));break;}g=lD(g,"STRINGS_ELEMENT");}}return (vY.RO(h));}static String HT(final String h){String g=h.trim();g=g.replaceAll("&","&amp;");g=g.replaceAll("<","&lt;");g=g.replaceAll(">","&gt;");g=g.replaceAll("\n","<br>");return (g);}String kK(final l k,final String i){final String m=XD(k);final List<l> o=OZ();final String t=(new ZE()).language;for(final l j in o){l h=SC(j,"STRINGS_ELEMENT");while(h!=null){if(h.getAttribute("element")==m){l g=SC(h,"TITRE_VALEUR");while(g!=null){if(g.getAttribute("valeur")==i&&g.firstChild!=null)return (WG(g));g=lD(g,"TITRE_VALEUR");}break;}h=lD(h,"STRINGS_ELEMENT");}final String v=j.getAttribute("langue");if(v==t)return (i);}return (i);}String GM(final l k,final l m){final String t=XD(k);final String i=attributeName(m);final List<l> v=OZ();for(final l DB in v){l g=SC(DB,"STRINGS_ELEMENT");while(g!=null){if(g.getAttribute("element")==t){l h=SC(g,"STRINGS_ATTRIBUT");while(h!=null){if(h.getAttribute("attribut")==i){final l j=SC(h,"TITRE");if(j!=null&&j.firstChild!=null)return (WG(j));break;}h=lD(h,"STRINGS_ATTRIBUT");}}g=lD(g,"STRINGS_ELEMENT");}}final String o=BR(k,m);if(o!=null)return ("${o}:${i}");return (i);}String gK(final l m,final l o,final String j){final String t=XD(m);final String v=attributeName(o);final List<l> DB=OZ();final String FB=(new ZE()).language;for(final l k in DB){l h=SC(k,"STRINGS_ELEMENT");while(h!=null){if(h.getAttribute("element")==t){l i=SC(h,"STRINGS_ATTRIBUT");while(i!=null){if(i.getAttribute("attribut")==v){l g=SC(i,"TITRE_VALEUR");while(g!=null){if(g.getAttribute("valeur")==j&&g.firstChild!=null)return (WG(g));g=lD(g,"TITRE_VALEUR");}break;}i=lD(i,"STRINGS_ATTRIBUT");}}h=lD(h,"STRINGS_ELEMENT");}final String HB=k.getAttribute("langue");if(HB==FB)return (j);}return (j);}String oH(final l k,final l j){final String m=XD(k);final String o=attributeName(j);final List<l> t=OZ();for(final l v in t){l g=SC(v,"STRINGS_ELEMENT");while(g!=null){if(g.getAttribute("element")==m){l h=SC(g,"STRINGS_ATTRIBUT");while(h!=null){if(h.getAttribute("attribut")==o){final l i=SC(h,"DOCUMENTATION");if(i!=null&&i.firstChild!=null)return (WG(i));break;}h=lD(h,"STRINGS_ATTRIBUT");}}g=lD(g,"STRINGS_ELEMENT");}}return (vY.oH(j));}static String WG(final BB i){final BB g=i.firstChild;if(g==null)return (null);final String h=g.nodeValue;if(h==null)return (null);return (h.trim());}l EZ(){if(wY==null){wY=SC(mY,"LANGAGE");}return wY;}l JZ(){if(xY==null){xY=SC(mY,"ENREGISTREMENT");if(xY==null){xY=mY.ownerDocument.createElement("ENREGISTREMENT");}}return xY;}l LZ(){if(yY==null){yY=SC(mY,"MENUS");if(yY==null){yY=mY.ownerDocument.createElement("MENUS");}}return yY;}l IZ(){if(zY==null){zY=SC(mY,"AFFICHAGE_NOEUDS");if(zY==null){zY=mY.ownerDocument.createElement("AFFICHAGE_NOEUDS");}}return zY;}List<l> PZ(){if(BZ==null){BZ=new List<l>();BB g=mY.firstChild;while(g!=null){if(g.nodeType==BB.zE&&g.nodeName=="STRINGS"){BZ.add(g as l);}g=g.nextSibling;}}return BZ;}static l SC(final BB g,final String h){final BB i=g.firstChild;return bP(i,h);}static l lD(final BB g,final String h){final BB i=g.nextSibling;return bP(i,h);}static l bP(BB g,final String h){if(h==null)return null;while(g!=null){if(g.nodeType==BB.zE&&h==g.nodeName){return g as l;}g=g.nextSibling;}return null;}static l cP(final BB g,final String h){return sM(g,g,h);}static l sM(final BB i,final BB j,final String k){BB g=j;BB h;while(g!=null){if(g.hasChildNodes()){g=(g.firstChild);}else if(g!=i&&null!=(h=g.nextSibling)){g=h;}else{h=null;while(g!=i){h=g.nextSibling;if(h!=null)break;g=g.parentNode;}g=h;}if(g!=i&&g!=null&&g.nodeType==BB.zE&&g.nodeName==k){return g as l;}}return null;}static void pJ(String g,[Exception h]){if(h!=null)print("Config: ${g}: ${h}");else print("Config: ${g}");}}class vD extends MapBase<String,String>{LinkedHashMap<String,String> map;vD(String h){map=new LinkedHashMap<String,String>();if(h!=null){for(String k in h.split(';')){List<String> g=k.split(':');if(g.length==2){String i=g[0].trim().toLowerCase();String j=g[1].trim().toLowerCase();if(i!=''&&j!='')map[i]=j;}}}}String operator[](String g)=>map[g];void operator[]=(String g,String h){map[g]=h;}String remove(String g){return (map.remove(g));}Iterable<String> get keys{return (map.keys);}void clear(){map.clear;}String toString(){List<String> g=new List<String>();map.forEach((String h,String i)=>g.add(h+': '+i));return (g.join('; '));}bool sU(vD g){List<String> j=keys;List<String> k=g.map.keys;return (j.every((String h)=>map[h]==g.map[h])&&k.every((String i)=>map[i]==g.map[i]));}}class FH{TextAreaElement jD;SpanElement QF;q selectionStart;q selectionEnd;List<SpanElement> MP=new List<SpanElement>();List<n> xK=new List<n>();bool visible;static const Duration jS=const Duration(milliseconds:700);Timer PP;HashMap<int,kD> zK;FH(){jD=ZB.querySelector("#tacursor");QF=ZB.querySelector("#caret");visible=true;zK=new HashMap<int,kD>();jD.onKeyUp.listen((KeyboardEvent g)=>WV(g));jD.onKeyDown.listen((KeyboardEvent g)=>VV(g));jD.onBlur.listen((Event g)=>blur(g));uO();}void JW(HashMap<String,kD> h){HashMap<String,int> g=new HashMap<String,int>();g['A']=KeyCode.A;g['B']=KeyCode.B;g['C']=KeyCode.C;g['D']=KeyCode.D;g['E']=KeyCode.E;g['F']=KeyCode.F;g['G']=KeyCode.G;g['H']=KeyCode.H;g['I']=KeyCode.I;g['J']=KeyCode.J;g['K']=KeyCode.K;g['L']=KeyCode.L;g['M']=KeyCode.M;g['N']=KeyCode.N;g['O']=KeyCode.O;g['P']=KeyCode.P;g['Q']=KeyCode.Q;g['R']=KeyCode.R;g['S']=KeyCode.S;g['T']=KeyCode.T;g['U']=KeyCode.U;g['V']=KeyCode.V;g['W']=KeyCode.W;g['X']=KeyCode.X;g['Y']=KeyCode.Y;g['Z']=KeyCode.Z;for(String i in h.keys){String j=i.toUpperCase();if(g[j]!=null)zK[g[j]]=h[i];}}static q oJ(MouseEvent h){q g=s.zG(h.client.x,h.client.y);if(g==null)return (null);g.EF();assert(g.u!=null);return (g);}void VV(KeyboardEvent h){if(selectionStart==null)return;bool i=h.ctrlKey||h.metaKey;bool j=h.shiftKey;int g=h.keyCode;if(i&&g==KeyCode.X){jD.value=JR();jD.select();}else if(i&&g==KeyCode.C){jD.value=JR();jD.select();}else if(g==KeyCode.PAGE_DOWN){iV();}else if(g==KeyCode.PAGE_UP){jV();}else if(g==KeyCode.END){XV();}else if(g==KeyCode.HOME){YV();}else if(g==KeyCode.LEFT){if(j)KW();else left();}else if(g==KeyCode.UP){TW();}else if(g==KeyCode.RIGHT){if(j)LW();else right();}else if(g==KeyCode.DOWN){qU();}else if(g==KeyCode.BACKSPACE){ZU();}else if(g==KeyCode.DELETE){PW();}else if(g==KeyCode.TAB&&!i&&!j){QW(h);}else if(i&&zK[g]!=null){h.preventDefault();return;}else if(jD.value!=''){String k=jD.value;jD.value='';s.iO(k,j);}else{return;}uO();}void WV(KeyboardEvent j){bool i=j.ctrlKey||j.metaKey;bool h=j.shiftKey;int g=j.keyCode;if(selectionStart==null)return;if(i&&!h&&g==KeyCode.Z){s.XH();jD.value='';}else if(i&&((!h&&g==KeyCode.Y)||(h&&g==KeyCode.Z))){s.WM();jD.value='';}else if(i&&!h&&g==KeyCode.X){YM();jD.value='';IB.ZC();}else if(i&&!h&&g==KeyCode.C){jD.value='';}else if(i&&!h&&g==KeyCode.V){if(selectionStart!=selectionEnd){YM();}mV(jD.value);jD.value='';IB.ZC();}else if(i&&zK[g]!=null){j.preventDefault();zK[g]();IB.ZC();}else if(jD.value!=''){String k=jD.value;jD.value='';s.iO(k,h);}else{return;}uO();}void blur(Event g){RH();}void YV(){FD h=selectionStart.gF();n g=selectionStart.u;if(g==null)return;while(!g.hC&&g.parent!=null)g=g.parent;Element j=g.DC();Rectangle k=j.getBoundingClientRect();h.x=k.left+1;h.y+= 5;q i=s.zG(h.x,h.y);if(i==null)return;if(i!=null){moveTo(i);IB.ZC();}}void XV(){FD h=selectionStart.gF();n g=selectionStart.u;if(g==null)return;while(!g.hC&&g.parent!=null)g=g.parent;Element j=g.DC();Rectangle k=j.getBoundingClientRect();h.x=k.right-1;h.y+= 5;q i=s.zG(h.x,h.y);if(i==null)return;if(i!=null){moveTo(i);IB.ZC();}}void left(){wG();selectionStart=CS(selectionStart);selectionEnd=new q.yW(selectionStart);YH(true);IB.ZC();}void right(){q g=new q.yW(selectionEnd);g=yR(g);wG();selectionStart=new q.yW(g);selectionEnd=new q.yW(g);YH(true);IB.ZC();}void TW(){wG();FD g=selectionStart.gF();if(g==null)return;q h=selectionStart;while(h==selectionStart){g.y=g.y-7;h=s.zG(g.x,g.y);h.EF();}if(h!=null){selectionStart=h;selectionEnd=new q.yW(selectionStart);}YH(true);IB.ZC();}void qU(){wG();FD g=selectionStart.gF();if(g==null)return;q h=selectionStart;while(h==selectionStart){g.y=g.y+14;h=s.zG(g.x,g.y);h.EF();}if(h!=null){selectionStart=h;selectionEnd=new q.yW(selectionStart);}YH(true);IB.ZC();}void KW(){q g=new q.yW(selectionStart);g=CS(g);kE(g,selectionEnd);}void LW(){q g=new q.yW(selectionEnd);g=yR(g);kE(selectionStart,g);}void jV(){FD g=selectionStart.gF();if(g==null)return;DivElement h=ZB.document.getElementById('doc1');g.y-= h.offsetHeight;q i=s.zG(g.x,g.y);if(i!=null){int j=h.scrollTop;moveTo(i);h.scrollTop=j-h.offsetHeight;IB.ZC();}}void iV(){FD g=selectionStart.gF();if(g==null)return;DivElement h=ZB.document.getElementById('doc1');g.y+= h.offsetHeight;q i=s.zG(g.x,g.y);if(i!=null){int j=h.scrollTop;moveTo(i);h.scrollTop=j+h.offsetHeight;IB.ZC();}}void ZU(){if(selectionStart==selectionEnd){n g=selectionStart.u;int h=selectionStart.JB;if(g is nG&&h==0)return;if(g is OB&&h==0&&g.nodeValue[0]=='\n'&&g.previousSibling!=null&&g.previousSibling.jE()){ZJ(selectionStart);return;}if(g is OB&&h==0&&g.nodeValue[0]=='\n'&&g.previousSibling==null&&g.parent.jG()){ZJ(selectionStart);return;}bool k=false;while(g!=null&&g.HD&&h==0&&g.PB>0){if(g.HD&&g.hC)k=true;else k=false;h=g.parent.aB(g);g=g.parent;}if(g is!OB&&h>0){n i=g.fB(h-1);if(k){n j=g.fB(h);assert(j.HD&&j.hC);if(i.AB!=j.AB&&!i.hC&&((i is OB&&s.CB.RE(j.AB))||(i.AB!=null&&s.CB.ZD(j.AB,i.AB)))){xR(j);return;}}if(i.HD&&i.hC&&h<g.PB){n j=g.fB(h);if(i.AB!=j.AB&&!j.hC&&((j is OB&&s.CB.RE(i.AB))||(j.AB!=null&&s.CB.ZD(i.AB,j.AB)))){wR(i);return;}}if(i.HD&&(!i.hC||(h==g.PB||g.fB(h).AB!=i.AB))){g=g.fB(h-1);h=g.PB;if(g is!OB&&h>0)i=g.fB(h-1);else i=null;}}while((g is!OB&&g.HD)&&g.PB==h&&g.firstChild!=null){g=g.lastChild;h=g.PB;}selectionStart=new q(g,h);selectionEnd=new q.yW(selectionStart);selectionStart.QG(-1);ZJ(selectionStart);}else{YM();}IB.ZC();}void PW(){if(selectionStart==selectionEnd){if(selectionStart.u is nG&&selectionStart.JB==selectionStart.u.PB)return;n g=selectionStart.u;int i=selectionStart.JB;while(g.HD&&i==g.PB&&g.PB>0){i=g.parent.aB(g)+1;g=g.parent;}if(g is!OB&&i>0&&i<g.PB){n h=g.fB(i);n j=g.fB(i-1);if(j.HD&&j.hC&&h.AB!=j.AB&&!h.hC&&((h is OB&&s.CB.RE(j.AB))||(h.AB!=null&&s.CB.ZD(j.AB,h.AB)))){wR(j);return;}if(h.HD&&h.hC&&h.AB!=j.AB&&!j.hC){if((j is OB&&s.CB.RE(h.AB))||(j.AB!=null&&s.CB.ZD(h.AB,j.AB))){xR(h);return;}}}if(g is!OB&&i<g.PB){n h=g.fB(i);while(h!=null&&h.HD&&(!h.hC||(i==0||g.fB(i-1).AB!=h.AB))){g=h;i=0;if(g is!OB&&i<g.PB)h=g.fB(i);else h=null;}}selectionStart=new q(g,i);selectionEnd=new q.yW(selectionStart);ZJ(selectionStart);}else{YM();}IB.ZC();}void QW(Event m){if(selectionStart!=selectionEnd)return;n g=selectionStart.u;if(g is OB)g=g.parent;if(g.nodeType!=n.tC)return;final String j=g.getAttribute("xml:space");bool h=(j=="preserve");if(!h&&g.AB!=null&&j==null){final List<l> o=s.CB.iE(g.AB);for(l i in o){if(s.CB.attributeName(i)=="space"&&s.CB.attributeNamespace(i)=="http://www.w3.org/XML/1998/namespace"){final String k=s.CB.uF(i);if(k=="preserve")h=true;else if(k=="default")h=false;break;}}}if(h){s.sK(selectionStart,"    ");m.preventDefault();}}q yR(q j){if(j.u is nG&&j.JB==j.u.PB)return (j);n g=j.u;int h=j.JB;while(g!=null&&g.HD&&h==g.PB&&!g.hC){h=g.parent.aB(g)+1;g=g.parent;}n i;if(g.firstChild!=null&&h<g.PB)i=g.fB(h);else i=null;while(i!=null&&i.HD&&!i.hC){g=i;h=0;if(g.firstChild!=null&&h<g.PB)i=g.fB(h);else i=null;}bool k=false;if(h==g.PB){k=(g.HD&&g.hC);h=g.parent.aB(g)+1;g=g.parent;while(k&&g.HD&&g.hC&&h==g.PB){h=g.parent.aB(g)+1;g=g.parent;}}else if(g is OB){h++ ;}else{g=g.fB(h);q m=g.CF();if(m!=null){g=m.u;h=m.JB;k=(g.HD&&g.hC);}else{h=g.parent.aB(g)+1;g=g.parent;}}if(g.firstChild!=null&&h<g.PB)i=g.fB(h);else i=null;while(i!=null&&i.HD&&(!i.hC||k)){g=i;h=0;if(g.firstChild!=null&&h<g.PB)i=g.fB(h);else i=null;}return (new q(g,h));}q CS(q j){if(j.u is nG&&j.JB==0)return (j);n g=j.u;int h=j.JB;while(g!=null&&g.HD&&h==0&&!g.hC){h=g.parent.aB(g);g=g.parent;}n i;if(g.firstChild!=null&&h>0)i=g.fB(h-1);else i=null;while(i!=null&&i.HD&&!i.hC){g=i;h=g.PB;if(g.firstChild!=null&&h>0)i=g.fB(h-1);else i=null;}bool k=false;if(h==0){k=(g.HD&&g.hC);h=g.parent.aB(g);g=g.parent;while(k&&g.HD&&g.hC&&h==0){h=g.parent.aB(g);g=g.parent;}}else if(g is OB){h-- ;}else{g=g.fB(h-1);h=g.PB;q m=g.PG();if(m!=null){g=m.u;h=m.JB;k=(g.HD&&g.hC);}else{h=g.parent.aB(g);g=g.parent;}}if(g.firstChild!=null&&h>0)i=g.fB(h-1);else i=null;while(i!=null&&i.HD&&(!i.hC||k)){g=i;h=g.PB;if(g.firstChild!=null&&h>0)i=g.fB(h-1);else i=null;}return (new q(g,h));}void YH(bool j){if(selectionEnd!=selectionStart)return;FD g=selectionStart.gF();if(g==null){visible=false;}else{visible=true;DivElement h=ZB.document.getElementById('doc1');int i=h.offset.top;int k=h.offset.height;if(g.y-i<0||g.y-i>k){if(j){h.scrollTop+= g.y.toInt()-i;g=selectionStart.gF();}else{visible=false;}}}if(visible){QF.style.visibility='visible';QF.style.top="${g.y}px";QF.style.left="${g.x}px";EW();jD.style.top="${g.y}px";jD.style.left="${g.x}px";jD.focus();}else{QF.style.visibility='hidden';}}void EW(){bool i;Element k=selectionStart.u.DC();bool m=QZ(k);if(m&&selectionStart.u.PB>0){bool g;if(selectionStart.JB>0){n o=selectionStart.u.fB(selectionStart.JB-1);Element t=o.DC();g=QZ(t);}else{if(selectionStart.u is yD)g=false;else g=true;}bool h;if(selectionStart.JB<selectionStart.u.PB){n j=selectionStart.u.fB(selectionStart.JB);Element v=j.DC();if(j is yD&&selectionStart.JB==0)h=false;else h=QZ(v);}else h=true;i=g&&h;}else i=false;if(i)QF.classes.add('horizontal');else if(QF.classes.contains('horizontal'))QF.classes.remove('horizontal');}bool QZ(Element g){return (g is DivElement||g is TableElement||g is UListElement||g is LIElement);}void moveTo(q g){wG();selectionStart=new q.yW(g);selectionStart.EF();selectionEnd=new q.yW(selectionStart);YH(true);}void RH(){visible=false;QF.style.visibility='hidden';}void show(){if(selectionStart!=null&&selectionStart==selectionEnd){visible=true;QF.style.visibility='visible';}}void focus(){if(visible)show();jD.focus();}void iU(){jD.value='';}kE(q o,q t){if(selectionStart==o&&selectionEnd==t){if(o==t){YH(false);}return;}wG();q HB=selectionStart;selectionStart=new q.yW(o);selectionEnd=new q.yW(t);if(selectionStart==selectionEnd){YH(false);IB.ZC();return;}if(selectionStart>selectionEnd){q KB=selectionStart;selectionStart=selectionEnd;selectionEnd=KB;}while((selectionStart.u is OB||selectionStart.u is zB||selectionStart.u is lB)&&selectionStart.JB==0){selectionStart=new q(selectionStart.u.parent,selectionStart.u.parent.aB(selectionStart.u));}while((selectionStart.u is OB||selectionStart.u is zB||selectionStart.u is lB)&&selectionStart.JB==selectionStart.u.PB){selectionStart=new q(selectionStart.u.parent,selectionStart.u.parent.aB(selectionStart.u)+1);}while((selectionEnd.u is OB||selectionEnd.u is zB||selectionEnd.u is lB)&&selectionEnd.JB==selectionEnd.u.PB){selectionEnd=new q(selectionEnd.u.parent,selectionEnd.u.parent.aB(selectionEnd.u)+1);}while((selectionEnd.u is OB||selectionEnd.u is zB||selectionEnd.u is lB)&&selectionEnd.JB==0){selectionEnd=new q(selectionEnd.u.parent,selectionEnd.u.parent.aB(selectionEnd.u));}if(selectionStart!=selectionEnd){if((selectionStart.u is OB||selectionStart.u is zB||selectionStart.u is lB)&&selectionStart.JB==selectionStart.u.PB){n g=selectionStart.u.nextNode();selectionStart=new q(g.parent,g.parent.aB(g));}if((selectionEnd.u is OB||selectionEnd.u is zB||selectionEnd.u is lB)&&selectionEnd.JB==0){n j=selectionEnd.u.previousNode();selectionEnd=new q(j.parent,j.parent.aB(j)+1);}bool m;do{m=false;if(selectionStart.u is!OB&&selectionStart.JB<selectionStart.u.PB){n g=selectionStart.u.fB(selectionStart.JB);if(new q(selectionStart.u,selectionStart.JB+1)>selectionEnd&&new q(g,0)<selectionEnd){selectionStart=new q(g,0);m=true;}}}while(m);do{m=false;if(selectionEnd.u is!OB&&selectionEnd.JB>0){n j=selectionEnd.u.fB(selectionEnd.JB-1);if(new q(selectionEnd.u,selectionEnd.JB-1)<selectionStart&&new q(j,j.PB)>selectionStart){selectionEnd=new q(j,j.PB);m=true;}}}while(m);}if(selectionStart.u==selectionEnd.u){n v=selectionStart.u;if(v.nodeType==n.qB){GP(v,selectionStart.JB,selectionEnd.JB);}else{for(int DB=selectionStart.JB;DB<selectionEnd.JB;DB++ ){n FB=v.fB(DB);FB.yK(true);xK.add(FB);}}}else{n h=selectionStart.u;if(h.nodeType==n.qB)h=h.parent;if(selectionEnd>new q(h,h.PB))selectionEnd=new q(h,h.PB);else{n k=selectionEnd.u;if(k.nodeType==n.qB)k=k.parent;if(k!=h){while(k.parent!=h){k=k.parent;}selectionEnd=new q(h,h.aB(k));}}n i;if(selectionStart.u.nodeType==n.tC||selectionStart.u.nodeType==n.BG){i=selectionStart.u.fB(selectionStart.JB);if(i!=null){q QB=new q(selectionStart.u,selectionStart.JB+1);if(selectionEnd>=QB){i.yK(true);xK.add(i);}}}else{i=selectionStart.u;GP(i,selectionStart.JB,i.PB);}if(i!=null){for(n g=i.nextSibling;g!=null;g=g.nextSibling){q SB=new q(g.parent,g.parent.aB(g));if(SB<selectionEnd){if(g.nodeType!=n.qB||selectionEnd>=new q(g.parent,g.parent.aB(g)+1)){g.yK(true);xK.add(g);}}else break;}}if(selectionEnd.u.nodeType==n.qB){GP(selectionEnd.u,0,selectionEnd.JB);}}if(selectionEnd!=selectionStart)RH();if(selectionStart!=HB)IB.ZC();}void GP(n o,int j,int k){Element h=o.DC();if(h==null)return;Text m=h.nodes.first;Node t=m.nextNode;RH();String i=o.nodeValue;if(j==0){m.remove();}else{m.text=i.substring(0,j);}SpanElement g=new SpanElement();MP.add(g);g.classes.add('selection');g.append(new Text(i.substring(j,k)));if(t==null)h.append(g);else h.insertBefore(g,t);if(k!=i.length){Text v=new Text(i.substring(k));if(g.nextNode==null)h.append(v);else h.insertBefore(v,g.nextNode);}}void wG(){for(SpanElement i in MP){Element g=i.parent;StringBuffer h=new StringBuffer();for(Node j in g.nodes){h.write(j.text);}g.nodes.clear();g.append(new Text(h.toString()));selectionEnd=new q.yW(selectionStart);visible=true;}MP.clear();for(n k in xK){k.yK(false);}xK.clear();}void uO(){if(!visible)return;if(PP!=null)PP.cancel();QF.style.visibility="visible";PP=new Timer.periodic(jS,(Timer g)=>cU());}void cU(){if(!visible)return;if(QF.style.visibility=="hidden")QF.style.visibility="visible";else if(QF.style.visibility=="visible")QF.style.visibility="hidden";}void ZJ(q h){n g;if(h.u.nodeType==n.qB&&h.u.PB<h.JB+1&&h.u.nextSibling!=null){n j=h.u;n k=j.nextSibling;while(k==null&&j.parent!=null){j=j.parent;k=j.nextSibling;}g=k;if(g.nodeType==n.qB&&g.parent!=null&&g.PB==1)g=g.parent;}else if(h.u.nodeType==n.qB&&h.u.PB<h.JB+1&&h.u.nextSibling==null){g=h.u;if(g.parent!=null)g=g.parent;if(g.HD&&g.hC){if(g.nextSibling.AB==g.AB){qO(g,g.nextSibling);}else{q m=new q.yW(h);m.QG(1);if(m>h)ZJ(m);}return;}}else if(h.u.nodeType==n.tC&&h.u.PB<h.JB+1){g=h.u;if(g.HD&&g.hC){if(g.nextSibling!=null&&g.nextSibling.AB==g.AB){qO(g,g.nextSibling);return;}}}else if(h.u.nodeType==n.tC||h.u.nodeType==n.BG){g=h.u.fB(h.JB);if(g.HD&&g.hC){if(g.previousSibling!=null&&g.previousSibling.AB==g.AB){qO(g.previousSibling,g);return;}else if(g.PB>0){q o=new q.yW(h);o.QG(-1);if(o<h)ZJ(o);return;}}if(g==null){ZB.window.alert("I'm sorry Dave, I'm afraid I can't do that.");return;}}else if(h.u.nodeType==n.qB&&h.JB==0&&h.u.PB==1&&h.u.parent is zB&&h.u.parent.PB==1){g=h.u.parent;while(g.parent is zB&&g.parent.PB==1)g=g.parent;}else{s.sV(h,1);wE i=zB.JN(selectionStart);if(i!=null){s.KC(i.sH);s.iK(LB.MB('undo.remove_text'),2);kE(i.start,i.end);}return;}if(g is yD&&g.parent.PB==1){g=g.parent;}if(!g.iJ){s.XM(g);wE i=zB.JN(selectionStart);if(i!=null){s.KC(i.sH);s.iK(LB.MB('undo.remove_element'),2);kE(i.start,i.end);}}}void YM(){if(selectionStart==selectionEnd)return;q g=new q.yW(selectionStart);q h=new q.yW(selectionEnd);wG();if(g.u is jC&&g.u==h.u&&g.JB==0&&h.JB==h.u.PB){s.XM(g.u);}else{s.BP(g,h);wE i=zB.JN(g);if(i!=null){s.KC(i.sH);s.iK(LB.MB('undo.remove'),2);kE(i.start,i.end);}}}void refresh(){q g=selectionStart;q h=selectionEnd;selectionStart=null;selectionEnd=null;kE(g,h);}String JR(){StringBuffer h=new StringBuffer();if(selectionStart.u==selectionEnd.u){n j=selectionStart.u;if(j.nodeType==n.qB){h.write(j.nodeValue.substring(selectionStart.JB,selectionEnd.JB));}else{for(int k=selectionStart.JB;k<selectionEnd.JB;k++ ){n m=j.fB(k);h.write(m);}}}else{n i;if(selectionStart.u.nodeType==n.tC){i=selectionStart.u.fB(selectionStart.JB);q o=new q(selectionStart.u,selectionStart.JB+1);if(selectionEnd>=o){h.write(i);}}else{i=selectionStart.u;h.write(i.nodeValue.substring(selectionStart.JB));}for(n g=i.nextSibling;g!=null;g=g.nextSibling){q t=new q(g.parent,g.parent.aB(g));if(t<selectionEnd){if(g.nodeType!=n.qB||selectionEnd>=new q(g.parent,g.parent.aB(g)+1)){h.write(g);g.yK(true);}}else break;}if(selectionEnd.u.nodeType==n.qB){h.write(selectionEnd.u.nodeValue.substring(0,selectionEnd.JB));}}return (h.toString());}bool mV(String i){AC k;try {gH v=new gH();k=v.parseFromString("<root>${i}</root>");}on eD catch (m){bool j=false;if(i.trim()!=''){n g=selectionStart.u;if(g.nodeType==n.qB)g=g.parent;if(g.nodeType==n.BG)j=true;else if(g.AB!=null&&!s.CB.RE(g.AB))j=true;}if(j){ZB.window.alert(LB.MB('insert.text_not_allowed'));return (false);}s.sK(selectionStart,i);return (true);}n g=selectionStart.u;if(g is OB)g=g.parent;l o=k.documentElement;n h=pD.jF(g.AB);if(o.childNodes!=null){for(BB DB in o.childNodes){n FB=pD.MI(DB,h);h.mB(FB);}}h.fG();if(s.VC!=null){lB.EN(g,h);s.DP(h);}GB t=new GB.DX(LB.MB('undo.paste'));try {t.TB(s.SE(h,selectionStart,checkValidity:true));}on RD catch (m){ZB.window.alert(m.toString());return (false);}s.KC(t);return (true);}void qO(n g,n h){GB j=new GB.DX(LB.MB('undo.remove_text'));n i;q m=new q(h,0);q o=new q(h,h.PB);if(o>m)i=s.hI(m,o);else i=null;j.TB(new GB.AX(h));if(i!=null)j.TB(s.SE(i,new q(g,g.PB)));q k;if(g.lastChild is OB)k=new q(g.lastChild,g.lastChild.PB);else k=new q(g,g.PB);s.KC(j);IB.TD(k);}void xR(n g){assert(g.previousSibling!=null);int t=g.parent.aB(g);GB k=new GB.DX(LB.MB('undo.remove_text'));int h=t;bool v=s.CB.RE(g.AB);while(h>0){n i=g.parent.fB(h-1);if(i.hC||(i is OB&&!v)||(i.AB!=null&&!s.CB.ZD(g.AB,i.AB)))break;h-- ;}q m=new q(g.parent,h);q o=new q(g.parent,t);assert(m<o);n DB=s.JG(g.parent,m,o);k.TB(s.DI(m,o));k.TB(s.SE(DB,new q(g,0)));q j=new q(g,0);j.EF();j=new q.uW(j);s.KC(k);moveTo(j);IB.ZC();return;}void wR(n g){assert(g.nextSibling!=null);int t=g.parent.aB(g.nextSibling);GB k=new GB.DX(LB.MB('undo.remove_text'));int h=t;bool v=s.CB.RE(g.AB);while(h<g.parent.PB){n i=g.parent.fB(h);if(i.hC||(i is OB&&!v)||(i.AB!=null&&!s.CB.ZD(g.AB,i.AB)))break;h++ ;}q m=new q(g.parent,h);q o=new q(g.parent,t);assert(o<m);n DB=s.JG(g.parent,o,m);k.TB(s.DI(o,m));k.TB(s.SE(DB,new q(g,g.PB)));q j=new q(g,g.PB);j.EF();j=new q.pW(j);s.KC(k);moveTo(j);IB.ZC();return;}}class iB{String tB;String EC;String localName;String value;iB.bW(oC g){tB=g.tB;EC=g.EC;if(g.EC!=null)localName=g.localName;else localName=g.name;value=g.nodeValue;}iB(String g,String h){tB=null;EC=null;localName=g;this.value=h;}iB.lW(String i,String g,String j){tB=i;int h=g.indexOf(':');if(h==-1){EC=null;localName=g;}else{EC=g.substring(0,h);localName=g.substring(h+1);}this.value=j;}iB.rW(iB g){tB=g.tB;EC=g.EC;localName=g.localName;value=g.value;}String get name{if(EC==null)return (localName);else return ("${EC}:${localName}");}String toString(){StringBuffer g=new StringBuffer();if(EC!=null){g.write(EC);g.write(':');}g.write(localName);g.write('="');g.write(n.DT(value));g.write('"');return (g.toString());}}class HL{int RZ=0;Map<String,n> SZ=new Map<String,n>();nG vC;GH CB;List<GB> ND=new List<GB>();int uD=-1;GB TM=null;String TJ;String bJ;List<l> VC;l gO;Future sO(String j){Completer g=new Completer();CB=new GH();CB.load(j).then((m){VC=CB.yG('hiddenp');if(VC.length==0)VC=null;gO=CB.XO('hiddendiv');TJ=null;vC=new nG();List<l> i=CB.FI();if(i.length==1){n h=pD.jF(i[0]);CB.CO(h);vC.mB(h);h.kG();}g.complete();},onError:(RD k){g.completeError(k);});return (g.future);}Future wO(String i,String k,{bool removeIndents: true}){Completer g=new Completer();CB=new GH();CB.load(k).then((v){VC=CB.yG('hiddenp');if(VC.length==0)VC=null;gO=CB.XO('hiddendiv');this.TJ=i;gH t=new gH();t.xO(i).then((AC m){if(removeIndents)tV(m.documentElement);vC=pD.MI(m,null);if(CB!=null&&VC!=null)DP(vC);g.complete();},onError:(eD h){if(h.errorCode==404){vC=new nG();List<l> o=CB.FI();if(o.length==1){n j=pD.jF(o[0]);CB.CO(j);vC.mB(j);j.kG();}g.complete();}else g.completeError(new RD("Opening ${i}: ${h}"));});},onError:(RD h){g.completeError(new RD("Reading config ${k}: ${h}"));});return (g.future);}Future AW(){assert(bJ!=null);Completer i=new Completer();String j='AaB03x';HttpRequest h=new HttpRequest();h.onLoad.listen((ProgressEvent o){String k=h.responseText;if(k.startsWith('ok')){if(uD>=0)TM=ND[uD];else TM=null;i.complete();}else{String m;if(k.startsWith('erreur\n'))m=k.substring('erreur\n'.length);else m=k;i.completeError(new RD(m));}});h.onError.listen((ProgressEvent o){i.completeError(new RD(h.status.toString()));});h.open('POST',bJ);h.setRequestHeader('Content-Type',"multipart/form-data; boundary=${j}");StringBuffer g=new StringBuffer();g.write("--${j}\r\n");g.write('Content-Disposition: form-data; name="chemin"\r\n');g.write('Content-type: text/plain; charset=UTF-8\r\n');g.write('Content-transfer-encoding: 8bit\r\n\r\n');g.write(TJ);g.write("\r\n--${j}\r\n");g.write('Content-Disposition: form-data; name="contenu"; filename="${TJ}"\r\n');g.write('Content-Type: application/octet-stream\r\n\r\n');vC.yF='UTF-8';g.write(toString());g.write('\r\n--${j}--\r\n\r\n');h.send(g.toString());return (i.future);}bool gU(){if(uD>=0)return (TM!=ND[uD]);else return (TM!=null);}String VM(n h){RZ++ ;String g="a${RZ}";SZ[g]=h;return (g);}Element UB(){return (vC.UB());}n xH(){for(n g=vC.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==n.tC)return (g);}return (null);}void insertNode(n g,q h){GB i=new GB.xW(h,g);KC(i);}void XM(n g){GB h=new GB.AX(g);KC(h);}void sK(q g,String h){GB i=new GB.mW(g,h);KC(i);}void sV(q g,int h){GB i=new GB.tW(g,h);KC(i);}void BP(q g,q h){GB i=DI(g,h);KC(i);}GB DI(q h,q i){assert(h<i);GB j=new GB.DX(LB.MB('undo.remove'));if(h.u==i.u){n o=h.u;if(o.nodeType==n.qB){j.TB(new GB.tW(new q(o,h.JB),i.JB-h.JB));}else{for(int k=h.JB;k<i.JB;k++ ){if(o.fB(k) is OB)j.TB(new GB.AX(o.fB(k)));}for(int k=h.JB;k<i.JB;k++ ){if(o.fB(k) is!OB)j.TB(new GB.AX(o.fB(k)));}}}else{bool v=false;n m;if(h.u.nodeType==n.tC){m=h.u.fB(h.JB);q DB=new q(h.u,h.JB+1);if(i>=DB)v=true;}else{m=h.u;if(m.PB-h.JB>0){j.TB(new GB.tW(new q(m,h.JB),m.PB-h.JB));}}if(i.u.nodeType==n.qB&&i.JB>0){j.TB(new GB.tW(new q(i.u,0),i.JB));}for(n g=m.nextSibling;g!=null;g=g.nextSibling){q t=new q(g.parent,g.parent.aB(g));if(t<i){if(g.nodeType==n.qB&&i>=new q(g.parent,g.parent.aB(g)+1)){j.TB(new GB.AX(g));}}else break;}if(v)j.TB(new GB.AX(m));for(n g=m.nextSibling;g!=null;g=g.nextSibling){q t=new q(g.parent,g.parent.aB(g));if(t<i){if(g.nodeType!=n.qB){j.TB(new GB.AX(g));}}else break;}}return (j);}n hI(q g,q i){assert(g<i);n m=g.u;if(m is OB)m=m.parent;n j=pD.jF(m.AB);if(g.u==i.u){n o=g.u;if(o.nodeType==n.qB){j.mB(new OB(o.nodeValue.substring(g.JB,i.JB)));}else{for(int t=g.JB;t<i.JB;t++ ){j.mB(new n.HX(o.fB(t)));}}}else{n k;if(g.u.nodeType==n.tC){k=g.u.fB(g.JB);q v=new q(g.u,g.JB+1);if(i>=v){j.mB(new n.HX(k));}}else{k=g.u;if(k.PB-g.JB>0){j.mB(new OB(k.nodeValue.substring(g.JB,k.PB)));}}for(n h=k.nextSibling;h!=null;h=h.nextSibling){q DB=new q(h.parent,h.parent.aB(h));if(DB<i){if(h.nodeType!=n.qB||(h.nodeType==n.qB&&i>=new q(h.parent,h.parent.aB(h)+1))){j.mB(new n.HX(h));}}else break;}if(i.u.nodeType==n.qB&&i.JB>0){j.mB(new OB(i.u.nodeValue.substring(0,i.JB)));}}return (j);}n JG(n k,q h,q i){while(h.JB==h.u.PB&&h<i){h=new q(h.u.parent,h.u.parent.aB(h.u)+1);}while(i.JB==0&&i>h){i=new q(i.u.parent,i.u.parent.aB(i.u));}n j=new n.HX(k);for(n g=j.firstChild;g!=null;g=j.firstChild)j.CD(g);int DB=0;for(n g=k.firstChild;g!=null;g=g.nextSibling){q m=new q(k,DB);q o=new q(k,DB+1);if(m>=h&&o<=i){n FB=new n.HX(g);j.mB(FB);}else if(o<=h||m>=i){}else{if(g is OB){if(m>h&&o>i){assert(g==i.u);if(0<i.JB)j.mB(new OB(g.nodeValue.substring(0,i.JB)));}else if(m<h&&o<i){assert(g==h.u);if(h.JB<g.PB)j.mB(new OB(g.nodeValue.substring(h.JB,g.PB)));}else{int t;if(h.u==g)t=h.JB;else t=0;int v;if(i.u==g)v=i.JB;else v=g.PB;if(t<v)j.mB(new OB(g.nodeValue.substring(t,v)));}}else{n FB=JG(g,h,i);j.mB(FB);}}DB++ ;}return (j);}GB SE(n DB,q i,{bool checkValidity: true}){if(i.u is OB&&i.JB==0)i=new q(i.u.parent,i.u.parent.aB(i.u));n h=i.u;int o=i.JB;if(h is OB){o=h.parent.aB(h);h=h.parent;}GB FB=new GB.DX('insertChildren');List<n> t=new List<n>();while(DB.firstChild!=null){t.add(DB.firstChild);DB.CD(DB.firstChild);}q j=new q.yW(i);for(n g in t){if(g is!OB){if(checkValidity&&(h is CG||h is DG||h is IH)){String m;if(g.AB==null)m=g.nodeName;else m=CB.YD(g.AB);throw new RD(m+' '+LB.MB('insert.not_authorized_here'));}if(g is DG){if(checkValidity&&h.nodeType==n.BG)throw new RD(LB.MB('insert.text_not_allowed'));String k=null;if(g.firstChild!=null)k=g.firstChild.nodeValue;if(k==null)k='';if(checkValidity&&k.trim()!=''&&!CB.RE(h.AB)){throw new RD(LB.MB('insert.text_not_allowed'));}FB.TB(new GB.xW(j,g));}else{if(checkValidity){if(h.nodeType==n.BG){if(!CB.FI().contains(g.AB))throw new RD(CB.YD(g.AB)+' '+LB.MB('insert.not_authorized_here'));}else if(g is!CG&&g is!IH){if(g.AB==null||!CB.ZD(h.AB,g.AB)){String m;if(g.AB==null)m=g.nodeName;else m=CB.YD(g.AB);String QB=CB.YD(h.AB);throw new RD(m+' '+LB.MB('insert.not_authorized_inside')+' '+QB);}if(!CB.QM(h,o,o,g.AB)){throw new RD(CB.YD(g.AB)+' '+LB.MB('insert.not_authorized_here'));}}}FB.TB(new GB.xW(j,g));}if(j.u is OB)j=new q(h,o+2);else j=new q(h,j.JB+1);}}bool HB=false;bool KB=true;for(n g in t){if(g is OB){if(checkValidity&&h.nodeType==n.BG)throw new RD(LB.MB('insert.text_not_allowed'));String k=g.nodeValue;if(k==null)k='';if(checkValidity&&k.trim()!=''&&!CB.RE(h.AB)){throw new RD(LB.MB('insert.text_not_allowed'));}int v=o+t.indexOf(g);if(i.u is OB)v++ ;if(HB)v-- ;if(t.length==1)j=i;else j=new q(h,v);if(KB){if(v>0&&(i.u is OB||h.fB(v-1) is OB))HB=true;KB=false;}FB.TB(new GB.mW(j,g.nodeValue));}}return (FB);}String toString(){return (vC.toString());}AC RW(){hH h=new AK();AC g=h.createDocument(null,null,null);vC.MF(g);return (g);}void KC(GB g){g.PO();if(uD<ND.length-1)ND.removeRange(uD+1,ND.length);if(uD<0||!ND[uD].KU(g)){ND.add(g);uD++ ;}IB.CL();}void XH(){if(uD<0)return;GB g=ND[uD];g.XH();uD-- ;IB.CL();IB.ZC();}void WM(){if(uD>=ND.length-1)return;GB g=ND[uD+1];g.PO();uD++ ;IB.CL();IB.ZC();}bool qR(){return (uD>=0);}bool pR(){return (uD<ND.length-1);}String jR(){String g;if(uD>=0)g=ND[uD].title;else g=null;if(g==null)return (LB.MB('undo.undo'));else return ("${LB.MB('undo.undo')} ${g}");}String hR(){String g;if(uD<ND.length-1)g=ND[uD+1].title;else g=null;if(g==null)return (LB.MB('undo.redo'));else return ("${LB.MB('undo.redo')} ${g}");}void iK(String j,int g){GB i=new GB.DX(j);for(int h=ND.length-g;h<ND.length;h++ )i.TB(ND[h]);ND.removeRange(ND.length-g,ND.length);ND.add(i);uD-= (g-1);}void iO(String j,bool FB){q g=IB.BD();q k=IB.DF();if(j=='\n'&&!FB){if(((g.u is JH)||(g.u.nextSibling==null&&g.u.parent is JH))&&g.JB==g.u.PB){SI.TT(g);return;}else{n i=g.u;while(i is OB||i is lB||i is zB||i is bE)i=i.parent;if(i is yD){jC.cT(g);return;}}}if(j=='\n'&&VC!=null){if(lB.YT())return;}bool m=false;n h=g.u;if(h.nodeType==n.qB)h=h.parent;if(h.DL)m=true;else if(j.trim()!=''){if(h.nodeType==n.BG)m=true;else if(h.AB!=null&&!s.CB.RE(h.AB)){if(VC!=null){l v=CB.SF(h.AB,VC);if(v!=null&&g==k){lB o=new lB.fX(v);o.mB(new OB(j));insertNode(o,g);IB.TD(new q(o,o.PB));IB.ZC();return;}else m=true;}else m=true;}}if(m){ZB.window.alert(LB.MB('insert.text_not_allowed'));IB.cursor.iU();return;}bool DB=false;if(g!=k){g=new q.yW(g);k=new q.yW(k);IB.cursor.wG();BP(g,k);DB=true;if(g.u.parent==null)g=IB.BD();}s.sK(g,j);if(DB){GB t=new GB.DX(LB.MB('undo.insert_text'));t.TB(ND.removeAt(ND.length-2));t.TB(ND.removeLast());ND.add(t);uD-= 1;}}void oI(l j,String h){q i=IB.BD();if(i==null)return;n g=pD.jF(j,h);if(h=='element'&&xH()==null){CB.CO(g);}g.gV(()=>RV(g,i));}bool RV(n i,q g){n k=null;if(IB.BD()!=IB.DF()){q FB=IB.BD();q HB=IB.DF();k=hI(FB,HB);IB.cursor.wG();if(g.u is!OB&&g.JB>0&&g.u.fB(g.JB-1) is OB){n KB=g.u.fB(g.JB-1);g=new q(KB,KB.PB);}BP(FB,HB);if(g.u.parent==null)g=IB.BD();}bool v=false;n j=g.u;if(j is OB)j=j.parent;if(j is lB){lB h=j;if(!CB.ZD(h.AB,i.AB)){GB m=new GB.DX(LB.MB('undo.insert_element'));q t=new q(h,h.PB);t.EF();if(g<t){n SB=hI(g,t);m.TB(DI(g,t));lB QB=pD.jF(h.AB);m.TB(new GB.xW(new q(h.parent,h.parent.aB(h)+1),QB));m.TB(SE(SB,new q(QB,0)));}m.TB(new GB.xW(new q(h.parent,h.parent.aB(h)+1),i));KC(m);v=true;}}else if(VC!=null&&j.AB!=null&&!CB.ZD(j.AB,i.AB)){l DB=CB.SF(j.AB,VC);if(DB!=null&&CB.ZD(DB,i.AB)){lB h=new lB.fX(DB);h.mB(i);insertNode(h,g);v=true;}}if(!v)insertNode(i,g);q o=i.CF();if(o==null)o=new q(i.parent,i.parent.aB(i)+1);IB.TD(o);IB.ZC();if(k!=null){try {if(o==null)throw new RD(k.toString()+LB.MB('insert.not_authorized_here'));if(s.VC!=null){lB.EN(i,k);}KC(SE(k,o,checkValidity:true));iK(LB.MB('undo.insert_element'),3);IB.CL();return (true);}on RD catch (bB){ZB.window.alert(bB.toString());XH();XH();ND.removeRange(ND.length-2,ND.length);IB.CL();return (false);}}return (true);}void tU(String g,l h){if(g=='jaxe.FonctionNormal'){zB.WL();}else if(YP[g]!=null)YP[g]();}List<l> VO(n i){List<l> g;if(i.nodeType==n.BG){g=s.CB.FI();}else if(i.AB==null){g=new List<l>();}else{n h;if(i.nodeType==n.qB)h=i.parent;else h=i;g=CB.bC(h.AB);if(h is lB&&h.parent.AB!=null){LinkedHashSet j=new LinkedHashSet.from(g);j.addAll(CB.bC(h.parent.AB));g=new List.from(j);}else if(VC!=null){l m=CB.SF(h.AB,VC);if(m!=null){LinkedHashSet j=new LinkedHashSet.from(g);j.addAll(CB.bC(m));g=new List.from(j);}}if(h.FS!=null){for(int k=0;k<g.length;k++ ){if(!h.FS.contains(CB.XD(g[k]))){g.removeAt(k);k-- ;}}}}return (g);}List<l> RP(List<l> m){List<l> i=new List<l>();q t=IB.BD();q v=IB.DF();n h=t.u;int DB=t.JB;n k=v.u;int FB=v.JB;if(h.nodeType==n.qB){DB=h.parent.aB(h);h=h.parent;}if(k.nodeType==n.qB){FB=k.parent.aB(k);k=k.parent;}if(h!=k)return (i);for(l g in m){if(s.CB.QM(h,DB,FB,g))i.add(g);}if(h is lB&&h.parent.AB!=null){int HB=h.parent.aB(h)+1;LinkedHashSet j=new LinkedHashSet.from(i);for(l g in m){if(!j.contains(g)){if(s.CB.QM(h.parent,HB,HB,g))j.add(g);}}i=new List.from(j);}else if(VC!=null){l o=null;for(l g in VC)if(i.contains(g)){o=g;break;}if(o!=null){LinkedHashSet j=new LinkedHashSet.from(i);for(l g in m){if(!j.contains(g)){if(s.CB.ZD(o,g))j.add(g);}}i=new List.from(j);}}return (i);}q zG(num g,num h){return (vC.zG(g,h));}void tV(final l g){TZ(g,null,false,true);}void TZ(final l m,final l t,final bool HB,final bool KB){l o;if(CB!=null)o=CB.OM(m,t);else o=null;bool v=UZ(m,o,t,HB);final bool DB=VZ(m,o,t,KB);BB FB;for(BB j=m.firstChild;j!=null;j=FB){FB=j.nextSibling;if(j.nodeType==BB.zE)TZ(j as l,o,v,DB);else if(!v&&j.nodeType==BB.nF){String g=j.nodeValue;if(DB&&j.parentNode.firstChild==j&&t!=null){int h=0;while(h<g.length&&(g[h]==' '||g[h]=='\t'))h++ ;if(h>0)g=g.substring(h);}int i=g.indexOf("\n ");int k=g.indexOf("\n\t");if(k!=-1&&(i==-1||k<i))i=k;while(i!=-1){int h=i;while(h+1<g.length&&(g[h+1]==' '||g[h+1]=='\t'))h++ ;g=g.substring(0,i+1)+g.substring(h+1);i=g.indexOf("\n ");k=g.indexOf("\n\t");if(k!=-1&&(i==-1||k<i))i=k;}i=g.indexOf("  ");while(i!=-1){int h=i;while(h+1<g.length&&g[h+1]==' ')h++ ;g=g.substring(0,i)+g.substring(h);i=g.indexOf("  ");}if(g.length==0)m.CD(j);else j.nodeValue=g;}}}bool UZ(final l m,final l j,final l v,final bool o){bool g;final String h=m.getAttribute("xml:space");if(h=="preserve")g=true;else if(h=="default")g=false;else g=o;if(j!=null&&h==""){final List<l> t=CB.iE(j);for(l i in t){if(CB.attributeName(i)=="space"&&CB.attributeNamespace(i)=="http://www.w3.org/XML/1998/namespace"){final String k=CB.uF(i);if(k=="preserve")g=true;else if(k=="default")g=false;break;}}}return (g);}bool VZ(final l m,final l j,final l k,final bool o){if(j==null)return true;if(k==null||!CB.RE(j)||!CB.RE(k))return true;BB g=m.previousSibling;while(g!=null){if(g.nodeType==BB.nF){final String h=g.nodeValue;if(!(h.endsWith(" ")||h.endsWith("\n")))return false;return true;}else if(g.nodeType==BB.zE){final BB i=g.lastChild;if(i!=null&&i.nodeType==BB.nF){final String h=i.nodeValue;if(!(h.endsWith(" ")||h.endsWith("\n")))return false;}return true;}g=g.previousSibling;}if(g==null)return o;return true;}void DP(n i){l j;if(i.AB!=null)j=CB.SF(i.AB,VC);else j=null;bool k=(j!=null);bool m=i is lB;bool t=i is zB;n o;for(n g=i.firstChild;g!=null;g=o){o=g.nextSibling;if(g is OB){if(k||m||t){String h=g.nodeValue;if(g.previousSibling==null||g.previousSibling is!CG||g.nextSibling==null||g.nextSibling is!CG){h=h.replaceAll('\n',' ');}h=h.replaceAll('  ',' ');if(k){if(g.previousSibling!=null&&g.previousSibling.AB!=null&&!CB.ZD(j,g.previousSibling.AB)){h=h.trimLeft();}if(g.nextSibling!=null&&g.nextSibling.AB!=null&&!CB.ZD(j,g.nextSibling.AB)){h=h.trimRight();}}else if(m){if(g.previousSibling==null)h=h.trimLeft();if(g.nextSibling==null)h=h.trimRight();}if(h.length==0)i.CD(g);else g.nodeValue=h;}}else if(g.firstChild!=null)DP(g);}}void QV(AC g){if(g.documentElement!=null)WZ(g.documentElement,null,false,1);}void WZ(final l i,final l j,final bool DB,final int k){l h;if(CB!=null)h=CB.OM(i,j);else h=null;bool m=UZ(i,h,j,DB);for(BB g=i.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==BB.zE)WZ(g as l,h,m,k+1);else if(!m&&g.nodeType==BB.nF&&g.nodeValue.contains("\n")){StringBuffer o=new StringBuffer("\n");int t=k;if(g.nextSibling==null)t-- ;for(int v=0;v<t;v++ )o.write('  ');String FB=o.toString();g.nodeValue=g.nodeValue.replaceAll("\n",FB);}}}}class RD implements Exception{final String message;final Exception pI;const RD([this.message,this.pI]);String toString(){String g;if(message==null)g='DaxeException';else g=message;if(pI!=null)g="${g} (parent exception: ${pI})";return (g);}}abstract class n{static const int tC=1;static const int qB=3;static const int BG=9;static const String kS='GRAS';static const String lS='ITALIQUE';static const String mS='EXPOSANT';static const String nS='INDICE';static const String oS='SOULIGNE';static const String pS='BARRE';static const String qS='FCOULEUR';static const String rS='PCOULEUR';static const String sS="^.*\\[(x[0-9a-fA-F]{2}|[0-9]{1,3}),(x[0-9a-fA-F]{2}|[0-9]{1,3}),(x[0-9a-fA-F]{2}|[0-9]{1,3})\\]\$";l AB;String XZ;n parent;int nodeType;String YZ;String EC;String localName;String nodeValue;n firstChild;n nextSibling;List<iB> attributes;bool iJ=false;bool DL=false;bool valid;List<String> FS;n.zW(BB g,n h,{bool createChildren: true}){XZ=s.VM(this);this.parent=h;if(g.nodeType==BB.zE||g.nodeType==BB.nF||g.nodeType==BB.GK)nodeType=g.nodeType;else nodeType=tC;YZ=g.tB;EC=g.EC;if(g.nodeType==BB.DK)localName=g.nodeName;else if(g.nodeType==BB.CK)localName='#cdata-section';else if(g.nodeType==BB.EK)localName='#comment';else if(g.nodeType==BB.GK)localName='#document';else localName=g.localName;if(nodeType==n.qB)nodeValue=g.nodeValue;attributes=new List<iB>();LinkedHashMap<String,oC> m=g.attributes;if(m!=null){for(BB i in m.values){attributes.add(new iB.bW(i));}}if(g is l){AB=s.CB.OM(g,h==null?null:h.AB);if(AB==null&&h!=null){AB=s.CB.tH(localName);}}if(createChildren){if(g.childNodes!=null){n j=null;for(BB i in g.childNodes){n k=pD.MI(i,this);if(j==null)firstChild=k;else j.nextSibling=k;j=k;}}else if((g.nodeType==BB.CK||g.nodeType==BB.DK||g.nodeType==BB.EK)&&g.nodeValue!=null&&g.nodeValue!=''){mB(new OB(g.nodeValue));}}if(nodeType==n.tC)valid=s.CB.SO(this);else valid=true;}n.EX(l g){AB=g;XZ=s.VM(this);parent=null;nodeType=tC;YZ=s.CB.kI(AB);EC=s.CB.HM(AB);localName=s.CB.XD(AB);nodeValue=null;firstChild=null;nextSibling=null;attributes=new List<iB>();valid=true;}n.FX(int g){AB=null;XZ=s.VM(this);parent=null;this.nodeType=g;YZ=null;EC=null;localName=null;nodeValue=null;firstChild=null;nextSibling=null;attributes=new List<iB>();valid=true;}n.GX(String g){XZ=s.VM(this);parent=null;nodeType=n.qB;YZ=null;this.EC=null;this.localName=null;nodeValue=g;firstChild=null;nextSibling=null;attributes=null;valid=true;}factory n.HX(n g){hH i=new AK();AC j=i.createDocument(null,null,null);BB k=g.MF(j);n h=pD.MI(k,g.parent);h.parent=null;return (h);}String get id{return (XZ);}Element DC(){return (ZB.document.getElementById(XZ));}Element CE(){Element g=DC();if(g!=null&&!g.nodes.isEmpty&&g.firstChild is Element)g=g.firstChild;return (g);}String get nodeName{if(nodeType==qB)return ('#text');StringBuffer g=new StringBuffer();if(EC!=null){g.write(EC);g.write(":");}g.write(localName);return (g.toString());}String get tB{return (YZ);}int get PB{if(nodeType==qB)return (nodeValue.length);int h=0;for(n g=firstChild;g!=null;g=g.nextSibling)h++ ;return (h);}bool get HD{return (false);}bool get hC{if(jE())return (true);Element g=DC();return (g is DivElement||g is TableElement||g is UListElement);}List<n> get childNodes{List<n> h=new List<n>();for(n g=firstChild;g!=null;g=g.nextSibling){h.add(g);}return (h);}n get previousSibling{if(parent==null)return (null);for(n g=parent.firstChild;g!=null;g=g.nextSibling){if(g.nextSibling==this)return (g);}return (null);}n get lastChild{for(n g=firstChild;g!=null;g=g.nextSibling){if(g.nextSibling==null)return (g);}return (null);}n fB(int i){assert(nodeType!=qB);int h=0;for(n g=firstChild;g!=null;g=g.nextSibling){if(h==i)return (g);h++ ;}return (null);}n nextNode(){if(firstChild!=null)return (firstChild);if(nextSibling!=null)return (nextSibling);n g=parent;while(g!=null){if(g.nextSibling!=null)return (g.nextSibling);g=g.parent;}return (null);}n previousNode(){if(firstChild!=null)return (lastChild);if(previousSibling!=null)return (previousSibling);n g=parent;while(g!=null){if(g.previousSibling!=null)return (g.previousSibling);g=g.parent;}return (null);}int aB(n i){int h=0;for(n g=firstChild;g!=null;g=g.nextSibling){if(g==i)return (h);h++ ;}assert(false);return (-1);}String getAttribute(String h){for(iB g in attributes){if(g.localName==h)return (g.value);}return (null);}void setAttribute(String g,String h){for(iB i in attributes){if(i.localName==g){i.value=h;return;}}attributes.add(new iB(g,h));return;}void setAttributeNS(String m,String g,String o){String i,j;int k=g.indexOf(":");if(k!=-1){i=g.substring(0,k);j=g.substring(k+1);}else{i=null;j=g;}iB h=MM(m,j);if(h!=null){h.EC=i;h.value=o;return;}h=new iB.lW(m,g,o);attributes.add(h);}iB LM(String h){for(iB g in attributes){if(g.localName==h)return (g);}return (null);}iB MM(String h,String i){if(attributes==null)return (null);for(iB g in attributes){if(g.tB==h&&g.localName==i){return (g);}}return (null);}LinkedHashMap<String,iB> SR(){LinkedHashMap<String,iB> g=new LinkedHashMap<String,iB>();for(iB h in attributes)g[h.name]=new iB.rW(h);return (g);}Element UB();void lE(){Element g=DC();if(g==null)return;Element h=UB();g.replaceWith(h);}void WF(List<n> o){List<n> t=childNodes;for(n g in o){Element m=g.DC();if(!t.contains(g)){if(m!=null)m.remove();else{lE();return;}}else if(m==null){n j=g.nextSibling;Node i=null;while(i==null&&j!=null){i=j.DC();if(i==null)j=j.nextSibling;}n k=g.previousSibling;Node h=null;while(h==null&&k!=null){h=k.DC();if(h==null)k=k.previousSibling;}if(i!=null){i.parent.insertBefore(g.UB(),i);}else if(h!=null){if(h.nextNode!=null)h.parent.insertBefore(g.UB(),h.nextNode);else h.parent.append(g.UB());}else{lE();return;}}else{g.lE();}}}void hJ(){lE();}void yK(bool h){Element g=DC();if(g==null)return;if(h)g.classes.add('selected');else g.classes.remove('selected');}void mB(n g){n h=lastChild;if(h!=null)h.nextSibling=g;else firstChild=g;g.parent=this;}void insertBefore(n h,n i){assert(i==null||this==i.parent);h.parent=this;n g=firstChild;if(g==i){n j=firstChild;firstChild=h;h.nextSibling=j;}else{while(g!=null&&g.nextSibling!=i){g=g.nextSibling;}assert(g!=null);assert(g.nextSibling==i);n j=g.nextSibling;g.nextSibling=h;h.nextSibling=j;}}void insertAfter(n h,n g){assert(this==g.parent);if(g.nextSibling==null)mB(h);else insertBefore(h,g.nextSibling);}void CD(n g){if(g.previousSibling!=null)g.previousSibling.nextSibling=g.nextSibling;if(g==firstChild)firstChild=g.nextSibling;g.parent=null;g.nextSibling=null;}void replaceWith(n g){if(parent.firstChild==this)parent.firstChild=g;else previousSibling.nextSibling=g;g.parent=parent;g.nextSibling=nextSibling;parent=null;nextSibling=null;}void normalize(){for(n g=firstChild;g!=null;g=g.nextSibling){while(g.nodeType==qB&&g.nextSibling!=null&&g.nextSibling.nodeType==qB){g.nodeValue="${g.nodeValue}${g.nextSibling.nodeValue}";CD(g.nextSibling);}}}void remove(q g,int h){if(nodeType==tC){for(int i=g.JB;i<h;i++ ){CD(fB(g.JB));}}else{String j=nodeValue;String k=j.substring(0,g.JB);String m=j.substring(g.JB+h);nodeValue="${k}${m}";}}bool jE(){return (false);}bool jG(){return (false);}void fG(){if(jG()&&firstChild!=null&&firstChild is OB){String g=firstChild.nodeValue;if(g.startsWith('\n')){if(g.length==1)CD(firstChild);else firstChild.nodeValue=g.substring(1);}}n i=lastChild;while(i!=null&&i is OB)i=i.previousSibling;if(jG()&&lastChild is OB&&(i==null||!i.jE())){String g=lastChild.nodeValue;if(g.endsWith('\n')){if(g.length==1)CD(lastChild);else lastChild.nodeValue=g.substring(0,g.length-1);}}for(n h=firstChild;h!=null;h=h.nextSibling){if(h.jE()&&h.nextSibling is OB){String g=h.nextSibling.nodeValue;if(g.startsWith('\n')){if(g.length==1)CD(h.nextSibling);else h.nextSibling.nodeValue=g.substring(1);}}}}BB MF(AC i){assert(nodeType==tC);l g=i.createElementNS(tB,nodeName);for(iB k in attributes)g.setAttributeNS(k.tB,k.name,k.value);if(jG()||firstChild!=null){if(jG())g.mB(i.vG('\n'));for(n j=firstChild;j!=null;j=j.nextSibling){g.mB(j.MF(i));if(j.jE())g.mB(i.vG('\n'));}n h=lastChild;while(h!=null&&h is OB)h=h.previousSibling;if(jG()&&lastChild!=null&&(h==null||!h.jE()))g.mB(i.vG('\n'));}return (g);}String toString(){hH g=new AK();AC h=g.createDocument(null,null,null);BB i=MF(h);return (i.toString());}static String DT(String g){g=g.replaceAll('&','&amp;');g=g.replaceAll('"','&quot;');g=g.replaceAll('<','&lt;');g=g.replaceAll('>','&gt;');return (g);}void kG(){valid=s.CB.SO(this);Element g=DC();if(g==null)return;if(valid&&g.classes.contains('invalid'))g.classes.remove('invalid');else if(!valid&&!g.classes.contains('invalid'))g.classes.add('invalid');}void gV(kD g){if(AB!=null&&s.CB.iE(AB).length>0)QE(()=>g());else g();}void QE([kD h]){if(AB!=null){hM g=new hM(this,h);g.show();}else{lM g=new lM(this,h);g.show();}}q zG(num yB,num DB){q wC=new q(this,0);if(nodeType==tC||nodeType==BG){for(n QB=firstChild;QB!=null;QB=QB.nextSibling){Element g=QB.DC();if(g==null)continue;double SB,FB,HB,KB;double bB,jB;if(g is DivElement&&g.nodes.length>0&&g.firstChild is SpanElement&&(g.firstChild as SpanElement).classes.contains('start_tag')&&g.lastChild is SpanElement&&(g.lastChild as SpanElement).classes.contains('end_tag')){Element i=g.firstChild;Rectangle h=i.getBoundingClientRect();SB=h.left;FB=h.top;bB=i.offset.height.toDouble();i=g.lastChild;h=i.getBoundingClientRect();HB=h.right;KB=h.bottom;jB=i.offset.height.toDouble();}else if(g is DivElement||g is TableCellElement||g is TableRowElement||g is TableElement||g is ImageElement||g.classes.contains('form')){Rectangle h=g.getBoundingClientRect();SB=h.left;FB=h.top;if(g.classes.contains('form'))HB=g.querySelector('table').getBoundingClientRect().right;else HB=h.right;KB=h.bottom;bB=jB=h.height;}else if(g is SpanElement&&g.nodes.length==1&&g.firstChild is Text&&!g.firstChild.nodeValue.endsWith('\n')){List<Rectangle> k=g.getClientRects();if(k.length==0)return (null);Rectangle h=k.first;SB=h.left;FB=h.top;bB=h.height*1.4;h=k.last;HB=h.right;KB=h.bottom;jB=h.height*1.4;}else if(g.firstChild is Element&&g.lastChild is SpanElement&&g.lastChild.lastChild is Text&&!g.lastChild.lastChild.nodeValue.endsWith('\n')){Element i=g.firstChild;List<Rectangle> k=i.getClientRects();if(k.length==0)return (null);Rectangle h=k.first;SB=h.left;FB=h.top;bB=h.height*1.3;i=g.lastChild;k=i.getClientRects();if(k.length==0)return (null);h=k.last;HB=h.right;KB=h.bottom;jB=h.height*1.3;}else{Element i=new Element.tag('span');i.append(new Text("|"));if(g.nodes.length==1&&g.firstChild is BRElement){g.append(i);Rectangle h=i.getBoundingClientRect();SB=-1.0;FB=h.top;bB=jB=i.offset.height.toDouble()*1.4;HB=-1.0;KB=h.bottom;i.remove();}else{if(g.nodes.isEmpty)g.append(i);else g.insertBefore(i,g.firstChild);Rectangle h=i.getBoundingClientRect();SB=h.left;FB=h.top;bB=i.offset.height.toDouble()*1.4;i.remove();if(g is LIElement){Node m=g;while(m.firstChild!=null&&(m.lastChild is!Text||(m.lastChild.nodeValue=='\n'&&m.lastChild.previousNode!=null))&&m.lastChild is!ImageElement&&m.lastChild is!ScriptElement){if(m.lastChild is Text&&m.lastChild.nodeValue=='\n'&&m.lastChild.previousNode!=null)m=m.lastChild.previousNode;else m=m.lastChild;}m.append(i);}else g.append(i);h=i.getBoundingClientRect();HB=h.left;KB=h.bottom;jB=i.offset.height.toDouble()*1.4;i.remove();}}if((DB<FB+bB&&(DB<FB-1||(yB<SB+1&&g is!LIElement&&QB is!lB)))){return (wC);}if(DB>KB-jB&&(DB>KB+1||(yB>HB-1&&g is!LIElement))){wC=new q(this,aB(QB)+1);}else{wC=QB.zG(yB,DB);return (wC);}}}else if(nodeType==qB){int o=0;for(Node g in DC().nodes){Text v;if(g is Text)v=g;else if(g is Element)v=g.firstChild;else continue;Range HC=new Range();for(int j=0;j<v.length;j++ ){if(nodeValue[o+j]!='\n'){HC.setStart(v,j);HC.setEnd(v,j+1);List<Rectangle> k=HC.getClientRects();for(Rectangle t in k){if(ZB.window.navigator.appVersion.contains("Trident")&&o+j+1<nodeValue.length&&nodeValue[o+j+1]=='\n'&&t.width==0){continue;}if(j<nodeValue.length-1&&t.left==t.right&&yB<t.left&&DB<t.bottom){return (new q(this,o+j+1));}if(yB<t.right&&DB<=t.bottom){if(yB<(t.left+t.right)/2)return (new q(this,o+j));else return (new q(this,o+j+1));}else if(DB<t.top-5){if(o+j==0||nodeValue[o+j]==' ')return (new q(this,o+j));else return (new q(this,o+j-1));}}}else{String KD=v.text;v.text="${KD.substring(0,j)}|${KD.substring(j)}";HC.setStart(v,j);HC.setEnd(v,j+1);List<Rectangle> k=HC.getClientRects();v.text=KD;if(ZB.window.navigator.appVersion.contains("Trident")){if(DB<=k.first.bottom){return (new q(this,o+j));}}else{for(Rectangle t in k){if(DB<=t.bottom){return (new q(this,o+j));}}}}}o+= v.length;}}return (new q(this,PB));}q CF(){return (new q(this,0));}q PG(){return (new q(this,PB));}void KP(Element g){String j=s.CB.eC(AB,'style',null);if(j!=null){List<String> m=j.split(';');for(String h in m){if(h==kS){g.style.fontWeight='bold';}else if(h==lS){g.style.fontStyle='italic';}else if(h==mS){g.style.verticalAlign='super';g.style.fontSize='80%';}else if(h==nS){g.style.verticalAlign='sub';g.style.fontSize='80%';}else if(h==oS){g.style.textDecoration='underline';}else if(h==pS){g.style.textDecoration='line-through';}else if(h.startsWith(qS)){g.style.background=ZZ(h);}else if(h.startsWith(rS)){g.style.color=ZZ(h);}}}String i=s.CB.eC(AB,'police',null);if(i!=null){if(i=='Monospaced')i='monospace';g.style.fontFamily=i;}String k=s.CB.eC(AB,'taille',null);if(k!=null){g.style.fontSize=k;}}String ZZ(String j){Iterable<Match> k=sS.allMatches(j);for(Match m in k){final List<int> g=new List<int>();for(int h=0;h<3;h++ ){String i=m.group(h+1);if(i.startsWith("x"))g[h]=int.parse(i.substring(1),radix:16);else g[h]=int.parse(i);}return ("rgb(${g[0]}, ${g[1]}, ${g[2]})");}return (null);}void JO(){RU();for(n g=firstChild;g!=null;g=g.nextSibling){g.JO();}}void DR(){bU();for(n g=firstChild;g!=null;g=g.nextSibling){g.DR();}}void RU(){}void bU(){}bool get fV{return false;}}class TP{static bool IL=false;static bool oM=false;static String AG='';void show(){DivElement h=ZB.document.getElementById('find_dlg');if(h!=null){TextInputElement o=ZB.document.getElementById('find_dlg_find_field');o.focus();return;}Element wC=ZB.querySelector("#doc1");wC.style.bottom='10.5em';h=new DivElement();h.id='find_dlg';h.classes.add('find');FormElement t=new FormElement();TableElement v=new TableElement();TableRowElement j=new TableRowElement();TableCellElement g=new TableCellElement();g.text=LB.MB('find.find');j.append(g);g=new TableCellElement();TextInputElement o=new TextInputElement();o..id='find_dlg_find_field'..name='find'..size=40..value=AG;g.append(o);j.append(g);v.append(j);j=new TableRowElement();g=new TableCellElement();g.text=LB.MB('find.replace_by');j.append(g);g=new TableCellElement();TextInputElement HB=new TextInputElement();HB..id='find_dlg_replace_field'..name='replace_by'..size=40;g.append(HB);j.append(g);v.append(j);h.append(v);DivElement m=new DivElement();m.classes.add('options');CheckboxInputElement DB=new CheckboxInputElement();DB..id='find_cb_ignore_case'..checked=IL..onChange.listen((Event i)=>IL=DB.checked);m.append(DB);LabelElement KB=new LabelElement();KB..htmlFor='find_cb_ignore_case'..text=LB.MB("find.case_sensitive");m.append(KB);CheckboxInputElement FB=new CheckboxInputElement();FB..id='find_cb_backwards'..checked=oM..onChange.listen((Event i)=>oM=FB.checked);m.append(FB);LabelElement QB=new LabelElement();QB..htmlFor='find_cb_backwards'..text=LB.MB("find.backwards");m.append(QB);t.append(m);DivElement k=new DivElement();k.classes.add('buttons');ButtonElement SB=new ButtonElement();SB..attributes['type']='button'..appendText(LB.MB("button.Close"))..onClick.listen((MouseEvent i)=>close());k.append(SB);ButtonElement bB=new ButtonElement();bB..attributes['type']='button'..appendText(LB.MB("find.replace"))..onClick.listen((MouseEvent i)=>replace());k.append(bB);ButtonElement jB=new ButtonElement();jB..attributes['type']='button'..appendText(LB.MB("find.replace_find"))..onClick.listen((MouseEvent i)=>uV());k.append(jB);ButtonElement yB=new ButtonElement();yB..attributes['type']='button'..appendText(LB.MB("find.replace_all"))..onClick.listen((MouseEvent i)=>replaceAll());k.append(yB);ButtonElement HC=new ButtonElement();HC..attributes['type']='button'..appendText(LB.MB("find.next"))..onClick.listen((MouseEvent i)=>next());k.append(HC);t.append(k);h.append(t);ZB.document.body.append(h);h.onKeyDown.listen((KeyboardEvent i){if(i.keyCode==KeyCode.ESC){close();}});o.focus();}void next(){AG=((ZB.document.getElementById('find_dlg_find_field')) as TextInputElement).value;if(AG=='')return;q g;if(!oM){q h=IB.DF();if(h==null)h=new q(s.vC,0);g=hV(h);}else{q i=IB.BD();if(i==null)i=new q(s.vC,s.vC.PB);g=AP(i);}if(g!=null){IB.TD(g);IB.cursor.kE(g,new q(g.u,g.JB+AG.length));}}q hV(q j){n g=j.u;int h=j.JB;if(g is!OB){g=g.fB(h);h=0;}while(g!=null){if(g is OB){int i;if(!IL)i=g.nodeValue.toLowerCase().indexOf(AG.toLowerCase(),h);else i=g.nodeValue.indexOf(AG,h);if(i!=-1)return (new q(g,i));}g=g.nextNode();h=0;}return (null);}q AP(q k){n g=k.u;int h=k.JB;if(g is!OB){if(h>0)g=g.fB(h-1);else{n i=g;g=null;while(i!=null){if(i.previousSibling!=null){g=i.previousSibling;break;}i=i.parent;}}if(g!=null)h=g.PB;}while(g!=null){if(g is OB){int j;if(!IL)j=g.nodeValue.toLowerCase().substring(0,h).lastIndexOf(AG.toLowerCase());else j=g.nodeValue.substring(0,h).lastIndexOf(AG);if(j!=-1)return (new q(g,j));}g=g.previousNode();if(g!=null)h=g.PB;}return (null);}void replace(){q g=new q.yW(IB.BD());q h=new q.yW(IB.DF());if(g==null||g.u is!OB)return;String i=((ZB.document.getElementById('find_dlg_replace_field')) as TextInputElement).value;GB j=new GB.DX(LB.MB('find.replace'));if(i!='')j.TB(new GB.mW(h,i));if(g!=h&&g.u==h.u)j.TB(new GB.tW(g,h.JB-g.JB));s.KC(j);IB.cursor.kE(g,new q(g.u,g.JB+i.length));}void uV(){replace();next();}void replaceAll(){AG=((ZB.document.getElementById('find_dlg_find_field')) as TextInputElement).value;if(AG=='')return;String i=((ZB.document.getElementById('find_dlg_replace_field')) as TextInputElement).value;q g=AP(new q(s.vC,s.vC.PB));GB h=new GB.DX(LB.MB('find.replace_all'));while(g!=null){if(i!='')h.TB(new GB.mW(new q(g.u,g.JB+AG.length),i));h.TB(new GB.tW(g,AG.length));g=AP(g);}s.KC(h);}void close(){DivElement g=ZB.document.getElementById('find_dlg');g.remove();Element h=ZB.querySelector("#doc1");h.style.bottom='1.5em';IB.gG();}}class EH{l dF;l eG;StreamSubscription<KeyboardEvent> mO;EH.dW(this.dF){}EH.fW(this.eG,this.dF){}void show(){DivElement t=new DivElement();t.id='dlg1';t.classes.add('dlg1');DivElement KB=new DivElement();KB.classes.add('dlg2');DivElement g=new DivElement();g.classes.add('dlg3');DivElement i=new DivElement();i.style.position='absolute';i.style.top='0px';i.style.right='0px';i.style.width='16px';i.style.height='16px';ImageElement k=new ImageElement();k.src='packages/daxe/images/close_dialog.png';k.width=16;k.height=16;k.style.position='fixed';k.onClick.listen((MouseEvent m)=>close());i.append(k);g.append(i);DivElement QB=new DivElement();QB.classes.add('dlgtitle');if(eG==null)QB.text=s.CB.YD(dF);else QB.text=s.CB.GM(dF,eG);g.append(QB);if(eG==null){ParagraphElement h=new ParagraphElement();h.appendText(LB.MB('help.element_name')+' ');SpanElement j=new SpanElement();j.classes.add('help_element_name');j.text=s.CB.XD(dF);h.append(j);g.append(h);}else{ParagraphElement h=new ParagraphElement();h.appendText(LB.MB('help.attribute_name')+' ');SpanElement j=new SpanElement();j.classes.add('help_attribute_name');j.text=s.CB.attributeName(eG);h.append(j);g.append(h);String HC=s.CB.uF(eG);if(HC!=null){h=new ParagraphElement();h.appendText(LB.MB('help.default_value')+' ');SpanElement SB=new SpanElement();SB.classes.add('help_default_value');SB.text=HC;h.append(SB);g.append(h);}}String o;if(eG==null)o=s.CB.jI(dF);else o=s.CB.oH(dF,eG);if(o!=null){o=GH.HT(o);ParagraphElement h=new Element.html("<p>${o}</p>");g.append(h);}if(eG==null){String wC=s.CB.cD(dF);if(wC!=null){DivElement bB=new DivElement();bB.classes.add('help_regexp');bB.text=wC;g.append(bB);}SpanElement v=new SpanElement();v.id='help_parents';v.classes.add('help_list_title');v.text=LB.MB('help.parents');v.onClick.listen((MouseEvent m)=>vU());g.append(v);SpanElement DB=new SpanElement();DB.id='help_children';DB.classes.add('help_list_title');DB.text=LB.MB('help.children');DB.onClick.listen((MouseEvent m)=>RR());g.append(DB);SpanElement FB=new SpanElement();FB.id='help_attributes';FB.classes.add('help_list_title');FB.text=LB.MB('help.attributes');FB.onClick.listen((MouseEvent m)=>uU());g.append(FB);DivElement jB=new DivElement();jB.classes.add('help_list_div');UListElement KD=new UListElement();KD.id='help_list';jB.append(KD);g.append(jB);}DivElement yB=new DivElement();yB.classes.add('buttons');ButtonElement HB=new ButtonElement();HB.attributes['type']='submit';HB.appendText(LB.MB("button.Close"));HB.onClick.listen((MouseEvent m)=>close());yB.append(HB);g.append(yB);KB.append(g);t.append(KB);ZB.document.body.append(t);if(g.clientHeight>t.clientHeight*3/4){KB.style.left="33%";g.style.left="-25%";}if(eG==null)RR();mO=ZB.document.onKeyDown.listen(null);mO.onData((KeyboardEvent m){if(m.keyCode==KeyCode.ESC){close();}});HB.focus();}void vU(){SpanElement o=ZB.document.getElementById('help_parents');o.classes.add('selected_tab');SpanElement t=ZB.document.getElementById('help_children');t.classes.remove('selected_tab');SpanElement v=ZB.document.getElementById('help_attributes');v.classes.remove('selected_tab');UListElement k=ZB.document.getElementById('help_list');k.nodes.clear();List<l> g=s.CB.iC(dF);if(g==null||g.length==0)return;HashMap<l,String> i=CR(g.toSet());g.sort((DB,FB)=>i[DB].toLowerCase().compareTo(i[FB].toLowerCase()));for(l j in g){LIElement h=new LIElement();h.text=i[j];String m=s.CB.jI(j);if(m!=null)h.title=m;h.onClick.listen((MouseEvent HB)=>MS(j));h.classes.add('help_selectable');k.append(h);}}HashMap<l,String> CR(Set<l> FB,[int k=0]){HashMap<String,Set<l>> m=new HashMap<String,Set<l>>();for(l g in FB){Set<l> t=TU(g,k);String o=s.CB.YD(t.first);if(o!=null){bool v=true;for(l HB in t){if(s.CB.YD(HB)!=o){v=false;break;}}if(v){String h;if(k==0)h=s.CB.YD(g);else h=s.CB.YD(g)+" ("+o+")";Set i=m[h];if(i==null){i=new HashSet<l>();m[h]=i;}i.add(g);}}}HashMap<l,String> j=new HashMap<l,String>();for(String h in m.keys){Set<l> i=m[h];if(i.length>1&&k<10){HashMap<l,String> DB=CR(i,k+1);j.addAll(DB);for(l g in i)if(DB[g]==null){if(h.indexOf('(')==-1&&g.getAttribute('type')!='')j[g]=h+" ("+g.getAttribute('type')+")";else j[g]=h;}}else{for(l g in i)j[g]=h;}}return (j);}Set<l> TU(l k,int m){Set<l> g=new Set<l>();g.add(k);for(int h=0;h<m;h++ ){Set<l> i=new Set<l>();for(l o in g){List<l> j=s.CB.iC(o);if(j!=null)i.addAll(j);}g=i;}return (g);}void RR(){SpanElement o=ZB.document.getElementById('help_parents');o.classes.remove('selected_tab');SpanElement t=ZB.document.getElementById('help_children');t.classes.add('selected_tab');SpanElement v=ZB.document.getElementById('help_attributes');v.classes.remove('selected_tab');UListElement k=ZB.document.getElementById('help_list');k.nodes.clear();List<l> g=s.CB.bC(dF);if(g==null||g.length==0)return;HashMap<l,String> i=new HashMap.fromIterable(g,value:(l DB)=>s.CB.YD(DB));g.sort((FB,HB)=>i[FB].toLowerCase().compareTo(i[HB].toLowerCase()));for(l j in g){LIElement h=new LIElement();h.text=i[j];String m=s.CB.jI(j);if(m!=null)h.title=m;h.onClick.listen((MouseEvent KB)=>MS(j));h.classes.add('help_selectable');k.append(h);}}void uU(){SpanElement o=ZB.document.getElementById('help_parents');o.classes.remove('selected_tab');SpanElement t=ZB.document.getElementById('help_children');t.classes.remove('selected_tab');SpanElement v=ZB.document.getElementById('help_attributes');v.classes.add('selected_tab');UListElement k=ZB.document.getElementById('help_list');k.nodes.clear();List<l> g=s.CB.iE(dF);if(g==null||g.length==0)return;HashMap<l,String> i=new HashMap.fromIterable(g,value:(l h)=>s.CB.GM(dF,h));g.sort((DB,FB)=>i[DB].toLowerCase().compareTo(i[FB].toLowerCase()));for(l h in g){LIElement j=new LIElement();j.text=i[h];String m=s.CB.oH(dF,h);if(m!=null)j.title=m;k.append(j);}}void MS(l g){this.dF=g;eG=null;close();show();}void close(){mO.cancel();DivElement g=ZB.document.getElementById('dlg1');g.remove();IB.gG();}}class WP{void update(n k,List<l> DB,List<l> FB){Element h=ZB.document.getElementById('insert');for(Element HB in h.children)HB.remove();GH j=s.CB;if(j==null)return;if(k.nodeType==n.tC&&k.AB!=null){h.append(aZ(k.AB));String m=j.XD(k.AB);SpanElement v=new SpanElement();v.appendText(j.zH(m));h.append(v);h.append(new HRElement());}List<l> o;if(IB.toolbar!=null)o=IB.toolbar.PR();else o=null;for(l i in DB){if(o!=null&&o.contains(i))continue;if(s.VC!=null&&s.VC.contains(i))continue;h.append(aZ(i));ButtonElement g=new ButtonElement();g.attributes['type']='button';g.classes.add('insertb');String m=j.XD(i);g.value=m;g.text=j.zH(m);if(!FB.contains(i))g.disabled=true;g.onClick.listen((Event t)=>insert(i));g.onKeyDown.listen((KeyboardEvent t){int KB=t.keyCode;if(KB==KeyCode.ENTER){t.preventDefault();insert(i);}});h.append(g);h.append(new BRElement());}}ButtonElement aZ(l h){ButtonElement g=new ButtonElement();g.attributes['type']='button';g.classes.add('help');g.value='?';g.text='?';String i=s.CB.jI(h);if(i!=null)g.title=i;g.onClick.listen((Event j)=>fO(h));return (g);}void insert(l g){s.oI(g,'element');}void fO(l g){EH h=new EH.dW(g);h.show();}}class EE implements q{int bZ;EE(int g){assert(g>=0);bZ=g;}EE.gW(gC i){n j=i.u;int k=i.JB;bZ=0;n g=s.vC;int h=0;while(g!=j||h!=k){if(h==g.PB){h=g.parent.aB(g)+1;g=g.parent;}else if(g is OB){h++ ;}else{g=g.fB(h);h=0;}bZ++ ;}}EE.qW(wD k){n i=s.vC;int m=i.PB;int j=0;n g=s.vC;int h=0;while(g!=i||h!=m){if(h==g.PB){h=g.parent.aB(g)+1;g=g.parent;}else if(g is OB){h++ ;}else{g=g.fB(h);h=0;}j++ ;}bZ=j-k.VF;}EE.vW(EE g){bZ=g.LF;}n get u{gC g=new gC.kW(this);return (g.u);}int get JB{gC g=new gC.kW(this);return (g.JB);}int get LF{return (bZ);}int get VF{wD g=new wD.sW(this);return (g.VF);}bool operator==(q g){return (bZ==g.LF);}bool operator<(q g){return (bZ<g.LF);}bool operator<=(q g){return (bZ<=g.LF);}bool operator>(q g){return (bZ>g.LF);}bool operator>=(q g){return (bZ>=g.LF);}void QG(int g){bZ+= g;}void EF(){gC g=new gC.kW(this);g.EF();bZ=g.LF;}FD gF(){gC g=new gC.kW(this);return (g.gF());}String JI({bool titles: false}){gC g=new gC.kW(this);return (g.JI(titles:titles));}String toString(){return ("[LeftOffsetPosition ${bZ}]");}}class kM{int cZ;WP dZ;jM eZ;kM(){cZ=0;dZ=new WP();eZ=new jM();}DivElement UB(){DivElement k=new DivElement();k.id='left_panel';DivElement m=new DivElement();m.id='tab_buttons';SpanElement h=new SpanElement();h.id='insert_tab_button';h.classes.add('tab_button');h.classes.add('selected');h.setAttribute('tabindex','-1');h.appendText(LB.MB('left.insert'));h.onClick.listen((MouseEvent j)=>FP());h.onKeyDown.listen((KeyboardEvent j){int g=j.keyCode;if(g==KeyCode.ENTER||g==KeyCode.DOWN){Element t=ZB.document.getElementById('insert');if(t.firstChild is ButtonElement){j.preventDefault();(t.firstChild as ButtonElement).focus();}}else if(g==KeyCode.RIGHT){HP();}else if(g==KeyCode.TAB){Timer.run((){IB.cursor.show();IB.cursor.focus();});}});m.append(h);SpanElement i=new SpanElement();i.id='tree_tab_button';i.classes.add('tab_button');i.setAttribute('tabindex','-1');i.appendText(LB.MB('left.tree'));i.onClick.listen((MouseEvent j)=>HP());i.onKeyDown.listen((KeyboardEvent j){int g=j.keyCode;if(g==KeyCode.ENTER||g==KeyCode.DOWN){if(eZ.VE!=null)eZ.VE.focus();}else if(g==KeyCode.LEFT){FP();}else if(g==KeyCode.TAB){Timer.run((){IB.cursor.show();IB.cursor.focus();});}});m.append(i);k.append(m);DivElement v=new DivElement();v.id='insert';k.append(v);DivElement o=new DivElement();o.id='tree';o.style.display='none';k.append(o);return (k);}void FP(){ZB.document.getElementById('insert').style.display='block';ZB.document.getElementById('tree').style.display='none';ZB.document.getElementById('insert_tab_button').classes.add('selected');ZB.document.getElementById('tree_tab_button').classes.remove('selected');ZB.document.getElementById('insert_tab_button').setAttribute('tabindex','0');ZB.document.getElementById('tree_tab_button').setAttribute('tabindex','-1');ZB.document.getElementById('insert_tab_button').focus();cZ=0;if(IB.BD()==null)return;n g=IB.BD().u;if(g is OB)g=g.parent;List<l> h=s.VO(g);List<l> i=s.RP(h);dZ.update(g,h,i);}void HP(){ZB.document.getElementById('tree').style.display='block';ZB.document.getElementById('insert').style.display='none';ZB.document.getElementById('tree_tab_button').classes.add('selected');ZB.document.getElementById('insert_tab_button').classes.remove('selected');ZB.document.getElementById('tree_tab_button').setAttribute('tabindex','0');ZB.document.getElementById('insert_tab_button').setAttribute('tabindex','-1');ZB.document.getElementById('tree_tab_button').focus();cZ=1;eZ.update();}void update(n g,List<l> h,List<l> i){if(cZ==0)dZ.update(g,h,i);else eZ.update();}}class ZE{String language;String qH;ZE(){List<String> g=LB.ZL.split('_');language=g[0];if(g.length>1)qH=g[1];else qH=null;}ZE.eW(String g){this.language=g;this.qH=null;}ZE.jW(String g,String h){this.language=g;this.qH=h;}int get hashCode{int g=17;g=37*g+language.hashCode;g=37*g+qH.hashCode;return g;}bool operator==(ZE g){return (language==g.language&&qH==g.qH);}}class dB extends IC{List<IC> items;String pO;dB(String g):super(g,null){items=new List<IC>();this.pO="menu_${IC.iM-1}";}add(IC g){g.parent=this;items.add(g);}Element mR(){TableRowElement g=new TableRowElement();g.id=hG;g.setAttribute('tabindex','-1');g.onKeyDown.listen((KeyboardEvent k){if(ZB.document.activeElement!=g)return;int i=k.keyCode;if(i==KeyCode.ENTER){select();}else if(i==KeyCode.UP){(parent as dB).cJ(this);}else if(i==KeyCode.DOWN){(parent as dB).wK(this);}else if(i==KeyCode.LEFT){if(parent is dB){if((parent as dB).parent is dB)(parent as dB).select();else if((parent as dB).parent is zF)((parent as dB).parent as zF).cJ(parent as dB);}}else if(i==KeyCode.RIGHT){for(IC m in items){if(m.enabled){m.select();break;}}}else if(i==KeyCode.TAB){Timer.run(NO);}});TableCellElement h=new TableCellElement();h.text=fZ;h.onMouseOver.listen((MouseEvent k){if(enabled){select();show();}});g.append(h);h=new TableCellElement();h.text=">";DivElement j=PM();j.classes.remove('dropdown_menu');j.classes.add('submenu');j.style.display='none';h.append(j);h.onMouseOver.listen((MouseEvent k){if(enabled){select();show();}});g.append(h);if(!enabled)g.classes.add('disabled');if(uI!=null)g.title=uI;return (g);}Element PM(){DivElement g=new DivElement();g.classes.add('dropdown_menu');g.id=pO;TableElement h=new TableElement();h.classes.add('menu');for(IC i in items){h.append(i.mR());}g.append(h);return (g);}Element qK(){return (ZB.querySelector("#${pO}"));}void show(){DivElement g=qK();g.style.display='block';}void RH(){for(IC g in items){if(g is dB)g.RH();g.xG();}DivElement h=qK();h.style.display='none';}bool rR(){DivElement g=qK();return (g.style.display!='none');}void EO(){items.add(new IC.nW());}void oU(IC h){for(IC g in items){if(g!=h)g.xG();}}void set title(String h){fZ=h;Element g=ZB.querySelector("#${hG}");if(g is TableRowElement){TableRowElement j=g;TableCellElement k=j.nodes.first;k.text=h;}else if(g is DivElement){Node i=g.firstChild;if(i is Text)i.text=h;}}void MO(){bool g=false;for(IC i in items){if(i.enabled){g=true;break;}}if(g==enabled)return;Element h=ZB.querySelector("#${hG}");if(g)h.classes.remove('disabled');else h.classes.add('disabled');enabled=g;if(parent is dB)(parent as dB).MO();}void DW(){for(IC g in items){if(g.enabled){g.select();return;}}}void cJ(IC h){bool i=false;for(IC g in items.reversed){if(g==h){i=true;}else if(i&&g.enabled){h.xG();g.select();break;}}}void wK(IC h){bool i=false;for(IC g in items){if(g==h){i=true;}else if(i&&g.enabled){h.xG();g.select();break;}}}}class IC{static int iM=0;String hG;String fZ;Object parent;kD action;String shortcut;Object data;bool enabled;bool selected;bool lO;String uI;bool checked;IC(this.fZ,this.action,{this.shortcut,this.data}){this.hG="item_${iM}";iM++ ;parent=null;enabled=true;selected=false;lO=false;checked=false;}IC.nW(){lO=true;enabled=false;checked=false;selected=false;}Element mR(){TableRowElement h=new TableRowElement();if(lO){TableCellElement g=new TableCellElement();g.append(new HRElement());h.append(g);}else{h.id=hG;h.setAttribute('tabindex','-1');h.onKeyDown.listen((KeyboardEvent i){int j=i.keyCode;if(j==KeyCode.ENTER){i.preventDefault();NO();BO();}else if(j==KeyCode.UP){(parent as dB).cJ(this);}else if(j==KeyCode.DOWN){(parent as dB).wK(this);}else if(j==KeyCode.LEFT){if((parent as dB).parent is dB){(parent as dB).RH();(parent as dB).vH().focus();i.preventDefault();i.stopPropagation();}else if((parent as dB).parent is zF)((parent as dB).parent as zF).cJ(parent as dB);}else if(j==KeyCode.RIGHT){Object k=parent;while(k is dB)k=(k as dB).parent;if(k is zF)k.wK(null);}else if(j==KeyCode.TAB){Timer.run(NO);}});TableCellElement g=new TableCellElement();g.text=fZ;g.onMouseUp.listen((MouseEvent i)=>BO());g.onMouseOver.listen((MouseEvent i){if(enabled)select();});g.onMouseOut.listen((MouseEvent i)=>xG());h.append(g);g=new TableCellElement();if(this.shortcut!=null)g.text="Ctrl+${shortcut}";g.onMouseUp.listen((MouseEvent i)=>BO());g.onMouseOver.listen((MouseEvent i){if(enabled)select();});g.onMouseOut.listen((MouseEvent i)=>xG());if(checked)h.classes.add('checked');h.append(g);if(!enabled)h.classes.add('disabled');}if(uI!=null)h.title=uI;return (h);}Element vH(){return (ZB.querySelector("#${hG}"));}void BO(){if(!enabled)return;IB.gG();action();}void select(){if(selected)return;selected=true;Element g=vH();g.classes.add('selected');if(this is dB){(this as dB).show();}if(parent is dB)(parent as dB).oU(this);g.focus();}void xG(){if(!selected)return;selected=false;Element g=vH();if(g!=null){g.classes.remove('selected');g.blur();}if(this is dB){(this as dB).RH();}}void disable(){if(!enabled)return;enabled=false;Element g=vH();g.classes.remove('selected');g.classes.add('disabled');if(parent is dB)(parent as dB).MO();}void enable(){if(enabled)return;enabled=true;Element g=vH();g.classes.remove('disabled');if(parent is dB)(parent as dB).MO();}void check(){if(checked)return;checked=true;Element g=vH();g.classes.add('checked');}void NS(){if(!checked)return;checked=false;Element g=vH();g.classes.remove('checked');}String get title{return (fZ);}void set title(String g){fZ=g;TableRowElement h=ZB.querySelector("#${hG}");TableCellElement i=h.nodes.first;i.text=g;}void NO(){if(parent is!dB)return;dB g=parent;while(g.parent is dB)g=g.parent;if(g.parent is zF)(g.parent as zF).lR();else g.RH();}}class zF{List<dB> AI;bool rK;dB hF;zF(){AI=new List<dB>();rK=false;hF=null;}add(dB g){AI.add(g);}insert(dB g,int h){AI.insert(h,g);}Element UB(){DivElement g=new DivElement();g.classes.add('menubar');bool h=false;for(dB i in AI){DivElement j=MR(i);g.append(j);if(!h&&i.enabled){j.setAttribute('tabindex','0');h=true;}}ZB.document.onMouseUp.listen((MouseEvent k)=>pU(k));return (g);}DivElement MR(dB g){DivElement h=new DivElement();h.text=g.title;h.id=g.hG;h.classes.add('menu_title');if(g.parent is lJ)h.setAttribute('tabindex','0');else h.setAttribute('tabindex','-1');h.onMouseDown.listen((MouseEvent i)=>cV(i,g));h.onMouseOver.listen((MouseEvent i)=>dV(i,g));h.onClick.listen((MouseEvent i)=>click(g));h.onKeyDown.listen((KeyboardEvent i){if(ZB.document.activeElement!=h)return;int j=i.keyCode;if(j==KeyCode.ENTER||j==KeyCode.DOWN){i.preventDefault();if(g==hF)g.DW();else eJ(g);}else if(j==KeyCode.LEFT){cJ(g);}else if(j==KeyCode.RIGHT){wK(g);}else if(j==KeyCode.TAB){Timer.run(lR);}});Element k=g.PM();k.style.display='none';h.append(k);return (h);}void cV(MouseEvent h,dB g){h.preventDefault();if(!g.rR()){eJ(g);rK=true;}else{rK=false;}}void dV(MouseEvent h,dB g){if(hF==null||hF==g)return;XJ(hF);eJ(g);}void click(dB g){if(rK){return;}if(!g.rR()){eJ(g);}else{XJ(g);}}void pU(MouseEvent g){if(hF==null)return;DivElement i=ZB.querySelector("#${hF.hG}");Rectangle h=i.getBoundingClientRect();if(g.client.x<h.left||g.client.x>h.right||g.client.y<h.top||g.client.y>h.bottom){XJ(hF);rK=true;}}void eJ(dB g){hF=g;DivElement h=ZB.querySelector("#${g.hG}");h.classes.add('selected');g.show();g.vH().focus();}void XJ(dB g){hF=null;DivElement h=ZB.querySelector("#${g.hG}");h.classes.remove('selected');g.RH();}void lR(){if(hF!=null)XJ(hF);}void cJ(dB g){if(g==null)g=hF;if(g==null)return;bool i=false;for(dB h in AI.reversed){if(h==g){i=true;}else if(i&&h.enabled){XJ(g);eJ(h);return;}}}void wK(dB g){if(g==null)g=hF;if(g==null)return;bool i=false;for(dB h in AI){if(h==g){i=true;}else if(i&&h.enabled){XJ(g);eJ(h);return;}}}}typedef n GL(BB _0,n _1);typedef n JL(l _0);pD KL=new pD();class pD{HashMap<String,JL> IR=new HashMap<String,JL>();HashMap<String,GL> HR=new HashMap<String,GL>();static void tS(){nC('anchor',(l i)=>new oG.PX(i),(BB g,n h)=>new oG.sX(g,h));nC('area',(l i)=>new DJ.eX(i),(BB g,n h)=>new DJ.tX(g,h));nC('br',(l i)=>new RL.MX(i),(BB g,n h)=>new RL.aX(g,h));nC('champ',(l i)=>new xI.QX(i),(BB g,n h)=>new xI.rX(g,h));nC('division',(l i)=>new TL.hX(i),(BB g,n h)=>new TL.vX(g,h));nC('empty',(l i)=>new zI.OX(i),(BB g,n h)=>new zI.iX(g,h));nC('equationmem',(l i)=>new EJ.zX(i),(BB g,n h)=>new EJ.EY(g,h));nC('equatexmem',(l i)=>new FJ.FY(i),(BB g,n h)=>new FJ.JY(g,h));nC('field',(l i)=>new xI.QX(i),(BB g,n h)=>new xI.rX(g,h));nC('hr',(l i)=>new QL.JX(i),(BB g,n h)=>new QL.RX(g,h));nC('item',(l i)=>new JH.LX(i),(BB g,n h)=>new JH.XX(g,h));nC('list',(l i)=>new SI.SX(i),(BB g,n h)=>new SI.xX(g,h));nC('liste',(l i)=>new SI.SX(i),(BB g,n h)=>new SI.xX(g,h));nC('fichier',(l i)=>new eH.qX(i),(BB g,n h)=>new eH.AY(g,h));nC('file',(l i)=>new eH.qX(i),(BB g,n h)=>new eH.AY(g,h));nC('form',(l i)=>new nE.nX(i),(BB g,n h)=>new nE.CY(g,h));nC('formulaire',(l i)=>new nE.nX(i),(BB g,n h)=>new nE.CY(g,h));nC('hiddendiv',(l i)=>new yI.NX(i),(BB g,n h)=>new yI.lX(g,h));nC('hiddenp',(l i)=>new lB.fX(i),(BB g,n h)=>new lB.uX(g,h));nC('simpletype',(l i)=>new CJ.bX(i),(BB g,n h)=>new CJ.mX(g,h));nC('string',(l i)=>new BJ.UX(i),(BB g,n h)=>new BJ.oX(g,h));nC('style',(l i)=>new zB.BY(i),(BB g,n h)=>new zB.DY(g,h));nC('stylespan',(l i)=>new bE.WX(i),(BB g,n h)=>new bE.pX(g,h));nC('symbol2',(l i)=>new AJ.VX(i),(BB g,n h)=>new AJ.jX(g,h));nC('symbole2',(l i)=>new AJ.VX(i),(BB g,n h)=>new AJ.jX(g,h));nC('table',(l i)=>new YG.GY(i),(BB g,n h)=>new YG.IY(g,h));nC('texttable',(l i)=>new YG.GY(i),(BB g,n h)=>new YG.IY(g,h));nC('tabletexte',(l i)=>new YG.GY(i),(BB g,n h)=>new YG.IY(g,h));nC('text',null,(BB g,n h)=>new OB.IX(g,h));nC('texte',null,(BB g,n h)=>new OB.IX(g,h));nC('typesimple',(l i)=>new CJ.bX(i),(BB g,n h)=>new CJ.mX(g,h));nC('vide',(l i)=>new zI.OX(i),(BB g,n h)=>new zI.iX(g,h));nC('zone',(l i)=>new DJ.eX(i),(BB g,n h)=>new DJ.tX(g,h));nC('witem',(l i)=>new yD.KX(i),(BB g,n h)=>new yD.TX(g,h));nC('wlist',(l i)=>new jC.dX(i),(BB g,n h)=>new jC.yX(g,h));}static void nC(String g,JL h,GL i){if(h!=null)KL.IR[g]=h;if(i!=null)KL.HR[g]=i;}static n MI(BB g,n h){l j;if(g is AC){return (new nG.cX(g));}else if(g is fL){return (new CG.ZX(g,h));}else if(g is eL){return (new IH.gX(g,h));}else if(g is gL){return (new DG.YX(g,h));}if(g is l){j=s.CB.OM(g,h!=null?h.AB:null);}else{j=null;}String m=s.CB.zR(j,g.nodeName,g.nodeType);GL o=KL.HR[m];n i;if(o!=null)i=o(g,h);else if(m=='plugin'){String k=s.CB.vO(j,'element',g.nodeName,"classe",null);if(k=='xpages.JEEquationMemoire')i=new EJ.EY(g,h);else if(k=='xpages.JEEquaTeXMemoire')i=new FJ.JY(g,h);else if(k=='xpages.jeimage.JEImage')i=new eH.AY(g,h);}else i=new BJ.oX(g,h);return (i);}static n jF(l g,[String i='element']){if(i=='commentaire'){return (new CG());}else if(i=='instruction'){return (new IH());}else if(i=='cdata'){return (new DG());}String k=s.CB.zR(g,s.CB.XD(g),BB.zE);JL m=KL.IR[k];n h;if(m!=null)h=m(g);else if(k=='plugin'){String j=s.CB.vO(g,'element',s.CB.XD(g),"classe",null);if(j=='xpages.JEEquationMemoire')h=new EJ.zX(g);else if(j=='xpages.JEEquaTeXMemoire')h=new FJ.FY(g);else if(j=='xpages.jeimage.JEImage')h=new eH.qX(g);}else h=new BJ.UX(g);return (h);}}class gC implements q{n gZ;int hZ;gC(n g,int h){assert(g!=null);assert(h>=0);gZ=g;hZ=h;}gC.kW(EE g){gZ=s.vC;hZ=0;QG(g.LF);}gC.oW(wD g){gZ=s.vC;hZ=gZ.PB;QG(-g.VF);}n get u{return (gZ);}int get JB{return (hZ);}int get LF{EE g=new EE.gW(this);return (g.LF);}int get VF{wD g=new wD.hW(this);return (g.VF);}bool operator==(q g){gC h;if(g is gC)h=g;else if(g is EE)h=new gC.kW(g);else if(g is wD)h=new gC.oW(g);return (gZ==h.gZ&&hZ==h.hZ);}bool operator<(q i){gC j;if(i is gC)j=i;else if(i is EE)j=new gC.kW(i);else if(i is wD)j=new gC.oW(i);n o=null;n g=gZ;double k=hZ.toDouble();while(g!=null){n h=j.gZ;double m=j.hZ.toDouble();while(h!=null){if(g==h){return (k<m);}if(h.parent==null)break;m=h.parent.aB(h)+0.5;h=h.parent;}if(g.parent==null)break;k=g.parent.aB(g)+0.5;g=g.parent;}assert(false);return (false);}bool operator<=(q g){return (this<g||this==g);}bool operator>(q g){return (!(this==g||this<g));}bool operator>=(q g){return (this>g||this==g);}void QG(int h){if(h>0){int g=h;while(g>0){if(hZ==gZ.PB){hZ=gZ.parent.aB(gZ)+1;gZ=gZ.parent;}else if(gZ is OB){hZ++ ;}else{gZ=gZ.fB(hZ);hZ=0;}g-- ;}}else if(h<0){int g=h;while(g<0){if(hZ==0){hZ=gZ.parent.aB(gZ);gZ=gZ.parent;}else if(gZ is OB){hZ-- ;}else{gZ=gZ.fB(hZ-1);hZ=gZ.PB;}g++ ;}}}void EF(){if(gZ.nodeType==n.tC&&hZ>0&&gZ.fB(hZ-1).nodeType==n.qB){gZ=gZ.fB(hZ-1);hZ=gZ.PB;}else if(gZ.nodeType==n.tC&&hZ<gZ.PB&&gZ.fB(hZ).nodeType==n.qB){gZ=gZ.fB(hZ);hZ=0;}else if(hZ==0&&gZ.firstChild!=null&&gZ.firstChild.nodeType==n.qB){gZ=gZ.firstChild;}}FD gF(){if(gZ.nodeType==n.qB){Element k=gZ.CE();if(k==null||k.nodes.length==0)return (null);assert(k.nodes.first is Text);Text h=k.nodes.first;int i=hZ;String m=h.text;assert(m.length!=0);Range j=new Range();FD t;if(i==0){j.setStart(h,i);j.setEnd(h,m.length);Rectangle g=j.getClientRects().first;t=new FD(g.left,g.top);}else if(m[i-1]=='\n'||m[i-1]==' '){if(i==m.length){if(gZ.nextSibling!=null&&gZ.nextSibling.nodeType==n.tC&&(m[i-1]=='\n'||!gZ.nextSibling.hC)){Rectangle g=(gZ.nextSibling.DC()).getClientRects()[0];t=new FD(g.left,g.top);}else if(m[i-1]==' '){j.setStart(h,0);j.setEnd(h,i);Rectangle g=j.getClientRects().last;t=new FD(g.right,g.top);}else{SpanElement DB=new SpanElement();DB.appendText("|");if(h.nextNode==null)k.append(DB);else k.insertBefore(DB,h.nextNode);Rectangle g=DB.getClientRects()[0];t=new FD(g.left,g.top);DB.remove();}}else{j.setStart(h,i);j.setEnd(h,i+1);List<Rectangle> o=j.getClientRects();Rectangle g;if(m[i-1]==' '&&i<m.length&&m[i]=='\n'){if(ZB.window.navigator.appVersion.contains("Trident")){j.setStart(h,i-1);j.setEnd(h,i);o=j.getClientRects();g=o.first;g=new Rectangle(g.left+7,g.top,g.width,g.height);}else g=o.first;}else if(m[i]=='\n'&&o.length==3)g=o[1];else if((ZB.window.navigator.userAgent.toLowerCase().indexOf('msie')>=0||ZB.window.navigator.appVersion.contains("Trident"))&&m[i-1]=='\n'&&m[i]=='\n'&&o.length==2)g=o.first;else{g=o.last;for(Rectangle SB in o)if(SB.width>1){g=SB;break;}}t=new FD(g.left,g.top);}}else{Rectangle g;if(ZB.window.navigator.appVersion.contains("Trident")&&i<m.length&&m[i]=='\n'){j.setStart(h,i-1);j.setEnd(h,i);g=j.getClientRects().first;}else{j.setStart(h,0);j.setEnd(h,i);g=j.getClientRects().last;}t=new FD(g.right,g.top);}return (t);}else{List<n> v=gZ.childNodes;if(v!=null&&hZ>0&&hZ==v.length){Element h=v[hZ-1].DC();if(h==null)return (null);Rectangle g;if(h is ImageElement||h is TableRowElement){g=h.getBoundingClientRect();return (new FD(g.right,g.top));}else if(h is DivElement||h is TableElement||h is UListElement||h is LIElement){g=h.getBoundingClientRect();return (new FD(g.left,g.bottom));}else{List<Rectangle> o=h.getClientRects();if(o.length==0)return (null);Rectangle g=o.last;return (new FD(g.right,g.top));}}else if(v!=null&&hZ<v.length){Element k=v[hZ].DC();if(k==null)return (null);if(hZ>0){n QB=v[hZ-1];n bB=v[hZ];Element jB=QB.DC();Element yB=k;if(QB.hC&&!bB.hC){List<Rectangle> HC=yB.getClientRects();if(HC.length==0)return (null);Rectangle FB=HC.first;return (new FD(FB.left,FB.top));}else if(QB.hC&&bB.hC){Rectangle HB=jB.getBoundingClientRect();Rectangle FB=yB.getBoundingClientRect();return (new FD(FB.left,(HB.bottom+FB.top)/2));}else{List<Rectangle> wC=jB.getClientRects();if(wC.length==0)return (null);Rectangle HB=wC.last;return (new FD(HB.right,HB.top));}}if(v[hZ] is yD){Rectangle g=k.getClientRects()[0];return (new FD(g.left-21,g.top+2));}Rectangle g=k.getClientRects()[0];return (new FD(g.left,g.top));}else{assert(hZ==0);Element k=gZ.CE();if(k==null)return (null);List<Rectangle> o=k.getClientRects();if(o.length==0)return (null);Rectangle g=o[0];FD t=new FD(g.left,g.top);CssStyleDeclaration YE=k.getComputedStyle();String KB=YE.paddingLeft;if(KB!=null&&KB.endsWith('px')){int KD=int.parse(KB.substring(0,KB.length-2),onError:(HF)=>null);if(KD!=null)t.x=t.x+KD;}return (t);}}}String JI({bool titles: false}){String i="";n g=gZ;while(g!=null){String k="";if(g.parent!=null){int m=1;for(n h=g.parent.firstChild;h!=null;h=h.nextSibling){if(h==g)break;if(h.nodeType==n.tC&&h.nodeName==g.nodeName)m++ ;}k="[${m}]";}if(g.nodeType==n.tC){String j;if(titles&&s.CB!=null&&g.AB!=null)j=s.CB.YD(g.AB);else j=g.nodeName;i="${j}${k}/${i}";}else if(g.nodeType==n.qB)i="#text";g=g.parent;}return ("/${i}");}String toString(){return ("[NodeOffsetPosition ${gZ.nodeName} ${hZ}]");}}abstract class q{factory q(n g,int h){return (new gC(g,h));}factory q.cW(int g){return (new EE(g));}factory q.iW(int g){return (new wD(g));}factory q.pW(q g){if(g is gC)return (new EE.gW(g));else if(g is EE)return (new EE.vW(g));else if(g is wD)return (new EE.qW(g));}factory q.uW(q g){if(g is gC)return (new wD.hW(g));else if(g is EE)return (new wD.sW(g));else if(g is wD)return (new wD.wW(g));}factory q.yW(q g){if(g is gC)return (new gC(g.u,g.JB));else if(g is EE)return (new EE(g.LF));else if(g is wD)return (new wD(g.VF));}n get u;int get JB;int get LF;int get VF;bool operator==(q g);bool operator<(q g);bool operator<=(q g);bool operator>(q g);bool operator>=(q g);void QG(int g);void EF();FD gF();String JI({bool titles: false});String toString();}class FD{num x;num y;FD(num this.x,num this.y);}class wD implements q{int iZ;wD(int g){assert(g>=0);iZ=g;}wD.hW(gC i){n j=i.u;int k=i.JB;iZ=0;n g=s.vC;int h=g.PB;while(g!=j||h!=k){if(h==0){h=g.parent.aB(g);g=g.parent;}else if(g is OB){h-- ;}else{g=g.fB(h-1);h=g.PB;}iZ++ ;}}wD.sW(EE k){n i=s.vC;int m=i.PB;int j=0;n g=s.vC;int h=0;while(g!=i||h!=m){if(h==g.PB){h=g.parent.aB(g)+1;g=g.parent;}else if(g is OB){h++ ;}else{g=g.fB(h);h=0;}j++ ;}iZ=j-k.LF;}wD.wW(wD g){iZ=g.VF;}n get u{gC g=new gC.oW(this);return (g.u);}int get JB{gC g=new gC.oW(this);return (g.JB);}int get LF{EE g=new EE.qW(this);return (g.LF);}int get VF{return (iZ);}bool operator==(q g){return (iZ==g.VF);}bool operator<(q g){return (iZ>g.VF);}bool operator<=(q g){return (iZ>=g.VF);}bool operator>(q g){return (iZ<g.VF);}bool operator>=(q g){return (iZ<=g.VF);}void QG(int g){iZ-= g;}void EF(){gC g=new gC.oW(this);g.EF();iZ=(new wD.hW(g)).iZ;}FD gF(){gC g=new gC.oW(this);return (g.gF());}String JI({bool titles: false}){gC g=new gC.oW(this);return (g.JI(titles:titles));}String toString(){return ("[RightOffsetPosition ${iZ}]");}}class gS{void show(){AC o=s.RW();s.QV(o);DivElement h=new DivElement();h.id='dlg1';h.classes.add('dlg1');DivElement i=new DivElement();i.classes.add('source_window');DivElement m=new DivElement();m.classes.add('source_content');DO(o,m);i.append(m);DivElement j=new DivElement();j.classes.add('source_bottom');ButtonElement k=new ButtonElement();k.attributes['type']='button';k.appendText(LB.MB("source.select_all"));k.onClick.listen((MouseEvent t)=>EP());j.append(k);ButtonElement g=new ButtonElement();g.attributes['type']='submit';g.appendText(LB.MB("button.Close"));g.onClick.listen((MouseEvent t)=>close());j.append(g);i.append(j);h.append(i);ZB.document.body.append(h);g.focus();}void DO(BB i,Element g){switch (i.nodeType){case BB.GK:SpanElement m=new SpanElement();m.classes.add('source_pi');String DB=(i as AC).UG;String FB=(i as AC).yF;m.appendText('<?xml version="${DB}" encoding="${FB}"?>');g.append(m);g.appendText('\n');for(BB k=i.firstChild;k!=null;k=k.nextSibling){DO(k,g);}break;case BB.zE:g.appendText('<');SpanElement j=new SpanElement();j.classes.add('source_element_name');j.appendText(i.nodeName);g.append(j);if(i.attributes!=null){for(oC v in i.attributes.values){g.appendText(' ');SpanElement o=new SpanElement();o.classes.add('source_attribute_name');o.appendText(v.nodeName);g.append(o);g.appendText('="');SpanElement t=new SpanElement();t.classes.add('source_attribute_value');jZ(t,v.nodeValue);g.append(t);g.appendText('"');}}if(i.firstChild!=null){g.appendText('>');if(i.childNodes!=null){for(BB k in i.childNodes){DO(k,g);}}g.appendText('</');j=new SpanElement();j.classes.add('source_element_name');j.appendText(i.nodeName);g.append(j);g.appendText('>');}else{g.appendText('/>');}break;case BB.nF:jZ(g,i.nodeValue);break;case BB.EK:SpanElement h=new SpanElement();h.classes.add('source_comment');h.appendText(i.toString());g.append(h);break;case BB.GQ:SpanElement h=new SpanElement();h.classes.add('source_entity');h.appendText(i.toString());g.append(h);break;case BB.CK:SpanElement h=new SpanElement();h.classes.add('source_cdata');h.appendText(i.toString());g.append(h);break;case BB.DK:SpanElement h=new SpanElement();h.classes.add('source_pi');h.appendText(i.toString());g.append(h);break;case BB.iL:SpanElement h=new SpanElement();h.classes.add('source_doctype');h.appendText(i.toString());g.append(h);break;default:g.appendText(i.toString());break;}}void jZ(Element i,String g){Map<String,String> k=<String,String>{'&':'&amp;','"':'&quot;','<':'&lt;','>':'&gt;'};Iterable<String> o=k.keys;int h=0;while(h<g.length){String m=g[h];if(o.contains(m)){if(h>0)i.appendText(g.substring(0,h));SpanElement j=new SpanElement();j.classes.add('source_entity');j.appendText(k[m]);i.append(j);g=g.substring(h+1);h=0;}else h++ ;}if(g.length>0)i.appendText(g);}void close(){DivElement g=ZB.document.getElementById('dlg1');g.remove();IB.gG();}void EP(){Selection g=ZB.window.getSelection();Range h=new Range();h.selectNodeContents(ZB.querySelector('.source_content'));g.removeAllRanges();g.addRange(h);}}class nM{static final List<List<String>> LI=[["\u0393","\u0394","\u0398","\u039B","\u039E","\u03A0","\u03A3","\u03A5","\u03A6","\u03A7","\u03A8","\u03A9"],["\u03B1","\u03B2","\u03B3","\u03B4","\u03B5","\u03B6","\u03B7","\u03B8","\u03B9","\u03BA","\u03BB","\u03BC","\u03BD","\u03BE","\u03BF","\u03C0","\u03C1","\u03C2","\u03C3","\u03C4","\u03C5","\u03C6","\u03C7","\u03C8","\u03C9",null,null,"\u03D1","\u03D5","\u03D6"],["\u2113","\u2102","\u2115","\u211A","\u211D","\u2124"],["¬","±","×","÷","·","\u2200","\u2203","\u2202","\u2207","\u2211","\u221D","\u221E","\u2227","\u2228","\u222B","\u223C","\u2248","\u2245","\u2260","\u2261","\u2264","\u2265","\u226A","\u226B","\u27C2","\u2225"],["\u2205","\u2208","\u2209","\u2229","\u222A","\u2282",null,null,null,"\u2190","\u2192","\u2194","\u21D0","\u21D2","\u21D4"],["°","\u212B","©","£","¥","\u20AC","¢"]];static final int qM=15;String sF;kD okfct;TableCellElement ME;nM(this.okfct);void show(){DivElement t=new DivElement();t.id='dlg1';t.classes.add('dlg1');DivElement FB=new DivElement();FB.classes.add('dlg2');DivElement HB=new DivElement();HB.classes.add('dlg3');FormElement KB=new FormElement();int bB=0;for(int g=0;g<LI.length;g++ )bB+= (LI[g].length/qM).ceil();TableElement h=new TableElement();h.classes.add('special_dlg');int i=0;for(int g=0;g<LI.length;g++ ){TableRowElement m=new TableRowElement();for(int o=0;o<LI[g].length;o++ ){TableCellElement QB=new TableCellElement();if(LI[g][o]!=null)QB.text=LI[g][o];QB.style.textAlign='center';m.append(QB);i++ ;if(i>=qM){i=0;if(o<LI[g].length-1){h.append(m);m=new TableRowElement();}}}if(i!=0){for(int SB=i;SB<qM;SB++ )m.append(new TableCellElement());i=0;}h.append(m);}h.onClick.listen((MouseEvent j)=>select(j.target));h.onDoubleClick.listen((MouseEvent j){select(j.target);if(ME!=null)UF(null);});KB.append(h);DivElement v=new DivElement();v.classes.add('buttons');ButtonElement DB=new ButtonElement();DB.attributes['type']='button';DB.appendText(LB.MB("button.Cancel"));DB.onClick.listen((MouseEvent j)=>cancel());v.append(DB);ButtonElement k=new ButtonElement();k.id='symbol_ok';if(sF==null)k.disabled=true;k.attributes['type']='submit';k.appendText(LB.MB("button.OK"));k.onClick.listen((MouseEvent j)=>UF(j));v.append(k);KB.append(v);HB.append(KB);FB.append(HB);t.append(FB);ZB.document.body.append(t);}void select(EventTarget h){if(h is!Node)return;Node g=h as Node;if(g is TableCellElement&&g.text!=''){if(ME!=null)ME.style.border='';ME=g;}else if(g.parent is TableCellElement){if(ME!=null)ME.style.border=null;ME=g.parent;}else return;ME.style.border='1px solid black';sF=ME.text;ButtonElement i=ZB.querySelector('button#symbol_ok');i.disabled=false;}void UF(MouseEvent g){ZB.querySelector('div#dlg1').remove();if(g!=null)g.preventDefault();if(okfct!=null)okfct();}void cancel(){ZB.querySelector('div#dlg1').remove();IB.gG();}String aO(){return (sF);}}class cB{static const int NE=0;static const int mE=1;static const int pM=2;n gZ;int kZ;bool lZ;cB(n h,int i,[bool g]){gZ=h;kZ=i;if(g!=null)lZ=g;else lZ=false;}Element UB(){Element h=new SpanElement();String i;if(kZ==NE)i="start_tag";else if(kZ==mE)i="end_tag";else if(kZ==pM)i="empty_tag";h.classes.add(i);if(lZ)h.classes.add('long');if(kZ!=mE){bool k;if(gZ.AB!=null){List<l> v=s.CB.iE(gZ.AB);k=(v!=null&&v.length>0);}else{k=(gZ is!CG&&gZ is!DG);}if(k){ImageElement DB=new ImageElement(src:'packages/daxe/images/attributes.png',width:16,height:16);DB.onClick.listen((MouseEvent j)=>VU(j));h.append(DB);}}String g;if(gZ.AB!=null){g=s.CB.YD(gZ.AB);if(g==null)g=gZ.nodeName;}else if(gZ is CG){if(kZ==NE)g="(";else g=")";}else if(gZ is IH){if(kZ==NE)g="PI ${gZ.nodeName}";else g="PI";}else if(gZ is DG)g="CDATA";else if(gZ.nodeName!=null)g=gZ.nodeName;else g="?";if(kZ!=mE){bool KB=(s.CB.eC(gZ.AB,'attributsVisibles','false')=='true');if(KB){h.append(new Text(g));for(iB FB in gZ.attributes){h.append(new Text(" "));Element m=new SpanElement();m.attributes['class']='attribute_name';m.text=FB.localName;h.append(m);h.append(new Text("="));Element o=new SpanElement();o.attributes['class']='attribute_value';o.text=FB.value;h.append(o);}}else{List<String> HB=s.CB.AV(gZ.AB)['titreAtt'];if(HB!=null){for(String QB in HB){String t=gZ.getAttribute(QB);if(t!=null&&t!=''){g+= " '${t}'";break;}}}h.append(new Text(g));}}else h.append(new Text(g));h.onDoubleClick.listen((MouseEvent j){IB.selectNode(gZ);j.preventDefault();j.stopPropagation();});return (h);}void VU(MouseEvent g){gZ.QE();}}class lJ{List<lG> items;List<l> IO=null;static final String LD='packages/daxe/images/toolbar/';lJ([GH g]){items=new List<lG>();if(s.bJ!=null){QD jB=new QD();jB.add(new LC(LB.MB('menu.save'),LD+'document_save.png',()=>IB.save(),null));items.add(jB);}QD QB=new QD();QB.add(new LC(LB.MB('undo.undo'),LD+'history_undo.png',()=>s.XH(),null,data:"undo",enabled:false));QB.add(new LC(LB.MB('undo.redo'),LD+'history_redo.png',()=>s.WM(),null,data:"redo",enabled:false));items.add(QB);QD yB=new QD();yB.add(new LC(LB.MB('find.find_replace'),LD+'find.png',()=>(new TP()).show(),null));items.add(yB);if(g!=null){List<l> h=g.yG('fichier');if(h!=null&&h.length>0){QD HC=new QD();cK(g,HC,h,LD+'insert_image.png');items.add(HC);}QD HB=new QD();h=g.yG('equationmem');if(h!=null&&h.length>0){cK(g,HB,h,LD+'equation.png');}h=g.yG('symbole2');if(h!=null&&h.length>0){cK(g,HB,h,LD+'insert_symbol.png');}else{PU(HB);}items.add(HB);QD SB=new QD();h=g.yG('tabletexte');if(h!=null&&h.length>0){cK(g,SB,h,LD+'insert_table.png');}h=g.yG('liste');if(h!=null&&h.length>0){cK(g,SB,h,LD+'ul.png');}items.add(SB);List<l> m=jC.dT();List<l> o=jC.eT();if(m.length>0||o.length>0){QD v=new QD();if(m.length>0){LC i=new LC(mZ(m[0]),LD+'ul.png',null,aP,data:new PD(m,null,null));i.action=(){if(i.selected)jC.DN();else jC.rP((i.data as PD).II);};v.add(i);}if(o.length>0){LC i=new LC(mZ(o[0]),LD+'ol.png',null,aP,data:new PD(o,null,null));i.action=(){if(i.selected)jC.DN();else jC.rP((i.data as PD).II);};v.add(i);}v.add(new LC(LB.MB('toolbar.rise_list_level'),LD+'list_rise_level.png',()=>jC.DN(),BT,data:'rise_list_level'));bool bB=true;for(l KD in m)if(s.CB.SF(jC.UL(KD),m)==null)bB=false;for(l YE in o)if(s.CB.SF(jC.UL(YE),o)==null)bB=false;if(bB)v.add(new LC(LB.MB('toolbar.lower_list_level'),LD+'list_lower_level.png',()=>jC.bT(),CT,data:'lower_list_level'));items.add(v);}List<l> DB=oG.QT();if(DB!=null&&DB.length>0){QD KB=new QD();LC i=new LC(LB.MB('toolbar.insert_link'),LD+'add_link.png',null,ET,data:new PD(DB,null,null));i.action=()=>oG.RT((i.data as PD).II);KB.add(i);i=new LC(LB.MB('toolbar.remove_link'),LD+'remove_link.png',()=>oG.WT(),FT,data:new PD(DB,null,null));KB.add(i);i=new LC(LB.MB('toolbar.insert_anchor'),LD+'anchor.png',null,ZP,data:new PD(DB,null,null));i.action=()=>oG.VT((i.data as PD).II);KB.add(i);items.add(KB);}QD j=new QD();List<l> HF=g.SU();for(l k in HF){String VG=g.QO(k);if(VG=='style'){String t=g.eC(k,'style',null);if(t=='GRAS'){PJ(g,j,k,LD+'style_bold.png','B');}else if(t=='ITALIQUE'){PJ(g,j,k,LD+'style_italic.png','I');}else if(t=='EXPOSANT'){PJ(g,j,k,LD+'style_superscript.png');}else if(t=='INDICE'){PJ(g,j,k,LD+'style_subscript.png');}else if(t=='BARRE'){PJ(g,j,k,LD+'style_strikethrough.png');}else if(t=='SOULIGNE'){PJ(g,j,k,LD+'style_underline.png');}}}if(j.length>0){j.add(new LC(LB.MB('toolbar.remove_styles'),LD+'remove_styles.png',()=>zB.WL(),null,data:"remove_styles"));items.add(j);}if(s.VC!=null){String KI=s.CB.eC(s.VC[0],'styleAtt','style');List<l> jJ=s.CB.iE(s.VC[0]);bool wC=false;for(l kJ in jJ){if(s.CB.attributeName(kJ)==KI){wC=true;break;}}if(wC){QD FB=new QD();FM(FB,'text-align','left',LB.MB('toolbar.align_left'),LD+'align_left.png');FM(FB,'text-align','right',LB.MB('toolbar.align_right'),LD+'align_right.png');FM(FB,'text-align','center',LB.MB('toolbar.align_center'),LD+'align_center.png');FM(FB,'text-align','justify',LB.MB('toolbar.align_justify'),LD+'align_justify.png');items.add(FB);}}l FL=bE.qP();if(FL!=null){List<String> eM=['serif','sans-serif','cursive','fantasy','monospace'];HH fM=nZ(LB.MB('toolbar.font'),"font-family",eM);items.add(fM);}}}HH nZ(String DB,String h,List<String> FB,[String t]){dB k=new dB(DB);k.parent=this;l i=bE.qP();for(String v in FB){String j=v;if(t!=null)j+= t;IC m=new IC(v,null,data:new PD([i],h,j));m.action=(){if(m.checked){q g=IB.BD();q HB=IB.DF();if(g==HB&&g.u is OB&&g.u.parent.AB==i&&(g.u.parent as zB).BH(h,j)&&g.JB==g.u.PB&&g.u.nextSibling==null){n o=g.u.parent;IB.TD(new q(o.parent,o.parent.aB(o)+1));IB.ZC();}else zB.WL(i,h);}else{zB.fT(i,h,j);}};k.add(m);}HH KB=new HH(k,GT,this);return (KB);}add(lG g){items.add(g);}insert(lG g,int h){items.insert(h,g);}remove(int g){items.remove(g);}List<LC> get IG{List<LC> g=new List<LC>();for(lG h in items){if(h is QD)g.addAll(h.IG);}return (g);}List<l> PR(){if(IO!=null)return (IO);List<l> h=new List<l>();for(lG i in items){if(i is QD){for(LC j in i.IG){if(j.data is PD){PD g=j.data;if(g.xF!=null)h.addAll(g.xF);}}}else if(i is HH){dB m=i.YJ;for(IC k in m.items){if(k.data is PD){PD g=k.data;if(g.xF!=null)h.addAll(g.xF);}}}}IO=h;return (h);}Element UB(){DivElement g=new DivElement();g.classes.add('toolbar');for(lG h in items){g.append(h.UB());}return (g);}String mZ(l h){String g=s.CB.jI(h);if(g==null)g=s.CB.YD(h);return (g);}cK(GH k,QD i,List<l> h,String j){LC g=new LC(mZ(h[0]),j,null,ZP,data:new PD(h,null,null));g.action=()=>s.oI((g.data as PD).II,'element');i.add(g);}PU(QD g){LC h=new LC(LB.MB('toolbar.symbol'),LD+'insert_symbol.png',xS,yS);g.add(h);}static xS(){nM g;g=new nM((){String h=g.aO();if(h!=null){s.iO(h,false);}});g.show();}static void yS(LC j,n g,n o,List<l> t,List<l> v){bool h=false;q i=IB.BD();q k=IB.DF();if(i==null){h=true;}else{n g=i.u;if(g.nodeType==n.qB)g=g.parent;if(g.DL)h=true;else{if(g.nodeType==n.BG)h=true;else if(g.AB!=null&&!s.CB.RE(g.AB)){if(s.VC!=null){l m=s.CB.SF(g.AB,s.VC);if(m!=null&&i==k){}else h=true;}else h=true;}}}if(h)j.disable();else j.enable();}static void ZP(LC g,n j,n k,List<l> i,List<l> m){PD h=g.data;List<l> o=h.xF;if(h.KM(i))g.enable();else g.disable();}PJ(GH v,QD k,l h,String m,[String o=null]){LC i=new LC(mZ(h),m,null,zS,data:new PD([h],null,null),shortcut:o);i.action=(){if(i.selected){q g=IB.BD();q t=IB.DF();if(g==t&&g.u is OB&&g.u.parent.AB==h&&g.JB==g.u.PB&&g.u.nextSibling==null){n j=g.u.parent;IB.TD(new q(j.parent,j.parent.aB(j)+1));IB.ZC();}else zB.WL(h);}else{zB.wP(h);}};k.add(i);}static void zS(LC g,n v,n h,List<l> m,List<l> o){PD i=g.data;List<l> j=i.xF;bool k=false;for(l t in j){if(o.contains(t)){k=true;break;}}if(k){g.enable();g.select();}else{if(h!=null&&j.contains(h.AB))g.select();else g.xG();if(i.KM(m))g.enable();else g.disable();}}FM(QD j,String g,String i,String k,String m){LC h=new LC(k,m,null,AT,data:new PD(s.VC,g,i));h.action=(){if(h.selected){lB.PT(g);}else{lB.UT(g,i);}};j.add(h);}static void AT(LC g,n m,n j,List<l> o,List<l> t){PD i=g.data;bool k=false;for(n h=m;h!=null;h=h.parent){if(s.VC.contains(h.AB)){if((h as lB).BH(i.iI,i.SJ)){k=true;break;}}}if(k){g.enable();g.select();}else{if(j!=null&&s.VC.contains(j.AB)&&(j as lB).BH(i.iI,i.SJ)){g.select();}else{g.xG();}if(lB.VL().length>0)g.enable();else g.disable();}}static void aP(LC g,n k,n t,List<l> m,List<l> v){PD i=g.data;List<l> o=i.xF;bool j=false;for(n h=k;h!=null;h=h.parent){if(o.contains(h.AB)){j=true;break;}}if(j){g.enable();g.select();}else{g.xG();if(i.KM(m))g.enable();else g.disable();}}static void BT(LC h,n j,n k,List<l> m,List<l> o){q i=IB.BD();n g=i.u;while(g!=null&&g is!yD)g=g.parent;if(g!=null)h.enable();else h.disable();}static void CT(LC h,n j,n k,List<l> m,List<l> o){q i=IB.BD();n g=i.u;while(g!=null&&g is!yD)g=g.parent;if(g==null||g.previousSibling==null)h.disable();else h.enable();}static void ET(LC g,n j,n k,List<l> h,List<l> m){PD i=g.data;if(IB.BD().u is OB&&i.KM(h))g.enable();else g.disable();}static void FT(LC g,n o,n t,List<l> v,List<l> i){PD j=g.data;List<l> k=j.xF;bool h=false;for(l m in k){if(i.contains(m)){h=true;break;}}if(h)g.enable();else g.disable();}static void GT(HH HB,n KB,n j,List<l> v,List<l> QB){dB DB=HB.YJ;IC k=null;for(IC g in DB.items){if(g.data is PD){PD FB=g.data;l h=FB.xF[0];String o=FB.iI;String t=FB.SJ;if(s.VC.contains(h)){bool m=false;for(n i=KB;i!=null;i=i.parent){if(s.VC.contains(i.AB)&&(i as lB).BH(o,t)){m=true;break;}}if(m){g.enable();k=g;g.check();}else{if(j!=null&&s.VC.contains(j.AB)&&(j as lB).BH(o,t)){k=g;g.check();}else{g.NS();}if(lB.VL().length>0)g.enable();else g.disable();}}else if(s.CB.QO(h)=='style'){if(QB.contains(h)){g.enable();k=g;}else{if(j!=null&&h==j.AB)k=g;if(v.contains(h))g.enable();else g.disable();}}else if(s.CB.QO(h)=='stylespan'){bool m=false;for(n i=KB;i!=null;i=i.parent){if(i.AB==h&&(i as bE).BH(o,t)){m=true;break;}}if(m){g.enable();k=g;g.check();}else{if(j!=null&&h==j.AB&&(j as bE).BH(o,t)){k=g;g.check();}else{g.NS();}if(v.contains(h))g.enable();else g.disable();}}else if(h!=null){if(v.contains(h))g.enable();else g.disable();}}}if(k==null)DB.title=HB.title;else DB.title=k.title;}void update(n i,List<l> t){List<l> j=new List<l>();for(n h=i;h!=null;h=h.parent)j.add(h.AB);n k=null;q g=IB.BD();q v=IB.DF();if(g.u is!OB&&g.u.PB>g.JB){if(v==new q(g.u,g.JB+1))k=g.u.fB(g.JB);}for(LC m in IG){if(m.update!=null)m.update(m,i,k,t,j);}for(lG o in items){if(o is HH){o.update(o,i,k,t,j);}}}}class QD extends lG{List<LC> IG;QD(){IG=new List<LC>();}add(LC g){IG.add(g);}insert(LC g,int h){IG.insert(h,g);}remove(int g){IG.remove(g);}get length{return (IG.length);}Element UB(){DivElement g=new DivElement();g.classes.add('toolbar-box');for(LC h in IG){g.append(h.UB());}return (g);}}typedef void eS(LC _0,n _1,n _2,List<l> _3,List<l> _4);class LC{static int XP=0;String fZ;String nR;kD action;eS update;Object data;String id;bool enabled;bool selected;StreamSubscription<MouseEvent> listener;String shortcut;int iconWidth;int iconHeight;LC(this.fZ,this.nR,this.action,this.update,{this.data,this.enabled: true,this.shortcut,this.iconWidth: 16,this.iconHeight: 16}){selected=false;id="button_${XP}";XP++ ;}Element UB(){DivElement g=new DivElement();g.id=id;g.classes.add('toolbar-button');if(!enabled)g.classes.add('button-disabled');else g.setAttribute('tabindex','0');if(selected)g.classes.add('button-selected');g.setAttribute('title',fZ);ImageElement h=new ImageElement();h.src=nR;h.width=iconWidth;h.height=iconHeight;if(enabled)listener=g.onClick.listen((MouseEvent i)=>action());g.append(h);g.onKeyDown.listen((KeyboardEvent i){int j=i.keyCode;if(j==KeyCode.ENTER){i.preventDefault();action();}});return (g);}String get title{return (fZ);}void set title(String g){fZ=g;Element h=DC();h.setAttribute('title',fZ);}Element DC(){return (ZB.querySelector("#${id}"));}void disable(){if(!enabled)return;enabled=false;Element g=DC();g.classes.add('button-disabled');listener.cancel();g.setAttribute('tabindex','-1');}void enable(){if(enabled)return;enabled=true;Element g=DC();g.classes.remove('button-disabled');listener=g.onClick.listen((MouseEvent h)=>action());g.setAttribute('tabindex','0');}void select(){if(selected)return;selected=true;Element g=DC();g.classes.add('button-selected');}void xG(){if(!selected)return;selected=false;Element g=DC();g.classes.remove('button-selected');}}abstract class lG{Element UB();}typedef void fS(HH _0,n _1,n _2,List<l> _3,List<l> _4);class HH extends lG{dB YJ;String title;fS update;HH(this.YJ,this.update,lJ g){title=YJ.title;YJ.parent=g;}Element UB(){DivElement g=new DivElement();g.classes.add('toolbar-menu');g.append(IB.SH.MR(YJ));return (g);}}class PD{List<l> xF;l II;String iI;String SJ;PD(this.xF,this.iI,this.SJ){assert(xF!=null&&xF.length>0&&(iI==null||SJ!=null));II=null;}String get css{if(iI==null)return (null);return ("${iI}: ${SJ}");}bool KM(List<l> h){for(l g in xF){if(h.contains(g)){II=g;return (true);}}II=null;return (false);}}class SD{n u;SD parent;SD firstChild;SD nextSibling;bool NG;DivElement vF;SpanElement VH;SpanElement sE;SD(this.u,this.parent){NG=false;kU();if(u.parent==s.vC){gJ();}}void jU(){for(n g=u.firstChild;g!=null;g=g.nextSibling){if(g is!OB){mB(new SD(g,this));}}}void DS(){if(firstChild!=null)CP(firstChild);}void CP(SD h){SD g=h;while(g!=null){if(g.vF!=null)g.vF.remove();g=g.nextSibling;}if(firstChild==h)firstChild=null;else h.previousSibling.nextSibling=null;}SD get lastChild{if(firstChild==null)return null;SD g=firstChild;while(g.nextSibling!=null){g=g.nextSibling;}return g;}SD get previousSibling{if(parent==null)return null;for(SD g=parent.firstChild;g!=null;g=g.nextSibling){if(g.nextSibling==this)return g;}return null;}List<SD> get children{List<SD> h=new List<SD>();for(SD g=firstChild;g!=null;g=g.nextSibling)h.add(g);return (h);}void mB(SD g){SD h=lastChild;if(h==null){firstChild=g;}else{h.nextSibling=g;}g.nextSibling=null;g.parent=this;vF.append(g.vF);}bool get KO{return LL(u);}kU(){vF=new DivElement();vF.classes.add('tree_div');VH=new SpanElement();VH.classes.add('tree_node_title');VH.setAttribute('tabindex','-1');VH.onKeyDown.listen((KeyboardEvent i){int h=i.keyCode;if(h==KeyCode.DOWN){if(firstChild!=null)firstChild.focus();else if(nextSibling!=null)nextSibling.focus();else if(parent!=null){SD g=parent;while(g.nextSibling==null&&g.parent!=null)g=g.parent;if(g.nextSibling!=null)g.nextSibling.focus();}}else if(h==KeyCode.UP){if(previousSibling!=null){SD g=previousSibling;while(g.lastChild!=null)g=g.lastChild;g.focus();}else if(parent!=null)parent.focus();else ZB.document.getElementById('tree_tab_button').focus();}else if(h==KeyCode.ENTER){IB.GS(u);}else if(h==KeyCode.RIGHT&&KO){if(!NG)gJ();firstChild.focus();}else if(h==KeyCode.LEFT&&NG){gJ();}else if(h==KeyCode.LEFT&&parent!=null){parent.focus();}});if(u.AB!=null)VH.appendText(s.CB.YD(u.AB));else VH.appendText(u.nodeName);VH.onClick.listen((MouseEvent i)=>IB.GS(u));if(LL(u)&&u.parent!=s.vC){yQ();}vF.append(VH);}void yQ(){sE=new SpanElement();sE.classes.add('expand_button');ImageElement g=new ImageElement(width:9,height:9);if(NG){sE.classes.add('expanded');g.src='packages/daxe/images/expanded_tree.png';}else{sE.classes.add('collapsed');g.src='packages/daxe/images/collapsed_tree.png';}sE.append(g);sE.onClick.listen((MouseEvent h)=>gJ());vF.append(sE);}void gJ(){if(!NG){jU();if(sE!=null){sE.classes.remove('collapsed');sE.classes.add('expanded');ImageElement g=sE.firstChild;g.src='packages/daxe/images/expanded_tree.png';}}else{DS();if(sE!=null){sE.classes.remove('expanded');sE.classes.add('collapsed');ImageElement g=sE.firstChild;g.src='packages/daxe/images/collapsed_tree.png';}}NG=!NG;}void update(){if(sE==null&&LL(u)&&u.parent!=s.vC){yQ();NG=true;}else if(sE!=null&&!LL(u)){DS();NG=false;sE.remove();}if(!NG)return;SD g=firstChild;for(n h=u.firstChild;h!=null;h=h.nextSibling){if(h is!OB){if(g==null){g=new SD(h,this);mB(g);}else if(g.u!=h){CP(g);g=new SD(h,this);mB(g);}else{g.update();}if(g!=null)g=g.nextSibling;}}if(g!=null)CP(g);}void focus(){VH.focus();}static bool LL(n h){for(n g=h.firstChild;g!=null;g=g.nextSibling){if(g is!OB){return (true);}}return (false);}}class jM{SD VE;jM(){}void update(){if(VE==null&&s.xH()!=null){VE=new SD(s.xH(),null);oZ();DivElement g=ZB.document.getElementById('tree');g.append(VE.vF);}else{if(VE==null){if(s.xH()!=null){VE=new SD(s.xH(),null);DivElement g=ZB.document.getElementById('tree');g.append(VE.vF);}}else{if(s.xH()==null){VE.vF.remove();VE=null;}else if(s.xH()!=VE.u){VE.vF.remove();VE=new SD(s.xH(),null);oZ();DivElement g=ZB.document.getElementById('tree');g.append(VE.vF);}else VE.update();}}}void oZ(){if(!VE.KO)return;if(!VE.NG)VE.gJ();if(VE.children.length<10){for(SD g=VE.firstChild;g!=null;g=g.nextSibling){if(g.KO&&!g.NG)g.gJ();}}}}class GB{static const int ZH=0;static const int aH=1;static const int mJ=2;static const int nJ=3;int hD;String title;q oB;String text;int length;n u;n tF;List<iB> attributes;List<GB> DH;bool NF;GB.mW(q h,String g,{bool updateDisplay: true}){assert(g!=null&&g!='');hD=ZH;title=LB.MB('undo.insert_text');this.oB=new q.yW(h);this.text=g;u=null;tF=null;attributes=null;DH=null;this.NF=updateDisplay;}GB.tW(q g,int h,{bool updateDisplay: true}){assert(h>0);assert(g.u.nodeType==n.qB);hD=aH;title=LB.MB('undo.remove_text');this.oB=new q.yW(g);text=null;this.length=h;u=null;tF=null;attributes=null;DH=null;this.NF=updateDisplay;}GB.xW(q g,n h,{bool updateDisplay: true}){hD=ZH;title=LB.MB('undo.insert_element');this.oB=new q.yW(g);text=null;this.u=h;tF=null;attributes=null;DH=null;this.NF=updateDisplay;}GB.AX(n g,{bool updateDisplay: true}){hD=aH;title=LB.MB('undo.remove_element');oB=null;text=null;this.u=g;tF=null;attributes=null;DH=null;this.NF=updateDisplay;}GB.BX(n g,List<iB> h,{bool updateDisplay: true}){hD=mJ;title=LB.MB('undo.attributes');oB=null;text=null;this.u=g;tF=null;this.attributes=h;DH=null;this.NF=updateDisplay;}GB.CX(n i,iB g,{bool updateDisplay: true}){hD=mJ;title=LB.MB('undo.attributes');oB=null;text=null;this.u=i;tF=null;LinkedHashMap<String,iB> h=i.SR();if(g.value==null){if(h[g.name]!=null)h.remove(g.name);}else h[g.name]=g;this.attributes=new List.from(h.values);DH=null;this.NF=updateDisplay;}GB.DX(String g){hD=nJ;this.title=g;oB=null;text=null;u=null;tF=null;attributes=null;DH=new List<GB>();NF=true;}bool KU(GB g){if(hD!=g.hD)return (false);if(hD==ZH&&u is OB&&g.text!=null&&g.oB.u==u&&g.oB.JB+1==u.PB){return (true);}if(text==null||g.text==null)return (false);if(u!=g.u)return (false);if((hD==ZH&&g.oB.JB==oB.JB+text.length)||(hD==aH&&g.oB.JB==oB.JB)){text="${text}${g.text}";return (true);}if((hD==ZH&&g.oB.JB==oB.JB)||(hD==aH&&oB.JB==g.oB.JB+g.text.length)){text="${g.text}${text}";if(hD==aH)oB=new q(oB.u,oB.JB-g.text.length);return (true);}return (false);}void TB(GB g){assert(hD==nJ);DH.add(g);}void PO(){if(hD==ZH)pZ(NF);else if(hD==aH)qZ(NF);else if(hD==mJ)rZ(NF);else if(hD==nJ){for(GB g in DH){g.PO();}}NF=true;}void XH(){if(hD==ZH)qZ(NF);else if(hD==aH)pZ(NF);else if(hD==mJ)rZ(NF);else if(hD==nJ){for(GB g in DH.reversed){g.XH();}}}void pZ(bool j){if(text!=null){oB.EF();if(oB.u.nodeType==n.tC){if(oB.u.fV)u=new KH(text);else u=new OB(text);text=null;}}if(text!=null){assert(oB.u.nodeType==n.qB);(oB.u as OB).sK(oB,text);if(j){oB.u.lE();IB.TD(new q(oB.u,oB.JB+text.length));if(oB.u.previousSibling==null&&oB.u.nextSibling==null){oB.u.parent.kG();}}}else{n g=oB.u;n h;List<n> i=new List<n>();i.add(u);if(g.nodeType==n.qB&&u.nodeType==n.qB){String k=g.nodeValue.substring(0,oB.JB);String m=g.nodeValue.substring(oB.JB);g.nodeValue="${k}${u.nodeValue}${m}";h=g;}else if(oB.JB==0){if(g.nodeType==n.qB){g.parent.insertBefore(u,g);h=g.parent;}else{g.insertBefore(u,g.firstChild);h=g;}}else if(g.PB==oB.JB){if(g.nodeType==n.qB){g.parent.insertBefore(u,g.nextSibling);h=g.parent;}else{g.mB(u);h=g;}}else if(g.nodeType==n.qB){if(tF==null)tF=(g as OB).nU(oB.JB);else{g.nodeValue=g.nodeValue.substring(0,oB.JB);g.parent.insertAfter(tF,g);}g.parent.insertBefore(u,tF);i.add(g);i.add(tF);h=g.parent;}else{n o=g.fB(oB.JB);g.insertBefore(u,o);h=g;}if(j){if(u.nodeType==n.tC)u.kG();h.kG();h.WF(i);if(u is OB)IB.TD(new q(u,u.nodeValue.length));else IB.TD(new q(u.parent,u.parent.aB(u)+1));}u.JO();}}void qZ(bool k){if(u==null&&text==null){if(oB.JB==0&&oB.u.PB==length){u=oB.u;oB=new q(u.parent,u.parent.aB(u));}else{text=oB.u.nodeValue.substring(oB.JB,oB.JB+length);}}if(text!=null){assert(oB.u.nodeType==n.qB);oB.u.remove(oB,text.length);if(k){oB.u.lE();IB.TD(oB);if(oB.u.previousSibling==null&&oB.u.nextSibling==null){oB.u.parent.kG();}}}else{u.DR();n h=u.parent;assert(h!=null);if(oB==null){if(u.previousSibling!=null&&u.previousSibling.nodeType==n.qB)oB=new q(u.previousSibling,u.previousSibling.PB);else oB=new q(h,h.aB(u));}n i=u.previousSibling;n g=u.nextSibling;h.CD(u);List<n> j=new List<n>();if(i!=null&&i.nodeType==n.qB&&g!=null&&g.nodeType==n.qB){tF=g;i.nodeValue="${i.nodeValue}${g.nodeValue}";g.parent.CD(g);j.add(i);j.add(u);j.add(g);}else j.add(u);if(k){h.kG();h.WF(j);IB.TD(oB);}}}void rZ(bool g){List<iB> h=u.attributes;u.attributes=attributes;attributes=h;if(g){u.kG();u.hJ();}}String toString(){StringBuffer g=new StringBuffer();switch (hD){case ZH:g.write("Insert ");break;case aH:g.write("Remove ");break;case mJ:g.write("Attributes ");break;case nJ:g.write("Compound ");break;}if(text!=null)g.write("text '${text}'");else if(u!=null)g.write("node ${u.nodeName}");else if(oB!=null)g.write("${length} chars at ${oB}");return (g.toString());}}class lM{n RF;List<InputElement> BI;List<InputElement> EL;kD okfct;lM(this.RF,[this.okfct]){BI=new List<InputElement>();EL=new List<InputElement>();}void show(){DivElement i=new DivElement();i.id='attributes_dlg';i.classes.add('dlg1');DivElement v=new DivElement();v.classes.add('dlg2');DivElement j=new DivElement();j.classes.add('dlg3');DivElement DB=new DivElement();DB.classes.add('dlgtitle');DB.text=RF.nodeName;j.append(DB);FormElement FB=new FormElement();TableElement QB=new TableElement();FE SB=null;for(iB bB in RF.attributes){TableRowElement k=new TableRowElement();TableCellElement g=new TableCellElement();InputElement HB=sZ(bB.name);BI.add(HB);g.append(HB);k.append(g);g=new TableCellElement();InputElement jB=tZ(bB.value);EL.add(jB);g.append(jB);k.append(g);uZ(k,HB);QB.append(k);}FB.append(QB);DivElement h=new DivElement();h.classes.add('buttons');ButtonElement m=new ButtonElement();m.attributes['type']='button';m.appendText(LB.MB("attribute.add"));m.onClick.listen((MouseEvent KB)=>vZ());h.append(m);ButtonElement o=new ButtonElement();o.attributes['type']='button';o.appendText(LB.MB("button.Cancel"));o.onClick.listen((MouseEvent KB)=>cancel());h.append(o);ButtonElement t=new ButtonElement();t.attributes['type']='submit';t.appendText(LB.MB("button.OK"));t.onClick.listen((MouseEvent KB)=>UF(KB));h.append(t);FB.append(h);j.append(FB);v.append(j);i.append(v);ZB.document.body.append(i);if(SB!=null)SB.focus();}void UF(MouseEvent k){List<iB> j=new List<iB>();for(int h=0;h<BI.length;h++ ){TextInputElement g=BI[h];String i=g.value;if(!wZ(i)){k.preventDefault();g.select();g.selectionStart=g.selectionEnd=g.value.length;ZB.window.alert(LB.MB('attribute.invalid_attribute_name'));return;}String o=EL[h].value;int DB=i.indexOf(':');iB m;String t=s.CB!=null?s.CB.eK(i):null;m=new iB.lW(t,i,o);j.add(m);}ZB.querySelector('div#attributes_dlg').remove();k.preventDefault();if(RF.DC()!=null){GB v=new GB.BX(RF,j);s.KC(v);}else{RF.attributes=j;}IB.gG();if(okfct!=null)okfct();}void cancel(){ZB.querySelector('div#attributes_dlg').remove();IB.gG();}void uZ(i,j){TableCellElement h=new TableCellElement();ButtonElement g=new ButtonElement();g.attributes['type']='button';g.value='-';g.text='-';g.onClick.listen((Event k)=>xZ(j));h.append(g);i.append(h);}TextInputElement sZ([String h]){TextInputElement g=new TextInputElement();g.spellcheck=false;g.value=h!=null?h:"";g.size=20;g.onInput.listen((Event i)=>yZ(g));g.onKeyUp.listen((KeyboardEvent i)=>yZ(g));return (g);}bool wZ(String g){final RegExp h=new RegExp("^[^<>&#!/?'\",0-9.\\-\\s][^<>&#!/?'\",\\s]*\$");return (h.hasMatch(g));}void yZ(TextInputElement g){String h=g.value;if(wZ(h)){g.classes.add('valid');g.classes.remove('invalid');}else{g.classes.add('invalid');g.classes.remove('valid');}}TextInputElement tZ([String h]){TextInputElement g=new TextInputElement();g.spellcheck=false;g.value=h!=null?h:"";g.size=40;return (g);}vZ(){TableElement k=ZB.document.querySelector("#attributes_dlg table");TextInputElement i=sZ();TextInputElement j=tZ();BI.add(i);EL.add(j);TableRowElement h=new TableRowElement();TableCellElement g=new TableCellElement();g.append(i);h.append(g);g=new TableCellElement();g.append(j);h.append(g);uZ(h,i);k.append(h);}void xZ(InputElement h){for(int g=0;g<BI.length;g++ ){if(BI[g]==h){BI.removeAt(g);EL.removeAt(g);TableRowElement i=ZB.document.querySelector("#attributes_dlg table tr:nth-child(${g+1})");i.remove();}}}}class hS{void show(){DivElement k=new DivElement();k.id='dlg1';k.classes.add('dlg1');DivElement t=new DivElement();t.classes.add('dlg2');DivElement h=new DivElement();h.classes.add('dlg3');DivElement g=new DivElement();g.classes.add('dlgtitle');g.text=LB.MB('validation.validation');h.append(g);List<n> FB=oR(s.vC);if(FB.length==0){h.appendText(LB.MB('validation.no_error'));}else{DivElement i=new DivElement();i.style.maxHeight='30em';i.style.overflow='auto';i.appendText(LB.MB('validation.errors'));UListElement HB=new UListElement();for(n m in FB){LIElement o=new LIElement();String g;if(m.AB!=null)g=s.CB.YD(m.AB);else g=null;q KB=new q(m,0);String v;if(g!=null)v="${g} ${KB.JI()}";else v=KB.JI();o.appendText(v);o.onClick.listen((MouseEvent QB)=>select(m));o.style.cursor='default';HB.append(o);}i.append(HB);h.append(i);}DivElement DB=new DivElement();DB.classes.add('buttons');ButtonElement j=new ButtonElement();j.attributes['type']='submit';j.appendText(LB.MB("button.Close"));j.onClick.listen((MouseEvent QB)=>close());DB.append(j);h.append(DB);t.append(h);k.append(t);ZB.document.body.append(k);j.focus();}List<n> oR(n g){List<n> h=new List<n>();if(g.nodeType==n.tC&&g is!DG){if(g.parent is nE){bool j=s.CB.EI(g.parent.AB,g.AB);if(j&&g.firstChild==null){h.add(g);return (h);}else if(!j&&g.firstChild==null&&(g.attributes==null||g.attributes.length==0)){return (h);}}if(!s.CB.SO(g))h.add(g);}for(n i=g.firstChild;i!=null;i=i.nextSibling)h.addAll(oR(i));return (h);}void select(n g){DivElement h=ZB.document.getElementById('dlg1');h.remove();IB.selectNode(g);}void close(){DivElement g=ZB.document.getElementById('dlg1');g.remove();IB.gG();}}class mM{static const int iS=400;FH zZ;q selectionStart;q selectionEnd;zF SH;IC HI;IC CI;dB KF;Point OO;lJ toolbar;kM Aa;q SM;DateTime nO;bool sI;mM(){zZ=new FH();Aa=new kM();SM=null;nO=null;sI=false;}Future sO(String i){Completer g=new Completer();s.sO(i).then((m){Ba();fF();Aa.FP();ZB.document.title=LB.MB('page.new_document');g.complete();},onError:(RD j){Element k=ZB.document.getElementById('doc2');String h="Error creating the new document: ${j}";k.text=h;g.completeError(h);});return (g.future);}Future wO(String h,String j,{bool removeIndents: true}){Completer g=new Completer();s.wO(h,j).then((o){Ba();fF();Aa.HP();s.vC.JO();ZB.document.title=h.split('/').last;g.complete();},onError:(RD k){Element m=ZB.document.getElementById('doc2');String i="Error reading the document: ${k}";m.text=i;g.completeError(i);});return (g.future);}void fF(){Element h=ZB.document.getElementById('doc2');h.children.clear();ZB.document.body.insertBefore(Aa.UB(),ZB.document.getElementById('doc1'));AR();ZB.window.onResize.listen((Event g)=>AR());Element k=s.UB();h.append(k);q m=new q(s.vC,0);zZ.moveTo(m);ZC();h.onMouseDown.listen((MouseEvent g)=>onMouseDown(g));h.onMouseMove.listen((MouseEvent g)=>onMouseMove(g));h.onMouseUp.listen((MouseEvent g)=>onMouseUp(g));h.onContextMenu.listen((MouseEvent g)=>onContextMenu(g));ZB.document.getElementById('doc1').onScroll.listen((Event g)=>onScroll(g));ZB.document.onMouseUp.listen((MouseEvent g){if(KF!=null){Element i=KF.qK();if(i.scrollHeight>i.clientHeight&&g.target==i&&g.client.x>i.offsetLeft+i.clientWidth)return;if(g.client!=OO)GR();g.preventDefault();}});if(s.bJ!=null){ZB.window.onBeforeUnload.listen((BeforeUnloadEvent o){if(s.gU()){String j=LB.MB('save.document_not_saved');o.returnValue=j;return j;}});}}void AR(){Element h=ZB.document.getElementById('headers');num i=h.getBoundingClientRect().bottom;String g=(i.round()+2).toString()+"px";ZB.document.getElementById('left_panel').style.top=g;ZB.document.getElementById('doc1').style.top=g;}void Ba(){SH=s.CB.ZV(s);dB i=new dB(LB.MB('menu.file'));i.parent=SH;IC g;if(s.bJ!=null){g=new IC(LB.MB('menu.save'),()=>save(),shortcut:'S');i.add(g);}g=new IC(LB.MB('menu.source'),()=>NW());i.add(g);g=new IC(LB.MB('menu.validation'),()=>(new hS()).show());i.add(g);SH.insert(i,0);dB h=new dB(LB.MB('menu.edit'));h.parent=SH;HI=new IC(LB.MB('undo.undo'),()=>s.XH(),shortcut:'Z');HI.enabled=false;h.add(HI);CI=new IC(LB.MB('undo.redo'),()=>s.WM(),shortcut:'Y');CI.enabled=false;h.add(CI);h.add(new IC(LB.MB('menu.select_all'),()=>EP(),shortcut:'A'));IC o=new IC(LB.MB('find.find_replace'),()=>(new TP()).show(),shortcut:'F');h.add(o);SH.insert(h,1);Element m=ZB.document.getElementById('headers');m.append(SH.UB());toolbar=new lJ(s.CB);m.append(toolbar.UB());HashMap<String,kD> j=new HashMap<String,kD>();for(LC k in toolbar.IG)if(k.shortcut!=null)j[k.shortcut]=k.action;for(dB t in SH.AI){zQ(t,j);}zZ.JW(j);}zQ(dB i,HashMap<String,kD> h){for(IC g in i.items){if(g.shortcut!=null&&g.action!=null)h[g.shortcut]=g.action;if(g is dB)zQ(g,h);}}void onMouseDown(MouseEvent g){if(KF!=null)GR();if(g.target is ImageElement||g.target is ButtonElement||g.target is TextInputElement||g.target is SelectElement)return;Element h=g.target;while(h is Element&&!h.classes.contains('dn')){h=h.parent;}if(h!=null&&h.attributes['contenteditable']=='true')return;if(g.button==1)return;g.preventDefault();if(g.button==2){return;}if(g.shiftKey){selectionStart=new q.yW(zZ.selectionStart);selectionEnd=FH.oJ(g);if(selectionEnd!=null)zZ.kE(selectionStart,selectionEnd);}else{selectionStart=FH.oJ(g);if(selectionStart!=null&&SM==selectionStart&&nO.difference(new DateTime.now()).inMilliseconds.abs()<iS&&selectionStart.u.nodeType!=n.tC){List<q> i=Ca(selectionStart);selectionStart=i[0];selectionEnd=i[1];zZ.kE(selectionStart,selectionEnd);sI=true;}}}void onMouseMove(MouseEvent h){if(selectionStart==null)return;if(KF!=null)return;q g=FH.oJ(h);if(sI){if(selectionEnd>selectionStart&&g<=selectionStart)selectionStart=selectionEnd;else if(selectionEnd<selectionStart&&g>=selectionStart)selectionStart=selectionEnd;}selectionEnd=g;if(selectionStart!=null&&selectionEnd!=null){if(sI&&selectionEnd.u.nodeType!=n.tC){List<q> i=Ca(selectionEnd);if(selectionEnd>selectionStart)selectionEnd=i[1];else selectionEnd=i[0];}zZ.kE(selectionStart,selectionEnd);}h.preventDefault();}List<q> Ca(q g){List<q> j=new List<q>();String k=g.u.nodeValue;int h=g.JB;int i=g.JB;String m=' \n,;:.?!/()[]{}';while(h>0&&m.indexOf(k[h-1])==-1)h-- ;while(i<k.length&&m.indexOf(k[i])==-1)i++ ;j.add(new q(g.u,h));j.add(new q(g.u,i));return (j);}void onMouseUp(MouseEvent g){if(!sI)selectionEnd=FH.oJ(g);SM=null;if(selectionStart!=null&&selectionEnd!=null){if(!sI)zZ.kE(selectionStart,selectionEnd);if(selectionStart==selectionEnd){SM=selectionStart;nO=new DateTime.now();}}selectionStart=null;selectionEnd=null;sI=false;g.preventDefault();}void onContextMenu(MouseEvent h){if(h.shiftKey)return;q g=FH.oJ(h);if(g!=null){h.preventDefault();if(zZ.selectionStart==null||zZ.selectionEnd==null||(g<zZ.selectionStart&&g<zZ.selectionEnd)||(g>zZ.selectionStart&&g>zZ.selectionEnd)){zZ.kE(g,g);}if(zZ.selectionStart!=null)MW(h);}}void onScroll(Event g){zZ.YH(false);}void MW(MouseEvent FB){if(s.CB==null||zZ.selectionStart.u==null)return;OO=FB.client;n h;if(zZ.selectionStart.u is OB)h=zZ.selectionStart.u.parent;else h=zZ.selectionStart.u;List<l> QB=s.VO(h);List<l> SB=s.RP(QB);KF=new dB(null);bool o=false;if(h.AB!=null){String k=s.CB.zH(h.nodeName);String i="${LB.MB('contextual.select_element')} ${k}";KF.add(new IC(i,()=>selectNode(h)));List<l> m=s.CB.iE(h.AB);if(m!=null&&m.length>0){i="${LB.MB('contextual.edit_attributes')} ${k}";KF.add(new IC(i,()=>h.QE()));}i="${LB.MB('contextual.help_about_element')} ${k}";KF.add(new IC(i,()=>(new EH.dW(h.AB)).show()));o=true;}if(s.gO!=null){n j=h;while(j!=null&&j is!yI)j=j.parent;if(j!=null){if(o)KF.EO();String k=s.CB.zH(j.nodeName);List<l> m=s.CB.iE(j.AB);if(m!=null&&m.length>0){String i="${LB.MB('contextual.edit_attributes')} ${k}";KF.add(new IC(i,()=>j.QE()));}KF.add(new IC(LB.MB('div.remove'),()=>(j as yI).qV()));o=true;}}List<l> t;if(toolbar!=null)t=toolbar.PR();else t=null;bool HB=true;for(l v in SB){if(t!=null&&t.contains(v))continue;if(s.VC!=null&&s.VC.contains(v))continue;if(HB&&o)KF.EO();HB=false;String bB=s.CB.XD(v);String i=s.CB.zH(bB);IC jB=new IC(i,()=>s.oI(v,'element'));KF.add(jB);}DivElement g=KF.PM();g.style.position='fixed';g.style.display='block';int DB=FB.client.x;int KB=FB.client.y;g.style.left="${DB}px";g.style.top="${KB}px";g.style.maxHeight="${ZB.window.innerHeight-KB}px";g.style.overflowY='auto';ZB.document.body.append(g);if(g.scrollHeight>g.clientHeight)g.style.paddingRight="${g.offsetWidth-g.clientWidth}px";if(DB+g.offsetWidth>ZB.window.innerWidth){DB=ZB.window.innerWidth-g.offsetWidth;g.style.left="${DB}px";}}void GR(){DivElement g=KF.qK();g.remove();KF=null;OO=null;}FH get cursor{return (zZ);}q BD(){return (zZ.selectionStart);}q DF(){return (zZ.selectionEnd);}void TD(q g){zZ.moveTo(g);}void gG(){zZ.focus();}void GS(n g){q j=new q(g.parent,g.parent.aB(g));FD h=j.gF();if(h==null)return;DivElement i=ZB.document.getElementById('doc1');int k=i.offset.top;i.scrollTop+= h.y.toInt()-k-10;}void selectNode(n g){int h=g.parent.aB(g);q i=new q(g.parent,h);q j=new q(g.parent,h+1);zZ.moveTo(i);zZ.kE(i,j);ZC();}void EP(){zZ.kE(new q(s.vC,0),new q(s.vC,s.vC.PB));}void ZC(){if(zZ.selectionStart==null)return;n g=zZ.selectionStart.u;if(g is OB)g=g.parent;List<l> h=s.VO(g);List<l> i=s.RP(h);Aa.update(g,h,i);VW(g,i);WW();}void VW(n h,List<l> g){List<dB> i=SH.AI;for(dB j in i){Da(j,g);}if(toolbar!=null)toolbar.update(h,g);}void Da(dB m,List<l> i){for(IC g in m.items){if(g is dB){Da(g,i);}else if(g.data is l){l j=g.data;String o=s.CB.XD(j);bool k=false;for(l h in i){if(s.CB.XD(h)==o){k=true;if(h!=j){g.data=h;g.action=()=>s.oI(h,'element');}break;}}if(k)g.enable();else g.disable();}}}void WW(){Element g=ZB.document.getElementById('path');if(zZ.selectionStart==null)g.text="";else g.text=zZ.selectionStart.JI(titles:true);}void CL(){if(s.qR()){if(!HI.enabled)HI.enable();}else{if(HI.enabled)HI.disable();}if(s.pR()){if(!CI.enabled)CI.enable();}else{if(CI.enabled)CI.disable();}HI.title=s.jR();CI.title=s.hR();if(toolbar!=null){for(LC g in toolbar.IG){if(g.data=="undo"){if(s.qR())g.enable();else g.disable();g.title=s.jR();}else if(g.data=="redo"){if(s.pR())g.enable();else g.disable();g.title=s.hR();}}}}void save(){s.AW().then((h){ZB.window.alert(LB.MB('save.success'));},onError:(RD g){ZB.window.alert(LB.MB('save.error')+': '+g.message);});}void NW(){(new gS()).show();}}void main(){uS();}class XB{qD qE;XB parent;int AH=14;final List<XB> children=new List<XB>();final StringBuffer text=new StringBuffer();XB([final qD g,final int h]){if(g!=null)aM(g);if(h!=null)YC(h);}void RB(final XB g){if(g!=null){children.add(g);g.aM(qE);g.HW(this);g.YC(AH);}}XB NB(final int g){if((g>=0)&&(g<children.length))return children[g];return null;}int QC(){return children.length;}void XC(final String h){for(int g=0;g<h.length;g++ )if(" \t\n\r".indexOf(h[g])<0)this.text.write(h[g]);else if((' '==h[g])&&(g>0)&&(' '!=h[g-1]))this.text.write(h[g]);}String gB(){return text.toString().trim();}void aM(final qD g){this.qE=g;for(final XB h in children)h.aM(g);}qD VJ(){return qE;}void HW(final XB g){this.parent=g;}XB getParent(){return parent;}void YC(final int g){this.AH=DD.max(g,8);for(final XB h in children)h.YC(this.AH);}int JD(){return AH;}String zC(){if(qE!=null)return qE.zC(AH);return null;}String CV(){if(qE!=null)return qE.zC(AH,qD.xM);return null;}String xU(){if(qE!=null)return qE.zC(AH,qD.kP);return null;}String yU(){if(qE!=null)return qE.zC(AH,qD.lP);return null;}xD AD(){if(qE!=null)return qE.AD(AH);return null;}double GI(g){return (qE.GI(g,zC()));}xD MV(String g){return (new xD(g,zC()));}void debug(final CanvasRenderingContext2D g,final double h,final double i){g.strokeStyle='blue';g.beginPath();g.moveTo(h,i-rB(true));g.lineTo(h+eB(true),i-rB(true));g.moveTo(h+eB(true),i-rB(true));g.lineTo(h+eB(true),i+xB(true));g.moveTo(h,i+xB(true));g.lineTo(h+eB(true),i+xB(true));g.moveTo(h,i-rB(true));g.lineTo(h,i+xB(true));g.stroke();g.strokeStyle='red';g.beginPath();g.moveTo(h,i);g.lineTo(h+eB(true),i);g.stroke();g.strokeStyle='black';}void GC(final CanvasRenderingContext2D i,final double j,final double k){if(qE.RM())debug(i,j,k);double m=j;XB g;for(int h=0;h<QC();h++ ){g=NB(h);g.GC(i,m,k);m+= g.eB(true)+2;}}double eB(final bool h){double g=0.0;for(final XB i in children)g+= i.eB(h)+2;return g-2;}double PC(final bool g){return rB(g)+xB(g);}double gR(){return rB(true);}double rB(final bool h){double g=0.0;for(final XB i in children)g=DD.max(g,i.rB(h));return g;}double xB(final bool h){double g=0.0;for(final XB i in children)g=DD.max(g,i.xB(h));return g;}double tD(){return qE.AD(JD()).pE*0.30;}}class rJ extends XB{int Ea=1;rJ():super();void GC(final CanvasRenderingContext2D g,final double h,final double t){final XB j=NB(0);final XB k=NB(1);final double m=t-tD();final double o=eB(true);j.GC(g,h+(o-j.eB(true))/2,m-j.xB(true)-1);g.lineWidth=Ea;g.beginPath();double i=m-Ea/2;if(Ea==1)i=i.floorToDouble()+0.5;g.moveTo(h+1,i);g.lineTo(h+o-1,i);g.stroke();g.lineWidth=1;k.GC(g,h+(o-k.eB(true))/2,m+k.rB(true)+1);}double eB(final bool g){return DD.max(NB(0).eB(g),NB(1).eB(g))+4;}double PC(final bool g){return rB(true)+xB(true);}double rB(final bool g){return NB(0).PC(true)+1+Ea/2+tD();}double xB(final bool g){return DD.max(0,NB(1).PC(true)+1+Ea/2-tD());}}class OI extends XG{String Fa="italic";void IS(final String g){this.Fa=g;}void GC(final CanvasRenderingContext2D h,final double i,final double j){final String k=gB();String g;if(Fa=='italic')g=CV();else if(Fa=='bold')g=xU();else if(Fa=='bold-italic')g=yU();else g=zC();h.font=g;h.fillText(k,i,j);}String zC(){if(qE!=null)return qE.zC(AH,qD.xM);return null;}}class fP extends XG{}class pB extends XB{bool Ga=true;double Ha=0.0;double Ia=0.0;pB():super();void dJ(final bool g){this.Ga=g;}void GW(final double g){this.Ha=g;}void IW(final double g){this.Ia=g;}void uK(final CanvasRenderingContext2D g,final double h,final double i,final String FB,final String HB,final String KB){g.font=zC();final double j=uH();final double k=UR();xD m=new xD(FB,zC());xD o=new xD(HB,zC());xD t=new xD(KB,zC());double v=m.actualBoundingBoxAscent+m.actualBoundingBoxDescent;double SB=m.actualBoundingBoxAscent;double bB=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent;double jB=o.actualBoundingBoxAscent;double DB=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent;double yB=t.actualBoundingBoxAscent;if(j-v-DB>0){final double HC=j-v-DB+2;double QB=HC/bB;g.save();g.scale(1,QB);g.fillText(HB,h,(i-k+v)/QB+jB);g.restore();}g.fillText(FB,h,i-k+SB);g.fillText(KB,h,i+j-k-(DB-yB).round());}void AS(final CanvasRenderingContext2D g,final double h,final double i,final String v,final String DB,final String m,final String FB){final double HB=uH();g.fillStyle='black';g.font=zC();xD t=new xD(m,zC());final double j=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent;final int o=((HB/j)/2).floor();for(int k=1;k<o;k++ ){g.fillText(m,h,i-j*k);g.fillText(m,h,i+j*k);}g.fillText(DB,h,i);g.fillText(v,h,i-j*o);g.fillText(FB,h,i+j*o);}void BS(final CanvasRenderingContext2D g,final double h,final double i,final String t,final String v,final String o,final String DB){final double FB=getParent().eB(true);final double HB=i-tD();g.save();g.fillStyle='black';g.font=zC();g.translate(h,i);g.rotate(PI/2.0);g.translate(-h,-HB);final double j=AD().pE-1;int KB=(FB/j).floor();final int m=KB~/2;for(int k=1;k<m;k++ ){g.fillText(o,h,i-j*k);g.fillText(o,h,i+j*k);}g.fillText(v,h,i);g.fillText(t,h,i-j*m);g.fillText(DB,h,i+j*m);g.restore();}void GC(final CanvasRenderingContext2D g,double h,final double i){if(Ha!=0){final double t=GI('A');h+= Ha*t;}if(gB().length==1&&"[{(|)}]\u222B".indexOf(gB()[0])>=0&&Ga){final double m=getParent().rB(false);final double o=getParent().xB(false);final double j=m+o-1;if(gB()=="("){if(j<AD().height){g.font=zC();g.fillText(gB(),h,i);}else uK(g,h,i,'\u239B','\u239C','\u239D');}else if(gB()==")"){if(j<AD().height){g.font=zC();g.fillText(gB(),h,i);}else uK(g,h,i,'\u239E','\u239F','\u23A0');}else if(gB()=="["){if(j<AD().height){g.font=zC();g.fillText(gB(),h,i);}else uK(g,h,i,'\u23A1','\u23A2','\u23A3');}else if(gB()=="]"){if(j<AD().height){g.font=zC();g.fillText(gB(),h,i);}else uK(g,h,i,'\u23A4','\u23A5','\u23A6');}else if(gB()=="{"){if(j<AD().height){g.font=zC();g.fillText(gB(),h,i);}else AS(g,h,i,'\u23A7','\u23A8','\u23AA','\u23A9');}else if(gB()=="}"){if(j<AD().height){g.font=zC();g.fillText(gB(),h,i);}else AS(g,h,i,'\u23AB','\u23AC','\u23AA','\u23AD');}else if(gB()=="|"){g.beginPath();g.moveTo(h+2,i-m);g.lineTo(h+2,i+o);g.stroke();}else if(gB()=="\u222B"){uK(g,h,i,'\u2320','\u23AE','\u2321');}}else if(gB().length==1&&"\uFE37\uFE38".indexOf(gB()[0])>=0){if(gB()=="\uFE37")BS(g,h,i,'\u23A7','\u23A8','\u23AA','\u23A9');else if(gB()=="\uFE38")BS(g,h,i,'\u23AB','\u23AC','\u23AA','\u23AD');}else if(gB().length==1&&"\u2211\u220F".indexOf(gB()[0])>=0&&Ga){g.strokeStyle='black';g.fillStyle='black';if(uH()>AD().height){final String v=VJ().zC(JD()*2);g.font=v;}else g.font=zC();if("\u2211".indexOf(gB()[0])>=0)g.fillText("\u2211",h,i);else g.fillText("\u220F",h,i);g.font=zC();}else if(gB()=="\u00AF"&&Ga){final double k=getParent().eB(false)-2;g.beginPath();g.moveTo(h,i);g.lineTo(h+k,i);g.stroke();}else if(gB()=="^"&&Ga){final double k=getParent().eB(false)-3;g.beginPath();g.moveTo(h,i);g.lineTo(h+k/2,i-3);g.moveTo(h+k/2,i-3);g.lineTo(h+k,i);g.stroke();}else if(gB()=="."||gB()==".."||gB()=="..."){g.font=zC();g.fillText(gB(),h+1,i);}else{g.font=zC();g.fillText(gB(),h,i);}}XB bO(){if(gB()=="\u222B"||"\u2211\u220F".contains(gB())){aC k;if(getParent() is aC)k=getParent() as aC;else k=getParent().getParent() as aC;final XB h=k.NB(1);if(!(h is aC&&h.QC()>0))return (h);final XB i=h.NB(0);if(!(i is aC&&i.QC()>0))return (h);final XB g=i.NB(0);if(!(g is QI||g is sJ||g is kF||g is pB))return (h);XB j;if(g is QI||g is sJ||g is kF)j=g.NB(0);else j=g;if(!(j.gB()=="\u222B"||"\u2211\u220F".contains(j.gB())))return (h);return (i.NB(1));}else return (getParent());}double uH(){return (bO().PC(false));}double UR(){return (bO().rB(false));}double BV(){return (bO().xB(false));}double eB(final bool k){double g=0.0;if(Ha!=0||Ia!=0){final double j=GI('A');final double m=Ha*j;final double o=Ia*j;g=m+o;}if(gB().length==1){final String h=gB()[0];if("|".indexOf(h)>=0)return 5+g;else if("\uFE37\uFE38".indexOf(h)>=0)return 1+g;else if("\u222B".indexOf(h)>=0){xD i=new xD(gB(),VJ().zC(JD()*2));return i.width+g;}else if("\u2211\u220F".indexOf(h)>=0){if(uH()>AD().height){xD i=new xD(gB(),VJ().zC(JD()*2));return i.width+g;}else return GI(gB()).round()+g;}else if("^\u00AF".indexOf(h)>=0&&Ga&&k)return getParent().eB(false)-2;}return GI(gB()).round()+g;}double PC(final bool g){return rB(g)+xB(g);}double rB(final bool i){if(gB().length==1&&"[()]\u222B".indexOf(gB()[0])>=0){if(!i||!Ga)return AD().pE;return (UR()+1);}else if(gB().length==1&&"{}".indexOf(gB()[0])>=0){if(!i||!Ga)return AD().pE;final double g=AD().pE;final int h=(uH()/g).floor()+1;if("{}".indexOf(gB()[0])>=0)if(h%2==0)return (h+1)*g*0.5+tD();return h*g*0.5+tD();}else if(gB().length==1&&"\u2211\u220F".indexOf(gB()[0])>=0&&Ga){if(uH()>AD().height)return VJ().AD(JD()*2).pE;else return AD().pE;}else if(gB().length==1&&"\uFE37\uFE38".indexOf(gB()[0])>=0)return 0.0;else if(gB()=="\u00AF"&&Ga)return (3.0);else if(gB()=="\u223C"&&Ga)return ((AD().pE~/2).toDouble());else if(gB()=="."||gB()==".."||gB()=="...")return ((AD().pE~/2).toDouble());else return AD().pE;}double xB(final bool i){if(gB().length==1&&"[()]\u222B".indexOf(gB()[0])>=0){if(!i||!Ga)return AD().rH;return (BV()+1);}else if(gB().length==1&&"{}".indexOf(gB()[0])>=0){if(!i||!Ga)return AD().rH;final double g=AD().pE;final int h=(uH()/g).floor()+1;if("{}".indexOf(gB()[0])>=0)if(h%2==0)return (h+1)*g*0.5-tD();return h*g*0.5-tD();}else if(gB().length==1&&"\u2211\u220F".indexOf(gB()[0])>=0&&Ga){if(uH()>AD().height)return VJ().AD(JD()*2).rH;else return AD().rH;}else if(gB().length==1&&"\uFE37\uFE38".indexOf(gB()[0])>=0)return GI("}");else return AD().rH;}}class kF extends XB{bool Ja=false;kF():super();void RB(final XB g){super.RB(g);if(g!=null){if(QC()==2&&!Ja)g.YC(JD()-2);else g.YC(JD());}}void YC(final int g){super.YC(g);if(NB(1)!=null&&!Ja)NB(1).YC(JD()-2);}void GC(final CanvasRenderingContext2D i,final double j,final double k){final XB g=NB(0);final XB h=NB(1);final double m=eB(true);g.GC(i,j+(m-g.eB(true))/2,k);if(Ja){double o;if(g is XG||g is OI)o=g.gR()+3;else o=g.rB(true);h.GC(i,j+(m-h.eB(true))/2,k-o);}else h.GC(i,j+(m-h.eB(true))/2,k-(g.rB(true)+h.xB(true)));}double eB(final bool g){return DD.max(NB(0).eB(g),NB(1).eB(g));}double PC(final bool g){if(Ja)return NB(0).PC(g)+NB(1).rB(g)+1;else return NB(0).PC(g)+NB(1).PC(g);}double rB(final bool g){if(Ja)return NB(0).rB(true)+NB(1).rB(true);else return NB(0).rB(true)+NB(1).PC(true);}double xB(final bool g){return NB(0).xB(true);}void IP(final bool g){this.Ja=g;}}class eP extends XB{eP():super();void RB(final XB g){super.RB(g);if(g!=null){if(QC()==2)g.YC(JD()-2);else g.YC(JD());}}void YC(final int g){super.YC(g);if(NB(1)!=null)NB(1).YC(JD()-2);}void GC(final CanvasRenderingContext2D g,final double h,final double i){if(QC()<2)return;final XB m=NB(0);final XB o=NB(1);final double DB=eB(true);final double FB=m.eB(true);final double k=8.0;final double j=o.eB(true);final double HB=o.PC(true);final double t=m.rB(true);final double v=m.xB(true);g.beginPath();g.moveTo(h,i);g.lineTo(h+j,i);g.moveTo(h+j,i);g.lineTo(h+k/2+j,i+v);g.moveTo(h+j-1,i);g.lineTo(h+k/2+j,i+v);g.moveTo(h+k/2+j,i+v);g.lineTo(h+k+j,i-(t+2));g.moveTo(h+k+j,i-(t+2));g.lineTo(h+DB,i-(t+2));g.stroke();m.GC(g,h+k+j,i);o.GC(g,h,i-o.xB(true));}double eB(final bool g){if(QC()<2)return 0.0;return NB(0).eB(g)+8+NB(1).eB(g);}double PC(final bool g){if(QC()<2)return 0.0;return xB(true)+DD.max(NB(0).rB(true)+4,NB(1).PC(true));}double rB(final bool g){if(QC()<2)return 0.0;return DD.max(NB(0).rB(true)+4,NB(1).PC(true));}double xB(final bool g){if(QC()<2)return 0.0;return NB(0).xB(true);}}class bH extends XB{static final int JT=0;static final int OL=1;int Ka=JT;bool La=false;bH():super();int GV(){return Ka;}void JP(final bool g){this.La=g;}bool RM(){return La;}void kV(final CanvasRenderingContext2D g){if(La){g.strokeStyle='blue';g.beginPath();g.moveTo(0,0);g.lineTo(UJ()-1,0);g.moveTo(UJ()-1,0);g.lineTo(UJ()-1,mI()-1);g.moveTo(0,0);g.lineTo(0,mI()-1);g.moveTo(0,mI()-1);g.lineTo(UJ()-1,mI()-1);g.stroke();g.strokeStyle='cyan';g.moveTo(0,mI()/2);g.lineTo(UJ()-1,mI()/2);g.stroke();g.strokeStyle='black';}if(NB(0)!=null){final double i=NB(0).rB(true)-tD();final double h=NB(0).xB(true)+tD();if(i>=h)GC(g,0.0,rB(true));else GC(g,0.0,h+tD());}}int UJ(){return eB(true).ceil();}int mI(){return PC(true).ceil();}void GC(final CanvasRenderingContext2D g,final double h,final double i){if(NB(0)!=null)NB(0).GC(g,h,i);}double eB(final bool g){if(NB(0)==null)return 0.0;return NB(0).eB(true)+1;}double PC(final bool i){if(NB(0)==null)return 0.0;if(Ka==OL)return NB(0).PC(true)+2;final double g=NB(0).rB(true)-tD();final double h=NB(0).xB(true)+tD();return DD.max(g,h)*2;}double rB(final bool g){if(NB(0)==null)return 0.0;if(Ka==OL)return NB(0).rB(true);return DD.max(NB(0).rB(true),NB(0).xB(true));}double xB(final bool g){if(NB(0)==null)return 0.0;if(Ka==OL)return NB(0).xB(true);return DD.max(NB(0).rB(true),NB(0).xB(true));}}class aC extends XB{aC():super();}class gP extends XB{gP():super();void GC(final CanvasRenderingContext2D g,final double h,final double i){final double DB=eB(true);final double FB=ZR();final double j=8.0;final double k=XR(true);final double m=YR(true);g.beginPath();g.moveTo(h,i);g.lineTo(h+3,i-1);g.moveTo(h+3,i);g.lineTo(h+j/2+1,i+m);g.moveTo(h+2,i-1);g.lineTo(h+j/2+1,i+m);g.moveTo(h+j/2+1,i+m);g.lineTo(h+j+3,i-(k+1));g.moveTo(h+j+3,i-(k+1));g.lineTo(h+DB,i-(k+1));g.stroke();double v=h+j+3;XB o;for(int t=0;t<QC();t++ ){o=NB(t);o.GC(g,v,i);v+= o.eB(true);}}double ZR(){double h=0.0;for(int g=0;g<QC();g++ )h+= NB(g).eB(true);return h;}double eB(final bool g){return ZR()+8+3;}double DV(final bool i){double g=0.0;for(int h=0;h<QC();h++ )g=DD.max(g,NB(h).PC(true));return g;}double PC(final bool g){return DV(true)+4;}double XR(final bool i){double g=0.0;for(int h=0;h<QC();h++ )g=DD.max(g,NB(h).rB(true));return g;}double rB(final bool g){return XR(true)+2;}double YR(final bool i){double g=0.0;for(int h=0;h<QC();h++ )g=DD.max(g,NB(h).xB(true));return g;}double xB(final bool g){return YR(true)+2;}}class NL extends XB{NL():super();void RB(final XB g){super.RB(g);if(g!=null){if(QC()==2)g.YC(JD()-2);else g.YC(JD());}}void YC(final int g){super.YC(g);if(NB(1)!=null)NB(1).YC(JD()-2);}void GC(final CanvasRenderingContext2D g,final double h,final double i){final XB j=NB(0);final XB k=NB(1);j.GC(g,h,i);k.GC(g,h+j.eB(true),i+k.rB(true)-tD());}double eB(final bool g){return NB(0).eB(g)+NB(1).eB(g);}double PC(final bool g){return rB(true)+xB(true);}double rB(final bool g){return NB(0).rB(true);}double xB(final bool g){return DD.max(NB(0).xB(true),NB(1).PC(true)-tD());}}class uM extends XB{uM():super();void RB(final XB g){super.RB(g);if(g!=null){if((QC()==2)||(QC()==3))g.YC(JD()-2);else g.YC(JD());}}void YC(final int g){super.YC(g);if(NB(1)!=null)NB(1).YC(JD()-2);if(NB(2)!=null)NB(2).YC(JD()-2);}void GC(final CanvasRenderingContext2D h,final double i,final double j){final XB g=NB(0);final XB k=NB(1);final XB o=NB(2);final double m=k.tD();final double t=j+g.xB(true)+m/2;final double v=j-g.rB(true)+m;g.GC(h,i,j);k.GC(h,i+g.eB(true),t);o.GC(h,i+g.eB(true),v);}double eB(final bool g){return NB(0).eB(g)+DD.max(NB(1).eB(g),NB(2).eB(g));}double PC(final bool g){return rB(true)+xB(true);}double rB(final bool g){return DD.max(NB(0).rB(true),NB(2).PC(true)+tD());}double xB(final bool g){return DD.max(NB(0).xB(true),NB(1).PC(true)-tD());}}class ML extends XB{ML():super();void RB(final XB g){super.RB(g);if(g!=null){if(QC()==2)g.YC(JD()-2);else g.YC(JD());}}void YC(final int g){super.YC(g);if(NB(1)!=null)NB(1).YC(JD()-2);}void GC(final CanvasRenderingContext2D i,final double j,final double k){final XB g=NB(0);final XB h=NB(1);g.GC(i,j,k);h.GC(i,j+g.eB(true),k-DD.max(h.xB(true)+tD(),g.rB(true)-h.xB(true)));}double eB(final bool g){return NB(0).eB(g)+NB(1).eB(g);}double PC(final bool g){return rB(true)+xB(true);}double rB(final bool i){final XB h=NB(0);final XB g=NB(1);return (g.rB(true)+DD.max(g.xB(true)+tD(),h.rB(true)-g.xB(true)));}double xB(final bool g){return NB(0).xB(true);}}class qJ extends XB{qJ():super();void GC(final CanvasRenderingContext2D o,final double QB,final double t){int g,h;final List<double> v=new List<double>(QC());final List<double> FB=new List<double>(QC());for(g=0;g<QC();g++ ){v[g]=cR(g);FB[g]=dR(g);}final int DB=aR();final List<double> m=new List<double>(DB);for(g=0;g<DB;g++ )m[g]=bR(g);final double HB=QB;final double SB=-PC(true)/2+v[0]-tD();double j=HB;double k=SB;for(g=0;g<QC();g++ ){final XB KB=NB(g);j=HB;for(h=0;(h<DB)&&(h<KB.QC());h++ ){final NI i=KB.NB(h) as NI;if(i.TR()=="left")i.GC(o,j+1,t+k);else if(i.TR()=="right")i.GC(o,j+m[h]-i.eB(true),t+k);else i.GC(o,j+m[h]/2-i.eB(true)/2,t+k);j+= m[h];}k+= FB[g];if(g<QC()-1)k+= v[g+1];}}double cR(final int i){if(i>=QC())return 0.0;final XB j=NB(i);double g=0.0;for(int h=0;h<j.QC();h++ )g=DD.max(g,j.NB(h).rB(true));return g;}double dR(final int i){if(i>=QC())return 0.0;final XB j=NB(i);double g=0.0;for(int h=0;h<j.QC();h++ )g=DD.max(g,j.NB(h).xB(true));return g;}double bR(final int i){double g=0.0;for(int h=0;h<QC();h++ ){final XB j=NB(h);if(i<j.QC())g=DD.max(g,j.NB(i).eB(true));}return g+2;}int aR(){int g=0;for(int h=0;h<QC();h++ ){final XB i=NB(h);g=DD.max(g,i.QC());}return g;}double eB(final bool j){double h=0.0;final int i=aR();for(int g=0;g<i;g++ )h+= bR(g);return h;}double PC(final bool i){double h=0.0;for(int g=0;g<QC();g++ )h+= cR(g)+dR(g);return h;}double rB(final bool g){return PC(true)/2+tD();}double xB(final bool g){return PC(true)/2-tD();}}class NI extends XB{String Ma="center";NI():super();void FW(final String g){Ma=g;}String TR(){return Ma;}}class dP extends XB{dP():super();void GC(final CanvasRenderingContext2D h,final double i,final double j){if(VJ().RM())debug(h,i,j);final double m=Na();double k=i;for(int g=0;g<QC();g++ ){NB(g).GC(h,k,j);k+= m;}}double Na(){double g=0.0;for(int h=0;h<QC();h++ )g=DD.max(g,NB(h).eB(true));return g;}double eB(final bool g){return Na()*QC();}double PC(final bool i){double g=0.0;for(int h=0;h<QC();h++ )g=DD.max(g,NB(h).PC(i));return g;}double rB(final bool i){double g=0.0;for(int h=0;h<QC();h++ )g=DD.max(g,NB(h).rB(i));return g;}double xB(final bool i){double g=0.0;for(int h=0;h<QC();h++ )g=DD.max(g,NB(h).xB(i));return g;}}class XG extends XB{XG():super();void GC(final CanvasRenderingContext2D g,final double h,final double i){g.font=zC();g.fillText(gB(),h,i);}double eB(final bool g){return GI(gB().replaceAll(' ','A'));}double PC(final bool g){return AD().pE+AD().rH;}double gR(){xD g=MV(gB());return (g.actualBoundingBoxAscent);}double rB(final bool g){return AD().pE;}double xB(final bool g){return AD().rH;}}class sJ extends XB{sJ():super();void RB(final XB g){super.RB(g);if(g!=null){if(QC()==2)g.YC(JD()-2);else g.YC(JD());}}void YC(final int g){super.YC(g);if(NB(1)!=null)NB(1).YC(JD()-2);}void GC(final CanvasRenderingContext2D i,final double j,final double k){final XB g=NB(0);final XB h=NB(1);final double m=eB(true);g.GC(i,j+(m-g.eB(true))/2,k);h.GC(i,j+(m-h.eB(true))/2,k+g.xB(true)+h.rB(true));}double eB(final bool g){return DD.max(NB(0).eB(g),NB(1).eB(g));}double PC(final bool g){return NB(0).PC(g)+NB(1).PC(g);}double rB(final bool g){return NB(0).rB(true);}double xB(final bool g){return NB(0).xB(true)+NB(1).PC(true);}}class QI extends XB{QI():super();void RB(final XB g){super.RB(g);if(g!=null){if((QC()==2)||(QC()==3))g.YC(JD()-2);else g.YC(JD());}}void YC(final int g){super.YC(g);if(NB(1)!=null)NB(1).YC(JD()-2);if(NB(2)!=null)NB(2).YC(JD()-2);}void GC(final CanvasRenderingContext2D h,final double i,final double j){final XB g=NB(0);final XB k=NB(1);final XB m=NB(2);final double o=eB(true);g.GC(h,i+(o-g.eB(true))/2,j);k.GC(h,i+(o-k.eB(true))/2,j+g.xB(true)+k.rB(true));m.GC(h,i+(o-m.eB(true))/2,j-(g.rB(true)+m.xB(true)));}double eB(final bool g){return DD.max(NB(0).eB(g),DD.max(NB(1).eB(g),NB(2).eB(g)));}double PC(final bool g){return NB(0).PC(g)+NB(1).PC(g)+NB(2).PC(g);}double rB(final bool g){return NB(0).rB(true)+NB(1).PC(true);}double xB(final bool g){return NB(0).xB(true)+NB(2).PC(true);}}class tM{String Oa;String Pa;String Qa;mP Ra;qD Sa;tM(String g,{String labelName,String labelValue,mP okfct}){Oa=g;Pa=labelName;Qa=labelValue;Ra=okfct;}void show(){DivElement h=new DivElement();h.id='dlg1';h.classes.add('dlg1');DivElement v=new DivElement();v.classes.add('dlg2');DivElement DB=new DivElement();DB.classes.add('dlg3');FormElement i=new FormElement();CanvasElement j=new CanvasElement(width:500,height:300);j.id='eqcanvas';nB QB=new nB(Oa);Sa=new qD(element:QB.pK(),context:j.context2D);Sa.GC(j.context2D);i.append(j);TextAreaElement g=new TextAreaElement();g.id='eqtext';g.value=Oa;g.style.width='100%';g.style.height='4em';g.attributes['spellcheck']='false';g.onInput.listen((Event FB)=>NF());i.append(g);if(Pa!=null){DivElement k=new DivElement();SpanElement KB=new SpanElement();KB.text=Pa;k.append(KB);k.appendText(' ');TextInputElement HB=new TextInputElement();HB.id='eqlabel';if(Qa!=null)HB.value=Qa;k.append(HB);i.append(k);}DivElement m=new DivElement();m.classes.add('buttons');ButtonElement o=new ButtonElement();o.attributes['type']='button';o.appendText(LB.MB("button.Cancel"));o.onClick.listen((MouseEvent FB)=>h.remove());m.append(o);ButtonElement t=new ButtonElement();t.attributes['type']='submit';t.appendText(LB.MB("button.OK"));t.onClick.listen((MouseEvent FB)=>UF(FB));m.append(t);i.append(m);DB.append(i);v.append(DB);h.append(v);ZB.document.body.append(h);g.focus();}void UF(MouseEvent g){TextAreaElement h=ZB.querySelector('textarea#eqtext');Oa=h.value;if(Pa!=null){TextInputElement i=ZB.querySelector('input#eqlabel');Qa=i.value;}ZB.querySelector('div#dlg1').remove();if(g!=null)g.preventDefault();if(Ra!=null)Ra();}String gB(){return (Oa);}String getData(){if(Oa=='')return (null);CanvasElement g=new CanvasElement(width:Sa.eB(),height:Sa.PC());nB h=new nB(Oa);qD i=new qD(element:h.pK(),context:g.context2D);i.GC(g.context2D);String j=g.toDataUrl('image/png');String k=j.substring('data:image/png;base64,'.length);return (k);}String WR(){return (Qa);}void NF(){TextAreaElement g=ZB.querySelector('textarea#eqtext');Oa=g.value;if(Oa.length>0&&Oa.contains('\n')){g.value=Oa.replaceAll('\n','');UF(null);return;}CanvasElement h=ZB.querySelector('canvas#eqcanvas');nB i=new nB(Oa);Sa.KS(i.pK());Sa.GC(h.context2D);}}typedef void mP();class qD{static String hP='STIXSubset-Regular';static String iP='STIXSubset-Italic';static String wM='STIXSubset-Bold';static bool jP=false;static const int IT=0;static const int kP=1;static const int xM=2;static const int lP=3;int Ta;int Ua;final int UM=8;final int tK=60;List<xD> Va=null;bool La=false;static final int LT=0;final int Ka=LT;bH Wa;CanvasRenderingContext2D Xa;qD({final bH element,final int inlinefontsize: 15,final int displayfontsize: 16,final CanvasRenderingContext2D context}){this.Ta=inlinefontsize;this.Ua=displayfontsize;if(context!=null)Va=new List<xD>(tK);if(element!=null)KS(element);if(context!=null)this.Xa=context;}static void oP(){if(jP)return;CanvasElement h=new CanvasElement(width:10,height:10);CanvasRenderingContext2D g=h.context2D;g.font="15px ${hP}";g.fillText('.',0,0);g.font="15px ${iP}";g.fillText('.',0,0);g.font="15px ${wM}";g.fillText('.',0,0);jP=true;}void KS(final bH g){if(g==null)return;Wa=g;Wa.aM(this);if(g.GV()==bH.OL)Wa.YC(Ua);else Wa.YC(Ta);Wa.JP(RM());}void JP(final bool g){this.La=g;if(Wa!=null)Wa.JP(g);}bool RM(){return La;}String zC(final int j,[int k=qD.IT]){int i;if(j<UM)i=UM;else if(j>tK)i=tK;else i=j;String g,h;if(k==qD.xM){g='';h=iP;}else if(k==qD.kP){g='';h=wM;}else if(k==qD.lP){g='italic';h=wM;}else{g='';h=hP;}return ("${g} ${i}px ${h}");}xD AD(final int h){int g;if(h<UM)g=UM;else if(h>tK)g=tK;else g=h;if(Va[g]==null)Va[g]=lU(zC(h));return Va[g];}xD lU(String g){return (new xD('Hg',g));}double GI(String g,String h){String i=Xa.font;Xa.font=h;double j=Xa.measureText(g).width;Xa.font=i;return (j);}void GC(final CanvasRenderingContext2D g){g.clearRect(0,0,g.canvas.width,g.canvas.height);if(Wa!=null)Wa.kV(g);}int eB(){if(Wa!=null&&Va!=null)return Wa.UJ();return 0;}int PC(){if(Wa!=null&&Va!=null)return Wa.mI();return 0;}}class nB{bH Wa;static final List<List<String>> KT=[["<==","\u21D0"],["==>","\u21D2"],["<=>","\u21D4"],["!=","\u2260"],["~=","\u2248"],["~","\u223C"],["<=","\u2264"],[">=","\u2265"],["<<","\u226A"],[">>","\u226B"],["-->","\u2192"],["<->","\u2194"],["->","\u2192"],["<--","\u2190"],["equiv","\u2261"],["forall","\u2200"],["quelquesoit","\u2200"],["exists","\u2203"],["ilexiste","\u2203"],["part","\u2202"],["drond","\u2202"],["nabla","\u2207"],["prop","\u221D"],["times","×"],["cross","×"],["croix","×"],["wedge","\u2227"],["pvec","\u2227"],["plusmn","±"],["plusoumoins","±"],["plusminus","±"],["cap","\u2229"],["cup","\u222A"],["...","\u2026"]];static final String yM="_^#*/\u2207±\u2213\u2227-+\u2200\u2203\u2202×=\u2260\u2248\u223C\u2261<>\u2264\u2265\u226A\u226B\u221D"+"|\u2229\u222A\u2190\u2192\u2194\u21D0\u21D2\u21D4";static final List<List<String>> nP=[["alpha","\u03B1"],["beta","\u03B2"],["gamma","\u03B3"],["delta","\u03B4"],["epsilon","\u03B5"],["zeta","\u03B6"],["eta","\u03B7"],["theta","\u03B8"],["iota","\u03B9"],["kappa","\u03BA"],["lambda","\u03BB"],["mu","\u03BC"],["nu","\u03BD"],["xi","\u03BE"],["omicron","\u03BF"],["rho","\u03C1"],["sigma","\u03C3"],["tau","\u03C4"],["upsilon","\u03C5"],["phi","\u03C6"],["chi","\u03C7"],["psi","\u03C8"],["omega","\u03C9"],["Alpha","\u0391"],["Beta","\u0392"],["Gamma","\u0393"],["Delta","\u0394"],["Epsilon","\u0395"],["Zeta","\u0396"],["Eta","\u0397"],["Theta","\u0398"],["Iota","\u0399"],["Kappa","\u039A"],["Lambda","\u039B"],["Mu","\u039C"],["Nu","\u039D"],["Xi","\u039E"],["Omicron","\u039F"],["Pi","\u03A0"],["Rho","\u03A1"],["Sigma","\u03A3"],["Tau","\u03A4"],["Upsilon","\u03A5"],["Phi","\u03A6"],["Chi","\u03A7"],["Psi","\u03A8"],["Omega","\u03A9"],["thetasym","\u03D1"],["upsih","\u03D2"],["piv","\u03D6"],["phiv","\u03D5"],["phi1","\u03D5"]];static final List<List<String>> pP=[["pi","\u03C0"],["infin","\u221E"],["infty","\u221E"],["infini","\u221E"],["parallel","\u2225"],["parallèle","\u2225"],["sun","\u2609"],["soleil","\u2609"],["star","\u2605"],["étoile","\u2605"],["mercury","\u263F"],["mercure","\u263F"],["venus","\u2640"],["vénus","\u2640"],["earth","\u2295"],["terre","\u2295"],["mars","\u2642"],["jupiter","\u2643"],["saturn","\u2644"],["saturne","\u2644"],["uranus","\u26E2"],["neptun","\u2646"],["neptune","\u2646"],["planck","\u210F"],["angstrom","\u212B"],["angström","\u212B"],["asterisk","*"],["astérisque","*"],["ell","\u2113"],["smalll","\u2113"],["petitl","\u2113"],["Ascr","\u{1D49C}"],["biga","\u{1D49C}"],["granda","\u{1D49C}"],["Bscr","\u212C"],["bigb","\u212C"],["grandb","\u212C"],["Cscr","\u{1D49E}"],["bigc","\u{1D49E}"],["grandc","\u{1D49E}"],["Dscr","\u{1D49F}"],["bigd","\u{1D49F}"],["grandd","\u{1D49F}"],["Escr","\u2130"],["bige","\u2130"],["grande","\u2130"],["Fscr","\u2131"],["bigf","\u2131"],["grandf","\u2131"],["Gscr","\u{1D4A2}"],["bigg","\u{1D4A2}"],["grandg","\u{1D4A2}"],["Hscr","\u210B"],["bigh","\u210B"],["grandh","\u210B"],["Iscr","\u2110"],["bigi","\u2110"],["grandi","\u2110"],["Jscr","\u{1D4A5}"],["bigj","\u{1D4A5}"],["grandj","\u{1D4A5}"],["Kscr","\u{1D4A6}"],["bigk","\u{1D4A6}"],["grandk","\u{1D4A6}"],["Lscr","\u2112"],["bigl","\u2112"],["grandl","\u2112"],["Mscr","\u2133"],["bigm","\u2133"],["grandm","\u2133"],["Nscr","\u{1D4A9}"],["bign","\u{1D4A9}"],["grandn","\u{1D4A9}"],["Oscr","\u{1D4AA}"],["bigo","\u{1D4AA}"],["grando","\u{1D4AA}"],["Pscr","\u{1D4AB}"],["bigp","\u{1D4AB}"],["grandp","\u{1D4AB}"],["Qscr","\u{1D4AC}"],["bigq","\u{1D4AC}"],["grandq","\u{1D4AC}"],["Rscr","\u211B"],["bigr","\u211B"],["grandr","\u211B"],["Sscr","\u{1D4AE}"],["bigs","\u{1D4AE}"],["grands","\u{1D4AE}"],["Tscr","\u{1D4AF}"],["bigt","\u{1D4AF}"],["grandt","\u{1D4AF}"],["Uscr","\u{1D4B0}"],["bigu","\u{1D4B0}"],["grandu","\u{1D4B0}"],["Vscr","\u{1D4B1}"],["bigv","\u{1D4B1}"],["grandv","\u{1D4B1}"],["Wscr","\u{1D4B2}"],["bigw","\u{1D4B2}"],["grandw","\u{1D4B2}"],["Xscr","\u{1D4B3}"],["bigx","\u{1D4B3}"],["grandx","\u{1D4B3}"],["Yscr","\u{1D4B4}"],["bigy","\u{1D4B4}"],["grandy","\u{1D4B4}"],["Zscr","\u{1D4B5}"],["bigz","\u{1D4B5}"],["grandz","\u{1D4B5}"]];static final List<String> MT=["sin","cos","tan","acos","asin","atan"];static final RegExp NT=new RegExp("^\\s?([0-9]+([\\.,][0-9]+)?|[\\.,][0-9]+)([Ee][+-]?[0-9]+)?\\s?\$");nB(final String h){Wa=new bH();final String j=OT(vV(h));if(h!=''){final dD i=qI(j);XB g;if(i==null)g=null;else g=i.GF();Wa.RB(g);}}bH pK(){return Wa;}String vV(String g){for(final List<String> h in KT){int i=g.indexOf(h[0]);while(i!=-1){g=g.substring(0,i)+h[1]+g.substring(i+h[0].length);i=g.indexOf(h[0]);}}return g;}static bool cH(String i,int h){String g=i[h];if(yM.indexOf(g)==-1)return (false);if(g!='+'&&g!='-')return (true);if(h<2)return (true);g=i[h-1];if(g!='E'&&g!='e')return (true);g=i[h-2];if("0123456789".indexOf(g)!=-1)return (false);return (true);}static String OT(String g){int h=g.indexOf(';');while(h!=-1){int i=0;bool t=false;String o;for(int j=h-1;j>=0&&i>=0;j-- ){o=g[j];if(o==';'&&i==0)break;if(o=='(')i-- ;else if(o==')')i++ ;else if(cH(g,j))t=true;if(i<0&&t){g=g.substring(0,j)+'('+g.substring(j,h)+')'+g.substring(h);h+= 2;}}i=0;t=false;for(int j=h+1;j<g.length&&i>=0;j++ ){o=g[j];if(o=='(')i++ ;else if(o==')')i-- ;else if(cH(g,j))t=true;if((i<0||i==0&&o==';')&&t)g=g.substring(0,h+1)+'('+g.substring(h+1,j)+')'+g.substring(j);if(o==';'&&i==0)break;}final int HB=g.substring(h+1).indexOf(';');if(HB==-1)h=HB;else h+= HB+1;}for(int KB=0;KB<yM.length;KB++ ){final String QB=yM[KB];h=g.indexOf(QB);while(h!=-1&&!cH(g,h))h=g.indexOf(QB,h+1);int SB=h;int m,k;String v=' ',DB=' ';int i;bool FB;while(SB!=-1){FB=false;m=h-1;if(m>=0)v=g[m];i=0;while(m>=0&&(i!=0||v!='(')&&(i!=0||!cH(g,m))){if(v==')')i++ ;else if(v=='(')i-- ;m-- ;if(m>=0)v=g[m];}if(m<0||cH(g,m))FB=true;k=h+1;if(k>=0&&k<=g.length-1)DB=g[k];i=0;while(k<g.length&&(i!=0||DB!=')')&&(i!=0||!cH(g,k))){if(DB=='(')i++ ;else if(DB==')')i-- ;k++ ;if(k<g.length)DB=g[k];}if(k>=g.length||cH(g,k))FB=true;if(FB){g=g.substring(0,m+1)+"("+g.substring(m+1,k)+")"+g.substring(k);h++ ;}SB=g.substring(h+1).indexOf(QB);h=SB+h+1;}}return g;}dD qI(String g){if(g==null||g=='')return null;if(g[0]=='('&&g[g.length-1]==')'){int i=0;for(int h=1;h<g.length-1;h++ ){if(g[h]=='(')i++ ;else if(g[h]==')')i-- ;if(i==-1)break;}if(i!=-1)g=g.substring(1,g.length-1);}int m=-1;int i=0;for(int h=0;h<g.length;h++ ){if(i==0&&cH(g,h)){m=h;break;}else if(g[h]=='(')i++ ;else if(g[h]==')')i-- ;}if(m==-1){bool DB;try {DB=NT.hasMatch(g);}on FormatException catch (jB){DB=false;}if(DB)return (new RI(g));final int o=g.indexOf('(');if(o!=-1&&g[g.length-1]==')'){int t=-1;i=0;for(int h=0;h<g.length;h++ ){final String j=g[h];if(j=='('&&i==0&&h!=o){t=h;break;}else if(j=='(')i++ ;else if(j==')')i-- ;}String yB=null;dD FB=null;if(t==-1){FB=new mG(g.substring(0,o));g=g.substring(o+1,g.length-1);}else{FB=qI(g.substring(0,t));g=g.substring(t+1,g.length-1);}final List<dD> v=new List<dD>();int k=-1;i=0;for(int h=0;h<g.length;h++ ){final String j=g[h];if(j==';'&&i==0){k=h;break;}else if(j=='(')i++ ;else if(j==')')i-- ;}if(k==-1)v.add(qI(g.trim()));else while(k!=-1){v.add(qI(g.substring(0,k).trim()));g=g.substring(k+1);k=-1;i=0;for(int h=0;h<g.length;h++ ){final String j=g[h];if(j==';'&&i==0){k=h;break;}else if(j=='(')i++ ;else if(j==')')i-- ;}if(k==-1)v.add(qI(g.trim()));}return (new dH(FB,v));}else return (new mG(g));}final String bB=g[m];final String QB=g.substring(0,m).trim();dD HB;if(QB=='')HB=null;else HB=qI(QB);final String SB=g.substring(m+1).trim();dD KB;if(SB=='')KB=null;else KB=qI(SB);return (new aE(bB,HB,KB));}static XB JC(final dD g){if(g!=null)return g.GF();final XG h=new XG();h.XC("?");return h;}}abstract class dD{XB GF();void UH();}class dH implements dD{dD TF;List<dD> uE;final RegExp eV=new RegExp("^[0-9]+.*\$");dH(final dD g,final List<dD> h){this.TF=g;if(g is mG&&eV.hasMatch(g.TF)){g.TF="?";}uE=h;if((WJ()=="unité"||WJ()=="unit")&&uE.length>1&&uE[1]!=null)uE[1].UH();}void UH(){for(dD g in uE)if(g!=null)g.UH();}String WJ(){if(TF is mG)return ((TF as mG).TF);else return (null);}XB GF(){dD j,o,v,FB;if(uE.length>0)j=uE[0];else j=null;if(uE.length>1)o=uE[1];else o=null;if(uE.length>2)v=uE[2];else v=null;if(uE.length>3)FB=uE[3];else FB=null;String i=WJ();XB h;if(i=="sqrt"||(i=="racine"&&(j==null||o==null))){h=new gP();h.RB(nB.JC(j));}else if(i=="racine"||i=="root"){h=new eP();h.RB(nB.JC(j));h.RB(nB.JC(o));}else if(i=="exp"){h=new ML();final OI HF=new OI();HF.XC("e");h.RB(HF);h.RB(nB.JC(j));}else if(i=="abs"){h=new aC();pB g=new pB();g.XC("|");h.RB(g);h.RB(nB.JC(j));g=new pB();g.XC("|");h.RB(g);}else if(i=="norm"||i=="norme"){h=new aC();pB g=new pB();g.XC("\u2016");h.RB(g);h.RB(nB.JC(j));g=new pB();g.XC("\u2016");h.RB(g);}else if(i=="fact"||i=="factorielle"||i=="factorial"){h=new aC();pB g;if(!(j is mG||j is RI)){g=new pB();g.XC("(");h.RB(g);}h.RB(j.GF());if(!(j is mG||j is RI)){g=new pB();g.XC(")");h.RB(g);}g=new pB();g.XC("!");h.RB(g);}else if(i=="int"||i=="intégrale"){h=new aC();pB g=new pB();g.XC("\u222B");g.dJ(true);if(v!=null&&FB!=null){final QI t=new QI();t.RB(g);t.RB(nB.JC(v));t.RB(nB.JC(FB));h.RB(t);}else if(v!=null){final sJ HC=new sJ();HC.RB(g);HC.RB(nB.JC(v));h.RB(HC);}else if(FB!=null){final kF k=new kF();k.RB(g);k.RB(nB.JC(FB));h.RB(k);}else h.RB(g);final aC m=new aC();m.RB(nB.JC(j));if(o!=null){g=new pB();g.XC("d");m.RB(g);m.RB(o.GF());}h.RB(m);}else if(i=="prod"||i=="sum"||i=="produit"||i=="somme"){h=new aC();final QI t=new QI();final pB g=new pB();if(i=="prod"||i=="produit")g.XC("\u220F");else if(i=="sum"||i=="somme")g.XC("\u2211");g.dJ(true);t.RB(g);t.RB(nB.JC(o));t.RB(nB.JC(v));h.RB(t);final aC m=new aC();m.RB(nB.JC(j));h.RB(m);}else if(i=="over"||i=="dessus"){final kF k=new kF();k.RB(nB.JC(j));k.RB(nB.JC(o));h=k;}else if(i=="subsup"){final uM jB=new uM();jB.RB(nB.JC(j));jB.RB(nB.JC(o));jB.RB(nB.JC(v));h=jB;}else if(i=="accent"){final kF k=new kF();k.IP(true);k.RB(nB.JC(j));if(o is aE&&(o as aE).TE=='\u223C'){final pB g=new pB();g.dJ(true);g.XC("\u223C");k.RB(g);}else k.RB(nB.JC(o));h=k;}else if(i=="matrix"||i=="matrice"){h=new aC();pB g=new pB();g.XC("(");h.RB(g);final qJ QB=new qJ();for(final dD SB in uE)QB.RB(nB.JC(SB));h.RB(QB);g=new pB();g.XC(")");h.RB(g);}else if(i=="system"||i=="système"){h=new aC();final pB g=new pB();g.XC("{");h.RB(g);final qJ QB=new qJ();for(final dD SB in uE){final aC m=new aC();final NI HB=new NI();HB.FW("left");HB.RB(nB.JC(SB));m.RB(HB);QB.RB(m);}h.RB(QB);}else if(i=="line"||i=="ligne"){h=new dP();for(final dD SB in uE){final NI HB=new NI();HB.RB(nB.JC(SB));h.RB(HB);}}else if(i=="slash"){h=new aC();h.RB(nB.JC(j));final pB g=new pB();g.XC("/");h.RB(g);h.RB(nB.JC(o));}else if(i=="frac"||i=="fraction"){final rJ wC=new rJ();wC.RB(nB.JC(j));wC.RB(nB.JC(o));h=wC;}else if(i=="pscalaire"||i=="scalarp"){final aC m=new aC();m.RB(nB.JC(j));final pB g=new pB();g.XC(".");m.RB(g);m.RB(nB.JC(o));return m;}else if(i=="dtemps"||i=="timed"){final kF k=new kF();k.IP(true);k.RB(nB.JC(j));pB yB=new pB();if(o is RI){try {final int jJ=int.parse((o as RI).QP);String KD="";for(int KB=0;KB<jJ;KB++ )KD=KD+'.';yB.XC(KD);}on FormatException catch (FL){yB.XC("?");}}else yB.XC("?");k.RB(yB);h=k;}else if(i=="unité"||i=="unit"){final aC m=new aC();m.RB(nB.JC(j));final pB g=new pB();g.XC(" ");m.RB(g);m.RB(nB.JC(o));return m;}else if(i=="moyenne"||i=="mean"){h=new aC();pB g=new pB();g.XC("\u2329");h.RB(g);h.RB(nB.JC(j));g=new pB();g.XC("\u232A");h.RB(g);}else if(i=="vecteur"||i=="vector"){final XB DB=nB.JC(j);if(DB is OI){DB.IS("bold");h=DB;}else if(DB is NL&&DB.NB(0) is OI){(DB.NB(0) as OI).IS("bold");h=DB;}else{final kF k=new kF();k.IP(true);k.RB(nB.JC(j));final pB g=new pB();g.dJ(true);g.XC("\u2192");k.RB(g);h=k;}}else{h=new aC();bool YE=true;if(TF is mG){XG VG=new XG();for(final List<String> bB in nB.nP)if(i==bB[0]){i=bB[1];break;}for(final List<String> bB in nB.pP)if(i==bB[0]){i=bB[1];break;}VG.XC(i);if(o==null&&j is mG)for(final String kJ in nB.MT)if(i==kJ){YE=false;break;}h.RB(VG);}else h.RB(TF.GF());if(YE){final pB g=new pB();g.XC("(");h.RB(g);}h.RB(nB.JC(j));for(int KB=1;KB<uE.length;KB++ ){final pB g=new pB();g.XC(";");h.RB(g);h.RB(uE[KB].GF());}if(YE){final pB g=new pB();g.XC(")");h.RB(g);}else{final XG KI=new XG();KI.XC("\u00A0");h.RB(KI);}}return h;}}class aE implements dD{String TE;dD UD;dD oD;bool vI;aE(final String h,final dD i,final dD g){TE=h;this.UD=i;this.oD=g;vI=false;if(TE=='#'&&g!=null)g.UH();}void UH(){vI=true;if(UD!=null)UD.UH();if(oD!=null)oD.UH();}XB GF(){if(TE=='/'){final rJ v=new rJ();v.RB(nB.JC(UD));v.RB(nB.JC(oD));return v;}else if(TE=='^'){final ML DB=new ML();bool m;if(UD is dH){String j=(UD as dH).WJ();if(j=="sqrt"||j=="racine")m=false;else if(j=="abs")m=false;else if(j=="matrice")m=false;else if(j=="dtemps"||j=="timed")m=false;else m=true;}else if(UD is aE){String QB=(UD as aE).TE;if(QB=='_')m=false;else m=true;}else m=false;XB k;if(m)k=fI(UD.GF());else k=nB.JC(UD);DB.RB(k);DB.RB(nB.JC(oD));return DB;}else if(TE=='_'){final NL FB=new NL();FB.RB(nB.JC(UD));FB.RB(nB.JC(oD));return FB;}else if(TE=='#'){final aC g=new aC();g.RB(nB.JC(UD));g.RB(nB.JC(oD));return g;}else if(TE=='*'){final aC g=new aC();XB k=nB.JC(UD);if(UD is aE&&"+-".indexOf((UD as aE).TE)!=-1)k=fI(k);g.RB(k);dD o=oD;if(oD!=null)while(o is aE&&(o as aE).UD!=null){o=(o as aE).UD;}final bool SB=o is RI;bool HB=false;if(UD is dH){final String j=(UD as dH).WJ();if(j=="pscalaire"||j=="scalarp")HB=true;}bool KB=false;if(oD is dH){final String j=(oD as dH).WJ();if(j=="pscalaire"||j=="scalarp")KB=true;}if((SB)||(HB&&KB)){final pB i=new pB();i.XC("×");g.RB(i);}else{if(vI){final pB i=new pB();i.XC(".");g.RB(i);}}XB h=nB.JC(oD);if(oD is aE&&"+-".indexOf((oD as aE).TE)!=-1)h=fI(h);g.RB(h);return g;}else if(TE=='-'){final aC g=new aC();if(UD!=null)g.RB(UD.GF());final pB i=new pB();i.XC("-");g.RB(i);if(oD!=null){XB h=oD.GF();if(oD is aE&&"+-".indexOf((oD as aE).TE)!=-1)h=fI(h);g.RB(h);}return g;}else if(TE=='+'){final aC g=new aC();if(UD!=null)g.RB(UD.GF());final pB i=new pB();i.XC("+");g.RB(i);if(oD!=null){XB h=oD.GF();if(h is aC&&h.QC()>0){XB t=h;while(t is aC&&t.QC()>0)t=t.NB(0);if(t.gB()=="-")h=fI(h);}g.RB(h);}return g;}else{final aC g=new aC();if(UD!=null){XB k=UD.GF();if(TE=='\u2227'&&UD is aE&&"+-".indexOf((UD as aE).TE)!=-1)k=fI(k);g.RB(k);}final pB i=new pB();i.XC(TE);if("=\u2260\u2248\u223C\u2261\u2264\u2265\u226A\u226B\u221D".indexOf(TE)!=-1){i.GW(0.5);i.IW(0.5);}g.RB(i);if(oD!=null){XB h=oD.GF();if(TE=='\u2227'&&oD is aE&&"+-".indexOf((oD as aE).TE)!=-1)h=fI(h);g.RB(h);}return g;}}XB fI(final XB i){final aC h=new aC();pB g=new pB();g.XC("(");h.RB(g);h.RB(i);g=new pB();g.XC(")");h.RB(g);return h;}}class RI implements dD{String QP;RI(final String g){this.QP=g;}void UH(){}XB GF(){final fP g=new fP();g.XC(QP);return g;}}class mG implements dD{String TF;bool vI;final RegExp aU=new RegExp("^[0-9]+[a-zA-Z]+\$");mG(final String g){this.TF=g.trim();vI=false;}void UH(){vI=true;}XB GF(){if(TF=="hat"||TF=="chapeau"){final pB h=new pB();h.dJ(true);h.XC("^");return h;}else if(TF=="bar"||TF=="barre"){final pB h=new pB();h.dJ(true);h.XC("\u00AF");return h;}else{String g=TF;bool k=vI;for(final List<String> i in nB.nP)if(g==i[0]){g=i[1];break;}for(final List<String> i in nB.pP)if(g==i[0]){g=i[1];k=true;break;}if(g.indexOf(',')!=-1||g.indexOf('.')!=-1||g.indexOf('(')!=-1||g.indexOf(')')!=-1)g="?";if(g.indexOf(' ')!=-1)g=g.replaceAll(" ","?");if(g.indexOf('\u00A0')!=-1)g=g.replaceAll("\u00A0","?");if(aU.hasMatch(g))g="?";XB j;if(k)j=new XG();else j=new OI();j.XC(g);return j;}}}class xD{static final vM=new CanvasElement(width:500,height:300);double width;double height;double pE;double rH;double actualBoundingBoxAscent;double actualBoundingBoxDescent;xD(final String KB,final String QB){SpanElement i=new SpanElement();i.setAttribute('style',"font: ${QB}");i.text=KB;DivElement j=new DivElement();j.setAttribute('style','display: inline-block; width: 1px; height: 0px;');DivElement m=new DivElement();m.append(i);m.append(j);ZB.document.body.append(m);width=i.offset.width.toDouble();j.style.verticalAlign='bottom';height=(j.offset.top-i.offset.top).toDouble();j.style.verticalAlign='baseline';pE=(j.offset.top-i.offset.top).toDouble();rH=height-pE;m.remove();CanvasRenderingContext2D k=vM.context2D;k.font=QB;k.fillStyle='white';k.fillRect(0,0,vM.width,vM.height);k.fillStyle='black';k.fillText(KB,0,pE);int h=width.ceil();int o=height.ceil();List<int> t=k.getImageData(0,0,h,o).data;int v=0;bool SB=false;int FB=v;int DB=o-1;bool bB=false;int HB=DB;for(int g=0;g<h*o;g++ ){if(!SB&&t[g*4]!=0xFF){v=g~/h;FB=v;SB=true;}if(t[g*4]<0x90){FB=g~/h;break;}}double jB=(v+FB)/2;for(int g=h*o-1;g>=0;g-- ){if(!bB&&t[g*4]!=0xFF){DB=g~/h;HB=DB;bB=true;}if(t[g*4]<0x90){HB=g~/h;break;}}double yB=(DB+HB)/2;actualBoundingBoxAscent=pE-jB;actualBoundingBoxDescent=yB-pE;}}class aN{static String bN;static String cN='en_US';static String nT(String g){if(g==null)return oT();if(g=="C")return "en_ISO";if(g.length<5)return g;if(g[2]!='-'&&(g[2]!='_'))return g;var h=g.substring(3);if(h.length<=3)h=h.toUpperCase();return '${g[0]}${g[1]}_${h}';}static String oT(){if(bN==null)bN=cN;return bN;}}Future<String> pT(){aN.cN=aN.nT(ZB.window.navigator.language);return new Future.value(aN.cN);}class oG extends n{String Ya;String Za;oG.PX(l g):super.EX(g){Ya=s.CB.eC(AB,'nameAtt','name');Za=s.CB.eC(AB,'hrefAtt','href');}oG.sX(BB g,n h):super.zW(g,h){Ya=s.CB.eC(AB,'nameAtt','name');Za=s.CB.eC(AB,'hrefAtt','href');}Element UB(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');g.classes.add('anchor');if(!valid)g.classes.add('invalid');if(firstChild==null){ImageElement h=new ImageElement();h.src='packages/daxe/images/toolbar/anchor.png';h.width=16;h.height=16;if(getAttribute(Ya)!=null)h.title=getAttribute(Ya);h.onClick.listen((MouseEvent j)=>QE());g.append(h);}else{if(getAttribute(Za)!=null)g.title=getAttribute(Za);n i=firstChild;while(i!=null){g.append(i.UB());i=i.nextSibling;}g.onDoubleClick.listen((MouseEvent j)=>QE());}return (g);}void WF(List<n> g){super.lE();}bool get HD{return (true);}static List<l> QT(){return (s.CB.yG('anchor'));}static void RT(l m){q g=IB.BD();if(g==IB.DF()){if(g.u is OB){String j=g.u.nodeValue;int k=g.JB;int h=k;if(h>0)h-- ;int i=k;while(h>0&&j[h]!=' ')h-- ;while(i<j.length&&j[i]!=' ')i++ ;IB.cursor.kE(new q(g.u,h),new q(g.u,i));}}s.oI(m,'element');}static void VT(l g){s.oI(g,'element');}static void WT(){q k=IB.BD();n h=k.u;while(h!=null){if(h is oG)break;h=h.parent;}if(h==null)return;oG g=h;if(g.firstChild==null){s.XM(g);IB.ZC();return;}h=g.parent;GB i=new GB.DX(LB.MB('undo.remove_element'));n m=s.hI(new q(g,0),new q(g,g.PB));i.TB(new GB.AX(g));q j;if(g.previousSibling is OB)j=new q(g.previousSibling,g.previousSibling.PB);else j=new q(h,h.aB(g));i.TB(s.SE(m,j,checkValidity:false));s.KC(i);IB.ZC();}}class DJ extends n{cB aa;cB ba;DJ.eX(l g):super.EX(g){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);}DJ.tX(BB g,n h):super.zW(g,h){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);fG();}Element UB(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.append(aa.UB());DivElement h=new DivElement();h.classes.add('indent');n i=firstChild;while(i!=null){h.append(i.UB());i=i.nextSibling;}if(lastChild==null||lastChild.nodeType==n.qB)h.appendText('\n');KP(h);g.append(h);g.append(ba.UB());return (g);}void WF(List<n> i){super.WF(i);DivElement h=CE();if(h.nodes.length>0){Node g=h.nodes.first;while(g!=null){Node j=g.nextNode;if(g is Text||g is BRElement)g.remove();g=j;}}if(lastChild==null||lastChild.nodeType==n.qB)h.appendText('\n');}void hJ(){Element g=DC().nodes[0];aa=new cB(this,cB.NE,true);g.replaceWith(aa.UB());}Element CE(){return (DC().nodes[1]);}bool jE(){return (true);}bool jG(){return (true);}}class DG extends n{cB aa;cB ba;DG():super.FX(n.tC){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);}DG.YX(BB g,n h):super.zW(g,h){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);}Element UB(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');g.append(aa.UB());SpanElement i=new SpanElement();n h=firstChild;while(h!=null){i.append(h.UB());h=h.nextSibling;}g.append(i);g.append(ba.UB());return (g);}Element CE(){return (DC().nodes[1]);}BB MF(AC h){String g=null;if(firstChild!=null)g=firstChild.nodeValue;return (h.KR(g));}void kG(){super.kG();parent.kG();}}class CG extends n{cB aa;cB ba;CG():super.FX(n.tC){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);}CG.ZX(BB g,n h):super.zW(g,h){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);}Element UB(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');g.append(aa.UB());SpanElement i=new SpanElement();n h=firstChild;while(h!=null){i.append(h.UB());h=h.nextSibling;}g.append(i);g.append(ba.UB());g.style.color="#808080";return (g);}Element CE(){return (DC().nodes[1]);}BB MF(AC h){String g=null;if(firstChild!=null)g=firstChild.nodeValue;return (h.LR(g));}}class TL extends n{cB aa;cB ba;TL.hX(l g):super.EX(g){aa=new cB(this,cB.NE,true);ba=new cB(this,cB.mE,true);}TL.vX(BB g,n h):super.zW(g,h){aa=new cB(this,cB.NE,true);ba=new cB(this,cB.mE,true);fG();}Element UB(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.append(aa.UB());DivElement h=new DivElement();h.classes.add('indent');n i=firstChild;while(i!=null){h.append(i.UB());i=i.nextSibling;}if(lastChild==null||lastChild.nodeType==n.qB)h.appendText('\n');g.append(h);g.append(ba.UB());return (g);}void WF(List<n> i){super.WF(i);DivElement h=CE();if(h.nodes.length>0){Node g=h.nodes.first;while(g!=null){Node j=g.nextNode;if(g is Text||g is BRElement)g.remove();g=j;}}if(lastChild==null||lastChild.nodeType==n.qB)h.appendText('\n');}void hJ(){Element g=DC().nodes[0];aa=new cB(this,cB.NE,true);g.replaceWith(aa.UB());}Element CE(){return (DC().nodes[1]);}bool jE(){return (true);}bool jG(){return (true);}}class nG extends n{String UG;String yF;nG():super.FX(n.BG){UG='1.0';yF='UTF-8';}nG.cX(BB g):super.zW(g,null){UG=(g as AC).UG;yF=(g as AC).yF;}Element UB(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');n h=firstChild;while(h!=null){g.append(h.UB());h=h.nextSibling;}if(lastChild==null||lastChild.nodeType==n.qB)g.appendText('\n');return (g);}BB MF(AC g){g.UG=UG;g.yF=yF;for(n h=firstChild;h!=null;h=h.nextSibling){g.mB(h.MF(g));}return (g);}}class zI extends n{cB aa;zI.OX(l g):super.EX(g){aa=new cB(this,cB.pM);}zI.iX(BB g,n h):super.zW(g,h){aa=new cB(this,cB.pM);}Element UB(){Element g;g=new SpanElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.append(aa.UB());return (g);}q CF(){return (null);}q PG(){return (null);}Element CE(){return (null);}}class FJ extends n{ImageElement ca;String da;String ea;String fa;String ga;BN ha;FJ.FY(l g):super.EX(g){da=s.CB.eC(AB,'texteAtt',null);ea=s.CB.eC(AB,'labelAtt',null);fa=s.CB.eC(AB,'serveur',null);}FJ.JY(BB g,n h):super.zW(g,h,createChildren:false){da=s.CB.eC(AB,'texteAtt','texte');fa=s.CB.eC(AB,'serveur',null);if(g.firstChild!=null)ga=g.firstChild.nodeValue;else ga=null;}Element UB(){ca=new ImageElement();ca.attributes['id']="${id}";ca.attributes['class']='dn';if(ga!=null){String g="data:image/png;base64,${ga}";ca.attributes['src']=g;}ca.onLoad.listen((Event h)=>YO());ca.onClick.listen((MouseEvent h)=>QE());ca.style.verticalAlign='middle';return (ca);}void YO(){if(ca.naturalWidth>500){ca.width=500;}}q CF(){return (null);}q PG(){return (null);}void QE([kD g]){String h=getAttribute(da);String i=getAttribute(ea);ha=new BN(fa,h,labelName:ea,labelValue:i,okfct:()=>QU(g));ha.show();}void QU(kD g){if(g!=null)g();String j=ha.gB();String h=ha.WR();if(g==null){List<iB> i=new List<iB>();i.add(new iB(da,j));if(ea!=null&&h!='')i.add(new iB(ea,h));GB k=new GB.BX(this,i,updateDisplay:false);s.KC(k);}else{setAttribute(da,j);if(ea!=null)setAttribute(ea,h);}BL();}void hJ(){BL();}void BL(){String g=getAttribute(da);getData(g).then((String h){ga=h;lE();IB.TD(new q(parent,parent.aB(this)+1));},onError:(Object i){ZB.window.alert(i.toString());});}Future<String> getData(String g){if(g==null||g=='')g='?';Completer<String> h=new Completer<String>();String j="${fa}?${Uri.encodeComponent(g)}";HttpRequest.request(j,method:'GET',responseType:'arraybuffer').then((HttpRequest k){Object i=k.response;if(i is ByteBuffer){Uint8List m=new Uint8List.view(i);String o=bS.cS(m);h.complete(o);}else h.completeError(new RD('request response is not a ByteBuffer'));},onError:(Object t){h.completeError(new RD("Error getting the equation image from the server ${fa} : ${t}"));});return (h.future);}BB MF(AC i){l g=i.createElementNS(tB,nodeName);for(iB h in attributes)g.setAttributeNS(h.tB,h.name,h.value);if(ga!=null)g.mB(i.vG(ga));return (g);}}class BN{String ia;String ja;String ka;kD la;String fa;String ga;BN(this.fa,String g,{String labelName,String labelValue,kD okfct}){ia=g;ja=labelName;ka=labelValue;la=okfct;}void show(){DivElement i=new DivElement();i.id='dlg1';i.classes.add('dlg1');DivElement v=new DivElement();v.classes.add('dlg2');DivElement DB=new DivElement();DB.classes.add('dlg3');FormElement h=new FormElement();ImageElement FB=new ImageElement();FB.id='eqimg';FB.src=VR();h.append(FB);TextAreaElement g=new TextAreaElement();g.id='eqtext';if(ia!=null)g.value=ia;g.style.width='100%';g.style.height='4em';g.attributes['spellcheck']='false';g.onInput.listen((Event j)=>hU());h.append(g);if(ja!=null){DivElement k=new DivElement();SpanElement QB=new SpanElement();QB.text=ja;k.append(QB);k.appendText(' ');TextInputElement HB=new TextInputElement();HB.id='eqlabel';if(ka!=null)HB.value=ka;k.append(HB);h.append(k);}DivElement SB=new DivElement();ButtonElement KB=new ButtonElement();KB.appendText(LB.MB("equation.preview"));KB.onClick.listen((MouseEvent j)=>oV(j));SB.append(KB);h.append(SB);DivElement m=new DivElement();m.classes.add('buttons');ButtonElement o=new ButtonElement();o.attributes['type']='button';o.appendText(LB.MB("button.Cancel"));o.onClick.listen((MouseEvent j)=>i.remove());m.append(o);ButtonElement t=new ButtonElement();t.attributes['type']='submit';t.appendText(LB.MB("button.OK"));t.onClick.listen((MouseEvent j)=>UF(j));m.append(t);h.append(m);DB.append(h);v.append(DB);i.append(v);ZB.document.body.append(i);g.focus();}void UF(MouseEvent g){TextAreaElement h=ZB.querySelector('textarea#eqtext');ia=h.value;if(ja!=null){TextInputElement i=ZB.querySelector('input#eqlabel');ka=i.value;}ZB.querySelector('div#dlg1').remove();if(g!=null)g.preventDefault();if(la!=null)la();}String gB(){return (ia);}void BL(){if(ia=='')return (null);ImageElement g=ZB.querySelector('img#eqimg');CanvasElement h=new CanvasElement(width:g.width,height:g.height);CanvasRenderingContext2D i=h.context2D;i.drawImage(g,0,0);String j=h.toDataUrl('image/png');ga=j.substring('data:image/png;base64,'.length);}String WR(){return (ka);}String VR(){String g=ia;if(g==null||g=='')g='?';return ("${fa}?${Uri.encodeComponent(g)}");}void UW(){ImageElement g=ZB.querySelector('img#eqimg');g.src=VR();}void oV(MouseEvent g){g.preventDefault();TextAreaElement h=ZB.querySelector('textarea#eqtext');ia=h.value;UW();}void hU(){TextAreaElement h=ZB.querySelector('textarea#eqtext');String g=h.value;if(g.length>0&&g.contains('\n')){h.value=g.replaceAll('\n','');UF(null);return;}}}class EJ extends n{ImageElement ca;String da;String ga;tM ha;EJ.zX(l g):super.EX(g){da=s.CB.eC(AB,'texteAtt','src');qD.oP();}EJ.EY(BB g,n h):super.zW(g,h,createChildren:false){da=s.CB.eC(AB,'texteAtt','src');if(g.firstChild!=null)ga=g.firstChild.nodeValue.replaceAll('\n','');else ga=null;qD.oP();}Element UB(){ca=new ImageElement();ca.attributes['id']="${id}";ca.attributes['class']='dn';if(ga!=null){String g="data:image/png;base64,${ga}";ca.attributes['src']=g;}ca.onLoad.listen((Event h)=>YO());ca.onClick.listen((MouseEvent h)=>QE());ca.style.verticalAlign='middle';return (ca);}void YO(){if(ca.naturalWidth>500){ca.width=500;}}q CF(){return (null);}q PG(){return (null);}void QE([kD h]){String g=getAttribute(da);if(g==null)g='';ha=new tM(g,okfct:(){String g=ha.gB();if(DC()!=null){iB i=new iB(da,g);GB j=new GB.CX(this,i,updateDisplay:false);s.KC(j);}else{setAttribute(da,g);}ga=ha.getData();if(ca!=null){String k="data:image/png;base64,${ga}";ca.attributes['src']=k;}if(h!=null)h();ca.onLoad.listen((Event m)=>IB.TD(new q(parent,parent.aB(this)+1)));});ha.show();}void hJ(){BL();lE();}void BL(){String j=getAttribute(da);nB h=new nB(j);CanvasElement k=new CanvasElement(width:500,height:300);qD i=new qD(element:h.pK(),context:k.context2D);CanvasElement g=new CanvasElement(width:i.eB(),height:i.PC());qD m=new qD(element:h.pK(),context:g.context2D);m.GC(g.context2D);String o=g.toDataUrl('image/png');ga=o.substring('data:image/png;base64,'.length);}BB MF(AC k){l h=k.createElementNS(tB,nodeName);for(iB i in attributes)h.setAttributeNS(i.tB,i.name,i.value);if(ga!=null){StringBuffer j=new StringBuffer();String g=ga;while(g!=''){if(g.length<=76){j.write(g);g='';}else{j.writeln(g.substring(0,76));g=g.substring(76);}}h.mB(k.vG(j.toString()));}return (h);}}class eH extends n{ImageElement ca;String ma;eH.qX(l g):super.EX(g){ma=s.CB.eC(AB,'srcAtt','src');}eH.AY(BB g,n h):super.zW(g,h){ma=s.CB.eC(AB,'srcAtt','src');}Element UB(){assert(s.TJ!=null);ca=new ImageElement();ca.id="${id}";ca.classes.add('dn');String g='';String h=s.TJ;int i=h.lastIndexOf('/');if(i!=-1)g=h.substring(0,i+1);String j="${g}${getAttribute(ma)}";ca.src=j;ca.alt=getAttribute(ma);ca.onLoad.listen((Event k)=>PV());ca.onClick.listen((MouseEvent k)=>QE());return (ca);}void PV(){if(ca.naturalWidth>500){ca.width=500;}if(IB.BD()!=null&&IB.BD()>new q(this,0))IB.cursor.YH(false);}q CF(){return (null);}q PG(){return (null);}}class nE extends n{List<l> pH;List<l> uG;HashMap<String,FE> FO;bool TG;FE control;nE.nX(l g):super.EX(g){pH=s.CB.bC(AB);uG=s.CB.iE(AB);TG=(pH.length==0&&uG.length==0);fF();}nE.CY(BB h,n k):super.zW(h,k,createChildren:false){pH=s.CB.bC(AB);uG=s.CB.iE(AB);TG=(pH.length==0&&uG.length==0);if(h.childNodes!=null){n i=null;for(BB j in h.childNodes){n g;if(TG&&j.nodeType==BB.nF)g=new KH.kX(j,this);else g=pD.MI(j,this);if(i==null)firstChild=g;else i.nextSibling=g;i=g;}}if(!TG){List<n> m=childNodes;for(n g in m){if(g is OB)CD(g);}}fF();}void fF(){if(uG.length>0)FO=new HashMap<String,FE>();NU();}void NU(){n h=null;for(l i in pH){bool j=false;for(n g in childNodes){if(g.AB==i){j=true;h=g;}}if(!j){n g=pD.jF(i);if(h!=null)insertAfter(g,h);else if(firstChild!=null)insertBefore(g,firstChild);else mB(g);h=g;}}}Element UB(){ButtonElement t=XL(AB,null);if(TG){TableRowElement h=new TableRowElement();h.id="${id}";h.classes.add('dn');TableCellElement g=new TableCellElement();g.classes.add('shrink');g.append(t);h.append(g);g=new TableCellElement();g.classes.add('shrink');g.text=s.CB.YD(AB);if(s.CB.EI(parent.AB,AB))g.classes.add('required');else g.classes.add('optional');h.append(g);g=new TableCellElement();String m;if(firstChild!=null)m=firstChild.nodeValue;else m='';control=new FE.wX(AB,m,valueChanged:()=>LO());g.append(control.UB());h.append(g);if(parent is nE)(parent as nE).dK(h,this);return (h);}else{DivElement j=new DivElement();j.id="${id}";j.classes.add('dn');j.classes.add('form');SpanElement i=new SpanElement();i.classes.add('form_title');i.append(t);i.appendText(' ');i.appendText(s.CB.YD(AB));if(s.CB.EI(parent.AB,AB))i.classes.add('required');else i.classes.add('optional');j.append(i);TableElement k=new TableElement();k.classes.add('expand');for(l v in uG){k.append(WU(v));}for(l DB in pH){for(n o in childNodes){if(o.AB==DB){o.iJ=true;JU(k,o);}}}j.append(k);return (j);}}void LO(){String h=control.wF();GB g=new GB.DX(LB.MB('form.text_edition'));if(firstChild is OB)g.TB(new GB.AX(firstChild,updateDisplay:false));if(h!='')g.TB(new GB.xW(new q(this,0),new KH(h),updateDisplay:false));s.KC(g);dM();}Element CE(){if(TG){return (DC().nodes[2]);}else{return (DC().nodes[1]);}}TableRowElement WU(l h){String o=s.CB.fK(AB,h);TableRowElement i=new TableRowElement();TableCellElement g=new TableCellElement();g.classes.add('shrink');ButtonElement v=XL(AB,h);g.append(v);i.append(g);g=new TableCellElement();g.classes.add('shrink');g.text=s.CB.GM(AB,h);if(s.CB.vK(AB,h))g.classes.add('required');else g.classes.add('optional');i.append(g);g=new TableCellElement();g.classes.add('expand');String j=getAttribute(o);String t=s.CB.uF(h);if(j==null){if(t!=null)j=t;else j='';}FE k;k=new FE.HY(AB,h,j,valueChanged:()=>eU(h,k),catchUndo:true);FO[o]=k;Element m=k.UB();if(m.firstChild is TextInputElement)(m.firstChild as TextInputElement).classes.add('form_field');g.append(m);i.append(g);g=new TableCellElement();g.classes.add('shrink');i.append(g);return (i);}void eU(l j,FE m){String h=m.wF();String k=s.CB.fK(AB,j);String i=s.CB.uF(j);iB g;if((h==''&&i==null)||h==i)g=new iB(k,null);else if(h!=''||i!=null)g=new iB(k,h);else g=null;if(g!=null)s.KC(new GB.CX(this,g,updateDisplay:false));}void JU(TableElement m,n i){Element j=i.UB();TableRowElement h;if(j is TableRowElement)h=j;else{h=new TableRowElement();TableCellElement g;int k;if(i is!nE){g=new TableCellElement();ButtonElement o=XL(i.AB,null);g.append(o);h.append(g);k=2;}else k=3;g=new TableCellElement();g.colSpan=k;g.append(j);h.append(g);dK(h,i);}m.append(h);}void dK(TableRowElement k,n g){TableCellElement j=new TableCellElement();j.classes.add('shrink');if(s.CB.JV().nD(AB,g.AB)){if(g.nextSibling==null||g.nextSibling.AB!=g.AB){if(g.firstChild!=null||g is!nE){ButtonElement h=new ButtonElement();h.attributes['type']='button';h.value='+';h.text='+';h.onClick.listen((Event m)=>MU(g));j.append(h);}}if((g.previousSibling!=null&&g.previousSibling.AB==g.AB)||(g.nextSibling!=null&&g.nextSibling.AB==g.AB)){ButtonElement i=new ButtonElement();i.attributes['type']='button';i.value='-';i.text='-';i.onClick.listen((Event m)=>s.XM(g));j.append(i);}}k.append(j);}void MU(n g){n h=pD.jF(g.AB);s.insertNode(h,new q(this,aB(g)+1));}void QE([kD g]){if(g!=null)g();}void lE(){if(!TG){super.lE();return;}String g;if(firstChild!=null)g=firstChild.nodeValue;else g='';if(control.wF()!=g)control.LP(g);dM();}void WF(List<n> g){lE();}void dM(){if(parent is nE){TableRowElement g=DC();g.nodes.last.remove();(parent as nE).dK(g,this);}}void hJ(){DivElement m=DC();TableElement o=ZB.querySelector("#${id}>table");int k=0;for(l h in uG){String i=s.CB.fK(AB,h);String g=getAttribute(i);String j=s.CB.uF(h);if(g==null){if(j!=null)g=j;else g='';}FO[i].LP(g);k++ ;}}bool jE(){return (pH.length!=0);}BB MF(AC h){if(pH.length==0)return (super.MF(h));l i=h.createElementNS(tB,nodeName);for(iB j in attributes)i.setAttributeNS(j.tB,j.name,j.value);i.mB(h.vG('\n'));for(n g=firstChild;g!=null;g=g.nextSibling){if(g.firstChild!=null||(g.attributes!=null&&g.attributes.length>0)){i.mB(g.MF(h));i.mB(h.vG('\n'));}}return (i);}static ButtonElement XL(final l i,final l j){ButtonElement g=new ButtonElement();g.attributes['type']='button';g.classes.add('help');g.value='?';g.text='?';if(j==null){String h=s.CB.jI(i);if(h!=null)g.title=h;g.onClick.listen((Event k)=>(new EH.dW(i)).show());}else{String h=s.CB.oH(i,j);if(h!=null)g.title=h;g.onClick.listen((Event k)=>(new EH.fW(j,i)).show());}return (g);}}class xI extends n{bool TG;FE control;xI.QX(l g):super.EX(g){List<l> h=s.CB.bC(AB);TG=(h.length==0);}xI.rX(BB h,n k):super.zW(h,k,createChildren:false){List<l> m=s.CB.bC(AB);TG=(m.length==0);if(h.childNodes!=null){n i=null;for(BB j in h.childNodes){n g;if(TG&&j.nodeType==BB.nF)g=new KH.kX(j,this);else g=pD.MI(j,this);if(i==null)firstChild=g;else i.nextSibling=g;i=g;}}}Element UB(){ButtonElement t=nE.XL(AB,null);TableRowElement h=new TableRowElement();h.id="${id}";h.classes.add('dn');TableCellElement g=new TableCellElement();g.classes.add('shrink');g.append(t);h.append(g);g=new TableCellElement();g.classes.add('shrink');g.text=s.CB.YD(AB);if(s.CB.EI(parent.AB,AB))g.classes.add('required');else g.classes.add('optional');h.append(g);g=new TableCellElement();g.classes.add('expand');if(TG){String k;if(firstChild!=null)k=firstChild.nodeValue;else k='';control=new FE.wX(AB,k,valueChanged:()=>LO());Element m=control.UB();m.id="content_${id}";TextInputElement o=m.querySelector('input');if(o!=null)o.classes.add('form_field');g.append(m);}else{DivElement i=new DivElement();i.id="content_${id}";i.classes.add('form_field');n j=firstChild;while(j!=null){i.append(j.UB());j=j.nextSibling;}g.append(i);}h.append(g);if(parent is nE)(parent as nE).dK(h,this);return (h);}Element CE(){return (ZB.document.getElementById("content_${id}"));}void LO(){String h=control.wF();GB g=new GB.DX(LB.MB('form.text_edition'));if(firstChild is OB)g.TB(new GB.AX(firstChild,updateDisplay:false));if(h!='')g.TB(new GB.xW(new q(this,0),new KH(h),updateDisplay:false));s.KC(g);dM();}void WF(List<n> g){lE();}void dM(){if(parent is nE){TableRowElement g=DC();g.nodes.last.remove();(parent as nE).dK(g,this);}}}class yI extends n{String na;yI.NX(l g):super.EX(g){na=s.CB.eC(AB,'styleAtt','style');}yI.lX(BB g,n h):super.zW(g,h){na=s.CB.eC(AB,'styleAtt','style');fG();}Element UB(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');if(css!=null)g.setAttribute('style',css);for(n h=firstChild;h!=null;){g.append(h.UB());h=h.nextSibling;}if(lastChild==null||lastChild.nodeType==n.qB)g.appendText('\n');return (g);}Element CE(){return (DC());}void WF(List<n> i){super.WF(i);DivElement h=CE();if(h.nodes.length>0){Node g=h.nodes.first;while(g!=null){Node j=g.nextNode;if(g is Text||g is BRElement)g.remove();g=j;}}if(lastChild==null||lastChild.nodeType==n.qB)h.appendText('\n');}bool jE(){return (true);}bool get HD{return (true);}void set css(String g){setAttribute(na,g);}String get css{return (getAttribute(na));}void qV(){GB g=new GB.DX(LB.MB('undo.remove_element'));n h=s.hI(new q(this,0),new q(this,PB));if(s.VC!=null){lB.EN(parent,h);}g.TB(new GB.AX(this));g.TB(s.SE(h,new q(parent,parent.aB(this)),checkValidity:false));s.KC(g);}}class lB extends n{String na;lB.fX(l g):super.EX(g){na=s.CB.eC(AB,'styleAtt','style');}lB.uX(BB g,n h):super.zW(g,h){na=s.CB.eC(AB,'styleAtt','style');}Element UB(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');g.classes.add('hiddenp');if(!valid)g.classes.add('invalid');if(css!=null)g.setAttribute('style',css);for(n h=firstChild;h!=null;){g.append(h.UB());h=h.nextSibling;}return (g);}Element CE(){return (DC());}bool get HD{return (true);}bool jE(){return (true);}void set css(String g){setAttribute(na,g);}String get css{return (getAttribute(na));}bool BH(String g,String h){if(css==null)return (false);vD i=new vD(css);return (i[g]==h);}static void PT(String j){List<lB> g=VL();if(g.length==0)return;GB h=new GB.DX(LB.MB('style.remove_styles'));for(lB k in g){GB i=ST(k,j);if(i!=null)h.TB(i);}s.KC(h);IB.cursor.refresh();}static GB ST(lB g,String i){String k=g.css;if(k==null)return (null);vD h=new vD(g.css);if(h[i]!=null){h.remove(i);String m=h.toString();iB j=g.LM(g.na);j.value=m;return (new GB.BX(g,[j],updateDisplay:true));}return (null);}static void UT(String j,String k){List<lB> g=VL();if(g.length==0)return;GB h=new GB.DX(LB.MB('style.apply_style'));for(lB m in g){GB i=XT(m,j,k);if(i!=null)h.TB(i);}s.KC(h);IB.cursor.refresh();}static GB XT(lB g,String k,String m){vD i=new vD(g.css);i[k]=m;String j=i.toString();iB h=g.LM(g.na);if(h==null)h=new iB(g.na,j);else h.value=j;return (new GB.BX(g,[h],updateDisplay:true));}static List<lB> VL(){List<lB> j=new List<lB>();q h=IB.BD();q m=IB.DF();n i=h.u;while(i!=null&&i is!lB)i=i.parent;n g;if(i is lB)g=i;else if(h.u is OB)g=h.u.parent;else if(h.JB<h.u.PB)g=h.u.fB(h.JB);else if(h.u.PB==0)g=h.u;else g=h.u.lastChild.nextNode();if(g==null)return (j);if(g is lB)j.add(g);if(g.parent==null)return (j);q k=new q(g.parent,g.parent.aB(g)+1);while(k<m){g=g.nextNode();if(g==null)break;if(g is lB)j.add(g);k=new q(g.parent,g.parent.aB(g)+1);}return (j);}static bool YT(){q o=IB.BD();q k=IB.DF();n g=o.u;int SB=o.JB;while(g is OB||g is zB){SB=g.parent.aB(g);g=g.parent;}if(g is lB){GB h=new GB.DX(LB.MB('undo.insert_text'));lB i=g;q HC=new q(i.parent,i.parent.aB(i));q HF=new q(i,0);q wC=new q(i,i.PB);assert(k<=wC);n t=s.JG(i,HF,o);n j=s.JG(i,k,wC);h.TB(new GB.AX(i));h.TB(new GB.xW(HC,j));h.TB(new GB.xW(HC,t));s.KC(h);IB.TD(new q(j,0));IB.ZC();return (true);}if(o.u!=k.u)return (false);if(g.AB==null)return (false);if(g is lB)return (false);l v=s.CB.SF(g.AB,s.VC);if(v==null)return (false);if(!s.CB.QM(g,SB,SB,v))return (false);GB h=new GB.DX(LB.MB('undo.insert_text'));int FB=SB;while(FB>0){n HB=g.fB(FB-1);if(HB is!OB&&!s.CB.ZD(v,HB.AB))break;FB-- ;}q KB=new q(g,FB);n t=null;if(KB<o)t=s.JG(g,KB,o);n m=k.u;int QB=k.JB;while(m is OB||m is zB){QB=m.parent.aB(m)+1;m=m.parent;}assert(m==g);while(QB<g.PB){n HB=g.fB(QB);if(HB is!OB&&!s.CB.ZD(v,HB.AB))break;QB++ ;}q bB=new q(g,QB);n j=null;if(bB>k){j=s.JG(g,k,bB);n jB=j.fB(j.PB-1);if(jB is OB){String DB=jB.nodeValue;if(DB.length>0&&DB[DB.length-1]=='\n'){if(DB.length==1)j.CD(jB);else jB.nodeValue=DB.substring(0,DB.length-1);}}}if(KB<bB){h.TB(s.DI(KB,bB));}int KD=FB;if(t!=null||g.PB==0){lB YE=pD.jF(v);h.TB(new GB.xW(KB,YE));if(t!=null)h.TB(s.SE(t,new q(YE,0)));KD++ ;}lB yB=pD.jF(v);h.TB(new GB.xW(new q(g,KD),yB));if(j!=null)h.TB(s.SE(j,new q(yB,0)));s.KC(h);IB.TD(new q(yB,0));IB.ZC();return (true);}static void EN(n j,n i){if(s.VC==null)return;n k;for(n g=i.firstChild;g!=null;g=k){k=g.nextSibling;if(g is lB&&!s.CB.ZD(j.AB,g.AB)){n o;for(n m=g.firstChild;m!=null;m=o){o=m.nextSibling;g.CD(m);i.insertBefore(m,g);}i.CD(g);}}l h;if(j.AB!=null)h=s.CB.SF(j.AB,s.VC);else h=null;if(h!=null){for(n g=i.firstChild;g!=null;g=k){k=g.nextSibling;if(g.AB!=h&&((g is OB&&!s.CB.RE(j.AB))||(!s.CB.ZD(j.AB,g.AB)&&s.CB.ZD(h,g.AB)))){i.CD(g);if(g.previousSibling!=null&&g.previousSibling.AB==h){g.previousSibling.mB(g);}else{lB t=new lB.fX(h);t.mB(g);i.insertBefore(t,k);}}}}}}class QL extends n{QL.JX(l g):super.EX(g){}QL.RX(BB g,n h):super.zW(g,h){}Element UB(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');g.classes.add('hr');List<l> h=s.CB.iE(AB);if(h!=null&&h.length>0){g.onClick.listen((MouseEvent i)=>QE());}g.append(new HRElement());return (g);}q CF(){return (null);}q PG(){return (null);}}class JH extends n{JH.LX(l g):super.EX(g){}JH.XX(BB g,n h):super.zW(g,h){fG();}Element UB(){LIElement h=new LIElement();h.id="${id}";h.classes.add('dn');ImageElement i=new ImageElement(src:'packages/daxe/images/bullet1.png',width:13,height:13);i.classes.add('bullet');List<l> j=s.CB.iE(AB);if(j!=null&&j.length>0)i.onClick.listen((MouseEvent g)=>QE());else{i.onDoubleClick.listen((MouseEvent g){IB.selectNode(this);g.preventDefault();g.stopPropagation();});}h.append(i);SpanElement o=new SpanElement();n k=firstChild;while(k!=null){o.append(k.UB());k=k.nextSibling;}h.append(o);ImageElement m=new ImageElement(src:'packages/daxe/images/bullet2.png',width:13,height:13);m.classes.add('bullet');if(j!=null&&j.length>0)m.onClick.listen((MouseEvent g)=>QE());else{m.onDoubleClick.listen((MouseEvent g){IB.selectNode(this);g.preventDefault();g.stopPropagation();});}h.append(m);return (h);}Element CE(){return (DC().nodes[1]);}bool jE(){return (true);}}class RL extends n{cB aa;RL.MX(l g):super.EX(g){}RL.aX(BB g,n h):super.zW(g,h){}Element UB(){Element g;g=new SpanElement();g.id="${id}";g.classes.add('dn');g.append(new BRElement());return (g);}q CF(){return (null);}q PG(){return (null);}}class SI extends n{cB aa;cB ba;l oa;SI.SX(l g):super.EX(g){fF();}SI.xX(BB g,n h):super.zW(g,h){fF();fG();}void fF(){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);List<l> g=s.CB.bC(AB);if(g.length>0)oa=g[0];}Element UB(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.append(aa.UB());UListElement i=new UListElement();i.classes.add('list');n h=firstChild;while(h!=null){i.append(h.UB());h=h.nextSibling;}g.append(i);g.append(ba.UB());return (g);}Element CE(){return (DC().nodes[1]);}bool jE(){return (true);}bool jG(){return (true);}static void TT(q h){JH g;if(h.u is JH)g=h.u;else g=h.u.parent;JH i=pD.jF(g.AB);s.insertNode(i,new q(g.parent,g.parent.aB(g)+1));IB.TD(new q(i,0));IB.ZC();}}class IH extends n{cB aa;cB ba;IH():super.FX(n.tC){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);}IH.gX(BB g,n h):super.zW(g,h){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);}Element UB(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');g.append(aa.UB());SpanElement i=new SpanElement();n h=firstChild;while(h!=null){i.append(h.UB());h=h.nextSibling;}g.append(i);g.append(ba.UB());return (g);}Element CE(){return (DC().nodes[1]);}BB MF(AC h){String g=null;if(firstChild!=null)g=firstChild.nodeValue;return (h.NR(nodeName,g));}}class CJ extends n{FE control;CJ.bX(l g):super.EX(g){}CJ.mX(BB h,n k):super.zW(h,k,createChildren:false){if(h.childNodes!=null){n i=null;for(BB j in h.childNodes){n g;if(j.nodeType==BB.nF)g=new KH.kX(j,this);else g=pD.MI(j,this);if(i==null)firstChild=g;else i.nextSibling=g;i=g;}}}Element UB(){Element g;g=new SpanElement();g.id="${id}";g.classes.add('dn');g.classes.add('simple_type');List<l> j=s.CB.iE(AB);if(j!=null&&j.length>0){ImageElement k=new ImageElement(src:'images/attributes.png',width:16,height:15);k.onClick.listen((MouseEvent h)=>QE());g.append(k);}String m=s.CB.YD(AB);g.append(new Text(m));String i;if(firstChild!=null)i=firstChild.nodeValue;else i='';control=new FE.wX(AB,i,valueChanged:()=>fU());g.append(control.UB());g.onDoubleClick.listen((MouseEvent h){IB.selectNode(this);h.preventDefault();h.stopPropagation();});return (g);}void fU(){String h=control.wF();GB g=new GB.DX(LB.MB('form.text_edition'));if(firstChild is OB)g.TB(new GB.AX(firstChild,updateDisplay:false));if(h!='')g.TB(new GB.xW(new q(this,0),new KH(h),updateDisplay:false));s.KC(g);control.focus();}void lE(){String g;if(firstChild!=null)g=firstChild.nodeValue;else g='';if(control.wF()!=g)control.LP(g);}q CF(){return (null);}q PG(){return (null);}}class AJ extends n{zM ha;String pa;AJ.VX(l g):super.EX(g){}AJ.jX(BB g,n h):super.zW(g,h,createChildren:false){pa=g.firstChild.nodeValue;}Element UB(){Element g=new SpanElement();g.id="${id}";g.classes.add('dn');g.classes.add('special');g.text=pa;return (g);}void QE([kD g]){ha=new zM(pa,okfct:(){pa=ha.aO();if(g!=null)g();});ha.show();}q CF(){return (null);}q PG(){return (null);}BB MF(AC g){l h=g.createElementNS(tB,nodeName);h.mB(g.vG(pa));return (h);}}class zM{static final List<List<String>> TI=[["\u0393","\u0394","\u0398","\u039B","\u039E","\u03A0","\u03A3","\u03A5","\u03A6","\u03A7","\u03A8","\u03A9"],["\u03B1","\u03B2","\u03B3","\u03B4","\u03B5","\u03B6","\u03B7","\u03B8","\u03B9","\u03BA","\u03BB","\u03BC","\u03BD","\u03BE","\u03BF","\u03C0","\u03C1","\u03C2","\u03C3","\u03C4","\u03C5","\u03C6","\u03C7","\u03C8","\u03C9"],["\u03D1","\u03D5","\u03D6"],["\u00AC","\u00B1","\u00D7","\u2113","\u2102","\u2115","\u211A","\u211D","\u2124","\u212B","\u2190","\u2192","\u2194","\u21D0","\u21D2","\u21D4","\u2200","\u2202","\u2203","\u2205","\u2207","\u2208","\u2209","\u2211","\u221D","\u221E","\u2227","\u2228","\u2229","\u222A","\u222B","\u223C","\u2248","\u2260","\u2261","\u2264","\u2265","\u2282"],["\u{1D49C}","\u212C","\u{1D49E}","\u{1D49F}","\u2130","\u2131","\u{1D4A2}","\u210B","\u2110","\u{1D4A5}","\u{1D4A6}","\u2112","\u2133","\u{1D4A9}","\u{1D4AA}","\u{1D4AB}","\u{1D4AC}","\u211B","\u{1D4AE}","\u{1D4AF}","\u{1D4B0}","\u{1D4B1}","\u{1D4B2}","\u{1D4B3}","\u{1D4B4}","\u{1D4B5}"]];static final int AN=13;String sF;kD okfct;TableCellElement ME;zM(this.sF,{this.okfct}){}void show(){DivElement t=new DivElement();t.id='dlg1';t.classes.add('dlg1');DivElement HB=new DivElement();HB.classes.add('dlg2');DivElement KB=new DivElement();KB.classes.add('dlg3');FormElement QB=new FormElement();int bB=0;for(int g=0;g<TI.length;g++ )bB+= (TI[g].length/AN).ceil();TableElement h=new TableElement();h.classes.add('special_dlg');int i=0;for(int g=0;g<TI.length;g++ ){TableRowElement m=new TableRowElement();for(int o=0;o<TI[g].length;o++ ){TableCellElement v=new TableCellElement();v.text=TI[g][o];v.style.textAlign='center';if(sF==TI[g][o]){ME=v;ME.style.border='1px solid black';}m.append(v);i++ ;if(i>=AN){i=0;if(o<TI[g].length-1){h.append(m);m=new TableRowElement();}}}if(i!=0){for(int SB=i;SB<AN;SB++ )m.append(new TableCellElement());i=0;}h.append(m);}h.onClick.listen((MouseEvent j)=>select(j.target));h.onDoubleClick.listen((MouseEvent j){select(j.target);if(ME!=null)UF(null);});QB.append(h);DivElement DB=new DivElement();DB.classes.add('buttons');ButtonElement FB=new ButtonElement();FB.attributes['type']='button';FB.appendText(LB.MB("button.Cancel"));FB.onClick.listen((MouseEvent j)=>cancel());DB.append(FB);ButtonElement k=new ButtonElement();k.id='special_ok';if(sF==null)k.disabled=true;k.attributes['type']='submit';k.appendText(LB.MB("button.OK"));k.onClick.listen((MouseEvent j)=>UF(j));DB.append(k);QB.append(DB);KB.append(QB);HB.append(KB);t.append(HB);ZB.document.body.append(t);}void select(EventTarget h){if(h is!Node)return;Node g=h as Node;if(g is TableCellElement&&g.text!=''){if(ME!=null)ME.style.border='';ME=g;}else if(g.parent is TableCellElement){if(ME!=null)ME.style.border=null;ME=g.parent;}else return;ME.style.border='1px solid black';sF=ME.text;ButtonElement i=ZB.querySelector('button#special_ok');i.disabled=false;}void UF(MouseEvent g){ZB.querySelector('div#dlg1').remove();if(g!=null)g.preventDefault();if(okfct!=null)okfct();}void cancel(){ZB.querySelector('div#dlg1').remove();IB.gG();}String aO(){return (sF);}}class BJ extends n{cB aa;cB ba;BJ.UX(l g):super.EX(g){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);}BJ.oX(BB g,n h):super.zW(g,h){aa=new cB(this,cB.NE);ba=new cB(this,cB.mE);}Element UB(){SpanElement g=new SpanElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');g.append(aa.UB());SpanElement i=new SpanElement();n h=firstChild;while(h!=null){i.append(h.UB());h=h.nextSibling;}KP(i);g.append(i);g.append(ba.UB());return (g);}Element CE(){return (DC().nodes[1]);}}class zB extends n{String qa;zB.BY(l g):super.EX(g){qa=s.CB.eC(g,'style',null);}zB.DY(BB g,n h):super.zW(g,h){qa=s.CB.eC(AB,'style',null);}Element UB(){Element g=new SpanElement();g.id="${id}";g.classes.add('dn');if(firstChild!=null){SpanElement h=new SpanElement();n i=firstChild;while(i!=null){h.append(i.UB());i=i.nextSibling;}KP(h);g.append(h);}else{cB j=new cB(this,cB.NE);cB k=new cB(this,cB.mE);g.append(j.UB());SpanElement h=new SpanElement();g.append(h);g.append(k.UB());}return (g);}void WF(List<n> g){super.lE();}Element CE(){if(firstChild!=null)return (DC().nodes.first);else return (DC().nodes[1]);}bool get HD{return (true);}void set css(String g){assert(false);}String get css{return (null);}bool matches(zB g){if(g is bE)return (false);return (AB==g.AB);}bool BH(String g,String h){return (false);}bool uR(String g){return (false);}static wE sP(q h,q i,[l DB,String jB]){h=new q.yW(h);i=new q.yW(i);IB.cursor.wG();h.EF();i.EF();assert(h!=i);GB o=new GB.DX(LB.MB('style.remove_styles'));n g=ZT(h.u,i.u);n t=g.parent;while(t!=null){if(t is zB&&(DB==null||GN(t,DB,jB)))g=t;t=t.parent;}if(g is OB){q QB=new q.pW(h);q SB=new q.uW(i);wE bB=new wE(o,QB,SB);return (bB);}if(g is zB)g=g.parent;q j=new q(g,0);q FB=new q(g,g.PB);n k;if(j!=h)k=s.JG(g,j,h);else k=null;n v=s.JG(g,h,i);n m;if(FB!=i)m=s.JG(g,i,FB);else m=null;if(DB==null)tP(v);else CN(v,DB,cssName:jB);int yB=new q.pW(j).LF;int HB;if(k!=null){HB=uP(k);if(k.lastChild is OB&&v.firstChild is OB){HB-- ;}}else HB=0;q QB=new q.cW(yB+HB);int HC=new q.uW(FB).VF;int KB;if(m!=null){KB=uP(m);if(m.firstChild is OB&&v.lastChild is OB){KB-- ;}}else KB=0;q SB=new q.iW(HC+KB);o.TB(s.DI(j,FB));if(m!=null)o.TB(s.SE(m,j,checkValidity:false));o.TB(s.SE(v,j,checkValidity:false));if(k!=null)o.TB(s.SE(k,j,checkValidity:false));wE bB=new wE(o,QB,SB);return (bB);}static n ZT(n i,n j){n g=i;while(g!=null){n h=j;while(h!=null){if(g==h){return (g);}if(h.parent==null)break;h=h.parent;}if(g.parent==null)break;g=g.parent;}return (null);}static tP(n h){for(n g=h.firstChild;g!=null;){if(g is zB){n j=g.firstChild;for(n i=g.firstChild;i!=null;){n k=i.nextSibling;h.insertBefore(i,g);i=k;}h.CD(g);g=j;}else{tP(g);g=g.nextSibling;}}h.normalize();}static CN(n h,l j,{String cssName,String cssValue}){for(n g=h.firstChild;g!=null;){if((cssValue!=null&&HN(g,j,cssName,cssValue))||GN(g,j,cssName)){if(g is bE&&cssName!=null&&(new vD((g as bE).css)).keys.length>1){vD k=new vD((g as bE).css);k.remove(cssName);(g as bE).css=k.toString();}else{n m=g.firstChild;for(n i=g.firstChild;i!=null;){n o=i.nextSibling;h.insertBefore(i,g);i=o;}h.CD(g);g=m;}}else{CN(g,j,cssName:cssName,cssValue:cssValue);g=g.nextSibling;}}h.normalize();}static int uP(n i){n k=i;int m=i.PB;int j=0;n g=i;int h=0;while(g!=k||h!=m){if(h==g.PB){h=g.parent.aB(g)+1;g=g.parent;}else if(g is OB){h++ ;}else{g=g.fB(h);h=0;}j++ ;}return (j);}static GB aT(q o,[l k,String i]){n h=o.u;if(h is OB)h=h.parent;for(n g=h;g!=null;g=g.parent){if((k==null&&g is zB)||GN(g,k,i)){if(g is bE&&i!=null&&(new vD((g as bE).css)).keys.length>1){vD m=new vD((g as bE).css);m.remove(i);iB t=new iB((g as bE).na,m.toString());return (new GB.CX(g,t));}else{GB j=new GB.DX(LB.MB('undo.remove_element'));n v=new n.HX(g);q DB=new q(g.parent,g.parent.aB(g)+1);j.TB(s.SE(v,DB,checkValidity:false));j.TB(new GB.AX(g));return (j);}}}return (null);}static void WL([l i,String j]){q g=IB.BD();q k=IB.DF();if(g==null)return;if(g==k){GB m=aT(g,i,j);if(m!=null)s.KC(m);IB.ZC();}else{wE h=sP(g,k,i,j);s.KC(h.sH);IB.cursor.kE(h.start,h.end);IB.ZC();}}static bool GN(n g,l i,String h){if(g is!zB)return (false);if(g.AB!=i)return (false);if(h==null)return (true);if((g as zB).css==null)return (false);return ((g as zB).uR(h));}static bool HN(n g,l h,String i,String j){if(g is!zB)return (false);if(g.AB!=h)return (false);if((g as zB).css==null)return (true);return ((g as zB).BH(i,j));}static wE vP(q k,q m,l o,{String cssName,String cssValue}){assert(k!=m);GB FB=new GB.DX(LB.MB('style.apply_style'));q HB=k;q t=new q.pW(k);q g=new q.yW(k);g.EF();if(g.u is OB&&g.JB==0){n h=g.u.previousSibling;if(h is zB&&HN(h,o,cssName,cssValue)){HB=new q(h.parent,h.parent.aB(h));t=new q.pW(g);t.QG(-2);if(h.lastChild is OB)t.QG(-1);}}q v=m;q DB=new q.uW(m);q j=new q.yW(m);j.EF();if(j.u is OB&&j.JB==j.u.PB){n i=g.u.nextSibling;if(i is zB&&HN(i,o,cssName,cssValue)){v=new q(i.parent,i.parent.aB(i)+1);DB=new q.uW(j);DB.QG(2);if(i.firstChild is OB)DB.QG(1);}}n KB=s.hI(HB,v);CN(KB,o,cssName:cssName,cssValue:cssValue);IN(KB,o,cssName,cssValue);FB.TB(s.SE(KB,v,checkValidity:false));FB.TB(s.DI(HB,v));return (new wE(FB,t,DB));}static void wP(l i,{String cssName,String cssValue}){q g=IB.BD();q o=IB.DF();if(g==o){n h=g.u;if(h is OB)h=h.parent;n j=pD.jF(i,'element');if(cssName!=null&&cssValue!=null)(j as zB).css="${cssName}: ${cssValue}";bool t=false;if(s.VC!=null){if(!s.CB.ZD(h.AB,i)){l k=s.CB.SF(h.AB,s.VC);if(k!=null&&s.CB.ZD(k,i)){lB v=new lB.fX(k);v.mB(j);s.insertNode(v,g);t=true;}}}if(!t)s.insertNode(j,g);q DB=j.CF();if(DB!=null){IB.TD(DB);IB.ZC();}return;}wE m=vP(g,o,i,cssName:cssName,cssValue:cssValue);s.KC(m.sH);IB.cursor.kE(m.start,m.end);IB.ZC();}static void IN(n i,l j,String k,String m){if(s.CB.ZD(i.AB,j)){n h=null;for(n g=i.firstChild;g!=null;){if(g is OB||s.CB.ZD(j,g.AB)){n o=g.nextSibling;i.CD(g);if(h==null){h=pD.jF(j,'element');if(k!=null&&m!=null)(h as zB).css="${k}: ${m}";}h.mB(g);g=o;}else{if(h!=null){i.insertBefore(h,g);h=null;}IN(g,j,k,m);g=g.nextSibling;}}if(h!=null)i.mB(h);}else{for(n g=i.firstChild;g!=null;g=g.nextSibling){if(g is!OB)IN(g,j,k,m);}}}static void fT(l g,String h,String k){q m=IB.BD();q o=IB.DF();if(m==o){zB.wP(g,cssName:h,cssValue:k);}else{wE i=zB.sP(m,o,g,h);s.KC(i.sH);wE j=vP(i.start,i.end,g,cssName:h,cssValue:k);s.KC(j.sH);s.iK(LB.MB('style.apply_style'),2);IB.cursor.kE(j.start,j.end);IB.ZC();}}static wE JN(q g){zB h=null,i=null;if(g.u is zB&&g.JB==g.u.PB)h=g.u;else if(g.u is OB&&g.JB==g.u.PB&&g.u.parent is zB&&g.u.parent.aB(g.u)==g.u.parent.PB)h=g.u.parent;else if(g.u is!OB&&g.JB>0&&g.u.PB>0&&g.u.fB(g.JB-1) is zB)h=g.u.fB(g.JB-1);if(g.u is zB&&g.JB==0)i=g.u;else if(g.u is OB&&g.JB==0&&g.u.parent is zB&&g.u.parent.aB(g.u)==0)i=g.u.parent;else if(g.u is!OB&&g.JB<g.u.PB&&g.u.PB>0&&g.u.fB(g.JB) is zB)i=g.u.fB(g.JB);if(h==null||i==null)return (null);if(!h.matches(i))return (null);q j;if(h.lastChild is OB&&i.firstChild is OB)j=new q(h.lastChild,h.lastChild.PB);else j=new q(h,h.PB);GB k=new GB.DX('merge');k.TB(new GB.AX(i));n m=new n.HX(i);k.TB(s.SE(m,new q(h,h.PB)));return (new wE(k,j,new q.yW(j)));}}class wE{GB sH;q start;q end;wE(this.sH,this.start,this.end);}class bE extends zB{String na;bE.WX(l g):super.BY(g){na=s.CB.eC(AB,'styleAtt','style');}bE.pX(BB g,n h):super.DY(g,h){na=s.CB.eC(AB,'styleAtt','style');}Element UB(){Element g=new SpanElement();g.id="${id}";g.classes.add('dn');if(firstChild!=null){SpanElement h=new SpanElement();n i=firstChild;while(i!=null){h.append(i.UB());i=i.nextSibling;}if(css!=null)h.setAttribute('style',css);g.append(h);}else{cB j=new cB(this,cB.NE);cB k=new cB(this,cB.mE);g.append(j.UB());SpanElement h=new SpanElement();h.setAttribute('style',css);g.append(h);g.append(k.UB());}return (g);}void set css(String g){setAttribute(na,g);}String get css{return (getAttribute(na));}void WF(List<n> g){super.lE();}Element CE(){if(firstChild!=null)return (DC().nodes.first);else return (DC().nodes[1]);}static l qP(){return (s.CB.XO('stylespan'));}bool matches(zB g){if(g is bE){vD h=new vD(css);vD i=new vD(g.css);return (h.sU(i));}else{return (false);}}bool BH(String g,String h){if(css==null)return (false);vD i=new vD(css);return (i[g]==h);}bool uR(String g){if(css==null)return (false);vD h=new vD(css);return (h[g]!=null);}}class YG extends n{String ra;String sa;String ta;l ua;l va;l wa;String xa;String ya;String za;String Ab;String Bb;String Cb;bool yH;YG.GY(l g):super.EX(g){fF();mU();}YG.IY(BB h,n i):super.zW(h,i,createChildren:false){fF();for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==BB.zE&&g.nodeName==xa)Db(g);}for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==BB.zE&&g.nodeName==ya)Db(g);}Db(h);for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==BB.zE&&g.nodeName==za)Db(g);}if(firstChild!=null&&firstChild.firstChild is EG)yH=true;}void Db(BB j){for(BB h=j.firstChild;h!=null;h=h.nextSibling){if(h.nodeType==BB.zE&&h.nodeName==ra){n i=new vE.LY(h,this);for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g.nodeType==BB.zE){if(g.nodeName==sa){n k=new OC.NY(g,i);i.mB(k);}else if(g.nodeName==ta){n m=new EG.PY(g,i);i.mB(m);}}}mB(i);}}}void fF(){DL=true;ra=s.CB.eC(AB,'trTag','tr');List<l> g=s.CB.JM(ra);ua=s.CB.SF(AB,g);sa=s.CB.eC(AB,'tdTag','td');List<l> h=s.CB.JM(sa);va=s.CB.SF(ua,h);ta=s.CB.eC(AB,'thTag','th');List<l> i=s.CB.JM(ta);wa=s.CB.SF(ua,i);ya=s.CB.eC(AB,'tbodyTag','tbody');xa=s.CB.eC(AB,'theadTag','thead');za=s.CB.eC(AB,'tfootTag','tfoot');Ab=s.CB.eC(AB,'colspanAttr',null);Bb=s.CB.eC(AB,'rowspanAttr',null);Cb=s.CB.eC(AB,'alignAttr',null);yH=false;}Element UB(){DivElement j=new DivElement();j.id="${id}";j.classes.add('dn');j.classes.add('table');FormElement g=new FormElement();g.classes.add('table_buttons');ButtonElement v=new ButtonElement();v.attributes['type']='button';v.appendText(LB.MB("table.Table"));v.onClick.listen((MouseEvent h)=>QE());v.style.marginRight='1em';g.append(v);ButtonElement DB=new ButtonElement();DB.attributes['type']='button';DB.appendText(LB.MB("table.Row"));DB.onClick.listen((MouseEvent h)=>zV());DB.style.marginRight='0.2em';g.append(DB);ButtonElement FB=new ButtonElement();FB.attributes['type']='button';FB.appendText("+");FB.onClick.listen((MouseEvent h)=>insertRow());FB.style.marginRight='0.2em';g.append(FB);ButtonElement HB=new ButtonElement();HB.attributes['type']='button';HB.appendText("-");HB.onClick.listen((MouseEvent h)=>rV());HB.style.marginRight='1em';g.append(HB);g.appendText(LB.MB('table.Column'));ButtonElement KB=new ButtonElement();KB.attributes['type']='button';KB.appendText("+");KB.onClick.listen((MouseEvent h)=>SV());KB.style.marginRight='0.2em';g.append(KB);ButtonElement QB=new ButtonElement();QB.attributes['type']='button';QB.appendText("-");QB.onClick.listen((MouseEvent h)=>pV());QB.style.marginRight='1em';g.append(QB);ButtonElement SB=new ButtonElement();SB.attributes['type']='button';SB.appendText(LB.MB("table.Cell"));SB.onClick.listen((MouseEvent h)=>dU());SB.style.marginRight='1em';g.append(SB);CheckboxInputElement bB=new CheckboxInputElement();bB.id="header${id}";bB.checked=yH;bB.onClick.listen((MouseEvent h)=>SW());g.append(bB);LabelElement jB=new LabelElement();jB.htmlFor="header${id}";jB.appendText(LB.MB('table.header'));jB.style.marginRight='1em';g.append(jB);ButtonElement k=new ButtonElement();k.attributes['type']='button';ImageElement i=new ImageElement();i.src='packages/daxe/images/mergeright.png';k.append(i);k.onClick.listen((MouseEvent h)=>bV());k.style.marginRight='0.2em';k.title=LB.MB('table.merge_right');g.append(k);ButtonElement m=new ButtonElement();m.attributes['type']='button';i=new ImageElement();i.src='packages/daxe/images/splitx.png';m.append(i);m.onClick.listen((MouseEvent h)=>LS());m.style.marginRight='0.2em';m.title=LB.MB('table.split_x');g.append(m);ButtonElement o=new ButtonElement();o.attributes['type']='button';i=new ImageElement();i.src='packages/daxe/images/mergebottom.png';o.append(i);o.onClick.listen((MouseEvent h)=>aV());o.style.marginRight='0.2em';o.title=LB.MB('table.merge_bottom');g.append(o);ButtonElement t=new ButtonElement();t.attributes['type']='button';i=new ImageElement();i.src='packages/daxe/images/splity.png';t.append(i);t.onClick.listen((MouseEvent h)=>NP());t.style.marginRight='0.2em';t.title=LB.MB('table.split_y');g.append(t);j.append(g);TableElement HC=new TableElement();HC.classes.add('indent');n yB=firstChild;while(yB!=null){HC.append(yB.UB());yB=yB.nextSibling;}j.append(HC);return (j);}q CF(){if(firstChild==null||firstChild.firstChild==null){return (null);}return (new q(firstChild.firstChild,0));}q PG(){if(lastChild==null||lastChild.lastChild==null){return (null);}return (new q(lastChild.lastChild,lastChild.lastChild.PB));}void mU(){int j=2;int k=2;for(int g=0;g<j;g++ ){vE h=new vE.KY(ua);for(int i=0;i<k;i++ ){OC m=new OC.MY(va);h.mB(m);}mB(h);}}void zV(){vE g=dO();if(g==null)return;g.QE();}void insertRow(){vE h=dO();if(h==null)return;n g=new vE.KY(ua);for(int i=0;i<SP();i++ ){OC j=new OC.MY(va);g.mB(j);}s.insertNode(g,new q(this,aB(h)+1));IB.TD(g.CF());}void rV(){vE g=dO();if(g==null)return;GB h=new GB.DX(LB.MB('undo.remove'));for(OC i in g.childNodes){if(i.SG>1)NP(i,h);}h.TB(new GB.AX(g));s.KC(h);}void SV(){OC g=nI();if(g==null)return;GB j=new GB.DX(LB.MB('undo.insert'));int m=lI(g);for(n h in childNodes){OC i;if(firstChild==h&&yH)i=new EG.OY(wa);else i=new OC.MY(va);int k=0;for(OC g=h.firstChild;g!=null&&m>=lI(g);g=g.nextSibling){k++ ;}j.TB(new GB.xW(new q(h,k),i));}s.KC(j);IB.TD(new q(g.nextSibling,0));}void pV(){OC g=nI();if(g==null)return;q h;if(g.nextSibling!=null)h=new q(g.nextSibling,0);else if(g.previousSibling!=null)h=new q(g.previousSibling,0);else h=null;GB j=new GB.DX(LB.MB('undo.remove'));int k=lI(g);int i=0;for(n m in childNodes){OC g=NM(k,i);while(g.KG>1){LS(g);g=NM(k,i);}j.TB(new GB.AX(g));i++ ;}s.KC(j);if(h!=null)IB.TD(h);}void dU(){OC g=nI();if(g==null)return;g.QE();}OC nI(){q h=IB.BD();n g=h.u;while(g!=null&&g is!OC)g=g.parent;return (g);}vE dO(){q h=IB.BD();n g=h.u;while(g!=null&&g is!vE)g=g.parent;return (g);}OC NM(int g,int h){return (grid()[g][h]);}int lI(OC j){List<List<OC>> h=grid();for(int g=0;g<h.length;g++ )for(int i=0;i<h[0].length;i++ )if(h[g][i]==j)return (g);assert(false);return (-1);}int ZO(OC j){List<List<OC>> h=grid();for(int i=0;i<h.length;i++ )for(int g=0;g<h[0].length;g++ )if(h[i][g]==j)return (g);assert(false);return (-1);}List<List<OC>> grid(){int j=SP();int t=SS();List<List<OC>> h=new List<List<OC>>(j);for(int g=0;g<j;g++ )h[g]=new List<OC>(t);int k=0;for(vE v in childNodes){int g=0;for(OC i in v.childNodes){while(g<j&&h[g][k]!=null)g++ ;for(int m=0;m<i.KG;m++ ){for(int o=0;o<i.SG;o++ ){h[g+m][k+o]=i;}}g+= i.KG;}k++ ;}return (h);}int SP(){int g=0;for(vE i in childNodes){int h=0;for(OC j in i.childNodes){h+= j.KG;}g=DD.max(g,h);}return (g);}int SS(){int g=0;for(vE h in childNodes){OC i=h.firstChild;g+= i.SG;}return (g);}void SW(){vE j=firstChild;if(j==null)return;n g=j.firstChild;while(g!=null){n t=g.nextSibling;if(yH&&g is EG){OC k=new OC.MY(va);n h=g.firstChild;while(h!=null){n m=h.nextSibling;g.CD(h);k.mB(h);h=m;}for(iB i in g.attributes)k.setAttribute(i.name,i.value);g.replaceWith(k);}else if(!yH&&g is OC&&g is!EG){EG o=new EG.OY(wa);n h=g.firstChild;while(h!=null){n m=h.nextSibling;g.CD(h);o.mB(h);h=m;}for(iB i in g.attributes)o.setAttribute(i.name,i.value);g.replaceWith(o);}g=t;}yH=!yH;j.lE();}void bV([OC g]){if(g==null)g=nI();if(g==null)return;int m=lI(g);int o=ZO(g);int j=m+g.KG;if(j>=SP())return;OC k=NM(j,o);if(k.parent!=g.parent)NP(k);OC h=g.nextSibling;if(h==null)return;if(h.SG!=g.SG){return;}GB i=new GB.DX(LB.MB('table.merge'));i.TB(new GB.CX(g,new iB(Ab,(g.KG+h.KG).toString())));i.TB(new GB.AX(h));s.KC(i);IB.TD(g.CF());IB.ZC();}void aV([OC g]){if(g==null)g=nI();if(g==null)return;int k=lI(g);int m=ZO(g);int j=m+g.SG;if(j>=SS())return;OC h=NM(k,j);if(h.KG!=g.KG){return;}GB i=new GB.DX(LB.MB('table.merge'));i.TB(new GB.CX(g,new iB(Bb,(g.SG+h.SG).toString())));i.TB(new GB.AX(h));s.KC(i);IB.TD(g.CF());IB.ZC();}void LS([OC g,GB i]){if(g==null)g=nI();if(g==null)return;if(g.KG<2)return;OC j;if(g is EG)j=new EG.OY(wa);else j=new OC.MY(va);vE k=g.parent;GB h;if(i!=null)h=i;else h=new GB.DX(LB.MB('table.split'));h.TB(new GB.xW(new q(k,k.aB(g)+1),j));h.TB(new GB.CX(g,new iB(Ab,(g.KG-1).toString())));if(i==null)s.KC(h);}void NP([OC g,GB i]){if(g==null)g=nI();if(g==null)return;if(g.SG<2)return;int m=lI(g);int o=ZO(g);int t=o+g.SG-1;vE j=fB(t);if(j==null)return;int k=0;for(OC g=j.firstChild;g!=null&&m>lI(g);g=g.nextSibling){k++ ;}OC v=new OC.MY(va);GB h;if(i!=null)h=i;else h=new GB.DX(LB.MB('table.split'));h.TB(new GB.xW(new q(j,k),v));h.TB(new GB.CX(g,new iB(Bb,(g.SG-1).toString())));if(i==null)s.KC(h);}bool jE(){return (true);}bool jG(){return (true);}}class vE extends n{vE.KY(l g):super.EX(g){iJ=true;DL=true;}vE.LY(BB g,n h):super.zW(g,h,createChildren:false){iJ=true;DL=true;fG();}Element UB(){TableRowElement g=new TableRowElement();g.attributes['id']="${id}";g.attributes['class']='dn';n h=firstChild;while(h!=null){g.append(h.UB());h=h.nextSibling;}return (g);}q CF(){if(firstChild==null){return (null);}return (new q(firstChild,0));}q PG(){if(lastChild==null){return (null);}return (new q(lastChild,lastChild.PB));}bool jE(){return (true);}}class OC extends n{OC.MY(l g):super.EX(g){iJ=true;}OC.NY(BB g,n h):super.zW(g,h){iJ=true;fG();}Element UB(){TableCellElement g=new TableCellElement();g.id="${id}";g.classes.add('dn');if(this is EG)g.classes.add('header');g.attributes['rowspan']=SG.toString();g.attributes['colspan']=KG.toString();if(align!='')g.attributes['align']=align;n h=firstChild;while(h!=null){g.append(h.UB());h=h.nextSibling;}if(lastChild==null||!lastChild.hC)g.appendText(' ');return (g);}void WF(List<n> h){super.WF(h);TableCellElement g=DC();if(lastChild==null||!lastChild.hC){if(g.lastChild is!Text)g.appendText(' ');}else{if(g.lastChild is Text)g.lastChild.remove();}}int get SG{YG h=parent.parent;String g=getAttribute(h.Bb);if(g==null||g=='')return (1);else return (int.parse(g,onError:(String i)=>1));}int get KG{YG h=parent.parent;String g=getAttribute(h.Ab);if(g==null||g=='')return (1);else return (int.parse(g,onError:(String i)=>1));}String get align{YG h=parent.parent;String g=getAttribute(h.Cb);if(g==null||g=='')return ('');else return (g);}}class EG extends OC{EG.OY(l g):super.MY(g){}EG.PY(BB g,n h):super.NY(g,h){fG();}}class OB extends n{OB(String g):super.GX(g){}OB.IX(BB g,n h):super.zW(g,h){}Element UB(){Element g;g=new SpanElement();g.attributes['id']="${id}";g.attributes['class']='dn';if(nodeValue!=null){g.append(new Text(nodeValue));}return (g);}void sK(q h,String i){assert(h.u==this);String g=nodeValue;if(g==null)g='';nodeValue="${g.substring(0,h.JB)}${i}${g.substring(h.JB)}";}OB nU(int g){String i=nodeValue.substring(0,g);String j=nodeValue.substring(g);nodeValue=i;n h=new OB(j);parent.insertBefore(h,nextSibling);return (h);}BB MF(AC g){return (g.vG(nodeValue));}bool get HD{return (true);}}class yD extends n{yD.KX(l g):super.EX(g){}yD.TX(BB g,n h):super.zW(g,h){fG();}Element UB(){LIElement g=new LIElement();g.id="${id}";g.classes.add('dn');n h=firstChild;while(h!=null){g.append(h.UB());h=h.nextSibling;}return (g);}Element CE(){return (DC());}bool jE(){return (true);}}class jC extends n{l oa;String type;jC.dX(l g):super.EX(g){fF();}jC.yX(BB h,n i):super.zW(h,i){fF();fG();for(n g in childNodes){if(g is OB&&g.nodeValue.trim()==''){CD(g);}}}void fF(){oa=UL(AB);type=s.CB.eC(AB,'type','ul');}Element UB(){DivElement g=new DivElement();g.id="${id}";g.classes.add('dn');if(!valid)g.classes.add('invalid');Element h;if(type=='ul')h=new UListElement();else h=new OListElement();h.classes.add('wlist');n i=firstChild;while(i!=null){h.append(i.UB());i=i.nextSibling;}g.append(h);return (g);}q CF(){if(firstChild==null){return (null);}return (new q(firstChild,0));}q PG(){if(lastChild==null){return (null);}return (new q(lastChild,lastChild.PB));}Element CE(){return (DC().firstChild);}bool jE(){return (true);}bool jG(){return (true);}static l UL(l h){List<l> g=s.CB.bC(h);if(g.length>0)return (g[0]);return (null);}static void rP(l QB){l YE=UL(QB);q DB=IB.BD();q KI=IB.DF();GB j=new GB.DX(s.CB.YD(QB));q SB;yD i=new yD.KX(YE);n m=DB.u;while(m!=null&&m is!jC){m=m.parent;}if(m is jC&&m.AB!=QB){SB=new q.pW(DB);jC v=new jC.dX(QB);for(n h=m.firstChild;h!=null;h=h.nextSibling){v.mB(new n.HX(h));}j.TB(new GB.xW(new q(m.parent,m.parent.aB(m)),v));j.TB(new GB.AX(m));s.KC(j);IB.TD(SB);IB.ZC();return;}n g=DB.u;while(g!=null&&g is!lB)g=g.parent;if(g is lB){for(n h=g.firstChild;h!=null;h=h.nextSibling)i.mB(new n.HX(h));if(g.previousSibling is jC&&g.nextSibling is jC){j.TB(new GB.xW(new q(g.previousSibling,g.previousSibling.PB),i));n HF=new n.HX(g.nextSibling);j.TB(s.SE(HF,new q(g.previousSibling,g.previousSibling.PB+1)));j.TB(new GB.AX(g.nextSibling));}else if(g.previousSibling is jC){j.TB(new GB.xW(new q(g.previousSibling,g.previousSibling.PB),i));}else if(g.nextSibling is jC){j.TB(new GB.xW(new q(g.nextSibling,0),i));}else{n v=new jC.dX(QB);v.mB(i);j.TB(new GB.xW(new q(g.parent,g.parent.aB(g)),v));}j.TB(new GB.AX(g));SB=new q(i,i.PB);}else{n k=DB.u;int VG=DB.JB;while(k is OB||k is zB){VG=k.parent.aB(k);k=k.parent;}int yB=VG;while(yB>0){n h=k.fB(yB-1);if((h is!OB&&!s.CB.ZD(YE,h.AB))||h.jE())break;yB-- ;}q FB=new q(k,yB);n HB=DB.u;int bB=DB.JB;while(HB is OB||HB is zB){bB=HB.parent.aB(HB)+1;HB=HB.parent;}assert(HB==k);while(bB<k.PB){n h=k.fB(bB);if((h is!OB&&!s.CB.ZD(YE,h.AB))||h.jE())break;bB++ ;}q t=new q(k,bB);n HC;if(FB<t){HC=s.hI(FB,t);for(n h=HC.firstChild;h!=null;h=HC.firstChild){HC.CD(h);i.mB(h);}n wC=i.fB(0);if(wC is OB){String jB=wC.nodeValue.trimLeft();if(jB=='')i.CD(wC);else wC.nodeValue=jB;}n KD=i.fB(i.PB-1);if(KD is OB){String jB=KD.nodeValue.trimRight();if(jB=='')i.CD(KD);else KD.nodeValue=jB;}}n o;if(FB.JB>0)o=FB.u.fB(FB.JB-1);else o=null;n KB;if(t.JB<t.u.PB)KB=t.u.fB(t.JB);else KB=null;if(o is jC&&KB is jC){j.TB(new GB.xW(new q(o,o.PB),i));n HF=new n.HX(KB);j.TB(s.SE(HF,new q(o,o.PB+1)));j.TB(new GB.AX(KB));}else if(o is jC){j.TB(new GB.xW(new q(o,o.PB),i));}else if(KB is jC){j.TB(new GB.xW(new q(KB,0),i));}else{n v=new jC.dX(QB);v.mB(i);j.TB(new GB.xW(t,v));}if(FB<t)j.TB(s.DI(FB,t));SB=new q(i,i.PB);}s.KC(j);IB.TD(SB);IB.ZC();}static void DN(){q SB=IB.BD();n g=SB.u;while(g!=null&&g is!yD)g=g.parent;if(g==null)return;GB i=new GB.DX(LB.MB('toolbar.lower_level'));yD t=g;jC j=t.parent;n v=null;if(t.nextSibling!=null){v=new jC.dX(j.AB);for(g=t.nextSibling;g!=null;g=g.nextSibling){v.mB(new n.HX(g));i.TB(new GB.AX(g));}}n h=new n.HX(t);q DB;if(j.parent is yD){yD KB=j.parent;jC QB=KB.parent;if(v!=null)h.mB(v);i.TB(new GB.xW(new q(QB,QB.aB(KB)+1),h));DB=new q(h,h.PB);}else{q m=new q(j.parent,j.parent.aB(j)+1);if(v!=null)i.TB(new GB.xW(m,v));if(s.VC!=null&&s.CB.SF(j.parent.AB,s.VC)!=null){l FB=s.CB.SF(j.parent.AB,s.VC);if(h.firstChild!=null){n o=h.firstChild;n HB=null;lB k=null;while(o!=null){HB=o.nextSibling;if(o is OB||s.CB.ZD(FB,o.AB)){if(k==null)k=new lB.fX(FB);h.CD(o);k.mB(o);h.insertBefore(k,HB);}else{k=null;}o=HB;}DB=m;i.TB(s.SE(h,m));}else{lB k=new lB.fX(FB);i.TB(new GB.xW(m,k));DB=new q(k,0);}}else{if(h.firstChild!=null){DB=m;i.TB(s.SE(h,m));}else{DB=m;}}}if(t.previousSibling!=null)i.TB(new GB.AX(t));else i.TB(new GB.AX(j));s.KC(i);IB.TD(DB);IB.ZC();}static void bT(){q t=IB.BD();n g=t.u;while(g!=null&&g is!yD)g=g.parent;if(g==null)return;yD i=g;yD h=i.previousSibling;if(h==null)return;GB j=new GB.DX(LB.MB('toolbar.rise_level'));j.TB(new GB.AX(i));n k=new n.HX(i);if(h.lastChild is jC){jC m=h.lastChild;j.TB(new GB.xW(new q(m,m.PB),k));}else{n o=new jC.dX(i.parent.AB);o.mB(k);j.TB(new GB.xW(new q(h,h.PB),o));}s.KC(j);IB.TD(new q(k,k.PB));IB.ZC();}static void cT(q k){yD g;n h=k.u;while(h!=null&&h is!yD)h=h.parent;assert(h!=null);if(h==null)return;g=h;q i=new q(g.parent,g.parent.aB(g));q o=new q(g.parent,g.parent.aB(g)+1);n t=s.JG(g,i,k);n m=s.JG(g,k,o);GB j=new GB.DX(LB.MB('undo.insert_text'));j.TB(new GB.xW(i,t));i=new q(g.parent,g.parent.aB(g)+1);j.TB(new GB.xW(i,m));j.TB(new GB.AX(g));s.KC(j);IB.TD(new q(m,0));IB.ZC();}static List<l> dT(){List<l> g=new List<l>();List<l> i=s.CB.yG('wlist');for(l h in i)if(s.CB.eC(h,'type','ul')=='ul')g.add(h);return (g);}static List<l> eT(){List<l> g=new List<l>();List<l> i=s.CB.yG('wlist');for(l h in i)if(s.CB.eC(h,'type','ul')=='ol')g.add(h);return (g);}}class KH extends OB{KH(String g):super(g){}KH.kX(BB g,n h):super.IX(g,h){}void lE(){parent.lE();}}class FE{static int SL=0;l FF;l tE;String value;String Eb;List<String> WE;List<String> OD;HashMap<String,String> tI;Element ED;kD valueChanged;bool catchUndo;dB zO;FE.wX(this.FF,this.value,{this.valueChanged}){tE=null;Eb="control${SL}";SL++ ;WE=s.CB.lK(FF);if(WE==null||WE.length==0)OD=s.CB.rU(FF);else{if(!WE.contains(''))WE.add('');}catchUndo=true;}FE.HY(this.FF,this.tE,this.value,{this.valueChanged,this.catchUndo: false}){Eb="control${SL}";SL++ ;WE=s.CB.gI(tE);if(WE==null||WE.length==0)OD=s.CB.XU(FF,tE);else{String g=s.CB.uF(tE);if(!WE.contains('')&&g==null)WE.add('');}}Element UB(){SpanElement DB=new SpanElement();bool HB;final List<String> SB=['true','false','1','0'];if(WE==null||WE.length!=SB.length||(value!=null&&!SB.contains(value))){HB=false;}else{HB=true;for(int KB=0;KB<WE.length;KB++ ){if(WE[KB]!=SB[KB]){HB=false;break;}}}if(HB){CheckboxInputElement QB=new CheckboxInputElement();ED=QB;if(value==null)value='false';QB.checked=(value=='true'||value=='1');QB.onChange.listen((Event g)=>QJ(true));DB.append(QB);}else if(WE==null||WE.length==0){TextInputElement i=new TextInputElement();i.spellcheck=false;ED=i;i.size=40;if(value==null)value="";i.value=value;QJ(false);i.onInput.listen((Event g)=>QJ(true));i.onKeyUp.listen((KeyboardEvent g){bool v=g.ctrlKey||g.metaKey;bool k=g.shiftKey;int m=g.keyCode;if(catchUndo&&v&&((!k&&m==KeyCode.Z)||(!k&&m==KeyCode.Y)||(k&&m==KeyCode.Z))){}else QJ(true);});if(OD!=null&&OD.length>0){String h;if(tE!=null)h=s.CB.gK(FF,tE,value);else h=s.CB.kK(FF,value);i.value=h;DataListElement bB=new DataListElement();bB.id='datalist_${Eb}';tI=new HashMap<String,String>();zO=new dB('');for(String o in OD){OptionElement j=new OptionElement();String h;if(tE!=null)h=s.CB.gK(FF,tE,o);else h=s.CB.kK(FF,o);j.value=h;tI[h]=o;bB.append(j);zO.add(new IC(h,(){i.value=h;QJ(true);}));}i.attributes['list']='datalist_${Eb}';DB.append(bB);}DB.append(i);if(OD!=null&&OD.length>0){i.style.width="90%";SpanElement t=new SpanElement();t.text='▼';t.style.cursor='default';t.onClick.listen((Event g)=>OW(i));t.onMouseOver.listen((Event g)=>t.style.background='#E0E0E0');t.onMouseOut.listen((Event g)=>t.style.background=null);DB.append(t);}}else{SelectElement FB=new SelectElement();ED=FB;if(value==null)value='';tI=new HashMap<String,String>();for(String o in WE){OptionElement j=new OptionElement();String h;if(tE!=null)h=s.CB.gK(FF,tE,o);else h=s.CB.kK(FF,o);j.text=h;j.value=o;tI[h]=o;if(o==value){j.defaultSelected=true;j.selected=true;}FB.append(j);}if(!WE.contains(value)){OptionElement j=new OptionElement();j.text=value;j.selected=true;FB.append(j);ED.classes.add('invalid');}FB.onChange.listen((Event g)=>QJ(true));DB.append(FB);}if(catchUndo){ED.onKeyDown.listen((KeyboardEvent g){bool v=g.ctrlKey||g.metaKey;bool k=g.shiftKey;int m=g.keyCode;if(v&&!k&&m==KeyCode.Z){g.preventDefault();}else if(v&&((!k&&m==KeyCode.Y)||(k&&m==KeyCode.Z))){g.preventDefault();}});ED.onKeyUp.listen((KeyboardEvent g){bool v=g.ctrlKey||g.metaKey;bool k=g.shiftKey;int m=g.keyCode;if(v&&!k&&m==KeyCode.Z){g.preventDefault();s.XH();}else if(v&&((!k&&m==KeyCode.Y)||(k&&m==KeyCode.Z))){g.preventDefault();s.WM();}});}return (DB);}void QJ(bool i){String j=value;if(ED is InputElement&&(ED as InputElement).type=='text'){String g=(ED as TextInputElement).value;if(tI!=null&&tI[g]!=null)value=tI[g];else value=g;}else if(ED is SelectElement){value=(ED as SelectElement).value;}else if(ED is InputElement&&(ED as InputElement).type=='checkbox'){bool k=(ED as CheckboxInputElement).checked;if(k)value='true';else value='false';}bool h;if(tE!=null)h=((value==''&&!s.CB.vK(FF,tE))||s.CB.OS(tE,value));else h=(value==''||s.CB.jO(FF,value));if(h){ED.classes.add('valid');ED.classes.remove('invalid');}else{ED.classes.add('invalid');ED.classes.remove('valid');}if(i&&value!=j&&valueChanged!=null)valueChanged();}String wF()=>value;void LP(String g){this.value=g;if(ED is InputElement&&(ED as InputElement).type=='text'){TextInputElement k=ED as TextInputElement;if(tE!=null)k.value=s.CB.gK(FF,tE,g);else k.value=s.CB.kK(FF,g);}else if(ED is SelectElement){SelectElement i=ED as SelectElement;while(i.options.length>0)i.options[0].remove();for(String j in WE){OptionElement h=new OptionElement();if(tE!=null)h.text=s.CB.gK(FF,tE,j);else h.text=s.CB.kK(FF,j);h.value=j;if(j==g)h.selected=true;i.append(h);}if(!WE.contains(g)){OptionElement h=new OptionElement();h.text=g;h.value=g;h.selected=true;i.append(h);ED.classes.add('invalid');}i.value=g;}else if(ED is InputElement&&(ED as InputElement).type=='checkbox')(ED as CheckboxInputElement).checked=(g=='true'||g=='1');}void focus(){if(ED is TextInputElement){TextInputElement g=ED as TextInputElement;g.select();g.selectionStart=g.selectionEnd=g.value.length;}else if(ED!=null){ED.focus();}}void OW(TextInputElement j){DivElement g=zO.PM();g.style.position='absolute';g.style.display='block';Rectangle h=j.getBoundingClientRect();g.style.left="${h.left}px";g.style.top="${h.bottom}px";g.style.width="${h.width}px";((g.firstChild) as Element).style.width="${h.width}px";ZB.document.body.append(g);StreamSubscription<MouseEvent> i=ZB.document.onMouseUp.listen(null);i.onData((MouseEvent k){i.cancel();g.remove();k.preventDefault();});}}class vB implements PL{YB Fb;final HashMap<l,EB> Gb=new HashMap<l,EB>();final HashMap<l,kB> Hb=new HashMap<l,kB>();final HashMap<String,List<EB>> Ib=new HashMap<String,List<EB>>();HashMap<String,String> Jb;final LinkedHashSet<EB> Kb=new LinkedHashSet<EB>();Set<YB> Lb;HashMap<String,String> Mb;vB(HashMap<String,String> g){this.Mb=g;Lb=new HashSet<YB>();Jb=new HashMap<String,String>();}Future load(final String k){Completer i=new Completer();CQ(k).then((l t){Fb=new YB(t,k,this,null);Nb(Fb,null,null);Lb.add(Fb);Fb.Ob().then((DB){for(final YB j in Lb)Kb.addAll(j.MD());for(final YB j in Lb)j.Pb();for(EB g in Kb){Gb[g.OG()]=g;if(g.cC()!=null&&g.wH()==null){List<EB> h=Ib[g.cC()];if(h==null){h=new List<EB>();Ib[g.cC()]=h;}h.add(g);}}for(EB g in Kb){final List<kB> m=g.attributes();if(m!=null){for(kB o in m)Hb[o.OG()]=o;}}i.complete();});},onError:(lF v){i.completeError(v);});return (i.future);}l IM(final String h){final List<EB> g=Ib[h];if(g==null)return (null);return (g[0].OG());}List<l> TO(final String i){final List<EB> g=Ib[i];if(g==null)return (null);List<l> h=new List<l>();for(EB j in g)h.add(j.OG());return (h);}l tH(final l g,final l j){if(j==null){String h;if(g.EC==null)h=g.nodeName;else h=g.localName;final String o=g.tB;for(final YB t in Lb){for(final EB i in t.eO()){if(i.wH()==null&&!i.QH()&&h==i.cC()&&o==i.eF())return (i.OG());}}print("DaxeWXS: elementReference: no matching root element in the schema for ${h}");return (null);}final EB m=Gb[j];if(m==null){print("DaxeWXS: elementReference: unknown element reference: ${j}");return (null);}final List<EB> v=m.bC();final String h=g.localName;final String DB=g.tB;for(final EB k in v){if(k.cC()==h&&k.eF()==DB)return (k.OG());}return (null);}String XD(final l g){final EB h=Gb[g];if(h==null){print("DaxeWXS: elementName: unknown element reference: ${g}");return (null);}return (h.cC());}String kI(final l h){final EB g=Gb[h];if(g==null)return (null);return (g.eF());}String HM(final l h){final String g=kI(h);if(g==null)return (null);return (Jb[g]);}String RO(final l i){final EB g=Gb[i];if(g==null)return (null);String h=g.nK();if(h!=null)return (h);if(g.Qb!=null)return (g.Qb.nK());return (null);}List<String> lK(final l h){final EB g=Gb[h];if(g==null)return (null);return (g.iD());}List<String> cM(final l h){final EB g=Gb[h];if(g==null)return (null);return (g.OD());}bool UO(final l h,final String i){final EB g=Gb[h];if(g==null)return (false);return (g.ID(i));}List<String> rO(){final LinkedHashSet<String> g=new LinkedHashSet<String>();if(Fb.LE()!=null)g.add(Fb.LE());for(final String h in Jb.keys)g.add(h);return (new List.from(g));}String iG(final String g){return (Jb[g]);}String LE(){return (Fb.LE());}List<l> MD(){final List<l> h=new List<l>();for(final EB g in Kb){if(g.cC()!=null&&g.wH()==null&&!g.QH())h.add(g.OG());}return (h);}List<l> FI(){final List<l> h=new List<l>();for(final YB i in Lb){for(final EB g in i.eO()){if(g.cC()!=null&&g.wH()==null&&!g.QH())h.add(g.OG());}}return (h);}bool EI(final l g,final l h){final EB i=Gb[g];if(i==null){print("DaxeWXS: requiredElement: unknown element reference: ${g}");return (false);}final EB j=Gb[h];if(j==null){print("DaxeWXS: requiredElement: unknown element reference: ${h}");return (false);}bool k=i.UE(j);return (k!=null&&k);}bool nD(final l g,final l h){final EB i=Gb[g];if(i==null){print("DaxeWXS: multipleChildren: unknown element reference: ${g}");return (false);}final EB j=Gb[h];if(j==null){print("DaxeWXS: multipleChildren: unknown element reference: ${h}");return (false);}bool k=i.nD(j);return (k!=null&&k);}List<l> bC(final l g){assert(g!=null);final EB h=Gb[g];if(h==null){print("DaxeWXS: subElements: unknown element reference: ${g}");return (null);}final List<EB> j=h.bC();final List<l> i=new List<l>();for(EB k in j)i.add(k.OG());return (i);}String cD(final l g,final bool i,final bool j){final EB h=Gb[g];if(h==null){print("DaxeWXS: regularExpression: unknown element reference: ${g}");return (null);}return (h.QR());}List<l> iC(final l g){final EB h=Gb[g];if(h==null){print("DaxeWXS: parentElements: unknown element reference: ${g}");return (null);}final List<EB> j=h.iC();final List<l> i=new List<l>();for(EB k in j)i.add(k.OG());return (i);}List<l> iE(final l g){final EB h=Gb[g];if(h==null){print("DaxeWXS: elementAttributes: unknown element reference: ${g}");return (null);}final List<kB> j=h.attributes();final List<l> i=new List<l>();for(kB k in j)i.add(k.OG());return (i);}String attributeName(final l g){final kB h=Hb[g];if(h==null){print("DaxeWXS: attributeName: unknown attribute reference: ${g}");return (null);}return (h.cC());}String attributeNamespace(final l g){final kB h=Hb[g];if(h==null){print("DaxeWXS: attributeNamespace: unknown attribute reference: ${g}");return (null);}return (h.eF());}String oH(final l g){final kB h=Hb[g];if(h==null){print("DaxeWXS: attributeDocumentation: unknown attribute reference: ${g}");return (null);}return (h.nK());}String eK(final String h){if(h==null)return (null);final String g=dE(h);if(g==null)return (null);if(g=="xml")return ("http://www.w3.org/XML/1998/namespace");return (Fb.nV(g));}bool TV(final l g){final kB h=Hb[g];if(h==null){print("DaxeWXS: isRequired: unknown attribute reference: ${g}");return (false);}return (h.kR()=="required");}bool GO(final l h,final l g){return (TV(g));}List<String> gI(final l g){final kB h=Hb[g];if(h==null){print("DaxeWXS: attributeValues: unknown attribute reference: ${g}");return (null);}return (h.iD());}List<String> OP(final l g){final kB h=Hb[g];if(h==null){print("DaxeWXS: suggestedAttributeValues: unknown attribute reference: ${g}");return (null);}return (h.OD());}String uF(final l g){final kB h=Hb[g];if(h==null){print("DaxeWXS: defaultAttributeValue: unknown attribute reference: ${g}");return (null);}return (h.defaultValue());}bool HO(final l g,final String i){final kB h=Hb[g];if(h==null){print("DaxeWXS: attributeIsValid: unknown attribute reference: ${g}");return (false);}return (h.ID(i));}bool RE(final l g){final EB h=Gb[g];if(h==null){print("DaxeWXS: canContainText: unknown element reference: ${g}");return (false);}return (h.RJ());}bool PS(final l g,final List<l> k,final bool m){final EB h=Gb[g];if(h==null){print("DaxeWXS: validElement: unknown element reference: ${g}");return (false);}final List<EB> i=new List<EB>();for(l o in k){final EB j=Gb[o];if(j!=null)i.add(j);}return (h.QS(i,m));}Future<YB> Rb(final String v,final String h,final String t,final YB k){String g;if(h.startsWith("http"))g=h;else g="${iT(v)}/${h}";if(g==null)return (new Future.error(new lF("include/import : location not found : ${h}")));for(YB m in Lb){if(Sb(m.OV())==Sb(g)){Nb(m,k,t);return (new Future.value(m));}}Completer<YB> i=new Completer<YB>();CQ(g).then((l DB){final YB j=new YB(DB,g,this,k);Nb(j,k,t);Lb.add(j);j.Ob().then((FB){i.complete(j);},onError:(lF o){i.completeError(new lF("include/import: ${o}"));});},onError:(lF o){i.completeError(new lF("include/import: ${o}"));});return (i.future);}String Sb(String g){int h=g.indexOf('/');if(h==-1)return (g);String j=g.substring(0,h);int i=g.substring(h+1).indexOf('/');if(i==-1)return (g);i+= h+1;String k=g.substring(h+1,i);if(j!='..'&&k=='..')return (Sb(g.substring(i+1)));else return ("${g.substring(0,h+1)}${Sb(g.substring(h+1))}");}void Nb(final YB j,final YB k,final String h){if(h!=null&&Jb[h]==null){String g=j.iG(h);if(g!=null)Jb[h]=g;else if(k!=null){g=k.iG(h);if(g!=null)Jb[h]=g;}}final String i=j.LE();if(i!=null&&i!=""){final String g=j.iG(i);if(g!=null)Jb[i]=g;}}static Future<l> CQ(final String g){Completer<l> h=new Completer<l>();gH j=new gH();j.xO(g).then((AC k){h.complete(k.documentElement);},onError:(eD i){print("DaxeWXS: Error reading ${g}: ${i}");h.completeError(new lF("DaxeWXS: reading ${g}: ${i}"));});return (h.future);}static String iT(final String g){final int h=g.lastIndexOf("/");if(h==-1){return (null);}else{return (g.substring(0,h));}}List<EB> Tb(final String j,final String m){final List<EB> k=new List<EB>();if(j==null||j==""||j=="##any"){for(final EB g in Kb)if(g.cC()!=null&&g.wH()==null&&!g.QH())k.add(g);}else if(j=="##local"){for(final EB g in Kb){if(g.cC()!=null&&g.wH()==null&&!g.QH()){final String h=g.eF();if(h==null||h==m)k.add(g);}}}else if(j=="##other"){for(final EB g in Kb){if(g.cC()!=null&&g.wH()==null&&!g.QH()){final String h=g.eF();if(h!=null&&h!=m)k.add(g);}}}else{final HashSet<String> i=new HashSet.from(j.split(new RegExp(r"\s+")));if(i.contains("##targetNamespace")){i.remove("##targetNamespace");i.add(m);}if(i.contains("##local")){i.remove("##local");i.add("");}for(final EB g in Kb){if(g.cC()!=null&&g.wH()==null&&!g.QH()){final String h=g.eF();if(h!=null&&i.contains(h))k.add(g);}}}return (k);}static String cE(final String g){if(g==null)return (null);final int h=g.indexOf(':');if(h==-1)return (g);return (g.substring(h+1));}static String dE(final String g){if(g==null)return (null);final int h=g.indexOf(':');if(h==-1)return (null);else return (g.substring(0,h));}static List<String> rG(final String g,final l h){final String i=h.bD(dE(g));final String j=h.tB;if(cE(g)=="boolean"&&j==i){final List<String> k=["true","false","1","0"];return (k);}return (null);}String Ub(final EB g){if(Mb[g.cC()]!=null)return (Mb[g.cC()]);else return (g.cC());}}abstract class uC{List<EB> iC();}abstract class VD{void CC(final YB g,final uB h);List<EB> MD();List<EB> bC();String cD();bool UE(final EB g);bool nD(final EB g);int XE(final List<EB> g,final int h,final bool i);bool gD();}class wJ extends HE implements VD,uC{List<EB> Vb;int Wb=1;int Xb=1;uC Yb;wJ(final l h,final uC i,final YB j){Zb(h);Vb=new List<EB>();for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l&&g.localName=="element")Vb.add(new EB(g as l,this,j));}try {if(h.BC("minOccurs"))Wb=int.parse(h.getAttribute("minOccurs"));}on FormatException {}this.Yb=i;}void CC(final YB g,final uB h){for(EB i in Vb)i.CC(g,h);}List<EB> MD(){final List<EB> g=new List<EB>();for(EB h in Vb)g.addAll(h.MD());return (g);}List<EB> bC(){final List<EB> g=new List<EB>();for(EB h in Vb)g.addAll(h.CH());return (g);}List<EB> iC(){if(Yb!=null)return (Yb.iC());return (new List<EB>());}String cD(){final StringBuffer g=new StringBuffer();g.write('(');bool h=true;for(EB j in Vb){final String i=j.cD();if(i!=null){if(!h)g.write(" & ");h=false;g.write(i);}}g.write(')');if(Wb==0)g.write('?');return (g.toString());}bool UE(final EB h){for(EB g in Vb)for(EB i in g.CH())if(i==h)return (Wb>0&&g.eR()>0);return (null);}bool nD(final EB g){for(EB h in Vb)for(EB i in h.CH())if(i==g)return (false);return (null);}int XE(final List<EB> k,final int h,final bool t){if(Vb.length==0)return (h);List<int> i=new List<int>(Vb.length);for(int g=0;g<Vb.length;g++ )i[g]=0;int m=0;for(int g=h;g<k.length;g++ ){final EB v=k[g];bool o=false;for(int j=0;j<Vb.length;j++ ){if(v==Vb[j]){o=true;i[j]++;break;}}if(!o)break;m++ ;}for(int g=0;g<Vb.length;g++ )if(i[g]>1)return (h);if(!t){for(int g=0;g<Vb.length;g++ )if(i[g]==0&&!Vb[g].gD())return (h);}return (h+m);}bool gD(){if(Vb.length==0)return (true);if(Wb==0)return (true);for(EB g in Vb){if(!g.gD())return (false);}return (true);}}abstract class HE implements uB{LN ab=null;void Zb(final l h){for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l&&g.localName=="annotation"){ab=new LN(g as l);break;}}}String nK(){if(ab==null)return (null);return (ab.nK());}}class LN implements uB{List<vJ> bb;LN(final l h){bb=new List<vJ>();for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l&&g.localName=="documentation"){bb.add(new vJ(g as l));break;}}}String nK(){if(bb==null)return (null);StringBuffer g=new StringBuffer();for(vJ h in bb){if(h.wF()!=null)g.write(h.wF());}return (g.toString());}}class bL extends HE implements VD{String cb="##any";String eb="strict";int Wb=1;int Xb=1;dL Yb;YB Fb;List<EB> Vb;bL(final l g,final dL h,final YB i){if(g.BC("namespace"))cb=g.getAttribute("namespace");if(g.BC("processContents"))eb=g.getAttribute("processContents");try {if(g.BC("minOccurs"))Wb=int.parse(g.getAttribute("minOccurs"));if(g.BC("maxOccurs")){if(g.getAttribute("maxOccurs")=="unbounded")Xb=9007199254740992;else Xb=int.parse(g.getAttribute("maxOccurs"));}}on FormatException {}this.Yb=h;this.Fb=i;Vb=null;}void CC(final YB g,final uB i){Vb=new List<EB>();Vb.addAll(g.UU(cb));for(EB h in Vb)h.OJ(this);}List<EB> MD(){return (new List<EB>());}List<EB> bC(){if(Vb==null)CC(Fb,null);return (Vb);}List<EB> iC(){return (Yb.iC());}String cD(){if(Vb==null)CC(Fb,null);final StringBuffer g=new StringBuffer();g.write('(');for(int h=0;h<Vb.length;h++ ){g.write(Fb.YD(Vb[h]));if(h!=Vb.length-1)g.write('|');}g.write(')');if(Wb==0&&Xb==1)g.write('?');else if(Wb==0&&Xb>1)g.write('*');else if(Wb>0&&Xb>1)g.write('+');return (g.toString());}bool UE(final EB g){if(Vb==null)CC(Fb,null);if(Vb.contains(g))return (Wb>0&&Vb.length==1);else return (null);}bool nD(final EB g){if(Vb==null)CC(Fb,null);if(Vb.contains(g))return (Xb>1);else return (null);}int XE(final List<EB> i,final int h,final bool j){if(Vb==null)CC(Fb,null);if(!j&&i.length<Wb)return (h);for(int g=h;g<i.length;g++ ){if(g-h>=Xb)return (g);if(!Vb.contains(i[g])){if(!j&&g-h<Wb)return (h);return (g);}}return (i.length);}bool gD(){return (Wb==0);}}class kB extends HE{kC fb=null;String gb=null;String hb=null;String ib=null;String jb=null;String kb=null;String lb=null;String mb=null;kB nb=null;l ob;uC Yb;YB Fb;kB(final l g,final uC j,final YB i){Zb(g);for(BB h=g.firstChild;h!=null;h=h.nextSibling){if(h is l&&h.localName=="simpleType"){fb=new kC(h as l,null,i);break;}}if(g.BC("name"))gb=g.getAttribute("name");if(g.BC("ref"))hb=g.getAttribute("ref");if(g.BC("type"))ib=g.getAttribute("type");if(g.BC("use"))jb=g.getAttribute("use");if(g.BC("default"))kb=g.getAttribute("default");if(g.BC("fixed"))lb=g.getAttribute("fixed");if(g.BC("form"))mb=g.getAttribute("form");ob=g;this.Yb=j;this.Fb=i;}void CC(final YB h){if(fb!=null)fb.CC(h,null);if(hb!=null){final String i=vB.dE(hb);String g;if(i=="xml")g="http://www.w3.org/XML/1998/namespace";else g=ob.bD(i);nb=h.xV(vB.cE(hb),g);if(nb==null)print("WXSAttribute: Référence d'attribut introuvable : ${hb}");}if(fb==null&&ib!=null){final String g=ob.bD(vB.dE(ib));if(g==null||g!=ob.tB||h.LE()==null||h.LE()==ob.tB){final ZG j=h.aJ(vB.cE(ib),g,null);if(j is kC)fb=j;}}if(fb==null&&nb!=null)fb=nb.fb;}String cC(){if(gb==null&&nb!=null)return (nb.cC());return (gb);}String kR(){return (jb);}l OG(){return (ob);}String eF(){if(hb!=null){final String h=vB.dE(hb);if(h!=null){final String i=ob.bD(h);if(i!=null)return (i);if(h=="xml")return ("http://www.w3.org/XML/1998/namespace");return (null);}}bool g;if(Fb.NV().contains(this))g=true;else if(mb!=null)g=(mb=="qualified");else g=(Fb.wU()=="qualified");if(g){final String j=Fb.LE();if(j=="")return (null);else return (j);}else return (null);}List<EB> iC(){if(Yb!=null)return (Yb.iC());return (new List<EB>());}List<String> iD(){if(lb!=null){final List<String> g=new List<String>();g.add(lb);return (g);}if(Fb.LE()!=null&&Fb.LE()==ob.tB&&vB.cE(ib)=="bool")return (vB.rG(ib,ob));if(fb!=null)return (fb.iD());else if(ib!=null)return (vB.rG(ib,ob));return (null);}List<String> OD(){if(lb!=null){final List<String> g=new List<String>();g.add(lb);return (g);}if(Fb.LE()!=null&&Fb.LE()==ob.tB&&vB.cE(ib)=="bool")return (vB.rG(ib,ob));if(fb!=null)return (fb.OD());else if(ib!=null)return (vB.rG(ib,ob));return (null);}String defaultValue(){if(kb!=null)return (kb);else if(lb!=null)return (lb);else if(nb!=null)return (nb.defaultValue());return (null);}bool ID(final String g){if(lb!=null)return (lb==g);if((g==null||g=="")&&jb=="required")return (false);if(fb!=null)return (fb.ID(g));if(ib!=null){final String h=ob.bD(vB.dE(ib));if(h!=null&&h==ob.tB)return (kC.yJ(vB.cE(ib),g));}if(nb!=null)return (nb.ID(g));if(ib==null)return (true);return (false);}}class mD extends HE implements uC{List<uB> pb;String gb=null;String hb=null;mD nb=null;l ob;uC Yb;YB Fb;mD(final l h,final uC j,final YB i){Zb(h);pb=new List<uB>();for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="attribute")pb.add(new kB(g as l,this,i));else if(g.localName=="attributeGroup")pb.add(new mD(g as l,this,i));}}if(h.BC("name"))gb=h.getAttribute("name");if(h.BC("ref"))hb=h.getAttribute("ref");ob=h;this.Yb=j;this.Fb=i;}String eF(){return (Fb.LE());}uC getParent(){return (Yb);}void CC(final YB h,final uB j){for(uB g in pb){if(g is kB)g.CC(h);else if(g is mD)g.CC(h,j);}if(hb!=null){final String k=vB.dE(hb);String i;if(k=="xml")i="http://www.w3.org/XML/1998/namespace";else i=ob.bD(k);nb=h.wV(vB.cE(hb),i,j);}}String cC(){if(gb==null&&nb!=null)return (nb.cC());return (gb);}List<EB> iC(){if(Yb!=null)return (Yb.iC());return (new List<EB>());}List<kB> attributes(){if(nb!=null)return (nb.attributes());final List<kB> h=new List<kB>();for(uB g in pb){if(g is kB)h.add(g);else if(g is mD)h.addAll(g.attributes());}return (h);}}class UI extends dL{UI(final l g,final uC h,final YB i){qb(g,h,i);}int XE(final List<EB> k,final int m,final bool i){int j=0;for(int g=m;g<k.length;){if(j>=Xb)return (g);int h=g;int o=g;for(VD t in rb){h=t.XE(k,g,i);if(i){if(h>o)o=h;}else{if(h>g)break;}}if(i)h=o;if(h==g){if(!i&&j<Wb)return (m);return (g);}g=h;j++ ;}if(!i&&j<Wb)return (m);return (k.length);}bool gD(){if(rb.length==0)return (true);if(Wb==0)return (true);for(VD g in rb){if(g.gD())return (true);}return (false);}}class FG extends HE implements VD,uC{VD sb=null;bool tb=null;lC Yb;FG(final l h,final lC j,final YB i){Zb(h);for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="restriction")sb=new pG(g as l,this,i);else if(g.localName=="extension")sb=new mF(g as l,this,i);}}if(h.BC("mixed"))tb=(h.getAttribute("mixed")=="true"||h.getAttribute("mixed")=="1");this.Yb=j;}void CC(final YB g,final uB h){if(sb!=null)sb.CC(g,h);}List<EB> MD(){if(sb!=null)return (sb.MD());return (new List<EB>());}List<EB> bC(){if(sb!=null)return (sb.bC());return (new List<EB>());}String cD(){if(sb!=null)return (sb.cD());return (null);}bool UE(final EB g){if(sb!=null)return (sb.UE(g));return (null);}bool nD(final EB g){if(sb!=null)return (sb.nD(g));return (null);}List<kB> attributes(){if(sb is pG)return ((sb as pG).attributes());else if(sb is mF)return ((sb as mF).attributes());return (new List<kB>());}List<EB> iC(){return (Yb.iC());}int XE(final List<EB> h,final int g,final bool i){if(sb!=null)return (sb.XE(h,g,i));return (g);}bool gD(){if(sb!=null)return (sb.gD());return (true);}}class lC extends HE implements ZG,VD,uC{cL ub=null;VD sb=null;List<uB> pb;String gb=null;bool tb=false;bool vb=false;uC Yb;YB Fb;List<EB> wb;List<mF> xb;lC(final l h,final uC j,final YB i){Zb(h);pb=new List<uB>();for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="simpleContent")ub=new cL(g as l,i);else if(g.localName=="complexContent")sb=new FG(g as l,this,i);else if(g.localName=="group")sb=new GE(g as l,this,i);else if(g.localName=="all")sb=new wJ(g as l,this,i);else if(g.localName=="choice")sb=new UI(g as l,this,i);else if(g.localName=="sequence")sb=new VI(g as l,this,i);else if(g.localName=="attribute")pb.add(new kB(g as l,this,i));else if(g.localName=="attributeGroup")pb.add(new mD(g as l,this,i));}}if(h.BC("name"))gb=h.getAttribute("name");if(h.BC("mixed"))tb=h.getAttribute("mixed")=="true"||h.getAttribute("mixed")=="1";if(h.BC("abstract"))vb=h.getAttribute("abstract")=="true"||h.getAttribute("abstract")=="1";this.Yb=j;this.Fb=i;wb=null;xb=null;}cL LV(){return (ub);}String cC(){return (gb);}bool FV(){return (tb);}String eF(){return (Fb.LE());}uC getParent(){return (Yb);}void CC(final YB g,final uB i){if(ub!=null)ub.CC(g,i);if(sb!=null)sb.CC(g,i);for(uB h in pb){if(h is kB)h.CC(g);else if(h is mD)h.CC(g,i);}}void OJ(final EB g){if(wb==null)wb=new List<EB>();wb.add(g);}void LU(final mF g){if(xb==null)xb=new List<mF>();xb.add(g);}List<EB> MD(){if(sb!=null)return (sb.MD());return (new List<EB>());}List<EB> bC(){final List<EB> g=new List<EB>();if(sb!=null)g.addAll(sb.bC());return (g);}List<EB> iC(){final List<EB> g=new List<EB>();if(Yb is EB){if(!(Yb as EB).QH())g.add(Yb as EB);final List<EB> h=(Yb as EB).iR();if(h!=null)g.addAll(h);}if(wb!=null){for(EB i in wb){if(!i.QH())g.add(i);final List<EB> h=i.iR();if(h!=null)g.addAll(h);}}if(xb!=null){for(mF j in xb)g.addAll(j.iC());}return (g);}String cD(){if(sb!=null)return (sb.cD());return (null);}bool UE(final EB g){if(sb!=null)return (sb.UE(g));return (null);}bool nD(final EB g){if(sb!=null)return (sb.nD(g));return (null);}List<String> iD(){if(ub!=null)return (ub.iD());return (null);}List<String> OD(){if(ub!=null)return (ub.OD());return (null);}List<kB> attributes(){if(ub!=null)return (ub.attributes());else if(sb is FG)return ((sb as FG).attributes());final List<kB> h=new List<kB>();for(uB g in pb){if(g is kB)h.add(g);else if(g is mD)h.addAll(g.attributes());}return (h);}int XE(final List<EB> h,final int g,final bool i){if(ub!=null)return (g);else if(sb!=null)return (sb.XE(h,g,i));return (g);}bool gD(){if(ub!=null)return (true);else if(sb!=null)return (sb.gD());return (true);}bool ID(final String g){if(ub!=null)return (ub.ID(g));return (g.trim()==''||RJ());}bool RJ(){if(sb is FG){FG h=sb as FG;ZG g=null;if(h.sb is mF){mF i=h.sb as mF;if(i.sb==null)g=i.yb;}else{pG j=h.sb as pG;if(j.sb==null)g=j.yb;}if(g is lC)return ((g as lC).RJ());}if(FV())return (true);if(LV()!=null)return (true);return (false);}}class vJ implements uB{String zb=null;String Ac=null;String Bc=null;vJ(final l g){if(g.BC("source"))zb=g.getAttribute("source");if(g.BC("xml:lang"))Ac=g.getAttribute("xml:lang");if(g.firstChild!=null)Bc=g.firstChild.nodeValue;}String wF(){return (Bc);}}class EB extends HE implements VD,uC{kC fb=null;lC Qb=null;List<uB> Cc;String gb=null;String hb=null;String ib=null;String Dc=null;int Wb=1;int Xb=1;String kb=null;String lb=null;bool vb=false;String mb=null;EB nb=null;EB Ec=null;l ob;uC Yb;YB Fb;List<uB> wb;List<EB> Fc;List<EB> Gc;List<EB> Hc;EB(final l g,final uC j,final YB i){Zb(g);Cc=new List<uB>();for(BB h=g.firstChild;h!=null;h=h.nextSibling){if(h is l){if(h.localName=="simpleType")fb=new kC(h as l,this,i);else if(h.localName=="complexType")Qb=new lC(h as l,this,i);else if(h.localName=="unique")Cc.add(new zP(h as l));else if(h.localName=="key")Cc.add(new AQ(h as l));else if(h.localName=="keyref")Cc.add(new BQ(h as l));}}if(g.BC("name"))gb=g.getAttribute("name");if(g.BC("ref"))hb=g.getAttribute("ref");if(g.BC("type"))ib=g.getAttribute("type");if(g.BC("substitutionGroup"))Dc=g.getAttribute("substitutionGroup");try {if(g.BC("minOccurs"))Wb=int.parse(g.getAttribute("minOccurs"));if(g.BC("maxOccurs")){if(g.getAttribute("maxOccurs")=="unbounded")Xb=9007199254740992;else Xb=int.parse(g.getAttribute("maxOccurs"));}}on FormatException {}if(g.BC("default"))kb=g.getAttribute("default");if(g.BC("fixed"))lb=g.getAttribute("fixed");if(g.BC("abstract"))vb=g.getAttribute("abstract")=="true"||g.getAttribute("abstract")=="1";if(g.BC("form"))mb=g.getAttribute("form");ob=g;this.Yb=j;this.Fb=i;wb=null;Fc=null;Hc=null;Gc=null;}String cC(){if(gb==null&&nb!=null)return (nb.cC());return (gb);}String wH(){return (hb);}int eR(){return (Wb);}int EV(){return (Xb);}bool QH(){return (vb);}l OG(){return (ob);}String eF(){bool g;if(Fb.eO().contains(this))g=true;else if(mb!=null)g=mb=="qualified";else g=Fb.zU()=="qualified";if(g)return (Fb.LE());else return (null);}uC getParent(){return (Yb);}void CC(final YB h,final uB j){if(fb!=null)fb.CC(h,null);if(Qb!=null)Qb.CC(h,j);if(hb!=null){final String g=ob.bD(vB.dE(hb));nb=h.ES(vB.cE(hb),g);if(nb!=null)nb.OJ(this);else print("Element reference not found : ${hb} (namespace: ${g})");}if(Qb==null&&fb==null&&ib!=null){final String g=ob.bD(vB.dE(ib));final ZG i=h.aJ(vB.cE(ib),g,j);if(i is lC){Qb=i;Qb.OJ(this);}else if(i is kC)fb=i;}if(Dc!=null){final String g=ob.bD(vB.dE(Dc));Ec=h.ES(vB.cE(Dc),g);Ec.OU(this);}}void OJ(final uB g){if(wb==null)wb=new List<uB>();wb.add(g);}void OU(final EB g){if(Fc==null)Fc=new List<EB>();Fc.add(g);}List<EB> iR(){return (Fc);}List<EB> MD(){final List<EB> g=new List<EB>();g.add(this);if(Qb!=null)g.addAll(Qb.MD());return (g);}List<EB> CH(){if(Gc!=null)return (Gc);Gc=new List<EB>();if(!vb&&gb!=null)Gc.add(this);if(nb!=null)Gc.addAll(nb.CH());if(Fc!=null)for(EB g in Fc)Gc.addAll(g.CH());return (Gc);}List<EB> bC(){if(Hc!=null)return (Hc);final LinkedHashSet<EB> g=new LinkedHashSet<EB>();if(nb!=null)g.addAll(nb.bC());else if(Qb!=null)g.addAll(Qb.bC());else if(fb==null&&ib==null&&Ec!=null)g.addAll(Ec.bC());Hc=new List.from(g);return (Hc);}List<EB> iC(){final LinkedHashSet<EB> g=new LinkedHashSet<EB>();if(Yb!=null)g.addAll(Yb.iC());if(wb!=null){for(uB h in wb){if(h is EB)g.addAll(h.iC());else if(h is bL)g.addAll(h.iC());}}if(Ec!=null)g.addAll(Ec.iC());return (new List.from(g));}String QR(){if(Qb==null&&fb==null&&ib==null&&Ec!=null)return (Ec.QR());if(Qb==null)return (null);return (Qb.cD());}String cD(){final List<EB> h=CH();if(h.length==0)return (null);final StringBuffer g=new StringBuffer();if(h.length>1)g.write('(');for(int i=0;i<h.length;i++ ){final EB j=h[i];g.write(Fb.YD(j));if(i!=h.length-1)g.write('|');}if(h.length>1)g.write(')');if(Wb==0&&Xb==1)g.write('?');else if(Wb==0&&Xb>1)g.write('*');else if(Wb>0&&Xb>1)g.write('+');return (g.toString());}bool UE(final EB g){if(Qb==null&&fb==null&&ib==null&&Ec!=null)return (Ec.UE(g));if(Qb==null)return (null);return (Qb.UE(g));}bool nD(final EB g){if(Qb==null&&fb==null&&ib==null&&Ec!=null)return (Ec.nD(g));if(Qb==null)return (null);return (Qb.nD(g));}List<String> iD(){if(lb!=null){final List<String> g=new List<String>();g.add(lb);return (g);}if(fb!=null)return (fb.iD());else if(Qb!=null)return (Qb.iD());else if(ib!=null)return (vB.rG(ib,ob));else if(fb==null&&Ec!=null)return (Ec.iD());return (null);}List<String> OD(){if(lb!=null){final List<String> g=new List<String>();g.add(lb);return (g);}if(fb!=null)return (fb.OD());else if(Qb!=null)return (Qb.OD());else if(ib!=null)return (vB.rG(ib,ob));else if(fb==null&&Ec!=null)return (Ec.OD());return (null);}List<kB> attributes(){if(nb!=null)return (nb.attributes());if(Qb!=null)return (Qb.attributes());else if(fb==null&&ib==null&&Ec!=null)return (Ec.attributes());return (new List<kB>());}bool RJ(){if(ib!=null){final String h=ob.bD(vB.dE(ib));final String g=ob.tB;if(g!=Fb.LE()&&g==h)return (true);}if(Qb!=null)return (Qb.RJ());if(fb!=null)return (true);if(Qb==null&&ib==null&&Ec!=null)return (Ec.RJ());return (false);}bool QS(final List<EB> g,final bool h){if(Qb==null){if(fb==null&&ib==null&&Ec!=null)return (Ec.QS(g,h));return (g.length==0);}if(g.length==0){if(h)return (true);if(Qb.gD())return (true);}final int i=Qb.XE(g,0,h);return (i>0&&i==g.length);}int XE(final List<EB> j,final int i,final bool k){int g=0;final List<EB> o=CH();for(int h=i;h<j.length;h++ ){if(g>=Xb)return (h);bool m=false;for(EB t in o)if(t==j[h])m=true;if(!m){if(!k&&g<Wb)return (i);return (h);}g++ ;}if(!k&&g<Wb)return (i);return (i+g);}bool gD(){return (Wb==0);}bool ID(final String g){if(lb!=null)return (lb==g);if(fb!=null)return (fb.ID(g));if(Qb!=null)return (Qb.ID(g));if(ib!=null){final String h=ob.bD(vB.dE(ib));if(h!=null&&h==ob.tB)return (kC.yJ(vB.cE(ib),g));return (false);}else return (true);}}class lF implements Exception{final String message;final Exception pI;const lF([this.message,this.pI]);String toString(){String g;if(message==null)g='WXSException';else g=message;if(pI!=null)g="${g} (parent exception: ${pI})";return (g);}}abstract class dL extends HE implements VD,uC{List<VD> rb;int Wb=1;int Xb=1;uC Yb;void qb(final l h,final uC j,final YB i){Zb(h);rb=new List<VD>();for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="element")rb.add(new EB(g as l,this,i));else if(g.localName=="group")rb.add(new GE(g as l,this,i));else if(g.localName=="choice")rb.add(new UI(g as l,this,i));else if(g.localName=="sequence")rb.add(new VI(g as l,this,i));else if(g.localName=="any")rb.add(new bL(g as l,this,i));}}try {if(h.BC("minOccurs"))Wb=int.parse(h.getAttribute("minOccurs"));if(h.BC("maxOccurs")){if(h.getAttribute("maxOccurs")=="unbounded")Xb=9007199254740992;else Xb=int.parse(h.getAttribute("maxOccurs"));}}on FormatException {}this.Yb=j;}void CC(final YB h,final uB i){for(VD g in rb)if(!(g is bL))g.CC(h,i);}List<EB> MD(){final List<EB> g=new List<EB>();for(VD h in rb)g.addAll(h.MD());return (g);}List<EB> bC(){final List<EB> g=new List<EB>();for(VD h in rb){if(h is EB)g.addAll(h.CH());else g.addAll(h.bC());}return (g);}List<EB> iC(){if(Yb!=null)return (Yb.iC());return (new List<EB>());}String cD(){if(rb.length==0)return (null);final String k=(this is UI)?"|":", ";StringBuffer g=new StringBuffer();if(rb.length>1||Wb!=1||Xb!=1)g.write('(');bool i=true;for(VD m in rb){final String j=m.cD();if(j!=null){if(!i)g.write(k);i=false;g.write(j);}}if(rb.length>1||Wb!=1||Xb!=1)g.write(')');if(rb.length==1&&g.length>2){String h=g.toString();if(h.substring(0,2)=="(("&&h.substring(g.length-2,g.length)=="))"){g=new StringBuffer(h.substring(1,h.length-1));}}if(Wb==0&&Xb==1)g.write('?');else if(Wb==0&&Xb>1)g.write('*');else if(Wb>0&&Xb>1)g.write('+');return (g.toString());}bool UE(final EB h){for(VD g in rb){if(g is EB){for(EB j in g.CH())if(j==h)return ((this is VI||rb.length==1)&&Wb!=0&&g.eR()!=0);}else{bool i=g.UE(h);if(i!=null)return (i);}}return (null);}bool nD(final EB i){for(VD h in rb){if(h is EB){for(EB j in h.CH())if(j==i)return (h.EV()>1||Xb>1);}else{bool g=h.nD(i);if(g!=null&&!g&&Xb>1)g=true;if(g!=null)return (g);}}return (null);}}class mF extends HE implements VD,uC{VD sb=null;List<uB> pb;String Ic=null;ZG yb=null;l ob;FG Yb;mF(final l i,final FG j,final YB h){Zb(i);pb=new List<uB>();for(BB g=i.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="group")sb=new GE(g as l,this,h);else if(g.localName=="all")sb=new wJ(g as l,this,h);else if(g.localName=="choice")sb=new UI(g as l,this,h);else if(g.localName=="sequence")sb=new VI(g as l,this,h);else if(g.localName=="attribute")pb.add(new kB(g as l,this,h));else if(g.localName=="attributeGroup")pb.add(new mD(g as l,this,h));}}if(i.BC("base"))Ic=i.getAttribute("base");ob=i;this.Yb=j;}void CC(final YB g,final uB i){if(sb!=null)sb.CC(g,i);for(uB h in pb){if(h is kB)h.CC(g);else if(h is mD)h.CC(g,i);}if(Ic!=null){final String j=ob.bD(vB.dE(Ic));yb=g.aJ(vB.cE(Ic),j,i);if(yb is lC)(yb as lC).LU(this);}}List<EB> MD(){final List<EB> g=new List<EB>();if(sb!=null)g.addAll(sb.MD());return (g);}List<EB> bC(){final List<EB> g=new List<EB>();if(yb is lC)g.addAll((yb as lC).bC());if(sb!=null)g.addAll(sb.bC());return (g);}List<EB> iC(){if(Yb!=null)return (Yb.iC());else return (new List<EB>());}String cD(){String g;if(yb is lC)g=(yb as lC).cD();else g=null;String h;if(sb!=null)h=sb.cD();else h=null;if(g==null&&h==null)return ("");else if(g!=null&&h==null)return (g);else if(g==null&&h!=null)return (h);else return ("(${g}, ${h})");}bool UE(final EB i){bool g=null;if(yb is lC)g=(yb as lC).UE(i);if(g!=null&&g)return (g);bool h=null;if(sb!=null)h=sb.UE(i);if(h!=null&&h)return (h);return (g!=null?g:h);}bool nD(final EB h){bool g=null;if(yb is lC)g=(yb as lC).nD(h);if(g!=null&&g)return (g);bool i=null;if(sb!=null)i=sb.nD(h);return (g!=null?g:i);}List<String> iD(){if(yb!=null)return (yb.iD());else if(Ic!=null)return (vB.rG(Ic,ob));return (null);}List<String> OD(){if(yb!=null)return (yb.OD());else if(Ic!=null)return (vB.rG(Ic,ob));return (null);}List<kB> attributes(){final List<kB> g=new List<kB>();for(uB h in pb){if(h is kB)g.add(h);else if(h is mD)g.addAll(h.attributes());}if(yb is lC){final List<kB> i=(yb as lC).attributes();final List<kB> j=new List<kB>();for(kB k in g){final String o=k.cC();bool m=false;for(kB t in i)if(o==t.cC()){m=true;break;}if(!m)j.add(k);}i.addAll(j);return (i);}return (g);}int XE(final List<EB> j,final int h,final bool i){int g=h;if(yb is lC){g=(yb as lC).XE(j,h,i);if(g==h&&!i&&!(yb as lC).gD())return (h);}if(sb!=null){int k=sb.XE(j,g,i);if(k==g&&!i&&!sb.gD())return (h);g=k;}return (g);}bool gD(){if(yb is lC&&!(yb as lC).gD())return (false);if(sb!=null)return (sb.gD());return (true);}bool ID(final String g){if(yb!=null)return (yb.ID(g));else if(Ic!=null)return (kC.yJ(vB.cE(Ic),g));return (false);}}class IF extends HE{String Jc;String Bc=null;bool lb=false;int Kc=0;IF(final l h){Zb(h);Jc=h.localName;if(h.BC("value")){Bc=h.getAttribute("value");Kc=int.parse(Bc,onError:(String i)=>0);if(Jc=="pattern"){Bc=Bc.replaceAll("\\i","[^<>&#!/?'\",0-9.\\-\\s]");Bc=Bc.replaceAll("\\I","[^a-zA-Z]");Bc=Bc.replaceAll("\\c","[^<>&#!/?'\",\\s]");Bc=Bc.replaceAll("\\C","\\W");Bc=Bc.replaceAll("\$","\\\$");for(int g=0;g<Bc.length;g++ ){if(Bc[g]=='^'&&(g==0||(Bc[g-1]!='['||(g>1&&Bc[g-2]=='\\')))){Bc=Bc.substring(0,g)+"\\^"+Bc.substring(g+1);g++ ;}}}}if(h.BC("fixed"))lb=h.getAttribute("fixed")=="true"||h.getAttribute("fixed")=="1";}String cO(){return (Jc);}String wF(){return (Bc);}bool ID(final String g){if(Jc=="minExclusive"){try {final double i=double.parse(g);return (i>Kc);}on FormatException {return (false);}}else if(Jc=="minInclusive"){try {final double i=double.parse(g);return (i>=Kc);}on FormatException {return (false);}}else if(Jc=="maxExclusive"){try {final double i=double.parse(g);return (i<Kc);}on FormatException {return (false);}}else if(Jc=="maxInclusive"){try {final double i=double.parse(g);return (i<=Kc);}on FormatException {return (false);}}else if(Jc=="totalDigits"){int j=0;for(int h=0;h<g.length;h++ )if(g[h].compareTo('0')>=0&&g[h].compareTo('9')<=0)j++ ;return (j<=Kc);}else if(Jc=="fractionDigits"){int j=0;bool k=false;for(int h=0;h<g.length;h++ ){if(!k){if(g[h]=='.')k=true;}else if(g[h].compareTo('0')>=0&&g[h].compareTo('9')<=0)j++ ;}return (j<=Kc);}else if(Jc=="length")return (g.length==Kc);else if(Jc=="minLength")return (g.length>=Kc);else if(Jc=="maxLength")return (g.length<=Kc);else if(Jc=="enumeration"){return (Bc!=null&&Bc==g);}else if(Jc=="whiteSpace"){return (true);}else if(Jc=="pattern"){return (kC.WC(g,Bc));}else return (true);}}class aL extends HE{String Lc=null;aL(final l g){if(g.BC("xpath"))Lc=g.getAttribute("xpath");}}class GE extends HE implements VD,uC{VD Mc=null;String gb=null;String hb=null;GE nb=null;int Wb=1;int Xb=1;l ob;uC Yb;YB Fb;List<GE> wb;GE(final l g,final uC j,final YB i){Zb(g);for(BB h=g.firstChild;h!=null;h=h.nextSibling){if(h is l){if(h.localName=="all")Mc=new wJ(h as l,this,i);else if(h.localName=="choice")Mc=new UI(h as l,this,i);else if(h.localName=="sequence")Mc=new VI(h as l,this,i);}}if(g.BC("name"))gb=g.getAttribute("name");if(g.BC("ref"))hb=g.getAttribute("ref");try {if(g.BC("minOccurs"))Wb=int.parse(g.getAttribute("minOccurs"));if(g.BC("maxOccurs")){if(g.getAttribute("maxOccurs")=="unbounded")Xb=9007199254740992;else Xb=int.parse(g.getAttribute("maxOccurs"));}}on FormatException {}ob=g;this.Yb=j;this.Fb=i;wb=null;}String cC(){if(gb==null&&nb!=null)return (nb.cC());return (gb);}String eF(){return (Fb.LE());}uC getParent(){return (Yb);}void CC(final YB g,final uB h){if(Mc!=null)Mc.CC(g,h);if(hb!=null){final String i=ob.bD(vB.dE(hb));nb=g.yV(vB.cE(hb),i,h);if(nb!=null)nb.OJ(this);else print("Référence de groupe introuvable : ${hb}");}}void OJ(final GE g){if(wb==null)wb=new List<GE>();wb.add(g);}List<EB> MD(){if(Mc!=null)return (Mc.MD());return (new List<EB>());}List<EB> bC(){if(nb!=null)return (nb.bC());if(Mc!=null)return (Mc.bC());return (new List<EB>());}List<EB> iC(){final List<EB> g=new List<EB>();if(Yb!=null)g.addAll(Yb.iC());if(wb!=null){for(GE h in wb)g.addAll(h.iC());}return (g);}String cD(){String g;if(nb!=null)g=nb.cD();else if(Mc!=null)g=Mc.cD();else g="()";if(Wb==0&&Xb==1)return ("${g}?");else if(Wb==0&&Xb>1)return ("${g}*");else if(Wb>0&&Xb>1)return ("${g}+");else return (g);}bool UE(final EB g){if(nb!=null)return (nb.UE(g));bool h=null;if(Mc!=null)h=Mc.UE(g);return (h);}bool nD(final EB g){if(nb!=null)return (nb.nD(g));bool h=null;if(Mc!=null)h=Mc.nD(g);return (h);}int XE(final List<EB> h,final int k,final bool j){if(!j&&h.length<Wb)return (k);int m=0;for(int g=k;g<h.length;){if(m>=Xb)return (g);int i=g;if(nb!=null)i=nb.XE(h,g,j);else if(Mc!=null)i=Mc.XE(h,g,j);if(i==g)return (g);g=i;m++ ;}return (h.length);}bool gD(){if(Wb==0)return (true);if(nb!=null)return (nb.gD());if(Mc!=null)return (Mc.gD());return (true);}}class xJ extends HE{String cb=null;String Nc=null;YB Oc=null;xJ(final l g,final YB h){if(g.BC("namespace"))cb=g.getAttribute("namespace");if(g.BC("schemaLocation"))Nc=g.getAttribute("schemaLocation");}Future Ob(final YB g){if(Nc==null)return (new Future.value(null));Completer h=new Completer();g.tO(Nc,cb,g).then((YB g){Oc=g;h.complete();},onError:(lF i){h.completeError(i);});return (h.future);}}class uJ extends HE{String Nc=null;YB Oc=null;uJ(final l g,final YB h){Zb(g);if(g.BC("schemaLocation"))Nc=g.getAttribute("schemaLocation");}Future Ob(final YB g){Completer h=new Completer();g.tO(Nc,null,g).then((YB g){Oc=g;h.complete();},onError:(lF i){h.completeError(i);});return (h.future);}}class AQ extends MN{AQ(final l g){qb(g);}}abstract class MN extends HE{NN Pc=null;List<aL> Qc;String gb=null;void qb(final l h){Zb(h);Qc=new List<aL>();for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="selector")Pc=new NN(g as l);else if(g.localName=="field")Qc.add(new aL(g as l));}}if(h.BC("name"))gb=h.getAttribute("name");}}class BQ extends MN{String Rc=null;BQ(final l g){qb(g);}}class ON extends HE{kC fb=null;String Sc=null;l ob;ON(final l h,final YB i){Zb(h);for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l&&g.localName=="simpleType"){fb=new kC(g as l,null,i);break;}}if(h.BC("itemType"))Sc=h.getAttribute("itemType");ob=h;}void CC(final YB g,final uB h){if(fb!=null)fb.CC(g,h);if(Sc!=null&&fb==null){final String i=ob.bD(vB.dE(Sc));final ZG j=g.aJ(vB.cE(Sc),i,h);if(j is kC)fb=j;else{final String k=ob.tB;if(k!=i)Sc=null;}}}bool ID(final String g){if(fb==null&&Sc==null)return (false);if(g==null)return (false);final List<String> i=g.trim().split(new RegExp(r"\s+"));for(String h in i){if(fb!=null){if(!fb.ID(h))return (false);}else{if(!kC.yJ(vB.cE(Sc),h))return (false);}}return (true);}}class qG implements uB,uC{List<uB> Tc;String Nc=null;YB Oc=null;YB Fb;qG(final l i,final YB h){Tc=new List<uB>();for(BB g=i.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="simpleType")Tc.add(new kC(g as l,this,h));else if(g.localName=="complexType")Tc.add(new lC(g as l,this,h));else if(g.localName=="group")Tc.add(new GE(g as l,this,h));else if(g.localName=="attributeGroup")Tc.add(new mD(g as l,this,h));}}if(i.BC("schemaLocation"))Nc=i.getAttribute("schemaLocation");this.Fb=h;}Future Ob(final YB g){Completer h=new Completer();g.tO(Nc,null,g).then((YB g){Oc=g;h.complete();},onError:(lF i){h.completeError(i);});return (h.future);}List<uB> IV(){return (Tc);}List<EB> iC(){return (new List<EB>());}String eF(){return (Fb.LE());}}class pG extends HE implements VD,uC{kC fb=null;List<IF> Uc;VD sb=null;List<uB> pb;String Ic=null;ZG yb=null;l ob;FG Yb;pG(final l j,final FG k,final YB i){Zb(j);Uc=new List<IF>();pb=new List<uB>();for(BB g=j.firstChild;g!=null;g=g.nextSibling){if(g is l){String h=g.localName;if(h=="simpleType")fb=new kC(g as l,this,i);else if(h=="minExclusive")Uc.add(new IF(g as l));else if(h=="minInclusive")Uc.add(new IF(g as l));else if(h=="maxExclusive")Uc.add(new IF(g as l));else if(h=="maxInclusive")Uc.add(new IF(g as l));else if(h=="totalDigits")Uc.add(new IF(g as l));else if(h=="fractionDigits")Uc.add(new IF(g as l));else if(h=="length")Uc.add(new IF(g as l));else if(h=="minLength")Uc.add(new IF(g as l));else if(h=="maxLength")Uc.add(new IF(g as l));else if(h=="enumeration")Uc.add(new IF(g as l));else if(h=="pattern")Uc.add(new IF(g as l));else if(h=="group")sb=new GE(g as l,this,i);else if(h=="all")sb=new wJ(g as l,this,i);else if(h=="choice")sb=new UI(g as l,this,i);else if(h=="sequence")sb=new VI(g as l,this,i);else if(h=="attribute")pb.add(new kB(g as l,this,i));else if(h=="attributeGroup")pb.add(new mD(g as l,this,i));}}if(j.BC("base"))Ic=j.getAttribute("base");ob=j;this.Yb=k;}void CC(final YB g,final uB h){if(fb!=null)fb.CC(g,h);if(sb!=null)sb.CC(g,h);for(uB i in pb){if(i is kB)i.CC(g);else if(i is mD)i.CC(g,h);}if(Ic!=null){final String j=ob.bD(vB.dE(Ic));yb=g.aJ(vB.cE(Ic),j,h);}}List<EB> MD(){final List<EB> g=new List<EB>();if(sb!=null)g.addAll(sb.MD());return (g);}List<EB> bC(){final List<EB> g=new List<EB>();if(sb!=null)g.addAll(sb.bC());return (g);}List<EB> iC(){if(Yb is FG)return (Yb.iC());else return (new List<EB>());}String cD(){if(sb!=null)return (sb.cD());return (null);}bool UE(final EB g){if(sb!=null)return (sb.UE(g));return (null);}bool nD(final EB g){if(sb!=null)return (sb.nD(g));return (null);}List<String> iD(){List<String> g=null;for(IF h in Uc){if(h.cO()=="enumeration"){if(g==null)g=new List<String>();g.add(h.wF());}}return (g);}List<String> OD(){return (iD());}List<kB> attributes(){final List<kB> h=new List<kB>();for(uB i in pb){if(i is kB)h.add(i);else if(i is mD)h.addAll(i.attributes());}if(yb is lC){final List<kB> g=(yb as lC).attributes();final List<kB> m=new List<kB>();for(kB j in h){final String o=j.cC();final bool t=j.kR()=="prohibited";for(kB k in g)if(o==k.cC()){if(t)m.add(k);else g[g.indexOf(k)]=j;break;}}for(kB v in m)g.remove(v);return (g);}return (h);}int XE(final List<EB> h,final int g,final bool i){if(sb==null)return (g);return (sb.XE(h,g,i));}bool gD(){if(sb!=null)return (sb.gD());return (true);}bool ID(final String h){if(yb!=null){if(!yb.ID(h))return (false);}bool i=false;for(final IF g in Uc){if(g.cO()=="enumeration"){if(g.ID(h))return (true);i=true;}else if(g.cO()=="pattern"){if(g.ID(h))return (true);i=true;}else if(!g.ID(h))return (false);}if(i)return (false);return (true);}}class YB implements uB{List<uJ> Vc;List<xJ> Wc;List<qG> Xc;LinkedHashMap<String,kC> Yc;LinkedHashMap<String,lC> Zc;LinkedHashMap<String,GE> ac;LinkedHashMap<String,mD> bc;LinkedHashMap<String,EB> Vb;LinkedHashMap<String,kB> cc;String dc=null;String ec=null;String fc=null;String gc;vB hc;List<YB> Lb;YB ic;HashMap<String,String> Jb;YB(final l h,final String KB,final vB QB,final YB SB){this.gc=KB;this.hc=QB;this.ic=SB;Vc=new List<uJ>();Wc=new List<xJ>();Xc=new List<qG>();Yc=new LinkedHashMap<String,kC>();Zc=new LinkedHashMap<String,lC>();ac=new LinkedHashMap<String,GE>();bc=new LinkedHashMap<String,mD>();Vb=new LinkedHashMap<String,EB>();cc=new LinkedHashMap<String,kB>();Lb=new List<YB>();for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){String i=g.localName;if(i=="include")Vc.add(new uJ(g as l,this));else if(i=="import")Wc.add(new xJ(g as l,this));else if(i=="redefine"){final qG DB=new qG(g as l,this);Xc.add(DB);for(uB j in DB.IV()){if(j is kC){final kC k=j;Yc[k.cC()]=k;}else if(j is lC){final lC m=j;Zc[m.cC()]=m;}else if(j is GE){final GE o=j;ac[o.cC()]=o;}else if(j is mD){final mD t=j;bc[t.cC()]=t;}}}else if(i=="simpleType"){final kC k=new kC(g as l,null,this);Yc[k.cC()]=k;}else if(i=="complexType"){final lC m=new lC(g as l,null,this);Zc[m.cC()]=m;}else if(i=="group"){final GE o=new GE(g as l,null,this);ac[o.cC()]=o;}else if(i=="attributeGroup"){final mD t=new mD(g as l,null,this);bc[t.cC()]=t;}else if(i=="element"){final EB FB=new EB(g as l,null,this);Vb[FB.cC()]=FB;}else if(i=="attribute"){final kB HB=new kB(g as l,null,this);cc[HB.cC()]=HB;}}}if(h.BC("targetNamespace")){dc=h.getAttribute("targetNamespace");if(dc=="")dc=null;}if(h.BC("attributeFormDefault"))ec=h.getAttribute("attributeFormDefault");if(h.BC("elementFormDefault"))fc=h.getAttribute("elementFormDefault");Jb=new HashMap<String,String>();if(h.attributes!=null){for(oC v in h.attributes.values){if(v.name.startsWith("xmlns:")){final String bB=v.name.substring(6);Jb[v.value]=bB;}}}}Future Ob(){List<Future> g=new List<Future>();for(uJ h in Vc)g.add(h.Ob(this));for(xJ i in Wc)g.add(i.Ob(this));for(qG j in Xc)g.add(j.Ob(this));return (Future.wait(g));}Iterable<EB> eO(){return (Vb.values);}Iterable<kB> NV(){return (cc.values);}String LE(){return (dc);}String wU(){return (ec);}String zU(){return (fc);}String OV(){return (gc);}Future<YB> tO(final String i,final String j,final YB k){Completer h=new Completer();hc.Rb(gc,i,j,k).then((YB g){if(g!=null&&!Lb.contains(g))Lb.add(g);h.complete(g);},onError:(lF m){h.completeError(m);});return (h.future);}void Pb(){for(kC g in Yc.values)g.CC(this,g.getParent() is qG?g:null);for(lC h in Zc.values)h.CC(this,h.getParent() is qG?h:null);for(GE i in ac.values)i.CC(this,i.getParent() is qG?i:null);for(mD j in bc.values)j.CC(this,j.getParent() is qG?j:null);for(EB k in Vb.values)k.CC(this,null);for(kB m in cc.values)m.CC(this);}String iG(final String g){return (Jb[g]);}String nV(final String g){if(g==null)return (null);for(String h in Jb.keys){if(g==Jb[h])return (h);}return (null);}List<EB> MD(){final List<EB> g=new List<EB>();for(lC h in Zc.values)g.addAll(h.MD());for(GE i in ac.values)g.addAll(i.MD());for(EB j in Vb.values)g.addAll(j.MD());return (g);}List<EB> UU(final String g){return (hc.Tb(g,dc));}EB ES(final String g,final String h){return (jc(g,h,null,null,'WXSElement') as EB);}ZG aJ(final String g,final String h,final uB i){return (jc(g,h,null,i,'WXSType') as ZG);}GE yV(final String g,final String h,final uB i){return (jc(g,h,null,i,'WXSGroup') as GE);}mD wV(final String g,final String h,final uB i){return (jc(g,h,null,i,'WXSAttributeGroup') as mD);}kB xV(final String g,final String h){return (jc(g,h,null,null,'WXSAttribute') as kB);}uB jc(final String i,final String m,final HashSet<YB> j,final uB o,final String k){if(i==null)return (null);HashSet<YB> h=null;if(ic!=null&&(j==null||!j.contains(ic))){if(h==null){if(j==null)h=new HashSet<YB>();else h=j;h.add(this);}final uB g=ic.jc(i,m,h,o,k);if(g!=null)return (g);}if((m==null&&dc==null)||(m!=null&&m==dc)){uB g;if(k=='WXSElement')g=Vb[i];else if(k=='WXSType'){g=Zc[i];if(g!=null&&g!=o)return (g);g=Yc[i];}else if(k=='WXSGroup')g=ac[i];else if(k=='WXSAttributeGroup')g=bc[i];else if(k=='WXSAttribute')g=cc[i];else g=null;if(g!=null&&g!=o)return (g);}for(YB t in Lb){if(j==null||!j.contains(t)){if(h==null){if(j==null)h=new HashSet<YB>();else h=j;h.add(this);}final uB g=t.jc(i,m,h,o,k);if(g!=null)return (g);}}return (null);}String YD(final EB g){return (hc.Ub(g));}}class NN extends HE{String Lc=null;NN(final l g){if(g.BC("xpath"))Lc=g.getAttribute("xpath");}}class VI extends dL{VI(final l g,final uC h,final YB i){qb(g,h,i);}int XE(final List<EB> j,final int k,final bool m){int i=0;for(int g=k;g<j.length;){if(i>=Xb)return (g);int h=g;for(VD o in rb){int t=o.XE(j,h,m);if(t==h){if(!m&&!o.gD()){if(i<Wb)return (k);return (g);}}h=t;}if(h==g)return (g);g=h;i++ ;}if(!m&&i<Wb)return (k);return (j.length);}bool gD(){if(Wb==0)return (true);for(VD g in rb){if(!g.gD())return (false);}return (true);}}class cL extends HE{pG kc=null;mF lc=null;cL(final l h,final YB i){Zb(h);for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="restriction")kc=new pG(g as l,null,i);else if(g.localName=="extension")lc=new mF(g as l,null,i);}}}void CC(final YB g,final uB h){if(kc!=null)kc.CC(g,h);else if(lc!=null)lc.CC(g,h);}List<String> iD(){if(kc!=null)return (kc.iD());else if(lc!=null)return (lc.iD());return (null);}List<String> OD(){if(kc!=null)return (kc.OD());else if(lc!=null)return (lc.OD());return (null);}List<kB> attributes(){if(kc!=null)return (kc.attributes());else if(lc!=null)return (lc.attributes());return (new List<kB>());}bool ID(final String g){if(kc!=null)return (kc.ID(g));if(lc!=null)return (lc.ID(g));return (false);}}class kC extends HE implements ZG{pG kc=null;ON mc=null;PN nc=null;String gb=null;uC Yb;YB Fb;kC(final l h,final uC j,final YB i){Zb(h);for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l){if(g.localName=="restriction")kc=new pG(g as l,null,i);else if(g.localName=="list")mc=new ON(g as l,i);else if(g.localName=="union")nc=new PN(g as l,i);}}if(h.BC("name"))gb=h.getAttribute("name");this.Yb=j;this.Fb=i;}String cC(){return (gb);}String eF(){return (Fb.LE());}uC getParent(){return (Yb);}void CC(final YB g,final uB h){if(kc!=null)kc.CC(g,h);if(mc!=null)mc.CC(g,h);if(nc!=null)nc.CC(g,h);}List<String> iD(){if(kc!=null)return (kc.iD());if(nc!=null)return (nc.iD());return (null);}List<String> OD(){if(kc!=null)return (kc.OD());if(nc!=null)return (nc.OD());return (null);}bool ID(final String g){if(kc!=null)return (kc.ID(g));if(mc!=null)return (mc.ID(g));if(nc!=null)return (nc.ID(g));return (false);}static bool yJ(final String h,final String g){if(h=="string")return (true);else if(h=="normalizedString")return (WC(g,"[^\\t\\r\\n]*"));else if(h=="token"){if(g.indexOf('\n')!=-1||g.indexOf('\r')!=-1||g.indexOf('\t')!=-1||g.indexOf("  ")!=-1)return (false);return (!g.startsWith(" ")&&!g.endsWith(" "));}else if(h=="base64Binary")return (WC(g,"(([a-zA-Z0-9+/=]\\s?){4})*"));else if(h=="hexBinary")return (WC(g,"(([0-9a-fA-F]){2})*"));else if(h=="integer")return (WC(g,"[+\\-]?\\d+"));else if(h=="positiveInteger")return (WC(g,"\\+?0*[1-9]\\d*"));else if(h=="negativeInteger")return (WC(g,"-0*[1-9]\\d*"));else if(h=="nonNegativeInteger")return (WC(g,"(-0+)|(\\+?\\d+)"));else if(h=="nonPositiveInteger")return (WC(g,"(\\+?0+)|(-\\d+)"));else if(h=="long"){if(!WC(g,"[+\\-]?\\d+"))return (false);try {final int m=int.parse(g);final int o=int.parse("9223372036854775807");final int v=int.parse("-9223372036854775808");if(m.compareTo(o)>0)return (false);if(m.compareTo(v)<0)return (false);return (true);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="unsignedLong"){if(!WC(g,"\\d+"))return (false);try {final int m=int.parse(g);final int o=int.parse("18446744073709551615");return (m.compareTo(o)<=0);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="int"){if(!WC(g,"[+\\-]?\\d+"))return (false);String k=g;if(k.startsWith("+"))k=k.substring(1);try {final int i=int.parse(k);return (i<=2147483647&&i>=-2147483648);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="unsignedInt"){if(!WC(g,"\\d+"))return (false);try {final int i=int.parse(g);return (i<=4294967295&&i>=0);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="short"){if(!WC(g,"[+\\-]?\\d+"))return (false);String k=g;if(k.startsWith("+"))k=k.substring(1);try {final int i=int.parse(k);return (i<=32767&&i>=-32768);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="unsignedShort"){if(!WC(g,"\\d+"))return (false);try {final int i=int.parse(g);return (i<=65535&&i>=0);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="byte"){if(!WC(g,"[+\\-]?\\d+"))return (false);String k=g;if(k.startsWith("+"))k=k.substring(1);try {final int i=int.parse(k);return (i<=127&&i>=-128);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="unsignedByte"){if(!WC(g,"\\d+"))return (false);try {final int i=int.parse(g);return (i<=255&&i>=0);}on FormatException catch (j){print("validerValeur(String, String) - FormatException ${j}");return (false);}}else if(h=="decimal"){return (WC(g,"[+\\-]?\\d+\\.?\\d*"));}else if(h=="float"){if(!WC(g,"(-?INF)|(NaN)|([+\\-]?\\d+\\.?\\d*([eE][+\\-]?\\d{1,3})?)"))return (false);if(g=="INF"||g=="-INF")return (true);try {double t=double.parse(g);if(DD.log(t.abs())/LN2>127)return (false);if(DD.log(t.abs())/LN2<-126)return (false);return (true);}on FormatException {return (false);}}else if(h=="double"){if(!WC(g,"(-?INF)|(NaN)|([+\\-]?\\d+\\.?\\d*([eE][+\\-]?\\d{1,3})?)"))return (false);if(g=="INF"||g=="-INF")return (true);try {double.parse(g);return (true);}on FormatException {return (false);}}else if(h=="boolean")return (WC(g,"(true)|(false)|1|0"));else if(h=="duration")return (WC(g,"-?P(\\d{1,4}Y)?(\\d{1,2}M)?(\\d{1,2}D)?(T(\\d{1,2}H)?(\\d{1,2}M)?(\\d{1,2}(\\.\\d+)?S)?)?"));else if(h=="dateTime")return (WC(g,"-?\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d(\\.\\d+)?(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="date")return (WC(g,"-?\\d{4}-[01]\\d-[0-3]\\d(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="time")return (WC(g,"[0-2]\\d:[0-5]\\d:[0-5]\\d(\\.\\d+)?(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="gYear")return (WC(g,"-?\\d{4}(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="gYearMonth")return (WC(g,"-?\\d{4}-[01]\\d(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="gMonth")return (WC(g,"--[01]\\d(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="gMonthDay")return (WC(g,"--[01]\\d-[0-3]\\d(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="gDay")return (WC(g,"---[0-3]\\d(([+\\-][01]\\d:\\d{2})|Z)?"));else if(h=="Name")return (WC(g,"[^<>&#!/?'\",0-9.\\-\\s][^<>&#!/?'\",\\s]*"));else if(h=="QName")return (WC(g,"[^<>&#!/?'\",0-9.\\-\\s][^<>&#!/?'\",\\s]*"));else if(h=="NCName")return (WC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:\\s]*"));else if(h=="anyURI")return (true);else if(h=="language")return (WC(g,"[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*"));else if(h=="ID")return (WC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:\\s]*"));else if(h=="IDREF")return (WC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:\\s]*"));else if(h=="IDREFS")return (WC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:]*"));else if(h=="ENTITY")return (WC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:\\s]*"));else if(h=="ENTITIES")return (WC(g,"[^<>&#!/?'\",0-9.\\-\\s:][^<>&#!/?'\",:]*"));else if(h=="NOTATION")return (WC(g,"[^0-9.\\-\\s][^\\s]*(\\s[^0-9.\\-\\s][^\\s]*)*"));else if(h=="NMTOKEN")return (WC(g,"[^<>&#!/?'\",\\s]+"));else if(h=="NMTOKENS")return (WC(g,"[^<>&#!/?'\",]+"));else return (true);}static bool WC(final String g,final String h){final RegExp i=new RegExp("^(${h})\$");return (i.hasMatch(g));}}abstract class uB{}abstract class ZG{String cC();String eF();uC getParent();void CC(final YB g,final uB h);List<String> iD();List<String> OD();bool ID(final String g);}class PN extends HE{List<kC> Yc;List<String> oc=null;l ob;List<kC> qc;PN(final l h,final YB i){Zb(h);Yc=new List<kC>();for(BB g=h.firstChild;g!=null;g=g.nextSibling){if(g is l&&g.localName=="simpleType")Yc.add(new kC(g as l,null,i));}if(h.BC("memberTypes"))oc=(h.getAttribute("memberTypes")).split(new RegExp(r"\s+"));ob=h;qc=null;}void CC(final YB h,final uB i){for(kC o in Yc)o.CC(h,i);if(oc!=null){qc=new List<kC>(oc.length);for(int g=0;g<oc.length;g++ ){final String j=oc[g];final String k=ob.bD(vB.dE(j));final ZG m=h.aJ(vB.cE(j),k,i);if(m is kC)qc[g]=m;else{qc[g]=null;final String t=ob.tB;if(t!=k)oc[g]=null;}}}}List<String> iD(){final List<String> g=new List<String>();if(oc!=null){for(int h=0;h<oc.length;h++ ){if(qc[h]!=null){final List<String> i=qc[h].iD();if(i==null)return (null);g.addAll(i);}else{final String j=oc[h];final String m=ob.bD(vB.dE(j));final String o=ob.tB;if(o==m){final List<String> i=vB.rG(j,ob);if(i==null)return (null);g.addAll(i);}}}}for(kC t in Yc){final List<String> k=t.iD();if(k==null)return (null);g.addAll(k);}if(g.length==0)return (null);return (g);}List<String> OD(){final List<String> g=new List<String>();if(oc!=null){for(int h=0;h<oc.length;h++ ){if(qc[h]!=null){final List<String> i=qc[h].iD();if(i!=null)g.addAll(i);}else{final String j=oc[h];final String m=ob.bD(vB.dE(j));final String o=ob.tB;if(o==m){final List<String> i=vB.rG(j,ob);if(i!=null)g.addAll(i);}}}}for(kC t in Yc){final List<String> k=t.iD();if(k!=null)g.addAll(k);}if(g.length==0)return (null);return (g);}bool ID(final String h){if(oc!=null){for(int g=0;g<oc.length;g++ ){if(qc[g]!=null){if(qc[g].ID(h))return (true);}else if(oc[g]!=null){if(kC.yJ(vB.cE(oc[g]),h))return (true);}}}for(final kC i in Yc){if(i.ID(h))return (true);}return (false);}}class zP extends MN{zP(final l g){qb(g);}}abstract class oC extends BB{String name;String value;bool AL;l TH;bool kO;}class BK extends GG implements oC{bool AL;l TH;bool kO;BK(final AC g,final String h){AL=true;TH=null;kO=false;nodeName=h;nodeValue=null;nodeType=BB.FQ;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;tB=null;EC=null;localName=null;}BK.bY(final AC h,final String i,final String j){AL=true;TH=null;kO=false;nodeName=j;nodeValue=null;nodeType=BB.FQ;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=h;this.tB=i;int g=name.indexOf(":");if(g!=-1){EC=name.substring(0,g);localName=name.substring(g+1);}else{EC=null;localName=name;}}String get name{return (nodeName);}void set name(String g){nodeName=g;}String get value{return (nodeValue);}void set value(String g){nodeValue=g;}String toString(){return ('${nodeName}="${GG.NQ(nodeValue)}"');}}abstract class gL extends zJ{}class UN extends GG implements gL{UN(final AC g,final String h){nodeName="#cdata-section";nodeValue=h;nodeType=BB.CK;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;tB=null;EC=null;localName=null;}String toString(){String g=nodeValue;if(g==null)g='';return ("<![CDATA[${g}]]>");}}abstract class fL extends BB{}class TN extends GG implements fL{TN(final AC g,final String h){nodeName="#comment";nodeValue=h;nodeType=BB.EK;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;tB=null;EC=null;localName=null;}String toString(){return ("<!--${nodeValue}-->");}}abstract class AC extends BB{hH implementation;l documentElement;String hO;String yF;bool RS;String UG;String OR;fH jK;l createElement(String g);QN createDocumentFragment();zJ vG(String g);fL LR(String g);gL KR(String g);eL NR(String g,String h);List<BB> getElementsByTagName(String g);l createElementNS(String g,String h);BB adoptNode(BB g);}abstract class QN extends BB{}class EQ extends GG implements QN{EQ(final AC g){nodeName="#document-fragment";nodeValue=null;nodeType=BB.mT;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;tB=null;EC=null;localName=null;}String toString(){StringBuffer g=new StringBuffer();for(BB h in childNodes){g.write(h.toString());}return (g.toString());}}class RN extends GG implements AC{hH implementation;l documentElement;String hO;String yF;bool RS;String UG;String OR;fH jK;HashMap<String,l> rc;RN(final hH i,final String h,final String g,final fH j){this.implementation=i;hO=null;yF="UTF-8";RS=false;UG="1.0";OR=null;this.jK=j;rc=new HashMap<String,l>();nodeName="#document";nodeValue=null;nodeType=BB.GK;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=null;this.tB=null;EC=null;localName=null;if(g!=null){if(h!=null)documentElement=new bG.cY(this,h,g);else documentElement=new bG(this,g);documentElement.parentNode=this;}}l createElement(String g){return (new bG(this,g));}QN createDocumentFragment(){return (new EQ(this));}zJ vG(String g){return (new hL(this,g));}fL LR(String g){return (new TN(this,g));}gL KR(String g){return (new UN(this,g));}eL NR(String g,String h){return (new SN(this,g,h));}List<BB> getElementsByTagName(String h){List<BB> i=new List<BB>();for(BB g in childNodes){if(h=='*'||g.nodeName==h)i.add(g);if(g is l)i.addAll(g.getElementsByTagName(h));}return (i);}l createElementNS(String g,String h){return (new bG.cY(this,g,h));}BB adoptNode(BB g){if(g.nodeType==BB.GK||g.nodeType==BB.iL||g.nodeType==BB.HQ||g.nodeType==BB.LQ)throw new eD("NOT_SUPPORTED_ERR");if(g.parentNode!=null){g.parentNode.CD(g);}if(g is oC){oC h=g;h.TH=null;h.AL=true;}sc(g);return (g);}void sc(BB g){g.ownerDocument=this;if(g.attributes!=null){List<String> j=new List<String>();for(oC i in g.attributes.values){if(i.AL)i.ownerDocument=this;else j.add(i.name);}for(String k in j){g.attributes.remove(k);}}if(g.childNodes!=null){for(BB h in g.childNodes){if(h.nodeType!=BB.iL&&h.nodeType!=BB.HQ&&h.nodeType!=BB.LQ)sc(h);}}}String toString(){StringBuffer g=new StringBuffer();g.write("<?xml");if(UG!=null)g.write(' version="${UG}"');if(yF!=null)g.write(' encoding="${yF}"');g.writeln("?>");if(jK!=null)g.write(jK.toString());for(BB h in childNodes){g.write(h.toString());}return (g.toString());}}abstract class fH extends BB{String name;String rI;String fJ;}class DQ extends GG implements fH{String name;String rI;String fJ;DQ(final String g,final String h,final String i){name=g;this.rI=h;this.fJ=i;nodeName=g;nodeValue=null;nodeType=BB.iL;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=null;tB=null;EC=null;localName=null;}String toString(){if(rI==null&&fJ!=null)return ('<!DOCTYPE ${name} SYSTEM "${fJ}">');if(rI!=null&&fJ!=null)return ('<!DOCTYPE ${name} PUBLIC "${rI}" "${fJ}">');if(rI!=null)return ('<!DOCTYPE ${name} PUBLIC "${rI}">');return ('<!DOCTYPE ${name}>');}}class eD implements Exception{final String message;final int errorCode;const eD(this.message,{this.errorCode});String toString(){String g="DOMException";if(message!=null)g+= ": ${message}";if(errorCode!=null)g+= ": ${errorCode}";return (g);}}abstract class hH{AC createDocument(String g,String h,fH i);}class AK implements hH{AK();AC createDocument(String g,String h,fH i){return (new RN(this,g,h,i));}}class gH{Future<AC> xO(String g,{bool disableCache: true}){Completer<AC> i=new Completer<AC>();HttpRequest h=new HttpRequest();if(disableCache){if(!g.contains('.php?')){Random m=new Random();String j="random_workaround=${m.nextDouble()}";if(g.contains('?'))g="${g}&${j}";else g="${g}?${j}";}}h.open('GET',g);h.onLoad.listen((ProgressEvent o){if(h.status!=200){i.completeError(new eD("Error reading ${g}",errorCode:h.status));return;}AC k;if(h.responseText==null){i.completeError(new eD("Error reading ${g}"));return;}try {k=parseFromString(h.responseText);}on eD catch (t){i.completeError(new eD("Error reading ${g}: ${t.message}"));return;}i.complete(k);});h.onError.listen((ProgressEvent o){i.completeError(new eD("Error reading ${g}"));});h.send();return (i.future);}AC parseFromString(String g){ZN h=new ZN();try {return (h.yO(g));}on Exception catch (i){throw new eD(i.toString());}}}abstract class l extends BB{String tagName;String getAttribute(String g);void setAttribute(String g,String h);oC LM(String g);oC HS(oC g);List<BB> getElementsByTagName(String g);void setAttributeNS(String g,String h,String i);oC MM(String g,String h);bool BC(String g);}class bG extends GG implements l{String tagName;bG(final AC h,final String g){this.tagName=g;nodeName=g;nodeValue=null;nodeType=BB.zE;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=h;tB=null;EC=null;localName=null;}bG.cY(final AC i,final String j,final String g){tagName=g;nodeName=g;nodeValue=null;nodeType=BB.zE;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=i;this.tB=j;int h=g.indexOf(":");if(h!=-1){EC=g.substring(0,h);localName=g.substring(h+1);}else{EC=null;localName=g;}}String getAttribute(String i){if(attributes==null)return ("");oC g=attributes[i];if(g==null)return ("");String h=g.nodeValue;if(h==null)return ("");return (h);}void setAttribute(String h,String i){if(attributes==null)attributes=new LinkedHashMap<String,oC>();oC g=attributes[h];if(g==null){g=new BK(ownerDocument,h);g.parentNode=this;g.TH=this;attributes[h]=g;}g.nodeValue=i;}oC LM(String g){if(attributes==null)return (null);return (attributes[g]);}oC HS(oC g){if(ownerDocument!=g.ownerDocument)throw new eD("WRONG_DOCUMENT_ERR");if(attributes==null)attributes=new LinkedHashMap<String,oC>();g.parentNode=this;g.TH=this;attributes[g.name]=g;return (g);}List<BB> getElementsByTagName(String i){List<BB> g=new List<BB>();if(childNodes==null)return (g);for(BB h in childNodes){if(i=='*'||h.nodeName==i)g.add(h);if(h is l)g.addAll(h.getElementsByTagName(i));}return (g);}void setAttributeNS(String m,String h,String o){if(attributes==null)attributes=new LinkedHashMap<String,oC>();String i,j;int k=h.indexOf(":");if(k!=-1){i=h.substring(0,k);j=h.substring(k+1);}else{i=null;j=h;}oC g=MM(m,j);if(g!=null){g.EC=i;g.nodeValue=o;return;}g=new BK.bY(ownerDocument,m,h);g.parentNode=this;g.TH=this;g.nodeValue=o;attributes[h]=g;}oC MM(String h,String i){if(attributes==null)return (null);for(oC g in attributes.values){if(g.tB==h&&g.localName==i){return (g);}}return (null);}bool BC(String g){if(attributes==null)return (false);return (attributes[g]!=null);}String toString(){StringBuffer g=new StringBuffer();g.write("<${tagName}");if(attributes!=null){for(oC h in attributes.values){g.write(" ");g.write(h.toString());}}if(childNodes!=null&&childNodes.length>0){g.write(">");for(BB i in childNodes){g.write(i.toString());}g.write("</${tagName}>");}else{g.write("/>");}return (g.toString());}}abstract class jT extends BB{}class VN extends GG implements jT{VN(final AC g,final String h){nodeName=h;nodeValue=null;nodeType=BB.GQ;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;tB=null;EC=null;localName=null;}String toString(){return ("&${nodeName};");}}abstract class BB{static const int zE=1;static const int FQ=2;static const int nF=3;static const int CK=4;static const int GQ=5;static const int HQ=6;static const int DK=7;static const int EK=8;static const int GK=9;static const int iL=10;static const int mT=11;static const int LQ=12;String nodeName;String nodeValue;int nodeType;BB parentNode;List<BB> childNodes;BB firstChild;BB lastChild;BB previousSibling;BB nextSibling;LinkedHashMap<String,oC> attributes;AC ownerDocument;String tB;String EC;String localName;BB insertBefore(BB g,BB h);BB CD(BB g);BB mB(BB g);bool hasChildNodes();String oO(String g);String bD(String g);}abstract class GG implements BB{static const int iH=1;static const int YN=2;static const int IQ=6;static const int oF=9;static const int JQ=10;static const int KQ=11;static const int MQ=12;String nodeName;String nodeValue;int nodeType;BB parentNode;List<BB> childNodes;BB firstChild;BB lastChild;BB previousSibling;BB nextSibling;LinkedHashMap<String,oC> attributes;AC ownerDocument;String tB;String EC;String localName;BB insertBefore(BB g,BB h){if(childNodes==null||!childNodes.contains(h))throw new eD("NOT_FOUND_ERR");tc(g);if(nodeType==oF&&g.nodeType==iH&&(this as AC).documentElement!=null)throw new eD("HIERARCHY_REQUEST_ERR");if(childNodes==null)childNodes=new List<BB>();if(g.parentNode!=null)g.parentNode.CD(g);g.parentNode=this;if(nodeType==oF&&g.nodeType==iH)(this as AC).documentElement=g;if(firstChild==h)firstChild=g;g.nextSibling=h;g.previousSibling=h.previousSibling;return (g);}BB CD(BB g){if(childNodes==null||!childNodes.contains(g))throw new eD("NOT_FOUND_ERR");if(nodeType==oF&&g.nodeType==iH)(this as AC).documentElement=null;if(firstChild==g)firstChild=g.nextSibling;if(lastChild==g)lastChild=g.previousSibling;if(g.previousSibling!=null)g.previousSibling.nextSibling=g.nextSibling;if(g.nextSibling!=null)g.nextSibling.previousSibling=g.previousSibling;g.parentNode=null;childNodes.remove(g);return (g);}BB mB(BB g){tc(g);if(nodeType==oF&&g.nodeType==iH&&(this as AC).documentElement!=null)throw new eD("HIERARCHY_REQUEST_ERR");if(childNodes==null)childNodes=new List<BB>();if(g.parentNode!=null)g.parentNode.CD(g);g.parentNode=this;if(nodeType==oF&&g.nodeType==iH)(this as AC).documentElement=g;g.nextSibling=null;if(firstChild==null){g.previousSibling=null;firstChild=g;lastChild=g;}else{lastChild.nextSibling=g;g.previousSibling=lastChild;lastChild=g;}childNodes.add(g);return (g);}bool hasChildNodes(){return (firstChild!=null);}String oO(String g){if(g==null||g==''){return (null);}switch (nodeType){case iH:return (uc(g));case oF:return (((this as AC).documentElement as bG).uc(g));case IQ:case MQ:case KQ:case JQ:return (null);case YN:if((this as oC).TH!=null){return (((this as oC).TH as bG).uc(g));}return null;default:if(parentNode!=null){return ((parentNode as bG).uc(g));}return (null);}}uc(final String g){final RegExp i=new RegExp(r"/^xmlns:(.*)$/");if(g!=null&&this.tB==g&&EC!=null&&bD(EC)==g){return (EC);}if(attributes!=null){for(oC h in attributes.values){if(i.hasMatch(h.name)&&h.value==g&&bD(h.localName)==g){return (localName);}}}if(parentNode!=null){return ((parentNode as bG).uc(g));}return null;}String bD(String h){switch (nodeType){case iH:if(tB!=null&&this.EC==h){return (tB);}if(attributes!=null){for(oC g in attributes.values){if(g.EC=='xmlns'&&g.localName==h){if(g.value!=null&&g.value!=''){return (g.value);}return (null);}else if(g.localName=='xmlns'&&h==null){if(g.value!=null&&g.value!=''){return (g.value);}return (null);}}}if(parentNode!=null&&parentNode.nodeType!=oF){return parentNode.bD(h);}return null;case oF:return ((this as AC).documentElement.bD(h));case IQ:case MQ:case JQ:case KQ:return (null);case YN:if(parentNode!=null)return (parentNode.bD(h));return (null);default:if(parentNode!=null)return (parentNode.bD(h));return (null);}}tc(BB g){if(nodeType!=oF&&ownerDocument!=g.ownerDocument)throw new eD("WRONG_DOCUMENT_ERR");if(nodeType==oF&&this!=g.ownerDocument)throw new eD("WRONG_DOCUMENT_ERR");if(nodeType!=iH&&nodeType!=oF)throw new eD("HIERARCHY_REQUEST_ERR");if(g.nodeType==oF)throw new eD("HIERARCHY_REQUEST_ERR");if(nodeType!=oF&&g.nodeType==YN)throw new eD("HIERARCHY_REQUEST_ERR");BB h=this;while(h!=null){if(g==h)throw new eD("HIERARCHY_REQUEST_ERR");h=h.parentNode;}}static String NQ(String g){g=g.replaceAll('&','&amp;');g=g.replaceAll('"','&quot;');g=g.replaceAll('<','&lt;');g=g.replaceAll('>','&gt;');return (g);}}class FK{List<sB> rules;HashMap<String,bool> bM;FK(this.rules){for(sB g in rules)g.mK=this;}List<MC> yO(String i){List<MC> j=new List<MC>();bM=new HashMap<String,bool>();int g=0;while(g<i.length){int k=g;for(sB m in rules){RC h=m.LG(i,g);if(h==null)continue;g+= h.RG;if(h.WH.length>0){assert(h.RG!=0);j.addAll(h.WH);break;}}if(k==g){throw new eD("parser blocking at character ${g}: ${i.substring(g,DD.min(g+10,i.length))}");}}return (j);}List<MC> lV(List<MC> i){List<MC> j=new List<MC>();bM=new HashMap<String,bool>();int g=0;while(g<i.length){int k=g;for(sB m in rules){RC h=m.MG(i,g);if(h==null)continue;g+= h.RG;if(h.WH.length>0){assert(h.RG!=0);j.addAll(h.WH);break;}}if(k==g){throw new eD("parser blocking at character ${i[g].position}");}}return (j);}bool FR(sB h){if(h.conditions==null)return (true);bool j=false;for(xE i in h.conditions){bool g=bM[i.name];if(g==null)g=false;if(g!=i.value)return (false);}return (true);}void ER(sB g){if(g.changes==null)return;for(rD h in g.changes){bM[h.name]=h.value;}}}class RC{int RG;String hK;List<MC> WH;RC.QY(this.RG,this.hK);RC.TY(this.RG,this.WH);}class rD{String name;bool value;rD(this.name,this.value);}class xE{String name;bool value;xE(this.name,this.value);}class MC{String id;String DE;List<MC> fC;Object data;int position;MC.SY(this.id,this.DE,this.position);MC.VY(this.id,this.fC,this.position);String toString(){StringBuffer g=new StringBuffer();g.write("[${id}");if(DE!=null)g.write(" ${DE}");else{for(MC h in fC){g.write(' ');g.write(h);}}g.write(']');return (g.toString());}}class mC extends yE{String sF=null;bool sR=false;bool tR=false;bool UV=false;List<String> WO=null;mC(this.sF);mC.WY(){sR=true;}mC.YY(){tR=true;}mC.aY(this.WO);RC LG(String i,int h){String g=i[h];if(sF!=null){if(g==sF)return (new RC.QY(1,g));}else if(sR){if('0123456789'.contains(g)){return (new RC.QY(1,g));}}else if(tR){if('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'.contains(g))return (new RC.QY(1,g));}else if(UV){return (new RC.QY(1,g));}else if(WO!=null){for(String j in WO){if(h+j.length<=i.length&&j==i.substring(h,h+j.length))return (null);}return (new RC.QY(1,g));}return (null);}RC MG(List<MC> g,int h){return (null);}}class aG extends yE{List<yE> items;aG(this.items);RC LG(String h,int i){for(yE j in items){RC g=j.LG(h,i);if(g!=null)return (g);}return (null);}RC MG(List<MC> h,int i){for(yE j in items){RC g=j.MG(h,i);if(g!=null)return (g);}return (null);}}class xC extends yE{String id;xC(this.id);RC LG(String g,int h){return (null);}RC MG(List<MC> g,int h){if(g[h].id==id)return (new RC.TY(1,[g[h]]));else return (null);}}abstract class yE{RC LG(String g,int h);RC MG(List<MC> g,int h);}class OE extends yE{static const int WN=0;static const int XN=1;static const int lT=2;int repeat;yE item;OE.UY(this.item){repeat=WN;}OE.XY(this.item){repeat=XN;}OE.ZY(this.item){repeat=lT;}RC LG(String j,int k){if(repeat==WN){RC g=item.LG(j,k);if(g==null)return (new RC.QY(0,''));else return (g);}StringBuffer h=null;int i=k;while(i<j.length){RC g=item.LG(j,i);if(g==null)break;if(h==null)h=new StringBuffer();h.write(g.hK);i=i+g.RG;}int o=i-k;if(o>0||repeat==XN){String m;if(h!=null)m=h.toString();else m='';return (new RC.QY(o,m));}else return (null);}RC MG(List<MC> i,int j){if(repeat==WN){RC g=item.MG(i,j);if(g==null)return (new RC.TY(0,new List<MC>()));else return (g);}List<MC> k=new List<MC>();int h=j;while(h<i.length){RC g=item.MG(i,h);if(g==null)break;k.addAll(g.WH);h=h+g.RG;}int m=h-j;if(m>0||repeat==XN)return (new RC.TY(m,k));else return (null);}}typedef void kT(_0);class sB extends yE{String id;List<xE> conditions;List<rD> changes;yE content;bool ignore;kT action;FK mK;sB(this.id,this.content,{this.conditions: null,this.changes: null,this.ignore: false,this.action: null});RC LG(String m,int j){if(!mK.FR(this))return (null);RC g=content.LG(m,j);if(g==null)return (null);MC h=new MC.SY(id,g.hK,j);if(action!=null)action(h);mK.ER(this);List<MC> i;if(ignore)i=new List<MC>();else i=[h];RC k=new RC.TY(g.RG,i);if(!ignore)k.hK=h.DE;return (k);}RC MG(List<MC> j,int k){if(!mK.FR(this))return (null);RC g=content.MG(j,k);if(g==null)return (null);MC i=new MC.VY(id,g.WH,g.WH[0].position);if(action!=null)action(i);mK.ER(this);List<MC> h;if(ignore)h=new List<MC>();else h=[i];RC m=new RC.TY(g.RG,h);return (m);}String toString(){return (id);}}class GD extends yE{List<yE> items;GD(this.items);GD.RY(String h){items=new List<yE>();for(int g=0;g<h.length;g++ )items.add(new mC(h[g]));}RC LG(String k,int m){StringBuffer g=null;int h=m;for(yE o in items){if(h>=k.length)return (null);RC i=o.LG(k,h);if(i==null)return (null);if(g==null)g=new StringBuffer();g.write(i.hK);h=h+i.RG;}int t=h-m;String j;if(g!=null)j=g.toString();else j='';return (new RC.QY(t,j));}RC MG(List<MC> i,int j){List<MC> k=new List<MC>();int g=j;for(yE m in items){if(g>=i.length)return (null);RC h=m.MG(i,g);if(h==null)return (null);k.addAll(h.WH);g=g+h.RG;}int o=g-j;return (new RC.TY(o,k));}}class ZN{List<sB> aD;List<sB> iF;AC rE;ZN(){vc();}vc(){aD=new List<sB>();xE v=new xE('in_tag',true);aD.add(new sB('CDATA_SECTION_OPEN',new GD.RY('<![CDATA['),conditions:[new xE('in_cdata_section',false)],changes:[new rD('in_cdata_section',true)]));aD.add(new sB('CDATA_SECTION_DATA',new OE.ZY(new mC.aY([']]>'])),conditions:[new xE('in_cdata_section',true)]));aD.add(new sB('CDATA_SECTION_CLOSE',new GD.RY(']]>'),conditions:[new xE('in_cdata_section',true)],changes:[new rD('in_cdata_section',false)]));aD.add(new sB('COMMENT_OPEN',new GD.RY('<!--'),changes:[new rD('in_comment',true)]));aD.add(new sB('COMMENT_CLOSE',new GD.RY('-->'),conditions:[new xE('in_comment',true)],changes:[new rD('in_comment',false)]));aD.add(new sB('COMMENT_DATA',new OE.ZY(new mC.aY(['-->'])),conditions:[new xE('in_comment',true)]));aD.add(new sB('DOC_DECL_OPEN',new GD.RY('<?xml'),changes:[new rD('in_tag',true),new rD('in_decl',true)]));aD.add(new sB('DOC_DECL_CLOSE',new GD.RY('?>'),conditions:[new xE('in_decl',true)],changes:[new rD('in_tag',false),new rD('in_decl',false)]));aD.add(new sB('DOCTYPE_OPEN',new GD.RY('<!DOCTYPE'),changes:[new rD('in_tag',true),new rD('in_doctype',true)]));aD.add(new sB('DOCTYPE_CLOSE',new GD.RY('>'),conditions:[new xE('in_doctype',true)],changes:[new rD('in_tag',false),new rD('in_doctype',false)]));aD.add(new sB('PI_OPEN',new GD.RY('<?'),changes:[new rD('in_pi',true)]));yE eM=new aG([new mC.YY(),new mC('_'),new mC(':')]);yE KD=new aG([new mC.YY(),new mC.WY(),new mC('.'),new mC('-'),new mC('_'),new mC(':')]);aD.add(new sB('PI_TARGET',new GD([eM,new OE.XY(KD)]),conditions:[new xE('in_pi',true),new xE('pi_after_target',false)],changes:[new rD('pi_after_target',true)]));aD.add(new sB('PI_DATA',new OE.ZY(new mC.aY(['?>'])),conditions:[new xE('pi_after_target',true)]));aD.add(new sB('PI_CLOSE',new GD.RY('?>'),conditions:[new xE('in_pi',true)],changes:[new rD('in_pi',false),new rD('pi_after_target',false)]));aD.add(new sB('TAG_END_OPEN',new GD.RY('</'),changes:[new rD('in_tag',true)]));aD.add(new sB('TAG_START_OPEN',new mC('<'),changes:[new rD('in_tag',true)]));aD.add(new sB('TAG_CLOSE',new mC('>'),conditions:[v],changes:[new rD('in_tag',false)]));aD.add(new sB('TAG_EMPTY_CLOSE',new GD.RY('/>'),conditions:[v],changes:[new rD('in_tag',false)]));aD.add(new sB('ATTR_EQ',new mC('='),conditions:[v]));sB FB=new sB('ENTITY_REF',new GD([new mC('&'),new OE.ZY(new aG([new mC('#'),new mC.WY(),new mC.YY()])),new mC(';')]),action:(MC g){String h=g.DE;h=h.substring(1,h.length-1);if(h.startsWith('#')){int KB;if(h[1]=='x'){h=h.substring(2);KB=int.parse(h,radix:16);}else{h=h.substring(1);KB=int.parse(h);}String k=new String.fromCharCode(KB);g.DE=new String.fromCharCode(KB);}else{String k=null;if(h=='amp')k='&';else if(h=='lt')k='<';else if(h=='gt')k='>';else if(h=='apos')k="'";else if(h=='quot')k='"';if(k!=null){g.DE=k;}else{}}});aD.add(FB);aD.add(new sB('ATTR_VALUE',new aG([new GD([new mC('"'),new OE.XY(new aG([new mC.aY(['"','&','<']),FB])),new mC('"')]),new GD([new mC("'"),new OE.XY(new aG([new mC.aY(["'",'&','<']),FB])),new mC("'")])]),conditions:[v]));aD.add(new sB('PCDATA',new OE.ZY(new mC.aY(['<','&'])),conditions:[new xE('in_tag',false)]));aD.add(new sB('GENERIC_ID',new GD([eM,new OE.XY(KD)]),conditions:[v]));aD.add(new sB('WHITE',new aG([new mC(' '),new mC('\n'),new mC('\r'),new mC('\t')]),conditions:[v],ignore:true));iF=new List<sB>();sB QB=new sB('ATTRIBUTE',new GD([new xC('GENERIC_ID'),new xC('ATTR_EQ'),new xC('ATTR_VALUE')]),action:(MC g){String m=g.fC[0].DE;String bB=g.fC[2].DE;bB=bB.substring(1,bB.length-1);oC j=new BK.bY(rE,null,m);j.value=bB;g.data=j;});iF.add(new sB('DOC_DECL',new GD([new xC('DOC_DECL_OPEN'),new OE.XY(QB),new xC('DOC_DECL_CLOSE')]),action:(MC g){int wC=g.fC.length-2;if(wC>0){for(int i=1;i<g.fC.length-1;i++ ){Object h=g.fC[i].data;if(h is oC){oC j=h;if(j.name=='version')rE.UG=j.value;else if(j.name=='encoding'){rE.yF=j.value;rE.hO=j.value;}}}}}));iF.add(new sB('DOCTYPE',new GD([new xC('DOCTYPE_OPEN'),new OE.ZY(new aG([new xC('GENERIC_ID'),new xC('ATTR_VALUE')])),new xC('DOCTYPE_CLOSE')]),action:(MC g){String m=g.fC[1].DE;String SB=null;String DB=null;for(int i=2;i<g.fC.length-1;i++ ){if(g.fC[i].id=='GENERIC_ID'&&g.fC[i].DE=='PUBLIC'&&i<g.fC.length-2&&g.fC[i+1].id=='ATTR_VALUE'){SB=g.fC[i+1].DE;SB=SB.substring(1,DB.length-1);}else if(g.fC[i].id=='GENERIC_ID'&&g.fC[i].DE=='SYSTEM'&&i<g.fC.length-2&&g.fC[i+1].id=='ATTR_VALUE'){DB=g.fC[i+1].DE;DB=DB.substring(1,DB.length-1);}}fH YE=new DQ(m,SB,DB);YE.ownerDocument=rE;g.data=YE;}));iF.add(new sB('OUTSIDE_ROOT',new xC('PCDATA'),ignore:true));sB HF=new sB('START_TAG',new GD([new xC('TAG_START_OPEN'),new xC('GENERIC_ID'),new OE.XY(QB),new xC('TAG_CLOSE')]));sB VG=new sB('END_TAG',new GD([new xC('TAG_END_OPEN'),new xC('GENERIC_ID'),new xC('TAG_CLOSE')]));sB KI=new sB('EMPTY_ELEMENT',new GD([new xC('TAG_START_OPEN'),new xC('GENERIC_ID'),new OE.XY(QB),new xC('TAG_EMPTY_CLOSE')]));sB jJ=new sB('COMMENT',new GD([new xC('COMMENT_OPEN'),new OE.UY(new xC('COMMENT_DATA')),new xC('COMMENT_CLOSE')]),action:(MC g){String h;if(g.fC.length==3)h=g.fC[1].DE;else h='';g.data=new TN(rE,h);});sB kJ=new sB('ENTITY_REF',new GD([new xC('ENTITY_REF')]),action:(MC g){String h=g.fC[0].DE;if(h.startsWith('&')&&h.length>1){h=h.substring(1,h.length-1);VN FB=new VN(rE,h);g.data=FB;}else{g.data=new hL(rE,h);}});sB FL=new sB('CDATA',new GD([new xC('CDATA_SECTION_OPEN'),new OE.UY(new xC('CDATA_SECTION_DATA')),new xC('CDATA_SECTION_CLOSE')]),action:(MC g){String h;if(g.fC.length==3)h=g.fC[1].DE;else h='';g.data=new UN(rE,h);});sB TS=new sB('PI',new GD([new xC('PI_OPEN'),new xC('PI_TARGET'),new OE.UY(new xC('PI_DATA')),new xC('PI_CLOSE')]),action:(MC g){String XW=g.fC[1].DE;String h;if(g.fC.length==4)h=g.fC[2].DE.replaceAll(new RegExp(r"^\s+"),'');else h='';g.data=new SN(rE,XW,h);});sB yB=new sB('ELEMENT',null,action:(MC g){bool fM=(g.fC[0].id=='EMPTY_ELEMENT');MC jB=g.fC[0];String m=jB.fC[1].DE;if(!fM){MC YW=g.fC[g.fC.length-1];String US=YW.fC[1].DE;if(US!=m)throw new Exception("End tag not matching start tag: ${US} != ${m}");}l t=new bG.cY(rE,null,m);int wC=jB.fC.length-3;if(wC>0){for(int i=2;i<jB.fC.length-1;i++ ){Object h=jB.fC[i].data;if(h is oC)t.HS(h);}}if(!fM){int ZW=g.fC.length-2;if(ZW>0){for(int i=1;i<g.fC.length-1;i++ ){MC HC=g.fC[i];if(HC.id=='PCDATA'){zJ aW=new hL(rE,HC.DE);t.mB(aW);}else{Object h=HC.data;if(h is BB)t.mB(h);}}for(BB o=t.firstChild;o!=null;o=o.nextSibling){if(o.nodeType==BB.nF){BB HB=o.nextSibling;while(HB!=null&&HB.nodeType==BB.nF){o.nodeValue+= HB.nodeValue;t.CD(HB);HB=o.nextSibling;}}}}}g.data=t;});yB.content=new aG([new GD([HF,new OE.XY(new aG([yB,jJ,new xC('PCDATA'),kJ,FL,TS])),VG]),KI]);iF.add(yB);iF.add(QB);iF.add(HF);iF.add(VG);iF.add(KI);iF.add(jJ);iF.add(kJ);iF.add(FL);iF.add(TS);}AC yO(String h){h=h.replaceAll('\r\n','\n');hH k=new AK();rE=new RN(k,null,null,null);FK i=new FK(aD);List<MC> j=i.yO(h);i=new FK(iF);j=i.lV(j);for(MC m in j){Object g=m.data;if(g is fH)rE.jK=g;else if(g is BB)rE.mB(g);}if(rE.documentElement!=null)wc(rE.documentElement);return (rE);}void wc(l g){if(g.attributes!=null){for(oC i in g.attributes.values){if(i.name=='xmlns'||(i.EC=='xmlns'&&i.localName==g.EC)){g.tB=i.value;break;}}}if(g.tB==null&&g.parentNode!=null)g.tB=g.parentNode.bD(g.EC);for(BB h=g.firstChild;h!=null;h=h.nextSibling){if(h is l)wc(h as l);}}}abstract class eL extends BB{String target;String data;}class SN extends GG implements eL{String target;String data;SN(final AC i,final String g,final String h){this.target=g;this.data=h;nodeName=g;nodeValue=h;nodeType=BB.DK;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=i;tB=null;EC=null;localName=null;}String toString(){return ("<?${target} ${data}?>");}}abstract class zJ extends BB{}class hL extends GG implements zJ{hL(final AC g,final String h){nodeName="#text";nodeValue=h;nodeType=BB.nF;parentNode=null;childNodes=null;firstChild=null;lastChild=null;previousSibling=null;nextSibling=null;attributes=null;ownerDocument=g;tB=null;EC=null;localName=null;}String toString(){return (GG.NQ(nodeValue));}}